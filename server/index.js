#!/usr/bin/env node
"use strict";var zy=Object.create;var Pi=Object.defineProperty;var Py=Object.getOwnPropertyDescriptor;var Ey=Object.getOwnPropertyNames;var Iy=Object.getPrototypeOf,Cy=Object.prototype.hasOwnProperty;var z=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ei=(t,e)=>{for(var r in e)Pi(t,r,{get:e[r],enumerable:!0})},Ry=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Ey(e))!Cy.call(t,o)&&o!==r&&Pi(t,o,{get:()=>e[o],enumerable:!(n=Py(e,o))||n.enumerable});return t};var Io=(t,e,r)=>(r=t!=null?zy(Iy(t)):{},Ry(e||!t||!t.__esModule?Pi(r,"default",{value:t,enumerable:!0}):r,t));var Qn=z(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.regexpCode=Q.getEsmExportName=Q.getProperty=Q.safeStringify=Q.stringify=Q.strConcat=Q.addCodeArg=Q.str=Q._=Q.nil=Q._Code=Q.Name=Q.IDENTIFIER=Q._CodeOrName=void 0;var Xn=class{};Q._CodeOrName=Xn;Q.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var zr=class extends Xn{constructor(e){if(super(),!Q.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};Q.Name=zr;var rt=class extends Xn{constructor(e){super(),this._items=typeof e=="string"?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let e=this._items[0];return e===""||e==='""'}get str(){var e;return(e=this._str)!==null&&e!==void 0?e:this._str=this._items.reduce((r,n)=>`${r}${n}`,"")}get names(){var e;return(e=this._names)!==null&&e!==void 0?e:this._names=this._items.reduce((r,n)=>(n instanceof zr&&(r[n.str]=(r[n.str]||0)+1),r),{})}};Q._Code=rt;Q.nil=new rt("");function cm(t,...e){let r=[t[0]],n=0;for(;n<e.length;)fu(r,e[n]),r.push(t[++n]);return new rt(r)}Q._=cm;var pu=new rt("+");function um(t,...e){let r=[Yn(t[0])],n=0;for(;n<e.length;)r.push(pu),fu(r,e[n]),r.push(pu,Yn(t[++n]));return E$(r),new rt(r)}Q.str=um;function fu(t,e){e instanceof rt?t.push(...e._items):e instanceof zr?t.push(e):t.push(R$(e))}Q.addCodeArg=fu;function E$(t){let e=1;for(;e<t.length-1;){if(t[e]===pu){let r=I$(t[e-1],t[e+1]);if(r!==void 0){t.splice(e-1,3,r);continue}t[e++]="+"}e++}}function I$(t,e){if(e==='""')return t;if(t==='""')return e;if(typeof t=="string")return e instanceof zr||t[t.length-1]!=='"'?void 0:typeof e!="string"?`${t.slice(0,-1)}${e}"`:e[0]==='"'?t.slice(0,-1)+e.slice(1):void 0;if(typeof e=="string"&&e[0]==='"'&&!(t instanceof zr))return`"${t}${e.slice(1)}`}function C$(t,e){return e.emptyStr()?t:t.emptyStr()?e:um`${t}${e}`}Q.strConcat=C$;function R$(t){return typeof t=="number"||typeof t=="boolean"||t===null?t:Yn(Array.isArray(t)?t.join(","):t)}function j$(t){return new rt(Yn(t))}Q.stringify=j$;function Yn(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}Q.safeStringify=Yn;function O$(t){return typeof t=="string"&&Q.IDENTIFIER.test(t)?new rt(`.${t}`):cm`[${t}]`}Q.getProperty=O$;function N$(t){if(typeof t=="string"&&Q.IDENTIFIER.test(t))return new rt(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)}Q.getEsmExportName=N$;function A$(t){return new rt(t.toString())}Q.regexpCode=A$});var gu=z(Ke=>{"use strict";Object.defineProperty(Ke,"__esModule",{value:!0});Ke.ValueScope=Ke.ValueScopeName=Ke.Scope=Ke.varKinds=Ke.UsedValueState=void 0;var Ve=Qn(),mu=class extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}},Rs;(function(t){t[t.Started=0]="Started",t[t.Completed=1]="Completed"})(Rs||(Ke.UsedValueState=Rs={}));Ke.varKinds={const:new Ve.Name("const"),let:new Ve.Name("let"),var:new Ve.Name("var")};var js=class{constructor({prefixes:e,parent:r}={}){this._names={},this._prefixes=e,this._parent=r}toName(e){return e instanceof Ve.Name?e:this.name(e)}name(e){return new Ve.Name(this._newName(e))}_newName(e){let r=this._names[e]||this._nameGroup(e);return`${e}${r.index++}`}_nameGroup(e){var r,n;if(!((n=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||n===void 0)&&n.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}};Ke.Scope=js;var Os=class extends Ve.Name{constructor(e,r){super(r),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=(0,Ve._)`.${new Ve.Name(r)}[${n}]`}};Ke.ValueScopeName=Os;var Z$=(0,Ve._)`\n`,hu=class extends js{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?Z$:Ve.nil}}get(){return this._scope}name(e){return new Os(e,this._newName(e))}value(e,r){var n;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let o=this.toName(e),{prefix:s}=o,i=(n=r.key)!==null&&n!==void 0?n:r.ref,a=this._values[s];if(a){let l=a.get(i);if(l)return l}else a=this._values[s]=new Map;a.set(i,o);let c=this._scope[s]||(this._scope[s]=[]),u=c.length;return c[u]=r.ref,o.setValue(r,{property:s,itemIndex:u}),o}getValue(e,r){let n=this._values[e];if(n)return n.get(r)}scopeRefs(e,r=this._values){return this._reduceValues(r,n=>{if(n.scopePath===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return(0,Ve._)`${e}${n.scopePath}`})}scopeCode(e=this._values,r,n){return this._reduceValues(e,o=>{if(o.value===void 0)throw new Error(`CodeGen: name "${o}" has no value`);return o.value.code},r,n)}_reduceValues(e,r,n={},o){let s=Ve.nil;for(let i in e){let a=e[i];if(!a)continue;let c=n[i]=n[i]||new Map;a.forEach(u=>{if(c.has(u))return;c.set(u,Rs.Started);let l=r(u);if(l){let d=this.opts.es5?Ke.varKinds.var:Ke.varKinds.const;s=(0,Ve._)`${s}${d} ${u} = ${l};${this.opts._n}`}else if(l=o?.(u))s=(0,Ve._)`${s}${l}${this.opts._n}`;else throw new mu(u);c.set(u,Rs.Completed)})}return s}};Ke.ValueScope=hu});var V=z(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.or=K.and=K.not=K.CodeGen=K.operators=K.varKinds=K.ValueScopeName=K.ValueScope=K.Scope=K.Name=K.regexpCode=K.stringify=K.getProperty=K.nil=K.strConcat=K.str=K._=void 0;var X=Qn(),dt=gu(),Gt=Qn();Object.defineProperty(K,"_",{enumerable:!0,get:function(){return Gt._}});Object.defineProperty(K,"str",{enumerable:!0,get:function(){return Gt.str}});Object.defineProperty(K,"strConcat",{enumerable:!0,get:function(){return Gt.strConcat}});Object.defineProperty(K,"nil",{enumerable:!0,get:function(){return Gt.nil}});Object.defineProperty(K,"getProperty",{enumerable:!0,get:function(){return Gt.getProperty}});Object.defineProperty(K,"stringify",{enumerable:!0,get:function(){return Gt.stringify}});Object.defineProperty(K,"regexpCode",{enumerable:!0,get:function(){return Gt.regexpCode}});Object.defineProperty(K,"Name",{enumerable:!0,get:function(){return Gt.Name}});var Ms=gu();Object.defineProperty(K,"Scope",{enumerable:!0,get:function(){return Ms.Scope}});Object.defineProperty(K,"ValueScope",{enumerable:!0,get:function(){return Ms.ValueScope}});Object.defineProperty(K,"ValueScopeName",{enumerable:!0,get:function(){return Ms.ValueScopeName}});Object.defineProperty(K,"varKinds",{enumerable:!0,get:function(){return Ms.varKinds}});K.operators={GT:new X._Code(">"),GTE:new X._Code(">="),LT:new X._Code("<"),LTE:new X._Code("<="),EQ:new X._Code("==="),NEQ:new X._Code("!=="),NOT:new X._Code("!"),OR:new X._Code("||"),AND:new X._Code("&&"),ADD:new X._Code("+")};var Ct=class{optimizeNodes(){return this}optimizeNames(e,r){return this}},yu=class extends Ct{constructor(e,r,n){super(),this.varKind=e,this.name=r,this.rhs=n}render({es5:e,_n:r}){let n=e?dt.varKinds.var:this.varKind,o=this.rhs===void 0?"":` = ${this.rhs}`;return`${n} ${this.name}${o};`+r}optimizeNames(e,r){if(e[this.name.str])return this.rhs&&(this.rhs=nn(this.rhs,e,r)),this}get names(){return this.rhs instanceof X._CodeOrName?this.rhs.names:{}}},Ns=class extends Ct{constructor(e,r,n){super(),this.lhs=e,this.rhs=r,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof X.Name&&!e[this.lhs.str]&&!this.sideEffects))return this.rhs=nn(this.rhs,e,r),this}get names(){let e=this.lhs instanceof X.Name?{}:{...this.lhs.names};return Zs(e,this.rhs)}},_u=class extends Ns{constructor(e,r,n,o){super(e,n,o),this.op=r}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}},vu=class extends Ct{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}},xu=class extends Ct{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}},bu=class extends Ct{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}},$u=class extends Ct{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,r){return this.code=nn(this.code,e,r),this}get names(){return this.code instanceof X._CodeOrName?this.code.names:{}}},eo=class extends Ct{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((r,n)=>r+n.render(e),"")}optimizeNodes(){let{nodes:e}=this,r=e.length;for(;r--;){let n=e[r].optimizeNodes();Array.isArray(n)?e.splice(r,1,...n):n?e[r]=n:e.splice(r,1)}return e.length>0?this:void 0}optimizeNames(e,r){let{nodes:n}=this,o=n.length;for(;o--;){let s=n[o];s.optimizeNames(e,r)||(M$(e,s.names),n.splice(o,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,r)=>Ir(e,r.names),{})}},Rt=class extends eo{render(e){return"{"+e._n+super.render(e)+"}"+e._n}},wu=class extends eo{},rn=class extends Rt{};rn.kind="else";var Pr=class t extends Rt{constructor(e,r){super(r),this.condition=e}render(e){let r=`if(${this.condition})`+super.render(e);return this.else&&(r+="else "+this.else.render(e)),r}optimizeNodes(){super.optimizeNodes();let e=this.condition;if(e===!0)return this.nodes;let r=this.else;if(r){let n=r.optimizeNodes();r=this.else=Array.isArray(n)?new rn(n):n}if(r)return e===!1?r instanceof t?r:r.nodes:this.nodes.length?this:new t(lm(e),r instanceof t?[r]:r.nodes);if(!(e===!1||!this.nodes.length))return this}optimizeNames(e,r){var n;if(this.else=(n=this.else)===null||n===void 0?void 0:n.optimizeNames(e,r),!!(super.optimizeNames(e,r)||this.else))return this.condition=nn(this.condition,e,r),this}get names(){let e=super.names;return Zs(e,this.condition),this.else&&Ir(e,this.else.names),e}};Pr.kind="if";var Er=class extends Rt{};Er.kind="for";var ku=class extends Er{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iteration=nn(this.iteration,e,r),this}get names(){return Ir(super.names,this.iteration.names)}},Su=class extends Er{constructor(e,r,n,o){super(),this.varKind=e,this.name=r,this.from=n,this.to=o}render(e){let r=e.es5?dt.varKinds.var:this.varKind,{name:n,from:o,to:s}=this;return`for(${r} ${n}=${o}; ${n}<${s}; ${n}++)`+super.render(e)}get names(){let e=Zs(super.names,this.from);return Zs(e,this.to)}},As=class extends Er{constructor(e,r,n,o){super(),this.loop=e,this.varKind=r,this.name=n,this.iterable=o}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iterable=nn(this.iterable,e,r),this}get names(){return Ir(super.names,this.iterable.names)}},to=class extends Rt{constructor(e,r,n){super(),this.name=e,this.args=r,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}};to.kind="func";var ro=class extends eo{render(e){return"return "+super.render(e)}};ro.kind="return";var Tu=class extends Rt{render(e){let r="try"+super.render(e);return this.catch&&(r+=this.catch.render(e)),this.finally&&(r+=this.finally.render(e)),r}optimizeNodes(){var e,r;return super.optimizeNodes(),(e=this.catch)===null||e===void 0||e.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(e,r){var n,o;return super.optimizeNames(e,r),(n=this.catch)===null||n===void 0||n.optimizeNames(e,r),(o=this.finally)===null||o===void 0||o.optimizeNames(e,r),this}get names(){let e=super.names;return this.catch&&Ir(e,this.catch.names),this.finally&&Ir(e,this.finally.names),e}},no=class extends Rt{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}};no.kind="catch";var oo=class extends Rt{render(e){return"finally"+super.render(e)}};oo.kind="finally";var zu=class{constructor(e,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=e,this._scope=new dt.Scope({parent:e}),this._nodes=[new wu]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,r){let n=this._extScope.value(e,r);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,r){return this._extScope.getValue(e,r)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,r,n,o){let s=this._scope.toName(r);return n!==void 0&&o&&(this._constants[s.str]=n),this._leafNode(new yu(e,s,n)),s}const(e,r,n){return this._def(dt.varKinds.const,e,r,n)}let(e,r,n){return this._def(dt.varKinds.let,e,r,n)}var(e,r,n){return this._def(dt.varKinds.var,e,r,n)}assign(e,r,n){return this._leafNode(new Ns(e,r,n))}add(e,r){return this._leafNode(new _u(e,K.operators.ADD,r))}code(e){return typeof e=="function"?e():e!==X.nil&&this._leafNode(new $u(e)),this}object(...e){let r=["{"];for(let[n,o]of e)r.length>1&&r.push(","),r.push(n),(n!==o||this.opts.es5)&&(r.push(":"),(0,X.addCodeArg)(r,o));return r.push("}"),new X._Code(r)}if(e,r,n){if(this._blockNode(new Pr(e)),r&&n)this.code(r).else().code(n).endIf();else if(r)this.code(r).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new Pr(e))}else(){return this._elseNode(new rn)}endIf(){return this._endBlockNode(Pr,rn)}_for(e,r){return this._blockNode(e),r&&this.code(r).endFor(),this}for(e,r){return this._for(new ku(e),r)}forRange(e,r,n,o,s=this.opts.es5?dt.varKinds.var:dt.varKinds.let){let i=this._scope.toName(e);return this._for(new Su(s,i,r,n),()=>o(i))}forOf(e,r,n,o=dt.varKinds.const){let s=this._scope.toName(e);if(this.opts.es5){let i=r instanceof X.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,X._)`${i}.length`,a=>{this.var(s,(0,X._)`${i}[${a}]`),n(s)})}return this._for(new As("of",o,s,r),()=>n(s))}forIn(e,r,n,o=this.opts.es5?dt.varKinds.var:dt.varKinds.const){if(this.opts.ownProperties)return this.forOf(e,(0,X._)`Object.keys(${r})`,n);let s=this._scope.toName(e);return this._for(new As("in",o,s,r),()=>n(s))}endFor(){return this._endBlockNode(Er)}label(e){return this._leafNode(new vu(e))}break(e){return this._leafNode(new xu(e))}return(e){let r=new ro;if(this._blockNode(r),this.code(e),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(ro)}try(e,r,n){if(!r&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');let o=new Tu;if(this._blockNode(o),this.code(e),r){let s=this.name("e");this._currNode=o.catch=new no(s),r(s)}return n&&(this._currNode=o.finally=new oo,this.code(n)),this._endBlockNode(no,oo)}throw(e){return this._leafNode(new bu(e))}block(e,r){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(r),this}endBlock(e){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let n=this._nodes.length-r;if(n<0||e!==void 0&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=r,this}func(e,r=X.nil,n,o){return this._blockNode(new to(e,r,n)),o&&this.code(o).endFunc(),this}endFunc(){return this._endBlockNode(to)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,r){let n=this._currNode;if(n instanceof e||r&&n instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${e.kind}/${r.kind}`:e.kind}"`)}_elseNode(e){let r=this._currNode;if(!(r instanceof Pr))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=e,this}get _root(){return this._nodes[0]}get _currNode(){let e=this._nodes;return e[e.length-1]}set _currNode(e){let r=this._nodes;r[r.length-1]=e}};K.CodeGen=zu;function Ir(t,e){for(let r in e)t[r]=(t[r]||0)+(e[r]||0);return t}function Zs(t,e){return e instanceof X._CodeOrName?Ir(t,e.names):t}function nn(t,e,r){if(t instanceof X.Name)return n(t);if(!o(t))return t;return new X._Code(t._items.reduce((s,i)=>(i instanceof X.Name&&(i=n(i)),i instanceof X._Code?s.push(...i._items):s.push(i),s),[]));function n(s){let i=r[s.str];return i===void 0||e[s.str]!==1?s:(delete e[s.str],i)}function o(s){return s instanceof X._Code&&s._items.some(i=>i instanceof X.Name&&e[i.str]===1&&r[i.str]!==void 0)}}function M$(t,e){for(let r in e)t[r]=(t[r]||0)-(e[r]||0)}function lm(t){return typeof t=="boolean"||typeof t=="number"||t===null?!t:(0,X._)`!${Pu(t)}`}K.not=lm;var D$=dm(K.operators.AND);function q$(...t){return t.reduce(D$)}K.and=q$;var L$=dm(K.operators.OR);function U$(...t){return t.reduce(L$)}K.or=U$;function dm(t){return(e,r)=>e===X.nil?r:r===X.nil?e:(0,X._)`${Pu(e)} ${t} ${Pu(r)}`}function Pu(t){return t instanceof X.Name?t:(0,X._)`(${t})`}});var ee=z(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.checkStrictMode=H.getErrorPath=H.Type=H.useFunc=H.setEvaluated=H.evaluatedPropsToName=H.mergeEvaluated=H.eachItem=H.unescapeJsonPointer=H.escapeJsonPointer=H.escapeFragment=H.unescapeFragment=H.schemaRefOrVal=H.schemaHasRulesButRef=H.schemaHasRules=H.checkUnknownRules=H.alwaysValidSchema=H.toHash=void 0;var se=V(),F$=Qn();function V$(t){let e={};for(let r of t)e[r]=!0;return e}H.toHash=V$;function K$(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:(mm(t,e),!hm(e,t.self.RULES.all))}H.alwaysValidSchema=K$;function mm(t,e=t.schema){let{opts:r,self:n}=t;if(!r.strictSchema||typeof e=="boolean")return;let o=n.RULES.keywords;for(let s in e)o[s]||_m(t,`unknown keyword: "${s}"`)}H.checkUnknownRules=mm;function hm(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(e[r])return!0;return!1}H.schemaHasRules=hm;function H$(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}H.schemaHasRulesButRef=H$;function B$({topSchemaRef:t,schemaPath:e},r,n,o){if(!o){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,se._)`${r}`}return(0,se._)`${t}${e}${(0,se.getProperty)(n)}`}H.schemaRefOrVal=B$;function J$(t){return gm(decodeURIComponent(t))}H.unescapeFragment=J$;function G$(t){return encodeURIComponent(Iu(t))}H.escapeFragment=G$;function Iu(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}H.escapeJsonPointer=Iu;function gm(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}H.unescapeJsonPointer=gm;function W$(t,e){if(Array.isArray(t))for(let r of t)e(r);else e(t)}H.eachItem=W$;function pm({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:n}){return(o,s,i,a)=>{let c=i===void 0?s:i instanceof se.Name?(s instanceof se.Name?t(o,s,i):e(o,s,i),i):s instanceof se.Name?(e(o,i,s),s):r(s,i);return a===se.Name&&!(c instanceof se.Name)?n(o,c):c}}H.mergeEvaluated={props:pm({mergeNames:(t,e,r)=>t.if((0,se._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,se._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,se._)`${r} || {}`).code((0,se._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,se._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,se._)`${r} || {}`),Cu(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:ym}),items:pm({mergeNames:(t,e,r)=>t.if((0,se._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,se._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,se._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,se._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function ym(t,e){if(e===!0)return t.var("props",!0);let r=t.var("props",(0,se._)`{}`);return e!==void 0&&Cu(t,r,e),r}H.evaluatedPropsToName=ym;function Cu(t,e,r){Object.keys(r).forEach(n=>t.assign((0,se._)`${e}${(0,se.getProperty)(n)}`,!0))}H.setEvaluated=Cu;var fm={};function X$(t,e){return t.scopeValue("func",{ref:e,code:fm[e.code]||(fm[e.code]=new F$._Code(e.code))})}H.useFunc=X$;var Eu;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(Eu||(H.Type=Eu={}));function Y$(t,e,r){if(t instanceof se.Name){let n=e===Eu.Num;return r?n?(0,se._)`"[" + ${t} + "]"`:(0,se._)`"['" + ${t} + "']"`:n?(0,se._)`"/" + ${t}`:(0,se._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,se.getProperty)(t).toString():"/"+Iu(t)}H.getErrorPath=Y$;function _m(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}H.checkStrictMode=_m});var jt=z(Ru=>{"use strict";Object.defineProperty(Ru,"__esModule",{value:!0});var Ce=V(),Q$={data:new Ce.Name("data"),valCxt:new Ce.Name("valCxt"),instancePath:new Ce.Name("instancePath"),parentData:new Ce.Name("parentData"),parentDataProperty:new Ce.Name("parentDataProperty"),rootData:new Ce.Name("rootData"),dynamicAnchors:new Ce.Name("dynamicAnchors"),vErrors:new Ce.Name("vErrors"),errors:new Ce.Name("errors"),this:new Ce.Name("this"),self:new Ce.Name("self"),scope:new Ce.Name("scope"),json:new Ce.Name("json"),jsonPos:new Ce.Name("jsonPos"),jsonLen:new Ce.Name("jsonLen"),jsonPart:new Ce.Name("jsonPart")};Ru.default=Q$});var so=z(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});Re.extendErrors=Re.resetErrorsCount=Re.reportExtraError=Re.reportError=Re.keyword$DataError=Re.keywordError=void 0;var Y=V(),Ds=ee(),Ze=jt();Re.keywordError={message:({keyword:t})=>(0,Y.str)`must pass "${t}" keyword validation`};Re.keyword$DataError={message:({keyword:t,schemaType:e})=>e?(0,Y.str)`"${t}" keyword must be ${e} ($data)`:(0,Y.str)`"${t}" keyword is invalid ($data)`};function ew(t,e=Re.keywordError,r,n){let{it:o}=t,{gen:s,compositeRule:i,allErrors:a}=o,c=bm(t,e,r);n??(i||a)?vm(s,c):xm(o,(0,Y._)`[${c}]`)}Re.reportError=ew;function tw(t,e=Re.keywordError,r){let{it:n}=t,{gen:o,compositeRule:s,allErrors:i}=n,a=bm(t,e,r);vm(o,a),s||i||xm(n,Ze.default.vErrors)}Re.reportExtraError=tw;function rw(t,e){t.assign(Ze.default.errors,e),t.if((0,Y._)`${Ze.default.vErrors} !== null`,()=>t.if(e,()=>t.assign((0,Y._)`${Ze.default.vErrors}.length`,e),()=>t.assign(Ze.default.vErrors,null)))}Re.resetErrorsCount=rw;function nw({gen:t,keyword:e,schemaValue:r,data:n,errsCount:o,it:s}){if(o===void 0)throw new Error("ajv implementation error");let i=t.name("err");t.forRange("i",o,Ze.default.errors,a=>{t.const(i,(0,Y._)`${Ze.default.vErrors}[${a}]`),t.if((0,Y._)`${i}.instancePath === undefined`,()=>t.assign((0,Y._)`${i}.instancePath`,(0,Y.strConcat)(Ze.default.instancePath,s.errorPath))),t.assign((0,Y._)`${i}.schemaPath`,(0,Y.str)`${s.errSchemaPath}/${e}`),s.opts.verbose&&(t.assign((0,Y._)`${i}.schema`,r),t.assign((0,Y._)`${i}.data`,n))})}Re.extendErrors=nw;function vm(t,e){let r=t.const("err",e);t.if((0,Y._)`${Ze.default.vErrors} === null`,()=>t.assign(Ze.default.vErrors,(0,Y._)`[${r}]`),(0,Y._)`${Ze.default.vErrors}.push(${r})`),t.code((0,Y._)`${Ze.default.errors}++`)}function xm(t,e){let{gen:r,validateName:n,schemaEnv:o}=t;o.$async?r.throw((0,Y._)`new ${t.ValidationError}(${e})`):(r.assign((0,Y._)`${n}.errors`,e),r.return(!1))}var Cr={keyword:new Y.Name("keyword"),schemaPath:new Y.Name("schemaPath"),params:new Y.Name("params"),propertyName:new Y.Name("propertyName"),message:new Y.Name("message"),schema:new Y.Name("schema"),parentSchema:new Y.Name("parentSchema")};function bm(t,e,r){let{createErrors:n}=t.it;return n===!1?(0,Y._)`{}`:ow(t,e,r)}function ow(t,e,r={}){let{gen:n,it:o}=t,s=[sw(o,r),iw(t,r)];return aw(t,e,s),n.object(...s)}function sw({errorPath:t},{instancePath:e}){let r=e?(0,Y.str)`${t}${(0,Ds.getErrorPath)(e,Ds.Type.Str)}`:t;return[Ze.default.instancePath,(0,Y.strConcat)(Ze.default.instancePath,r)]}function iw({keyword:t,it:{errSchemaPath:e}},{schemaPath:r,parentSchema:n}){let o=n?e:(0,Y.str)`${e}/${t}`;return r&&(o=(0,Y.str)`${o}${(0,Ds.getErrorPath)(r,Ds.Type.Str)}`),[Cr.schemaPath,o]}function aw(t,{params:e,message:r},n){let{keyword:o,data:s,schemaValue:i,it:a}=t,{opts:c,propertyName:u,topSchemaRef:l,schemaPath:d}=a;n.push([Cr.keyword,o],[Cr.params,typeof e=="function"?e(t):e||(0,Y._)`{}`]),c.messages&&n.push([Cr.message,typeof r=="function"?r(t):r]),c.verbose&&n.push([Cr.schema,i],[Cr.parentSchema,(0,Y._)`${l}${d}`],[Ze.default.data,s]),u&&n.push([Cr.propertyName,u])}});var wm=z(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});on.boolOrEmptySchema=on.topBoolOrEmptySchema=void 0;var cw=so(),uw=V(),lw=jt(),dw={message:"boolean schema is false"};function pw(t){let{gen:e,schema:r,validateName:n}=t;r===!1?$m(t,!1):typeof r=="object"&&r.$async===!0?e.return(lw.default.data):(e.assign((0,uw._)`${n}.errors`,null),e.return(!0))}on.topBoolOrEmptySchema=pw;function fw(t,e){let{gen:r,schema:n}=t;n===!1?(r.var(e,!1),$m(t)):r.var(e,!0)}on.boolOrEmptySchema=fw;function $m(t,e){let{gen:r,data:n}=t,o={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,cw.reportError)(o,dw,void 0,e)}});var ju=z(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});sn.getRules=sn.isJSONType=void 0;var mw=["string","number","integer","boolean","null","object","array"],hw=new Set(mw);function gw(t){return typeof t=="string"&&hw.has(t)}sn.isJSONType=gw;function yw(){let t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}sn.getRules=yw});var Ou=z(Wt=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.shouldUseRule=Wt.shouldUseGroup=Wt.schemaHasRulesForType=void 0;function _w({schema:t,self:e},r){let n=e.RULES.types[r];return n&&n!==!0&&km(t,n)}Wt.schemaHasRulesForType=_w;function km(t,e){return e.rules.some(r=>Sm(t,r))}Wt.shouldUseGroup=km;function Sm(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(n=>t[n]!==void 0))}Wt.shouldUseRule=Sm});var io=z(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.reportTypeError=je.checkDataTypes=je.checkDataType=je.coerceAndCheckDataType=je.getJSONTypes=je.getSchemaTypes=je.DataType=void 0;var vw=ju(),xw=Ou(),bw=so(),U=V(),Tm=ee(),an;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(an||(je.DataType=an={}));function $w(t){let e=zm(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}je.getSchemaTypes=$w;function zm(t){let e=Array.isArray(t)?t:t?[t]:[];if(e.every(vw.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}je.getJSONTypes=zm;function ww(t,e){let{gen:r,data:n,opts:o}=t,s=kw(e,o.coerceTypes),i=e.length>0&&!(s.length===0&&e.length===1&&(0,xw.schemaHasRulesForType)(t,e[0]));if(i){let a=Au(e,n,o.strictNumbers,an.Wrong);r.if(a,()=>{s.length?Sw(t,e,s):Zu(t)})}return i}je.coerceAndCheckDataType=ww;var Pm=new Set(["string","number","integer","boolean","null"]);function kw(t,e){return e?t.filter(r=>Pm.has(r)||e==="array"&&r==="array"):[]}function Sw(t,e,r){let{gen:n,data:o,opts:s}=t,i=n.let("dataType",(0,U._)`typeof ${o}`),a=n.let("coerced",(0,U._)`undefined`);s.coerceTypes==="array"&&n.if((0,U._)`${i} == 'object' && Array.isArray(${o}) && ${o}.length == 1`,()=>n.assign(o,(0,U._)`${o}[0]`).assign(i,(0,U._)`typeof ${o}`).if(Au(e,o,s.strictNumbers),()=>n.assign(a,o))),n.if((0,U._)`${a} !== undefined`);for(let u of r)(Pm.has(u)||u==="array"&&s.coerceTypes==="array")&&c(u);n.else(),Zu(t),n.endIf(),n.if((0,U._)`${a} !== undefined`,()=>{n.assign(o,a),Tw(t,a)});function c(u){switch(u){case"string":n.elseIf((0,U._)`${i} == "number" || ${i} == "boolean"`).assign(a,(0,U._)`"" + ${o}`).elseIf((0,U._)`${o} === null`).assign(a,(0,U._)`""`);return;case"number":n.elseIf((0,U._)`${i} == "boolean" || ${o} === null
              || (${i} == "string" && ${o} && ${o} == +${o})`).assign(a,(0,U._)`+${o}`);return;case"integer":n.elseIf((0,U._)`${i} === "boolean" || ${o} === null
              || (${i} === "string" && ${o} && ${o} == +${o} && !(${o} % 1))`).assign(a,(0,U._)`+${o}`);return;case"boolean":n.elseIf((0,U._)`${o} === "false" || ${o} === 0 || ${o} === null`).assign(a,!1).elseIf((0,U._)`${o} === "true" || ${o} === 1`).assign(a,!0);return;case"null":n.elseIf((0,U._)`${o} === "" || ${o} === 0 || ${o} === false`),n.assign(a,null);return;case"array":n.elseIf((0,U._)`${i} === "string" || ${i} === "number"
              || ${i} === "boolean" || ${o} === null`).assign(a,(0,U._)`[${o}]`)}}}function Tw({gen:t,parentData:e,parentDataProperty:r},n){t.if((0,U._)`${e} !== undefined`,()=>t.assign((0,U._)`${e}[${r}]`,n))}function Nu(t,e,r,n=an.Correct){let o=n===an.Correct?U.operators.EQ:U.operators.NEQ,s;switch(t){case"null":return(0,U._)`${e} ${o} null`;case"array":s=(0,U._)`Array.isArray(${e})`;break;case"object":s=(0,U._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":s=i((0,U._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":s=i();break;default:return(0,U._)`typeof ${e} ${o} ${t}`}return n===an.Correct?s:(0,U.not)(s);function i(a=U.nil){return(0,U.and)((0,U._)`typeof ${e} == "number"`,a,r?(0,U._)`isFinite(${e})`:U.nil)}}je.checkDataType=Nu;function Au(t,e,r,n){if(t.length===1)return Nu(t[0],e,r,n);let o,s=(0,Tm.toHash)(t);if(s.array&&s.object){let i=(0,U._)`typeof ${e} != "object"`;o=s.null?i:(0,U._)`!${e} || ${i}`,delete s.null,delete s.array,delete s.object}else o=U.nil;s.number&&delete s.integer;for(let i in s)o=(0,U.and)(o,Nu(i,e,r,n));return o}je.checkDataTypes=Au;var zw={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,U._)`{type: ${t}}`:(0,U._)`{type: ${e}}`};function Zu(t){let e=Pw(t);(0,bw.reportError)(e,zw)}je.reportTypeError=Zu;function Pw(t){let{gen:e,data:r,schema:n}=t,o=(0,Tm.schemaRefOrVal)(t,n,"type");return{gen:e,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:t}}});var Im=z(qs=>{"use strict";Object.defineProperty(qs,"__esModule",{value:!0});qs.assignDefaults=void 0;var cn=V(),Ew=ee();function Iw(t,e){let{properties:r,items:n}=t.schema;if(e==="object"&&r)for(let o in r)Em(t,o,r[o].default);else e==="array"&&Array.isArray(n)&&n.forEach((o,s)=>Em(t,s,o.default))}qs.assignDefaults=Iw;function Em(t,e,r){let{gen:n,compositeRule:o,data:s,opts:i}=t;if(r===void 0)return;let a=(0,cn._)`${s}${(0,cn.getProperty)(e)}`;if(o){(0,Ew.checkStrictMode)(t,`default is ignored for: ${a}`);return}let c=(0,cn._)`${a} === undefined`;i.useDefaults==="empty"&&(c=(0,cn._)`${c} || ${a} === null || ${a} === ""`),n.if(c,(0,cn._)`${a} = ${(0,cn.stringify)(r)}`)}});var nt=z(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.validateUnion=oe.validateArray=oe.usePattern=oe.callValidateCode=oe.schemaProperties=oe.allSchemaProperties=oe.noPropertyInData=oe.propertyInData=oe.isOwnProperty=oe.hasPropFunc=oe.reportMissingProp=oe.checkMissingProp=oe.checkReportMissingProp=void 0;var ue=V(),Mu=ee(),Xt=jt(),Cw=ee();function Rw(t,e){let{gen:r,data:n,it:o}=t;r.if(qu(r,n,e,o.opts.ownProperties),()=>{t.setParams({missingProperty:(0,ue._)`${e}`},!0),t.error()})}oe.checkReportMissingProp=Rw;function jw({gen:t,data:e,it:{opts:r}},n,o){return(0,ue.or)(...n.map(s=>(0,ue.and)(qu(t,e,s,r.ownProperties),(0,ue._)`${o} = ${s}`)))}oe.checkMissingProp=jw;function Ow(t,e){t.setParams({missingProperty:e},!0),t.error()}oe.reportMissingProp=Ow;function Cm(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,ue._)`Object.prototype.hasOwnProperty`})}oe.hasPropFunc=Cm;function Du(t,e,r){return(0,ue._)`${Cm(t)}.call(${e}, ${r})`}oe.isOwnProperty=Du;function Nw(t,e,r,n){let o=(0,ue._)`${e}${(0,ue.getProperty)(r)} !== undefined`;return n?(0,ue._)`${o} && ${Du(t,e,r)}`:o}oe.propertyInData=Nw;function qu(t,e,r,n){let o=(0,ue._)`${e}${(0,ue.getProperty)(r)} === undefined`;return n?(0,ue.or)(o,(0,ue.not)(Du(t,e,r))):o}oe.noPropertyInData=qu;function Rm(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}oe.allSchemaProperties=Rm;function Aw(t,e){return Rm(e).filter(r=>!(0,Mu.alwaysValidSchema)(t,e[r]))}oe.schemaProperties=Aw;function Zw({schemaCode:t,data:e,it:{gen:r,topSchemaRef:n,schemaPath:o,errorPath:s},it:i},a,c,u){let l=u?(0,ue._)`${t}, ${e}, ${n}${o}`:e,d=[[Xt.default.instancePath,(0,ue.strConcat)(Xt.default.instancePath,s)],[Xt.default.parentData,i.parentData],[Xt.default.parentDataProperty,i.parentDataProperty],[Xt.default.rootData,Xt.default.rootData]];i.opts.dynamicRef&&d.push([Xt.default.dynamicAnchors,Xt.default.dynamicAnchors]);let h=(0,ue._)`${l}, ${r.object(...d)}`;return c!==ue.nil?(0,ue._)`${a}.call(${c}, ${h})`:(0,ue._)`${a}(${h})`}oe.callValidateCode=Zw;var Mw=(0,ue._)`new RegExp`;function Dw({gen:t,it:{opts:e}},r){let n=e.unicodeRegExp?"u":"",{regExp:o}=e.code,s=o(r,n);return t.scopeValue("pattern",{key:s.toString(),ref:s,code:(0,ue._)`${o.code==="new RegExp"?Mw:(0,Cw.useFunc)(t,o)}(${r}, ${n})`})}oe.usePattern=Dw;function qw(t){let{gen:e,data:r,keyword:n,it:o}=t,s=e.name("valid");if(o.allErrors){let a=e.let("valid",!0);return i(()=>e.assign(a,!1)),a}return e.var(s,!0),i(()=>e.break()),s;function i(a){let c=e.const("len",(0,ue._)`${r}.length`);e.forRange("i",0,c,u=>{t.subschema({keyword:n,dataProp:u,dataPropType:Mu.Type.Num},s),e.if((0,ue.not)(s),a)})}}oe.validateArray=qw;function Lw(t){let{gen:e,schema:r,keyword:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(c=>(0,Mu.alwaysValidSchema)(o,c))&&!o.opts.unevaluated)return;let i=e.let("valid",!1),a=e.name("_valid");e.block(()=>r.forEach((c,u)=>{let l=t.subschema({keyword:n,schemaProp:u,compositeRule:!0},a);e.assign(i,(0,ue._)`${i} || ${a}`),t.mergeValidEvaluated(l,a)||e.if((0,ue.not)(i))})),t.result(i,()=>t.reset(),()=>t.error(!0))}oe.validateUnion=Lw});var Nm=z(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.validateKeywordUsage=xt.validSchemaType=xt.funcKeywordCode=xt.macroKeywordCode=void 0;var Me=V(),Rr=jt(),Uw=nt(),Fw=so();function Vw(t,e){let{gen:r,keyword:n,schema:o,parentSchema:s,it:i}=t,a=e.macro.call(i.self,o,s,i),c=Om(r,n,a);i.opts.validateSchema!==!1&&i.self.validateSchema(a,!0);let u=r.name("valid");t.subschema({schema:a,schemaPath:Me.nil,errSchemaPath:`${i.errSchemaPath}/${n}`,topSchemaRef:c,compositeRule:!0},u),t.pass(u,()=>t.error(!0))}xt.macroKeywordCode=Vw;function Kw(t,e){var r;let{gen:n,keyword:o,schema:s,parentSchema:i,$data:a,it:c}=t;Bw(c,e);let u=!a&&e.compile?e.compile.call(c.self,s,i,c):e.validate,l=Om(n,o,u),d=n.let("valid");t.block$data(d,h),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function h(){if(e.errors===!1)m(),e.modifying&&jm(t),g(()=>t.error());else{let v=e.async?f():p();e.modifying&&jm(t),g(()=>Hw(t,v))}}function f(){let v=n.let("ruleErrs",null);return n.try(()=>m((0,Me._)`await `),x=>n.assign(d,!1).if((0,Me._)`${x} instanceof ${c.ValidationError}`,()=>n.assign(v,(0,Me._)`${x}.errors`),()=>n.throw(x))),v}function p(){let v=(0,Me._)`${l}.errors`;return n.assign(v,null),m(Me.nil),v}function m(v=e.async?(0,Me._)`await `:Me.nil){let x=c.opts.passContext?Rr.default.this:Rr.default.self,b=!("compile"in e&&!a||e.schema===!1);n.assign(d,(0,Me._)`${v}${(0,Uw.callValidateCode)(t,l,x,b)}`,e.modifying)}function g(v){var x;n.if((0,Me.not)((x=e.valid)!==null&&x!==void 0?x:d),v)}}xt.funcKeywordCode=Kw;function jm(t){let{gen:e,data:r,it:n}=t;e.if(n.parentData,()=>e.assign(r,(0,Me._)`${n.parentData}[${n.parentDataProperty}]`))}function Hw(t,e){let{gen:r}=t;r.if((0,Me._)`Array.isArray(${e})`,()=>{r.assign(Rr.default.vErrors,(0,Me._)`${Rr.default.vErrors} === null ? ${e} : ${Rr.default.vErrors}.concat(${e})`).assign(Rr.default.errors,(0,Me._)`${Rr.default.vErrors}.length`),(0,Fw.extendErrors)(t)},()=>t.error())}function Bw({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function Om(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,Me.stringify)(r)})}function Jw(t,e,r=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(t):n==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==n||r&&typeof t>"u")}xt.validSchemaType=Jw;function Gw({schema:t,opts:e,self:r,errSchemaPath:n},o,s){if(Array.isArray(o.keyword)?!o.keyword.includes(s):o.keyword!==s)throw new Error("ajv implementation error");let i=o.dependencies;if(i?.some(a=>!Object.prototype.hasOwnProperty.call(t,a)))throw new Error(`parent schema must have dependencies of ${s}: ${i.join(",")}`);if(o.validateSchema&&!o.validateSchema(t[s])){let c=`keyword "${s}" value is invalid at path "${n}": `+r.errorsText(o.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(c);else throw new Error(c)}}xt.validateKeywordUsage=Gw});var Zm=z(Yt=>{"use strict";Object.defineProperty(Yt,"__esModule",{value:!0});Yt.extendSubschemaMode=Yt.extendSubschemaData=Yt.getSubschema=void 0;var bt=V(),Am=ee();function Ww(t,{keyword:e,schemaProp:r,schema:n,schemaPath:o,errSchemaPath:s,topSchemaRef:i}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){let a=t.schema[e];return r===void 0?{schema:a,schemaPath:(0,bt._)`${t.schemaPath}${(0,bt.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:a[r],schemaPath:(0,bt._)`${t.schemaPath}${(0,bt.getProperty)(e)}${(0,bt.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,Am.escapeFragment)(r)}`}}if(n!==void 0){if(o===void 0||s===void 0||i===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:o,topSchemaRef:i,errSchemaPath:s}}throw new Error('either "keyword" or "schema" must be passed')}Yt.getSubschema=Ww;function Xw(t,e,{dataProp:r,dataPropType:n,data:o,dataTypes:s,propertyName:i}){if(o!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=e;if(r!==void 0){let{errorPath:u,dataPathArr:l,opts:d}=e,h=a.let("data",(0,bt._)`${e.data}${(0,bt.getProperty)(r)}`,!0);c(h),t.errorPath=(0,bt.str)`${u}${(0,Am.getErrorPath)(r,n,d.jsPropertySyntax)}`,t.parentDataProperty=(0,bt._)`${r}`,t.dataPathArr=[...l,t.parentDataProperty]}if(o!==void 0){let u=o instanceof bt.Name?o:a.let("data",o,!0);c(u),i!==void 0&&(t.propertyName=i)}s&&(t.dataTypes=s);function c(u){t.data=u,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,u]}}Yt.extendSubschemaData=Xw;function Yw(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:n,createErrors:o,allErrors:s}){n!==void 0&&(t.compositeRule=n),o!==void 0&&(t.createErrors=o),s!==void 0&&(t.allErrors=s),t.jtdDiscriminator=e,t.jtdMetadata=r}Yt.extendSubschemaMode=Yw});var Lu=z((xj,Mm)=>{"use strict";Mm.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,o,s;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(o=n;o--!==0;)if(!t(e[o],r[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(r).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(r,s[o]))return!1;for(o=n;o--!==0;){var i=s[o];if(!t(e[i],r[i]))return!1}return!0}return e!==e&&r!==r}});var qm=z((bj,Dm)=>{"use strict";var Qt=Dm.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var n=typeof r=="function"?r:r.pre||function(){},o=r.post||function(){};Ls(e,n,o,t,"",t)};Qt.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};Qt.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};Qt.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};Qt.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function Ls(t,e,r,n,o,s,i,a,c,u){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,o,s,i,a,c,u);for(var l in n){var d=n[l];if(Array.isArray(d)){if(l in Qt.arrayKeywords)for(var h=0;h<d.length;h++)Ls(t,e,r,d[h],o+"/"+l+"/"+h,s,o,l,n,h)}else if(l in Qt.propsKeywords){if(d&&typeof d=="object")for(var f in d)Ls(t,e,r,d[f],o+"/"+l+"/"+Qw(f),s,o,l,n,f)}else(l in Qt.keywords||t.allKeys&&!(l in Qt.skipKeywords))&&Ls(t,e,r,d,o+"/"+l,s,o,l,n)}r(n,o,s,i,a,c,u)}}function Qw(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}});var ao=z(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.getSchemaRefs=He.resolveUrl=He.normalizeId=He._getFullPath=He.getFullPath=He.inlineRef=void 0;var e0=ee(),t0=Lu(),r0=qm(),n0=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function o0(t,e=!0){return typeof t=="boolean"?!0:e===!0?!Uu(t):e?Lm(t)<=e:!1}He.inlineRef=o0;var s0=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function Uu(t){for(let e in t){if(s0.has(e))return!0;let r=t[e];if(Array.isArray(r)&&r.some(Uu)||typeof r=="object"&&Uu(r))return!0}return!1}function Lm(t){let e=0;for(let r in t){if(r==="$ref")return 1/0;if(e++,!n0.has(r)&&(typeof t[r]=="object"&&(0,e0.eachItem)(t[r],n=>e+=Lm(n)),e===1/0))return 1/0}return e}function Um(t,e="",r){r!==!1&&(e=un(e));let n=t.parse(e);return Fm(t,n)}He.getFullPath=Um;function Fm(t,e){return t.serialize(e).split("#")[0]+"#"}He._getFullPath=Fm;var i0=/#\/?$/;function un(t){return t?t.replace(i0,""):""}He.normalizeId=un;function a0(t,e,r){return r=un(r),t.resolve(e,r)}He.resolveUrl=a0;var c0=/^[a-z_][-a-z0-9._]*$/i;function u0(t,e){if(typeof t=="boolean")return{};let{schemaId:r,uriResolver:n}=this.opts,o=un(t[r]||e),s={"":o},i=Um(n,o,!1),a={},c=new Set;return r0(t,{allKeys:!0},(d,h,f,p)=>{if(p===void 0)return;let m=i+h,g=s[p];typeof d[r]=="string"&&(g=v.call(this,d[r])),x.call(this,d.$anchor),x.call(this,d.$dynamicAnchor),s[h]=g;function v(b){let k=this.opts.uriResolver.resolve;if(b=un(g?k(g,b):b),c.has(b))throw l(b);c.add(b);let T=this.refs[b];return typeof T=="string"&&(T=this.refs[T]),typeof T=="object"?u(d,T.schema,b):b!==un(m)&&(b[0]==="#"?(u(d,a[b],b),a[b]=d):this.refs[b]=m),b}function x(b){if(typeof b=="string"){if(!c0.test(b))throw new Error(`invalid anchor "${b}"`);v.call(this,`#${b}`)}}}),a;function u(d,h,f){if(h!==void 0&&!t0(d,h))throw l(f)}function l(d){return new Error(`reference "${d}" resolves to more than one schema`)}}He.getSchemaRefs=u0});var lo=z(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.getData=er.KeywordCxt=er.validateFunctionCode=void 0;var Jm=wm(),Vm=io(),Vu=Ou(),Us=io(),l0=Im(),uo=Nm(),Fu=Zm(),j=V(),q=jt(),d0=ao(),Ot=ee(),co=so();function p0(t){if(Xm(t)&&(Ym(t),Wm(t))){h0(t);return}Gm(t,()=>(0,Jm.topBoolOrEmptySchema)(t))}er.validateFunctionCode=p0;function Gm({gen:t,validateName:e,schema:r,schemaEnv:n,opts:o},s){o.code.es5?t.func(e,(0,j._)`${q.default.data}, ${q.default.valCxt}`,n.$async,()=>{t.code((0,j._)`"use strict"; ${Km(r,o)}`),m0(t,o),t.code(s)}):t.func(e,(0,j._)`${q.default.data}, ${f0(o)}`,n.$async,()=>t.code(Km(r,o)).code(s))}function f0(t){return(0,j._)`{${q.default.instancePath}="", ${q.default.parentData}, ${q.default.parentDataProperty}, ${q.default.rootData}=${q.default.data}${t.dynamicRef?(0,j._)`, ${q.default.dynamicAnchors}={}`:j.nil}}={}`}function m0(t,e){t.if(q.default.valCxt,()=>{t.var(q.default.instancePath,(0,j._)`${q.default.valCxt}.${q.default.instancePath}`),t.var(q.default.parentData,(0,j._)`${q.default.valCxt}.${q.default.parentData}`),t.var(q.default.parentDataProperty,(0,j._)`${q.default.valCxt}.${q.default.parentDataProperty}`),t.var(q.default.rootData,(0,j._)`${q.default.valCxt}.${q.default.rootData}`),e.dynamicRef&&t.var(q.default.dynamicAnchors,(0,j._)`${q.default.valCxt}.${q.default.dynamicAnchors}`)},()=>{t.var(q.default.instancePath,(0,j._)`""`),t.var(q.default.parentData,(0,j._)`undefined`),t.var(q.default.parentDataProperty,(0,j._)`undefined`),t.var(q.default.rootData,q.default.data),e.dynamicRef&&t.var(q.default.dynamicAnchors,(0,j._)`{}`)})}function h0(t){let{schema:e,opts:r,gen:n}=t;Gm(t,()=>{r.$comment&&e.$comment&&eh(t),x0(t),n.let(q.default.vErrors,null),n.let(q.default.errors,0),r.unevaluated&&g0(t),Qm(t),w0(t)})}function g0(t){let{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,j._)`${r}.evaluated`),e.if((0,j._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,j._)`${t.evaluated}.props`,(0,j._)`undefined`)),e.if((0,j._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,j._)`${t.evaluated}.items`,(0,j._)`undefined`))}function Km(t,e){let r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,j._)`/*# sourceURL=${r} */`:j.nil}function y0(t,e){if(Xm(t)&&(Ym(t),Wm(t))){_0(t,e);return}(0,Jm.boolOrEmptySchema)(t,e)}function Wm({schema:t,self:e}){if(typeof t=="boolean")return!t;for(let r in t)if(e.RULES.all[r])return!0;return!1}function Xm(t){return typeof t.schema!="boolean"}function _0(t,e){let{schema:r,gen:n,opts:o}=t;o.$comment&&r.$comment&&eh(t),b0(t),$0(t);let s=n.const("_errs",q.default.errors);Qm(t,s),n.var(e,(0,j._)`${s} === ${q.default.errors}`)}function Ym(t){(0,Ot.checkUnknownRules)(t),v0(t)}function Qm(t,e){if(t.opts.jtd)return Hm(t,[],!1,e);let r=(0,Vm.getSchemaTypes)(t.schema),n=(0,Vm.coerceAndCheckDataType)(t,r);Hm(t,r,!n,e)}function v0(t){let{schema:e,errSchemaPath:r,opts:n,self:o}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,Ot.schemaHasRulesButRef)(e,o.RULES)&&o.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function x0(t){let{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,Ot.checkStrictMode)(t,"default is ignored in the schema root")}function b0(t){let e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,d0.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function $0(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function eh({gen:t,schemaEnv:e,schema:r,errSchemaPath:n,opts:o}){let s=r.$comment;if(o.$comment===!0)t.code((0,j._)`${q.default.self}.logger.log(${s})`);else if(typeof o.$comment=="function"){let i=(0,j.str)`${n}/$comment`,a=t.scopeValue("root",{ref:e.root});t.code((0,j._)`${q.default.self}.opts.$comment(${s}, ${i}, ${a}.schema)`)}}function w0(t){let{gen:e,schemaEnv:r,validateName:n,ValidationError:o,opts:s}=t;r.$async?e.if((0,j._)`${q.default.errors} === 0`,()=>e.return(q.default.data),()=>e.throw((0,j._)`new ${o}(${q.default.vErrors})`)):(e.assign((0,j._)`${n}.errors`,q.default.vErrors),s.unevaluated&&k0(t),e.return((0,j._)`${q.default.errors} === 0`))}function k0({gen:t,evaluated:e,props:r,items:n}){r instanceof j.Name&&t.assign((0,j._)`${e}.props`,r),n instanceof j.Name&&t.assign((0,j._)`${e}.items`,n)}function Hm(t,e,r,n){let{gen:o,schema:s,data:i,allErrors:a,opts:c,self:u}=t,{RULES:l}=u;if(s.$ref&&(c.ignoreKeywordsWithRef||!(0,Ot.schemaHasRulesButRef)(s,l))){o.block(()=>rh(t,"$ref",l.all.$ref.definition));return}c.jtd||S0(t,e),o.block(()=>{for(let h of l.rules)d(h);d(l.post)});function d(h){(0,Vu.shouldUseGroup)(s,h)&&(h.type?(o.if((0,Us.checkDataType)(h.type,i,c.strictNumbers)),Bm(t,h),e.length===1&&e[0]===h.type&&r&&(o.else(),(0,Us.reportTypeError)(t)),o.endIf()):Bm(t,h),a||o.if((0,j._)`${q.default.errors} === ${n||0}`))}}function Bm(t,e){let{gen:r,schema:n,opts:{useDefaults:o}}=t;o&&(0,l0.assignDefaults)(t,e.type),r.block(()=>{for(let s of e.rules)(0,Vu.shouldUseRule)(n,s)&&rh(t,s.keyword,s.definition,e.type)})}function S0(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(T0(t,e),t.opts.allowUnionTypes||z0(t,e),P0(t,t.dataTypes))}function T0(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{th(t.dataTypes,r)||Ku(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),I0(t,e)}}function z0(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&Ku(t,"use allowUnionTypes to allow union type keyword")}function P0(t,e){let r=t.self.RULES.all;for(let n in r){let o=r[n];if(typeof o=="object"&&(0,Vu.shouldUseRule)(t.schema,o)){let{type:s}=o.definition;s.length&&!s.some(i=>E0(e,i))&&Ku(t,`missing type "${s.join(",")}" for keyword "${n}"`)}}}function E0(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function th(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function I0(t,e){let r=[];for(let n of t.dataTypes)th(e,n)?r.push(n):e.includes("integer")&&n==="number"&&r.push("integer");t.dataTypes=r}function Ku(t,e){let r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,Ot.checkStrictMode)(t,e,t.opts.strictTypes)}var Fs=class{constructor(e,r,n){if((0,uo.validateKeywordUsage)(e,r,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Ot.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",nh(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,uo.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",q.default.errors))}result(e,r,n){this.failResult((0,j.not)(e),r,n)}failResult(e,r,n){this.gen.if(e),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,j.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:r}=this;this.fail((0,j._)`${r} !== undefined && (${(0,j.or)(this.invalid$data(),e)})`)}error(e,r,n){if(r){this.setParams(r),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,r){(e?co.reportExtraError:co.reportError)(this,this.def.error,r)}$dataError(){(0,co.reportError)(this,this.def.$dataError||co.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,co.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,n=j.nil){this.gen.block(()=>{this.check$data(e,n),r()})}check$data(e=j.nil,r=j.nil){if(!this.$data)return;let{gen:n,schemaCode:o,schemaType:s,def:i}=this;n.if((0,j.or)((0,j._)`${o} === undefined`,r)),e!==j.nil&&n.assign(e,!0),(s.length||i.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==j.nil&&n.assign(e,!1)),n.else()}invalid$data(){let{gen:e,schemaCode:r,schemaType:n,def:o,it:s}=this;return(0,j.or)(i(),a());function i(){if(n.length){if(!(r instanceof j.Name))throw new Error("ajv implementation error");let c=Array.isArray(n)?n:[n];return(0,j._)`${(0,Us.checkDataTypes)(c,r,s.opts.strictNumbers,Us.DataType.Wrong)}`}return j.nil}function a(){if(o.validateSchema){let c=e.scopeValue("validate$data",{ref:o.validateSchema});return(0,j._)`!${c}(${r})`}return j.nil}}subschema(e,r){let n=(0,Fu.getSubschema)(this.it,e);(0,Fu.extendSubschemaData)(n,this.it,e),(0,Fu.extendSubschemaMode)(n,e);let o={...this.it,...n,items:void 0,props:void 0};return y0(o,r),o}mergeEvaluated(e,r){let{it:n,gen:o}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=Ot.mergeEvaluated.props(o,e.props,n.props,r)),n.items!==!0&&e.items!==void 0&&(n.items=Ot.mergeEvaluated.items(o,e.items,n.items,r)))}mergeValidEvaluated(e,r){let{it:n,gen:o}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return o.if(r,()=>this.mergeEvaluated(e,j.Name)),!0}};er.KeywordCxt=Fs;function rh(t,e,r,n){let o=new Fs(t,r,e);"code"in r?r.code(o,n):o.$data&&r.validate?(0,uo.funcKeywordCode)(o,r):"macro"in r?(0,uo.macroKeywordCode)(o,r):(r.compile||r.validate)&&(0,uo.funcKeywordCode)(o,r)}var C0=/^\/(?:[^~]|~0|~1)*$/,R0=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function nh(t,{dataLevel:e,dataNames:r,dataPathArr:n}){let o,s;if(t==="")return q.default.rootData;if(t[0]==="/"){if(!C0.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);o=t,s=q.default.rootData}else{let u=R0.exec(t);if(!u)throw new Error(`Invalid JSON-pointer: ${t}`);let l=+u[1];if(o=u[2],o==="#"){if(l>=e)throw new Error(c("property/index",l));return n[e-l]}if(l>e)throw new Error(c("data",l));if(s=r[e-l],!o)return s}let i=s,a=o.split("/");for(let u of a)u&&(s=(0,j._)`${s}${(0,j.getProperty)((0,Ot.unescapeJsonPointer)(u))}`,i=(0,j._)`${i} && ${s}`);return i;function c(u,l){return`Cannot access ${u} ${l} levels up, current level is ${e}`}}er.getData=nh});var Vs=z(Bu=>{"use strict";Object.defineProperty(Bu,"__esModule",{value:!0});var Hu=class extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}};Bu.default=Hu});var po=z(Wu=>{"use strict";Object.defineProperty(Wu,"__esModule",{value:!0});var Ju=ao(),Gu=class extends Error{constructor(e,r,n,o){super(o||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,Ju.resolveUrl)(e,r,n),this.missingSchema=(0,Ju.normalizeId)((0,Ju.getFullPath)(e,this.missingRef))}};Wu.default=Gu});var Hs=z(ot=>{"use strict";Object.defineProperty(ot,"__esModule",{value:!0});ot.resolveSchema=ot.getCompilingSchema=ot.resolveRef=ot.compileSchema=ot.SchemaEnv=void 0;var pt=V(),j0=Vs(),jr=jt(),ft=ao(),oh=ee(),O0=lo(),ln=class{constructor(e){var r;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,ft.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}};ot.SchemaEnv=ln;function Yu(t){let e=sh.call(this,t);if(e)return e;let r=(0,ft.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:o}=this.opts.code,{ownProperties:s}=this.opts,i=new pt.CodeGen(this.scope,{es5:n,lines:o,ownProperties:s}),a;t.$async&&(a=i.scopeValue("Error",{ref:j0.default,code:(0,pt._)`require("ajv/dist/runtime/validation_error").default`}));let c=i.scopeName("validate");t.validateName=c;let u={gen:i,allErrors:this.opts.allErrors,data:jr.default.data,parentData:jr.default.parentData,parentDataProperty:jr.default.parentDataProperty,dataNames:[jr.default.data],dataPathArr:[pt.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:i.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,pt.stringify)(t.schema)}:{ref:t.schema}),validateName:c,ValidationError:a,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:pt.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,pt._)`""`,opts:this.opts,self:this},l;try{this._compilations.add(t),(0,O0.validateFunctionCode)(u),i.optimize(this.opts.code.optimize);let d=i.toString();l=`${i.scopeRefs(jr.default.scope)}return ${d}`,this.opts.code.process&&(l=this.opts.code.process(l,t));let f=new Function(`${jr.default.self}`,`${jr.default.scope}`,l)(this,this.scope.get());if(this.scope.value(c,{ref:f}),f.errors=null,f.schema=t.schema,f.schemaEnv=t,t.$async&&(f.$async=!0),this.opts.code.source===!0&&(f.source={validateName:c,validateCode:d,scopeValues:i._values}),this.opts.unevaluated){let{props:p,items:m}=u;f.evaluated={props:p instanceof pt.Name?void 0:p,items:m instanceof pt.Name?void 0:m,dynamicProps:p instanceof pt.Name,dynamicItems:m instanceof pt.Name},f.source&&(f.source.evaluated=(0,pt.stringify)(f.evaluated))}return t.validate=f,t}catch(d){throw delete t.validate,delete t.validateName,l&&this.logger.error("Error compiling schema, function code:",l),d}finally{this._compilations.delete(t)}}ot.compileSchema=Yu;function N0(t,e,r){var n;r=(0,ft.resolveUrl)(this.opts.uriResolver,e,r);let o=t.refs[r];if(o)return o;let s=M0.call(this,t,r);if(s===void 0){let i=(n=t.localRefs)===null||n===void 0?void 0:n[r],{schemaId:a}=this.opts;i&&(s=new ln({schema:i,schemaId:a,root:t,baseId:e}))}if(s!==void 0)return t.refs[r]=A0.call(this,s)}ot.resolveRef=N0;function A0(t){return(0,ft.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:Yu.call(this,t)}function sh(t){for(let e of this._compilations)if(Z0(e,t))return e}ot.getCompilingSchema=sh;function Z0(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function M0(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||Ks.call(this,t,e)}function Ks(t,e){let r=this.opts.uriResolver.parse(e),n=(0,ft._getFullPath)(this.opts.uriResolver,r),o=(0,ft.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===o)return Xu.call(this,r,t);let s=(0,ft.normalizeId)(n),i=this.refs[s]||this.schemas[s];if(typeof i=="string"){let a=Ks.call(this,t,i);return typeof a?.schema!="object"?void 0:Xu.call(this,r,a)}if(typeof i?.schema=="object"){if(i.validate||Yu.call(this,i),s===(0,ft.normalizeId)(e)){let{schema:a}=i,{schemaId:c}=this.opts,u=a[c];return u&&(o=(0,ft.resolveUrl)(this.opts.uriResolver,o,u)),new ln({schema:a,schemaId:c,root:t,baseId:o})}return Xu.call(this,r,i)}}ot.resolveSchema=Ks;var D0=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function Xu(t,{baseId:e,schema:r,root:n}){var o;if(((o=t.fragment)===null||o===void 0?void 0:o[0])!=="/")return;for(let a of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let c=r[(0,oh.unescapeFragment)(a)];if(c===void 0)return;r=c;let u=typeof r=="object"&&r[this.opts.schemaId];!D0.has(a)&&u&&(e=(0,ft.resolveUrl)(this.opts.uriResolver,e,u))}let s;if(typeof r!="boolean"&&r.$ref&&!(0,oh.schemaHasRulesButRef)(r,this.RULES)){let a=(0,ft.resolveUrl)(this.opts.uriResolver,e,r.$ref);s=Ks.call(this,n,a)}let{schemaId:i}=this.opts;if(s=s||new ln({schema:r,schemaId:i,root:n,baseId:e}),s.schema!==s.root.schema)return s}});var ih=z((zj,q0)=>{q0.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var el=z((Pj,lh)=>{"use strict";var L0=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),ch=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function Qu(t){let e="",r=0,n=0;for(n=0;n<t.length;n++)if(r=t[n].charCodeAt(0),r!==48){if(!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n];break}for(n+=1;n<t.length;n++){if(r=t[n].charCodeAt(0),!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n]}return e}var U0=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function ah(t){return t.length=0,!0}function F0(t,e,r){if(t.length){let n=Qu(t);if(n!=="")e.push(n);else return r.error=!0,!1;t.length=0}return!0}function V0(t){let e=0,r={error:!1,address:"",zone:""},n=[],o=[],s=!1,i=!1,a=F0;for(let c=0;c<t.length;c++){let u=t[c];if(!(u==="["||u==="]"))if(u===":"){if(s===!0&&(i=!0),!a(o,n,r))break;if(++e>7){r.error=!0;break}c>0&&t[c-1]===":"&&(s=!0),n.push(":");continue}else if(u==="%"){if(!a(o,n,r))break;a=ah}else{o.push(u);continue}}return o.length&&(a===ah?r.zone=o.join(""):i?n.push(o.join("")):n.push(Qu(o))),r.address=n.join(""),r}function uh(t){if(K0(t,":")<2)return{host:t,isIPV6:!1};let e=V0(t);if(e.error)return{host:t,isIPV6:!1};{let r=e.address,n=e.address;return e.zone&&(r+="%"+e.zone,n+="%25"+e.zone),{host:r,isIPV6:!0,escapedHost:n}}}function K0(t,e){let r=0;for(let n=0;n<t.length;n++)t[n]===e&&r++;return r}function H0(t){let e=t,r=[],n=-1,o=0;for(;o=e.length;){if(o===1){if(e===".")break;if(e==="/"){r.push("/");break}else{r.push(e);break}}else if(o===2){if(e[0]==="."){if(e[1]===".")break;if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&(e[1]==="."||e[1]==="/")){r.push("/");break}}else if(o===3&&e==="/.."){r.length!==0&&r.pop(),r.push("/");break}if(e[0]==="."){if(e[1]==="."){if(e[2]==="/"){e=e.slice(3);continue}}else if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&e[1]==="."){if(e[2]==="/"){e=e.slice(2);continue}else if(e[2]==="."&&e[3]==="/"){e=e.slice(3),r.length!==0&&r.pop();continue}}if((n=e.indexOf("/",1))===-1){r.push(e);break}else r.push(e.slice(0,n)),e=e.slice(n)}return r.join("")}function B0(t,e){let r=e!==!0?escape:unescape;return t.scheme!==void 0&&(t.scheme=r(t.scheme)),t.userinfo!==void 0&&(t.userinfo=r(t.userinfo)),t.host!==void 0&&(t.host=r(t.host)),t.path!==void 0&&(t.path=r(t.path)),t.query!==void 0&&(t.query=r(t.query)),t.fragment!==void 0&&(t.fragment=r(t.fragment)),t}function J0(t){let e=[];if(t.userinfo!==void 0&&(e.push(t.userinfo),e.push("@")),t.host!==void 0){let r=unescape(t.host);if(!ch(r)){let n=uh(r);n.isIPV6===!0?r=`[${n.escapedHost}]`:r=t.host}e.push(r)}return(typeof t.port=="number"||typeof t.port=="string")&&(e.push(":"),e.push(String(t.port))),e.length?e.join(""):void 0}lh.exports={nonSimpleDomain:U0,recomposeAuthority:J0,normalizeComponentEncoding:B0,removeDotSegments:H0,isIPv4:ch,isUUID:L0,normalizeIPv6:uh,stringArrayToHexStripped:Qu}});var hh=z((Ej,mh)=>{"use strict";var{isUUID:G0}=el(),W0=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,X0=["http","https","ws","wss","urn","urn:uuid"];function Y0(t){return X0.indexOf(t)!==-1}function tl(t){return t.secure===!0?!0:t.secure===!1?!1:t.scheme?t.scheme.length===3&&(t.scheme[0]==="w"||t.scheme[0]==="W")&&(t.scheme[1]==="s"||t.scheme[1]==="S")&&(t.scheme[2]==="s"||t.scheme[2]==="S"):!1}function dh(t){return t.host||(t.error=t.error||"HTTP URIs must have a host."),t}function ph(t){let e=String(t.scheme).toLowerCase()==="https";return(t.port===(e?443:80)||t.port==="")&&(t.port=void 0),t.path||(t.path="/"),t}function Q0(t){return t.secure=tl(t),t.resourceName=(t.path||"/")+(t.query?"?"+t.query:""),t.path=void 0,t.query=void 0,t}function ek(t){if((t.port===(tl(t)?443:80)||t.port==="")&&(t.port=void 0),typeof t.secure=="boolean"&&(t.scheme=t.secure?"wss":"ws",t.secure=void 0),t.resourceName){let[e,r]=t.resourceName.split("?");t.path=e&&e!=="/"?e:void 0,t.query=r,t.resourceName=void 0}return t.fragment=void 0,t}function tk(t,e){if(!t.path)return t.error="URN can not be parsed",t;let r=t.path.match(W0);if(r){let n=e.scheme||t.scheme||"urn";t.nid=r[1].toLowerCase(),t.nss=r[2];let o=`${n}:${e.nid||t.nid}`,s=rl(o);t.path=void 0,s&&(t=s.parse(t,e))}else t.error=t.error||"URN can not be parsed.";return t}function rk(t,e){if(t.nid===void 0)throw new Error("URN without nid cannot be serialized");let r=e.scheme||t.scheme||"urn",n=t.nid.toLowerCase(),o=`${r}:${e.nid||n}`,s=rl(o);s&&(t=s.serialize(t,e));let i=t,a=t.nss;return i.path=`${n||e.nid}:${a}`,e.skipEscape=!0,i}function nk(t,e){let r=t;return r.uuid=r.nss,r.nss=void 0,!e.tolerant&&(!r.uuid||!G0(r.uuid))&&(r.error=r.error||"UUID is not valid."),r}function ok(t){let e=t;return e.nss=(t.uuid||"").toLowerCase(),e}var fh={scheme:"http",domainHost:!0,parse:dh,serialize:ph},sk={scheme:"https",domainHost:fh.domainHost,parse:dh,serialize:ph},Bs={scheme:"ws",domainHost:!0,parse:Q0,serialize:ek},ik={scheme:"wss",domainHost:Bs.domainHost,parse:Bs.parse,serialize:Bs.serialize},ak={scheme:"urn",parse:tk,serialize:rk,skipNormalize:!0},ck={scheme:"urn:uuid",parse:nk,serialize:ok,skipNormalize:!0},Js={http:fh,https:sk,ws:Bs,wss:ik,urn:ak,"urn:uuid":ck};Object.setPrototypeOf(Js,null);function rl(t){return t&&(Js[t]||Js[t.toLowerCase()])||void 0}mh.exports={wsIsSecure:tl,SCHEMES:Js,isValidSchemeName:Y0,getSchemeHandler:rl}});var _h=z((Ij,Ws)=>{"use strict";var{normalizeIPv6:uk,removeDotSegments:fo,recomposeAuthority:lk,normalizeComponentEncoding:Gs,isIPv4:dk,nonSimpleDomain:pk}=el(),{SCHEMES:fk,getSchemeHandler:gh}=hh();function mk(t,e){return typeof t=="string"?t=$t(Nt(t,e),e):typeof t=="object"&&(t=Nt($t(t,e),e)),t}function hk(t,e,r){let n=r?Object.assign({scheme:"null"},r):{scheme:"null"},o=yh(Nt(t,n),Nt(e,n),n,!0);return n.skipEscape=!0,$t(o,n)}function yh(t,e,r,n){let o={};return n||(t=Nt($t(t,r),r),e=Nt($t(e,r),r)),r=r||{},!r.tolerant&&e.scheme?(o.scheme=e.scheme,o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=fo(e.path||""),o.query=e.query):(e.userinfo!==void 0||e.host!==void 0||e.port!==void 0?(o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=fo(e.path||""),o.query=e.query):(e.path?(e.path[0]==="/"?o.path=fo(e.path):((t.userinfo!==void 0||t.host!==void 0||t.port!==void 0)&&!t.path?o.path="/"+e.path:t.path?o.path=t.path.slice(0,t.path.lastIndexOf("/")+1)+e.path:o.path=e.path,o.path=fo(o.path)),o.query=e.query):(o.path=t.path,e.query!==void 0?o.query=e.query:o.query=t.query),o.userinfo=t.userinfo,o.host=t.host,o.port=t.port),o.scheme=t.scheme),o.fragment=e.fragment,o}function gk(t,e,r){return typeof t=="string"?(t=unescape(t),t=$t(Gs(Nt(t,r),!0),{...r,skipEscape:!0})):typeof t=="object"&&(t=$t(Gs(t,!0),{...r,skipEscape:!0})),typeof e=="string"?(e=unescape(e),e=$t(Gs(Nt(e,r),!0),{...r,skipEscape:!0})):typeof e=="object"&&(e=$t(Gs(e,!0),{...r,skipEscape:!0})),t.toLowerCase()===e.toLowerCase()}function $t(t,e){let r={host:t.host,scheme:t.scheme,userinfo:t.userinfo,port:t.port,path:t.path,query:t.query,nid:t.nid,nss:t.nss,uuid:t.uuid,fragment:t.fragment,reference:t.reference,resourceName:t.resourceName,secure:t.secure,error:""},n=Object.assign({},e),o=[],s=gh(n.scheme||r.scheme);s&&s.serialize&&s.serialize(r,n),r.path!==void 0&&(n.skipEscape?r.path=unescape(r.path):(r.path=escape(r.path),r.scheme!==void 0&&(r.path=r.path.split("%3A").join(":")))),n.reference!=="suffix"&&r.scheme&&o.push(r.scheme,":");let i=lk(r);if(i!==void 0&&(n.reference!=="suffix"&&o.push("//"),o.push(i),r.path&&r.path[0]!=="/"&&o.push("/")),r.path!==void 0){let a=r.path;!n.absolutePath&&(!s||!s.absolutePath)&&(a=fo(a)),i===void 0&&a[0]==="/"&&a[1]==="/"&&(a="/%2F"+a.slice(2)),o.push(a)}return r.query!==void 0&&o.push("?",r.query),r.fragment!==void 0&&o.push("#",r.fragment),o.join("")}var yk=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function Nt(t,e){let r=Object.assign({},e),n={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},o=!1;r.reference==="suffix"&&(r.scheme?t=r.scheme+":"+t:t="//"+t);let s=t.match(yk);if(s){if(n.scheme=s[1],n.userinfo=s[3],n.host=s[4],n.port=parseInt(s[5],10),n.path=s[6]||"",n.query=s[7],n.fragment=s[8],isNaN(n.port)&&(n.port=s[5]),n.host)if(dk(n.host)===!1){let c=uk(n.host);n.host=c.host.toLowerCase(),o=c.isIPV6}else o=!0;n.scheme===void 0&&n.userinfo===void 0&&n.host===void 0&&n.port===void 0&&n.query===void 0&&!n.path?n.reference="same-document":n.scheme===void 0?n.reference="relative":n.fragment===void 0?n.reference="absolute":n.reference="uri",r.reference&&r.reference!=="suffix"&&r.reference!==n.reference&&(n.error=n.error||"URI is not a "+r.reference+" reference.");let i=gh(r.scheme||n.scheme);if(!r.unicodeSupport&&(!i||!i.unicodeSupport)&&n.host&&(r.domainHost||i&&i.domainHost)&&o===!1&&pk(n.host))try{n.host=URL.domainToASCII(n.host.toLowerCase())}catch(a){n.error=n.error||"Host's domain name can not be converted to ASCII: "+a}(!i||i&&!i.skipNormalize)&&(t.indexOf("%")!==-1&&(n.scheme!==void 0&&(n.scheme=unescape(n.scheme)),n.host!==void 0&&(n.host=unescape(n.host))),n.path&&(n.path=escape(unescape(n.path))),n.fragment&&(n.fragment=encodeURI(decodeURIComponent(n.fragment)))),i&&i.parse&&i.parse(n,r)}else n.error=n.error||"URI can not be parsed.";return n}var nl={SCHEMES:fk,normalize:mk,resolve:hk,resolveComponent:yh,equal:gk,serialize:$t,parse:Nt};Ws.exports=nl;Ws.exports.default=nl;Ws.exports.fastUri=nl});var xh=z(ol=>{"use strict";Object.defineProperty(ol,"__esModule",{value:!0});var vh=_h();vh.code='require("ajv/dist/runtime/uri").default';ol.default=vh});var Ph=z(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});Pe.CodeGen=Pe.Name=Pe.nil=Pe.stringify=Pe.str=Pe._=Pe.KeywordCxt=void 0;var _k=lo();Object.defineProperty(Pe,"KeywordCxt",{enumerable:!0,get:function(){return _k.KeywordCxt}});var dn=V();Object.defineProperty(Pe,"_",{enumerable:!0,get:function(){return dn._}});Object.defineProperty(Pe,"str",{enumerable:!0,get:function(){return dn.str}});Object.defineProperty(Pe,"stringify",{enumerable:!0,get:function(){return dn.stringify}});Object.defineProperty(Pe,"nil",{enumerable:!0,get:function(){return dn.nil}});Object.defineProperty(Pe,"Name",{enumerable:!0,get:function(){return dn.Name}});Object.defineProperty(Pe,"CodeGen",{enumerable:!0,get:function(){return dn.CodeGen}});var vk=Vs(),Sh=po(),xk=ju(),mo=Hs(),bk=V(),ho=ao(),Xs=io(),il=ee(),bh=ih(),$k=xh(),Th=(t,e)=>new RegExp(t,e);Th.code="new RegExp";var wk=["removeAdditional","useDefaults","coerceTypes"],kk=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),Sk={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},Tk={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},$h=200;function zk(t){var e,r,n,o,s,i,a,c,u,l,d,h,f,p,m,g,v,x,b,k,T,A,de,Oe,te;let it=t.strict,$n=(e=t.code)===null||e===void 0?void 0:e.optimize,Eo=$n===!0||$n===void 0?1:$n||0,wn=(n=(r=t.code)===null||r===void 0?void 0:r.regExp)!==null&&n!==void 0?n:Th,Ty=(o=t.uriResolver)!==null&&o!==void 0?o:$k.default;return{strictSchema:(i=(s=t.strictSchema)!==null&&s!==void 0?s:it)!==null&&i!==void 0?i:!0,strictNumbers:(c=(a=t.strictNumbers)!==null&&a!==void 0?a:it)!==null&&c!==void 0?c:!0,strictTypes:(l=(u=t.strictTypes)!==null&&u!==void 0?u:it)!==null&&l!==void 0?l:"log",strictTuples:(h=(d=t.strictTuples)!==null&&d!==void 0?d:it)!==null&&h!==void 0?h:"log",strictRequired:(p=(f=t.strictRequired)!==null&&f!==void 0?f:it)!==null&&p!==void 0?p:!1,code:t.code?{...t.code,optimize:Eo,regExp:wn}:{optimize:Eo,regExp:wn},loopRequired:(m=t.loopRequired)!==null&&m!==void 0?m:$h,loopEnum:(g=t.loopEnum)!==null&&g!==void 0?g:$h,meta:(v=t.meta)!==null&&v!==void 0?v:!0,messages:(x=t.messages)!==null&&x!==void 0?x:!0,inlineRefs:(b=t.inlineRefs)!==null&&b!==void 0?b:!0,schemaId:(k=t.schemaId)!==null&&k!==void 0?k:"$id",addUsedSchema:(T=t.addUsedSchema)!==null&&T!==void 0?T:!0,validateSchema:(A=t.validateSchema)!==null&&A!==void 0?A:!0,validateFormats:(de=t.validateFormats)!==null&&de!==void 0?de:!0,unicodeRegExp:(Oe=t.unicodeRegExp)!==null&&Oe!==void 0?Oe:!0,int32range:(te=t.int32range)!==null&&te!==void 0?te:!0,uriResolver:Ty}}var go=class{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...zk(e)};let{es5:r,lines:n}=this.opts.code;this.scope=new bk.ValueScope({scope:{},prefixes:kk,es5:r,lines:n}),this.logger=jk(e.logger);let o=e.validateFormats;e.validateFormats=!1,this.RULES=(0,xk.getRules)(),wh.call(this,Sk,e,"NOT SUPPORTED"),wh.call(this,Tk,e,"DEPRECATED","warn"),this._metaOpts=Ck.call(this),e.formats&&Ek.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&Ik.call(this,e.keywords),typeof e.meta=="object"&&this.addMetaSchema(e.meta),Pk.call(this),e.validateFormats=o}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:e,meta:r,schemaId:n}=this.opts,o=bh;n==="id"&&(o={...bh},o.id=o.$id,delete o.$id),r&&e&&this.addMetaSchema(o,o[n],!1)}defaultMeta(){let{meta:e,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof e=="object"?e[r]||e:void 0}validate(e,r){let n;if(typeof e=="string"){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);let o=n(r);return"$async"in n||(this.errors=n.errors),o}compile(e,r){let n=this._addSchema(e,r);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:n}=this.opts;return o.call(this,e,r);async function o(l,d){await s.call(this,l.$schema);let h=this._addSchema(l,d);return h.validate||i.call(this,h)}async function s(l){l&&!this.getSchema(l)&&await o.call(this,{$ref:l},!0)}async function i(l){try{return this._compileSchemaEnv(l)}catch(d){if(!(d instanceof Sh.default))throw d;return a.call(this,d),await c.call(this,d.missingSchema),i.call(this,l)}}function a({missingSchema:l,missingRef:d}){if(this.refs[l])throw new Error(`AnySchema ${l} is loaded but ${d} cannot be resolved`)}async function c(l){let d=await u.call(this,l);this.refs[l]||await s.call(this,d.$schema),this.refs[l]||this.addSchema(d,l,r)}async function u(l){let d=this._loading[l];if(d)return d;try{return await(this._loading[l]=n(l))}finally{delete this._loading[l]}}}addSchema(e,r,n,o=this.opts.validateSchema){if(Array.isArray(e)){for(let i of e)this.addSchema(i,void 0,n,o);return this}let s;if(typeof e=="object"){let{schemaId:i}=this.opts;if(s=e[i],s!==void 0&&typeof s!="string")throw new Error(`schema ${i} must be string`)}return r=(0,ho.normalizeId)(r||s),this._checkUnique(r),this.schemas[r]=this._addSchema(e,n,r,o,!0),this}addMetaSchema(e,r,n=this.opts.validateSchema){return this.addSchema(e,r,!0,n),this}validateSchema(e,r){if(typeof e=="boolean")return!0;let n;if(n=e.$schema,n!==void 0&&typeof n!="string")throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let o=this.validate(n,e);if(!o&&r){let s="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(s);else throw new Error(s)}return o}getSchema(e){let r;for(;typeof(r=kh.call(this,e))=="string";)e=r;if(r===void 0){let{schemaId:n}=this.opts,o=new mo.SchemaEnv({schema:{},schemaId:n});if(r=mo.resolveSchema.call(this,o,e),!r)return;this.refs[e]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=kh.call(this,e);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{let r=e;this._cache.delete(r);let n=e[this.opts.schemaId];return n&&(n=(0,ho.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(let r of e)this.addKeyword(r);return this}addKeyword(e,r){let n;if(typeof e=="string")n=e,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=n);else if(typeof e=="object"&&r===void 0){if(r=e,n=r.keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(Nk.call(this,n,r),!r)return(0,il.eachItem)(n,s=>sl.call(this,s)),this;Zk.call(this,r);let o={...r,type:(0,Xs.getJSONTypes)(r.type),schemaType:(0,Xs.getJSONTypes)(r.schemaType)};return(0,il.eachItem)(n,o.type.length===0?s=>sl.call(this,s,o):s=>o.type.forEach(i=>sl.call(this,s,o,i))),this}getKeyword(e){let r=this.RULES.all[e];return typeof r=="object"?r.definition:!!r}removeKeyword(e){let{RULES:r}=this;delete r.keywords[e],delete r.all[e];for(let n of r.rules){let o=n.rules.findIndex(s=>s.keyword===e);o>=0&&n.rules.splice(o,1)}return this}addFormat(e,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[e]=r,this}errorsText(e=this.errors,{separator:r=", ",dataVar:n="data"}={}){return!e||e.length===0?"No errors":e.map(o=>`${n}${o.instancePath} ${o.message}`).reduce((o,s)=>o+r+s)}$dataMetaSchema(e,r){let n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(let o of r){let s=o.split("/").slice(1),i=e;for(let a of s)i=i[a];for(let a in n){let c=n[a];if(typeof c!="object")continue;let{$data:u}=c.definition,l=i[a];u&&l&&(i[a]=zh(l))}}return e}_removeAllSchemas(e,r){for(let n in e){let o=e[n];(!r||r.test(n))&&(typeof o=="string"?delete e[n]:o&&!o.meta&&(this._cache.delete(o.schema),delete e[n]))}}_addSchema(e,r,n,o=this.opts.validateSchema,s=this.opts.addUsedSchema){let i,{schemaId:a}=this.opts;if(typeof e=="object")i=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof e!="boolean")throw new Error("schema must be object or boolean")}let c=this._cache.get(e);if(c!==void 0)return c;n=(0,ho.normalizeId)(i||n);let u=ho.getSchemaRefs.call(this,e,n);return c=new mo.SchemaEnv({schema:e,schemaId:a,meta:r,baseId:n,localRefs:u}),this._cache.set(c.schema,c),s&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=c),o&&this.validateSchema(e,!0),c}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):mo.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){let r=this.opts;this.opts=this._metaOpts;try{mo.compileSchema.call(this,e)}finally{this.opts=r}}};go.ValidationError=vk.default;go.MissingRefError=Sh.default;Pe.default=go;function wh(t,e,r,n="error"){for(let o in t){let s=o;s in e&&this.logger[n](`${r}: option ${o}. ${t[s]}`)}}function kh(t){return t=(0,ho.normalizeId)(t),this.schemas[t]||this.refs[t]}function Pk(){let t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(let e in t)this.addSchema(t[e],e)}function Ek(){for(let t in this.opts.formats){let e=this.opts.formats[t];e&&this.addFormat(t,e)}}function Ik(t){if(Array.isArray(t)){this.addVocabulary(t);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let e in t){let r=t[e];r.keyword||(r.keyword=e),this.addKeyword(r)}}function Ck(){let t={...this.opts};for(let e of wk)delete t[e];return t}var Rk={log(){},warn(){},error(){}};function jk(t){if(t===!1)return Rk;if(t===void 0)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}var Ok=/^[a-z_$][a-z0-9_$:-]*$/i;function Nk(t,e){let{RULES:r}=this;if((0,il.eachItem)(t,n=>{if(r.keywords[n])throw new Error(`Keyword ${n} is already defined`);if(!Ok.test(n))throw new Error(`Keyword ${n} has invalid name`)}),!!e&&e.$data&&!("code"in e||"validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function sl(t,e,r){var n;let o=e?.post;if(r&&o)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:s}=this,i=o?s.post:s.rules.find(({type:c})=>c===r);if(i||(i={type:r,rules:[]},s.rules.push(i)),s.keywords[t]=!0,!e)return;let a={keyword:t,definition:{...e,type:(0,Xs.getJSONTypes)(e.type),schemaType:(0,Xs.getJSONTypes)(e.schemaType)}};e.before?Ak.call(this,i,a,e.before):i.rules.push(a),s.all[t]=a,(n=e.implements)===null||n===void 0||n.forEach(c=>this.addKeyword(c))}function Ak(t,e,r){let n=t.rules.findIndex(o=>o.keyword===r);n>=0?t.rules.splice(n,0,e):(t.rules.push(e),this.logger.warn(`rule ${r} is not defined`))}function Zk(t){let{metaSchema:e}=t;e!==void 0&&(t.$data&&this.opts.$data&&(e=zh(e)),t.validateSchema=this.compile(e,!0))}var Mk={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function zh(t){return{anyOf:[t,Mk]}}});var Eh=z(al=>{"use strict";Object.defineProperty(al,"__esModule",{value:!0});var Dk={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};al.default=Dk});var jh=z(Or=>{"use strict";Object.defineProperty(Or,"__esModule",{value:!0});Or.callRef=Or.getValidate=void 0;var qk=po(),Ih=nt(),Be=V(),pn=jt(),Ch=Hs(),Ys=ee(),Lk={keyword:"$ref",schemaType:"string",code(t){let{gen:e,schema:r,it:n}=t,{baseId:o,schemaEnv:s,validateName:i,opts:a,self:c}=n,{root:u}=s;if((r==="#"||r==="#/")&&o===u.baseId)return d();let l=Ch.resolveRef.call(c,u,o,r);if(l===void 0)throw new qk.default(n.opts.uriResolver,o,r);if(l instanceof Ch.SchemaEnv)return h(l);return f(l);function d(){if(s===u)return Qs(t,i,s,s.$async);let p=e.scopeValue("root",{ref:u});return Qs(t,(0,Be._)`${p}.validate`,u,u.$async)}function h(p){let m=Rh(t,p);Qs(t,m,p,p.$async)}function f(p){let m=e.scopeValue("schema",a.code.source===!0?{ref:p,code:(0,Be.stringify)(p)}:{ref:p}),g=e.name("valid"),v=t.subschema({schema:p,dataTypes:[],schemaPath:Be.nil,topSchemaRef:m,errSchemaPath:r},g);t.mergeEvaluated(v),t.ok(g)}}};function Rh(t,e){let{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,Be._)`${r.scopeValue("wrapper",{ref:e})}.validate`}Or.getValidate=Rh;function Qs(t,e,r,n){let{gen:o,it:s}=t,{allErrors:i,schemaEnv:a,opts:c}=s,u=c.passContext?pn.default.this:Be.nil;n?l():d();function l(){if(!a.$async)throw new Error("async schema referenced by sync schema");let p=o.let("valid");o.try(()=>{o.code((0,Be._)`await ${(0,Ih.callValidateCode)(t,e,u)}`),f(e),i||o.assign(p,!0)},m=>{o.if((0,Be._)`!(${m} instanceof ${s.ValidationError})`,()=>o.throw(m)),h(m),i||o.assign(p,!1)}),t.ok(p)}function d(){t.result((0,Ih.callValidateCode)(t,e,u),()=>f(e),()=>h(e))}function h(p){let m=(0,Be._)`${p}.errors`;o.assign(pn.default.vErrors,(0,Be._)`${pn.default.vErrors} === null ? ${m} : ${pn.default.vErrors}.concat(${m})`),o.assign(pn.default.errors,(0,Be._)`${pn.default.vErrors}.length`)}function f(p){var m;if(!s.opts.unevaluated)return;let g=(m=r?.validate)===null||m===void 0?void 0:m.evaluated;if(s.props!==!0)if(g&&!g.dynamicProps)g.props!==void 0&&(s.props=Ys.mergeEvaluated.props(o,g.props,s.props));else{let v=o.var("props",(0,Be._)`${p}.evaluated.props`);s.props=Ys.mergeEvaluated.props(o,v,s.props,Be.Name)}if(s.items!==!0)if(g&&!g.dynamicItems)g.items!==void 0&&(s.items=Ys.mergeEvaluated.items(o,g.items,s.items));else{let v=o.var("items",(0,Be._)`${p}.evaluated.items`);s.items=Ys.mergeEvaluated.items(o,v,s.items,Be.Name)}}}Or.callRef=Qs;Or.default=Lk});var Oh=z(cl=>{"use strict";Object.defineProperty(cl,"__esModule",{value:!0});var Uk=Eh(),Fk=jh(),Vk=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",Uk.default,Fk.default];cl.default=Vk});var Nh=z(ul=>{"use strict";Object.defineProperty(ul,"__esModule",{value:!0});var ei=V(),tr=ei.operators,ti={maximum:{okStr:"<=",ok:tr.LTE,fail:tr.GT},minimum:{okStr:">=",ok:tr.GTE,fail:tr.LT},exclusiveMaximum:{okStr:"<",ok:tr.LT,fail:tr.GTE},exclusiveMinimum:{okStr:">",ok:tr.GT,fail:tr.LTE}},Kk={message:({keyword:t,schemaCode:e})=>(0,ei.str)`must be ${ti[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,ei._)`{comparison: ${ti[t].okStr}, limit: ${e}}`},Hk={keyword:Object.keys(ti),type:"number",schemaType:"number",$data:!0,error:Kk,code(t){let{keyword:e,data:r,schemaCode:n}=t;t.fail$data((0,ei._)`${r} ${ti[e].fail} ${n} || isNaN(${r})`)}};ul.default=Hk});var Ah=z(ll=>{"use strict";Object.defineProperty(ll,"__esModule",{value:!0});var yo=V(),Bk={message:({schemaCode:t})=>(0,yo.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,yo._)`{multipleOf: ${t}}`},Jk={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:Bk,code(t){let{gen:e,data:r,schemaCode:n,it:o}=t,s=o.opts.multipleOfPrecision,i=e.let("res"),a=s?(0,yo._)`Math.abs(Math.round(${i}) - ${i}) > 1e-${s}`:(0,yo._)`${i} !== parseInt(${i})`;t.fail$data((0,yo._)`(${n} === 0 || (${i} = ${r}/${n}, ${a}))`)}};ll.default=Jk});var Mh=z(dl=>{"use strict";Object.defineProperty(dl,"__esModule",{value:!0});function Zh(t){let e=t.length,r=0,n=0,o;for(;n<e;)r++,o=t.charCodeAt(n++),o>=55296&&o<=56319&&n<e&&(o=t.charCodeAt(n),(o&64512)===56320&&n++);return r}dl.default=Zh;Zh.code='require("ajv/dist/runtime/ucs2length").default'});var Dh=z(pl=>{"use strict";Object.defineProperty(pl,"__esModule",{value:!0});var Nr=V(),Gk=ee(),Wk=Mh(),Xk={message({keyword:t,schemaCode:e}){let r=t==="maxLength"?"more":"fewer";return(0,Nr.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,Nr._)`{limit: ${t}}`},Yk={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:Xk,code(t){let{keyword:e,data:r,schemaCode:n,it:o}=t,s=e==="maxLength"?Nr.operators.GT:Nr.operators.LT,i=o.opts.unicode===!1?(0,Nr._)`${r}.length`:(0,Nr._)`${(0,Gk.useFunc)(t.gen,Wk.default)}(${r})`;t.fail$data((0,Nr._)`${i} ${s} ${n}`)}};pl.default=Yk});var qh=z(fl=>{"use strict";Object.defineProperty(fl,"__esModule",{value:!0});var Qk=nt(),ri=V(),eS={message:({schemaCode:t})=>(0,ri.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,ri._)`{pattern: ${t}}`},tS={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:eS,code(t){let{data:e,$data:r,schema:n,schemaCode:o,it:s}=t,i=s.opts.unicodeRegExp?"u":"",a=r?(0,ri._)`(new RegExp(${o}, ${i}))`:(0,Qk.usePattern)(t,n);t.fail$data((0,ri._)`!${a}.test(${e})`)}};fl.default=tS});var Lh=z(ml=>{"use strict";Object.defineProperty(ml,"__esModule",{value:!0});var _o=V(),rS={message({keyword:t,schemaCode:e}){let r=t==="maxProperties"?"more":"fewer";return(0,_o.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,_o._)`{limit: ${t}}`},nS={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:rS,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxProperties"?_o.operators.GT:_o.operators.LT;t.fail$data((0,_o._)`Object.keys(${r}).length ${o} ${n}`)}};ml.default=nS});var Uh=z(hl=>{"use strict";Object.defineProperty(hl,"__esModule",{value:!0});var vo=nt(),xo=V(),oS=ee(),sS={message:({params:{missingProperty:t}})=>(0,xo.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,xo._)`{missingProperty: ${t}}`},iS={keyword:"required",type:"object",schemaType:"array",$data:!0,error:sS,code(t){let{gen:e,schema:r,schemaCode:n,data:o,$data:s,it:i}=t,{opts:a}=i;if(!s&&r.length===0)return;let c=r.length>=a.loopRequired;if(i.allErrors?u():l(),a.strictRequired){let f=t.parentSchema.properties,{definedProperties:p}=t.it;for(let m of r)if(f?.[m]===void 0&&!p.has(m)){let g=i.schemaEnv.baseId+i.errSchemaPath,v=`required property "${m}" is not defined at "${g}" (strictRequired)`;(0,oS.checkStrictMode)(i,v,i.opts.strictRequired)}}function u(){if(c||s)t.block$data(xo.nil,d);else for(let f of r)(0,vo.checkReportMissingProp)(t,f)}function l(){let f=e.let("missing");if(c||s){let p=e.let("valid",!0);t.block$data(p,()=>h(f,p)),t.ok(p)}else e.if((0,vo.checkMissingProp)(t,r,f)),(0,vo.reportMissingProp)(t,f),e.else()}function d(){e.forOf("prop",n,f=>{t.setParams({missingProperty:f}),e.if((0,vo.noPropertyInData)(e,o,f,a.ownProperties),()=>t.error())})}function h(f,p){t.setParams({missingProperty:f}),e.forOf(f,n,()=>{e.assign(p,(0,vo.propertyInData)(e,o,f,a.ownProperties)),e.if((0,xo.not)(p),()=>{t.error(),e.break()})},xo.nil)}}};hl.default=iS});var Fh=z(gl=>{"use strict";Object.defineProperty(gl,"__esModule",{value:!0});var bo=V(),aS={message({keyword:t,schemaCode:e}){let r=t==="maxItems"?"more":"fewer";return(0,bo.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,bo._)`{limit: ${t}}`},cS={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:aS,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxItems"?bo.operators.GT:bo.operators.LT;t.fail$data((0,bo._)`${r}.length ${o} ${n}`)}};gl.default=cS});var ni=z(yl=>{"use strict";Object.defineProperty(yl,"__esModule",{value:!0});var Vh=Lu();Vh.code='require("ajv/dist/runtime/equal").default';yl.default=Vh});var Kh=z(vl=>{"use strict";Object.defineProperty(vl,"__esModule",{value:!0});var _l=io(),Ee=V(),uS=ee(),lS=ni(),dS={message:({params:{i:t,j:e}})=>(0,Ee.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,Ee._)`{i: ${t}, j: ${e}}`},pS={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:dS,code(t){let{gen:e,data:r,$data:n,schema:o,parentSchema:s,schemaCode:i,it:a}=t;if(!n&&!o)return;let c=e.let("valid"),u=s.items?(0,_l.getSchemaTypes)(s.items):[];t.block$data(c,l,(0,Ee._)`${i} === false`),t.ok(c);function l(){let p=e.let("i",(0,Ee._)`${r}.length`),m=e.let("j");t.setParams({i:p,j:m}),e.assign(c,!0),e.if((0,Ee._)`${p} > 1`,()=>(d()?h:f)(p,m))}function d(){return u.length>0&&!u.some(p=>p==="object"||p==="array")}function h(p,m){let g=e.name("item"),v=(0,_l.checkDataTypes)(u,g,a.opts.strictNumbers,_l.DataType.Wrong),x=e.const("indices",(0,Ee._)`{}`);e.for((0,Ee._)`;${p}--;`,()=>{e.let(g,(0,Ee._)`${r}[${p}]`),e.if(v,(0,Ee._)`continue`),u.length>1&&e.if((0,Ee._)`typeof ${g} == "string"`,(0,Ee._)`${g} += "_"`),e.if((0,Ee._)`typeof ${x}[${g}] == "number"`,()=>{e.assign(m,(0,Ee._)`${x}[${g}]`),t.error(),e.assign(c,!1).break()}).code((0,Ee._)`${x}[${g}] = ${p}`)})}function f(p,m){let g=(0,uS.useFunc)(e,lS.default),v=e.name("outer");e.label(v).for((0,Ee._)`;${p}--;`,()=>e.for((0,Ee._)`${m} = ${p}; ${m}--;`,()=>e.if((0,Ee._)`${g}(${r}[${p}], ${r}[${m}])`,()=>{t.error(),e.assign(c,!1).break(v)})))}}};vl.default=pS});var Hh=z(bl=>{"use strict";Object.defineProperty(bl,"__esModule",{value:!0});var xl=V(),fS=ee(),mS=ni(),hS={message:"must be equal to constant",params:({schemaCode:t})=>(0,xl._)`{allowedValue: ${t}}`},gS={keyword:"const",$data:!0,error:hS,code(t){let{gen:e,data:r,$data:n,schemaCode:o,schema:s}=t;n||s&&typeof s=="object"?t.fail$data((0,xl._)`!${(0,fS.useFunc)(e,mS.default)}(${r}, ${o})`):t.fail((0,xl._)`${s} !== ${r}`)}};bl.default=gS});var Bh=z($l=>{"use strict";Object.defineProperty($l,"__esModule",{value:!0});var $o=V(),yS=ee(),_S=ni(),vS={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,$o._)`{allowedValues: ${t}}`},xS={keyword:"enum",schemaType:"array",$data:!0,error:vS,code(t){let{gen:e,data:r,$data:n,schema:o,schemaCode:s,it:i}=t;if(!n&&o.length===0)throw new Error("enum must have non-empty array");let a=o.length>=i.opts.loopEnum,c,u=()=>c??(c=(0,yS.useFunc)(e,_S.default)),l;if(a||n)l=e.let("valid"),t.block$data(l,d);else{if(!Array.isArray(o))throw new Error("ajv implementation error");let f=e.const("vSchema",s);l=(0,$o.or)(...o.map((p,m)=>h(f,m)))}t.pass(l);function d(){e.assign(l,!1),e.forOf("v",s,f=>e.if((0,$o._)`${u()}(${r}, ${f})`,()=>e.assign(l,!0).break()))}function h(f,p){let m=o[p];return typeof m=="object"&&m!==null?(0,$o._)`${u()}(${r}, ${f}[${p}])`:(0,$o._)`${r} === ${m}`}}};$l.default=xS});var Jh=z(wl=>{"use strict";Object.defineProperty(wl,"__esModule",{value:!0});var bS=Nh(),$S=Ah(),wS=Dh(),kS=qh(),SS=Lh(),TS=Uh(),zS=Fh(),PS=Kh(),ES=Hh(),IS=Bh(),CS=[bS.default,$S.default,wS.default,kS.default,SS.default,TS.default,zS.default,PS.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},ES.default,IS.default];wl.default=CS});var Sl=z(wo=>{"use strict";Object.defineProperty(wo,"__esModule",{value:!0});wo.validateAdditionalItems=void 0;var Ar=V(),kl=ee(),RS={message:({params:{len:t}})=>(0,Ar.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,Ar._)`{limit: ${t}}`},jS={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:RS,code(t){let{parentSchema:e,it:r}=t,{items:n}=e;if(!Array.isArray(n)){(0,kl.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}Gh(t,n)}};function Gh(t,e){let{gen:r,schema:n,data:o,keyword:s,it:i}=t;i.items=!0;let a=r.const("len",(0,Ar._)`${o}.length`);if(n===!1)t.setParams({len:e.length}),t.pass((0,Ar._)`${a} <= ${e.length}`);else if(typeof n=="object"&&!(0,kl.alwaysValidSchema)(i,n)){let u=r.var("valid",(0,Ar._)`${a} <= ${e.length}`);r.if((0,Ar.not)(u),()=>c(u)),t.ok(u)}function c(u){r.forRange("i",e.length,a,l=>{t.subschema({keyword:s,dataProp:l,dataPropType:kl.Type.Num},u),i.allErrors||r.if((0,Ar.not)(u),()=>r.break())})}}wo.validateAdditionalItems=Gh;wo.default=jS});var Tl=z(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});ko.validateTuple=void 0;var Wh=V(),oi=ee(),OS=nt(),NS={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){let{schema:e,it:r}=t;if(Array.isArray(e))return Xh(t,"additionalItems",e);r.items=!0,!(0,oi.alwaysValidSchema)(r,e)&&t.ok((0,OS.validateArray)(t))}};function Xh(t,e,r=t.schema){let{gen:n,parentSchema:o,data:s,keyword:i,it:a}=t;l(o),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=oi.mergeEvaluated.items(n,r.length,a.items));let c=n.name("valid"),u=n.const("len",(0,Wh._)`${s}.length`);r.forEach((d,h)=>{(0,oi.alwaysValidSchema)(a,d)||(n.if((0,Wh._)`${u} > ${h}`,()=>t.subschema({keyword:i,schemaProp:h,dataProp:h},c)),t.ok(c))});function l(d){let{opts:h,errSchemaPath:f}=a,p=r.length,m=p===d.minItems&&(p===d.maxItems||d[e]===!1);if(h.strictTuples&&!m){let g=`"${i}" is ${p}-tuple, but minItems or maxItems/${e} are not specified or different at path "${f}"`;(0,oi.checkStrictMode)(a,g,h.strictTuples)}}}ko.validateTuple=Xh;ko.default=NS});var Yh=z(zl=>{"use strict";Object.defineProperty(zl,"__esModule",{value:!0});var AS=Tl(),ZS={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,AS.validateTuple)(t,"items")};zl.default=ZS});var eg=z(Pl=>{"use strict";Object.defineProperty(Pl,"__esModule",{value:!0});var Qh=V(),MS=ee(),DS=nt(),qS=Sl(),LS={message:({params:{len:t}})=>(0,Qh.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,Qh._)`{limit: ${t}}`},US={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:LS,code(t){let{schema:e,parentSchema:r,it:n}=t,{prefixItems:o}=r;n.items=!0,!(0,MS.alwaysValidSchema)(n,e)&&(o?(0,qS.validateAdditionalItems)(t,o):t.ok((0,DS.validateArray)(t)))}};Pl.default=US});var tg=z(El=>{"use strict";Object.defineProperty(El,"__esModule",{value:!0});var st=V(),si=ee(),FS={message:({params:{min:t,max:e}})=>e===void 0?(0,st.str)`must contain at least ${t} valid item(s)`:(0,st.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,st._)`{minContains: ${t}}`:(0,st._)`{minContains: ${t}, maxContains: ${e}}`},VS={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:FS,code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:s}=t,i,a,{minContains:c,maxContains:u}=n;s.opts.next?(i=c===void 0?1:c,a=u):i=1;let l=e.const("len",(0,st._)`${o}.length`);if(t.setParams({min:i,max:a}),a===void 0&&i===0){(0,si.checkStrictMode)(s,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&i>a){(0,si.checkStrictMode)(s,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,si.alwaysValidSchema)(s,r)){let m=(0,st._)`${l} >= ${i}`;a!==void 0&&(m=(0,st._)`${m} && ${l} <= ${a}`),t.pass(m);return}s.items=!0;let d=e.name("valid");a===void 0&&i===1?f(d,()=>e.if(d,()=>e.break())):i===0?(e.let(d,!0),a!==void 0&&e.if((0,st._)`${o}.length > 0`,h)):(e.let(d,!1),h()),t.result(d,()=>t.reset());function h(){let m=e.name("_valid"),g=e.let("count",0);f(m,()=>e.if(m,()=>p(g)))}function f(m,g){e.forRange("i",0,l,v=>{t.subschema({keyword:"contains",dataProp:v,dataPropType:si.Type.Num,compositeRule:!0},m),g()})}function p(m){e.code((0,st._)`${m}++`),a===void 0?e.if((0,st._)`${m} >= ${i}`,()=>e.assign(d,!0).break()):(e.if((0,st._)`${m} > ${a}`,()=>e.assign(d,!1).break()),i===1?e.assign(d,!0):e.if((0,st._)`${m} >= ${i}`,()=>e.assign(d,!0)))}}};El.default=VS});var og=z(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.validateSchemaDeps=wt.validatePropertyDeps=wt.error=void 0;var Il=V(),KS=ee(),So=nt();wt.error={message:({params:{property:t,depsCount:e,deps:r}})=>{let n=e===1?"property":"properties";return(0,Il.str)`must have ${n} ${r} when property ${t} is present`},params:({params:{property:t,depsCount:e,deps:r,missingProperty:n}})=>(0,Il._)`{property: ${t},
    missingProperty: ${n},
    depsCount: ${e},
    deps: ${r}}`};var HS={keyword:"dependencies",type:"object",schemaType:"object",error:wt.error,code(t){let[e,r]=BS(t);rg(t,e),ng(t,r)}};function BS({schema:t}){let e={},r={};for(let n in t){if(n==="__proto__")continue;let o=Array.isArray(t[n])?e:r;o[n]=t[n]}return[e,r]}function rg(t,e=t.schema){let{gen:r,data:n,it:o}=t;if(Object.keys(e).length===0)return;let s=r.let("missing");for(let i in e){let a=e[i];if(a.length===0)continue;let c=(0,So.propertyInData)(r,n,i,o.opts.ownProperties);t.setParams({property:i,depsCount:a.length,deps:a.join(", ")}),o.allErrors?r.if(c,()=>{for(let u of a)(0,So.checkReportMissingProp)(t,u)}):(r.if((0,Il._)`${c} && (${(0,So.checkMissingProp)(t,a,s)})`),(0,So.reportMissingProp)(t,s),r.else())}}wt.validatePropertyDeps=rg;function ng(t,e=t.schema){let{gen:r,data:n,keyword:o,it:s}=t,i=r.name("valid");for(let a in e)(0,KS.alwaysValidSchema)(s,e[a])||(r.if((0,So.propertyInData)(r,n,a,s.opts.ownProperties),()=>{let c=t.subschema({keyword:o,schemaProp:a},i);t.mergeValidEvaluated(c,i)},()=>r.var(i,!0)),t.ok(i))}wt.validateSchemaDeps=ng;wt.default=HS});var ig=z(Cl=>{"use strict";Object.defineProperty(Cl,"__esModule",{value:!0});var sg=V(),JS=ee(),GS={message:"property name must be valid",params:({params:t})=>(0,sg._)`{propertyName: ${t.propertyName}}`},WS={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:GS,code(t){let{gen:e,schema:r,data:n,it:o}=t;if((0,JS.alwaysValidSchema)(o,r))return;let s=e.name("valid");e.forIn("key",n,i=>{t.setParams({propertyName:i}),t.subschema({keyword:"propertyNames",data:i,dataTypes:["string"],propertyName:i,compositeRule:!0},s),e.if((0,sg.not)(s),()=>{t.error(!0),o.allErrors||e.break()})}),t.ok(s)}};Cl.default=WS});var jl=z(Rl=>{"use strict";Object.defineProperty(Rl,"__esModule",{value:!0});var ii=nt(),mt=V(),XS=jt(),ai=ee(),YS={message:"must NOT have additional properties",params:({params:t})=>(0,mt._)`{additionalProperty: ${t.additionalProperty}}`},QS={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:YS,code(t){let{gen:e,schema:r,parentSchema:n,data:o,errsCount:s,it:i}=t;if(!s)throw new Error("ajv implementation error");let{allErrors:a,opts:c}=i;if(i.props=!0,c.removeAdditional!=="all"&&(0,ai.alwaysValidSchema)(i,r))return;let u=(0,ii.allSchemaProperties)(n.properties),l=(0,ii.allSchemaProperties)(n.patternProperties);d(),t.ok((0,mt._)`${s} === ${XS.default.errors}`);function d(){e.forIn("key",o,g=>{!u.length&&!l.length?p(g):e.if(h(g),()=>p(g))})}function h(g){let v;if(u.length>8){let x=(0,ai.schemaRefOrVal)(i,n.properties,"properties");v=(0,ii.isOwnProperty)(e,x,g)}else u.length?v=(0,mt.or)(...u.map(x=>(0,mt._)`${g} === ${x}`)):v=mt.nil;return l.length&&(v=(0,mt.or)(v,...l.map(x=>(0,mt._)`${(0,ii.usePattern)(t,x)}.test(${g})`))),(0,mt.not)(v)}function f(g){e.code((0,mt._)`delete ${o}[${g}]`)}function p(g){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){f(g);return}if(r===!1){t.setParams({additionalProperty:g}),t.error(),a||e.break();return}if(typeof r=="object"&&!(0,ai.alwaysValidSchema)(i,r)){let v=e.name("valid");c.removeAdditional==="failing"?(m(g,v,!1),e.if((0,mt.not)(v),()=>{t.reset(),f(g)})):(m(g,v),a||e.if((0,mt.not)(v),()=>e.break()))}}function m(g,v,x){let b={keyword:"additionalProperties",dataProp:g,dataPropType:ai.Type.Str};x===!1&&Object.assign(b,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(b,v)}}};Rl.default=QS});var ug=z(Nl=>{"use strict";Object.defineProperty(Nl,"__esModule",{value:!0});var eT=lo(),ag=nt(),Ol=ee(),cg=jl(),tT={keyword:"properties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:s}=t;s.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&cg.default.code(new eT.KeywordCxt(s,cg.default,"additionalProperties"));let i=(0,ag.allSchemaProperties)(r);for(let d of i)s.definedProperties.add(d);s.opts.unevaluated&&i.length&&s.props!==!0&&(s.props=Ol.mergeEvaluated.props(e,(0,Ol.toHash)(i),s.props));let a=i.filter(d=>!(0,Ol.alwaysValidSchema)(s,r[d]));if(a.length===0)return;let c=e.name("valid");for(let d of a)u(d)?l(d):(e.if((0,ag.propertyInData)(e,o,d,s.opts.ownProperties)),l(d),s.allErrors||e.else().var(c,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(c);function u(d){return s.opts.useDefaults&&!s.compositeRule&&r[d].default!==void 0}function l(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},c)}}};Nl.default=tT});var fg=z(Al=>{"use strict";Object.defineProperty(Al,"__esModule",{value:!0});var lg=nt(),ci=V(),dg=ee(),pg=ee(),rT={keyword:"patternProperties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,data:n,parentSchema:o,it:s}=t,{opts:i}=s,a=(0,lg.allSchemaProperties)(r),c=a.filter(m=>(0,dg.alwaysValidSchema)(s,r[m]));if(a.length===0||c.length===a.length&&(!s.opts.unevaluated||s.props===!0))return;let u=i.strictSchema&&!i.allowMatchingProperties&&o.properties,l=e.name("valid");s.props!==!0&&!(s.props instanceof ci.Name)&&(s.props=(0,pg.evaluatedPropsToName)(e,s.props));let{props:d}=s;h();function h(){for(let m of a)u&&f(m),s.allErrors?p(m):(e.var(l,!0),p(m),e.if(l))}function f(m){for(let g in u)new RegExp(m).test(g)&&(0,dg.checkStrictMode)(s,`property ${g} matches pattern ${m} (use allowMatchingProperties)`)}function p(m){e.forIn("key",n,g=>{e.if((0,ci._)`${(0,lg.usePattern)(t,m)}.test(${g})`,()=>{let v=c.includes(m);v||t.subschema({keyword:"patternProperties",schemaProp:m,dataProp:g,dataPropType:pg.Type.Str},l),s.opts.unevaluated&&d!==!0?e.assign((0,ci._)`${d}[${g}]`,!0):!v&&!s.allErrors&&e.if((0,ci.not)(l),()=>e.break())})})}}};Al.default=rT});var mg=z(Zl=>{"use strict";Object.defineProperty(Zl,"__esModule",{value:!0});var nT=ee(),oT={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){let{gen:e,schema:r,it:n}=t;if((0,nT.alwaysValidSchema)(n,r)){t.fail();return}let o=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),t.failResult(o,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};Zl.default=oT});var hg=z(Ml=>{"use strict";Object.defineProperty(Ml,"__esModule",{value:!0});var sT=nt(),iT={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:sT.validateUnion,error:{message:"must match a schema in anyOf"}};Ml.default=iT});var gg=z(Dl=>{"use strict";Object.defineProperty(Dl,"__esModule",{value:!0});var ui=V(),aT=ee(),cT={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,ui._)`{passingSchemas: ${t.passing}}`},uT={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:cT,code(t){let{gen:e,schema:r,parentSchema:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(o.opts.discriminator&&n.discriminator)return;let s=r,i=e.let("valid",!1),a=e.let("passing",null),c=e.name("_valid");t.setParams({passing:a}),e.block(u),t.result(i,()=>t.reset(),()=>t.error(!0));function u(){s.forEach((l,d)=>{let h;(0,aT.alwaysValidSchema)(o,l)?e.var(c,!0):h=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},c),d>0&&e.if((0,ui._)`${c} && ${i}`).assign(i,!1).assign(a,(0,ui._)`[${a}, ${d}]`).else(),e.if(c,()=>{e.assign(i,!0),e.assign(a,d),h&&t.mergeEvaluated(h,ui.Name)})})}}};Dl.default=uT});var yg=z(ql=>{"use strict";Object.defineProperty(ql,"__esModule",{value:!0});var lT=ee(),dT={keyword:"allOf",schemaType:"array",code(t){let{gen:e,schema:r,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");let o=e.name("valid");r.forEach((s,i)=>{if((0,lT.alwaysValidSchema)(n,s))return;let a=t.subschema({keyword:"allOf",schemaProp:i},o);t.ok(o),t.mergeEvaluated(a)})}};ql.default=dT});var xg=z(Ll=>{"use strict";Object.defineProperty(Ll,"__esModule",{value:!0});var li=V(),vg=ee(),pT={message:({params:t})=>(0,li.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,li._)`{failingKeyword: ${t.ifClause}}`},fT={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:pT,code(t){let{gen:e,parentSchema:r,it:n}=t;r.then===void 0&&r.else===void 0&&(0,vg.checkStrictMode)(n,'"if" without "then" and "else" is ignored');let o=_g(n,"then"),s=_g(n,"else");if(!o&&!s)return;let i=e.let("valid",!0),a=e.name("_valid");if(c(),t.reset(),o&&s){let l=e.let("ifClause");t.setParams({ifClause:l}),e.if(a,u("then",l),u("else",l))}else o?e.if(a,u("then")):e.if((0,li.not)(a),u("else"));t.pass(i,()=>t.error(!0));function c(){let l=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);t.mergeEvaluated(l)}function u(l,d){return()=>{let h=t.subschema({keyword:l},a);e.assign(i,a),t.mergeValidEvaluated(h,i),d?e.assign(d,(0,li._)`${l}`):t.setParams({ifClause:l})}}}};function _g(t,e){let r=t.schema[e];return r!==void 0&&!(0,vg.alwaysValidSchema)(t,r)}Ll.default=fT});var bg=z(Ul=>{"use strict";Object.defineProperty(Ul,"__esModule",{value:!0});var mT=ee(),hT={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,mT.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};Ul.default=hT});var $g=z(Fl=>{"use strict";Object.defineProperty(Fl,"__esModule",{value:!0});var gT=Sl(),yT=Yh(),_T=Tl(),vT=eg(),xT=tg(),bT=og(),$T=ig(),wT=jl(),kT=ug(),ST=fg(),TT=mg(),zT=hg(),PT=gg(),ET=yg(),IT=xg(),CT=bg();function RT(t=!1){let e=[TT.default,zT.default,PT.default,ET.default,IT.default,CT.default,$T.default,wT.default,bT.default,kT.default,ST.default];return t?e.push(yT.default,vT.default):e.push(gT.default,_T.default),e.push(xT.default),e}Fl.default=RT});var wg=z(Vl=>{"use strict";Object.defineProperty(Vl,"__esModule",{value:!0});var ve=V(),jT={message:({schemaCode:t})=>(0,ve.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,ve._)`{format: ${t}}`},OT={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:jT,code(t,e){let{gen:r,data:n,$data:o,schema:s,schemaCode:i,it:a}=t,{opts:c,errSchemaPath:u,schemaEnv:l,self:d}=a;if(!c.validateFormats)return;o?h():f();function h(){let p=r.scopeValue("formats",{ref:d.formats,code:c.code.formats}),m=r.const("fDef",(0,ve._)`${p}[${i}]`),g=r.let("fType"),v=r.let("format");r.if((0,ve._)`typeof ${m} == "object" && !(${m} instanceof RegExp)`,()=>r.assign(g,(0,ve._)`${m}.type || "string"`).assign(v,(0,ve._)`${m}.validate`),()=>r.assign(g,(0,ve._)`"string"`).assign(v,m)),t.fail$data((0,ve.or)(x(),b()));function x(){return c.strictSchema===!1?ve.nil:(0,ve._)`${i} && !${v}`}function b(){let k=l.$async?(0,ve._)`(${m}.async ? await ${v}(${n}) : ${v}(${n}))`:(0,ve._)`${v}(${n})`,T=(0,ve._)`(typeof ${v} == "function" ? ${k} : ${v}.test(${n}))`;return(0,ve._)`${v} && ${v} !== true && ${g} === ${e} && !${T}`}}function f(){let p=d.formats[s];if(!p){x();return}if(p===!0)return;let[m,g,v]=b(p);m===e&&t.pass(k());function x(){if(c.strictSchema===!1){d.logger.warn(T());return}throw new Error(T());function T(){return`unknown format "${s}" ignored in schema at path "${u}"`}}function b(T){let A=T instanceof RegExp?(0,ve.regexpCode)(T):c.code.formats?(0,ve._)`${c.code.formats}${(0,ve.getProperty)(s)}`:void 0,de=r.scopeValue("formats",{key:s,ref:T,code:A});return typeof T=="object"&&!(T instanceof RegExp)?[T.type||"string",T.validate,(0,ve._)`${de}.validate`]:["string",T,de]}function k(){if(typeof p=="object"&&!(p instanceof RegExp)&&p.async){if(!l.$async)throw new Error("async format in sync schema");return(0,ve._)`await ${v}(${n})`}return typeof g=="function"?(0,ve._)`${v}(${n})`:(0,ve._)`${v}.test(${n})`}}}};Vl.default=OT});var kg=z(Kl=>{"use strict";Object.defineProperty(Kl,"__esModule",{value:!0});var NT=wg(),AT=[NT.default];Kl.default=AT});var Sg=z(fn=>{"use strict";Object.defineProperty(fn,"__esModule",{value:!0});fn.contentVocabulary=fn.metadataVocabulary=void 0;fn.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];fn.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var zg=z(Hl=>{"use strict";Object.defineProperty(Hl,"__esModule",{value:!0});var ZT=Oh(),MT=Jh(),DT=$g(),qT=kg(),Tg=Sg(),LT=[ZT.default,MT.default,(0,DT.default)(),qT.default,Tg.metadataVocabulary,Tg.contentVocabulary];Hl.default=LT});var Eg=z(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});di.DiscrError=void 0;var Pg;(function(t){t.Tag="tag",t.Mapping="mapping"})(Pg||(di.DiscrError=Pg={}))});var Cg=z(Jl=>{"use strict";Object.defineProperty(Jl,"__esModule",{value:!0});var mn=V(),Bl=Eg(),Ig=Hs(),UT=po(),FT=ee(),VT={message:({params:{discrError:t,tagName:e}})=>t===Bl.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,mn._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},KT={keyword:"discriminator",type:"object",schemaType:"object",error:VT,code(t){let{gen:e,data:r,schema:n,parentSchema:o,it:s}=t,{oneOf:i}=o;if(!s.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!i)throw new Error("discriminator: requires oneOf keyword");let c=e.let("valid",!1),u=e.const("tag",(0,mn._)`${r}${(0,mn.getProperty)(a)}`);e.if((0,mn._)`typeof ${u} == "string"`,()=>l(),()=>t.error(!1,{discrError:Bl.DiscrError.Tag,tag:u,tagName:a})),t.ok(c);function l(){let f=h();e.if(!1);for(let p in f)e.elseIf((0,mn._)`${u} === ${p}`),e.assign(c,d(f[p]));e.else(),t.error(!1,{discrError:Bl.DiscrError.Mapping,tag:u,tagName:a}),e.endIf()}function d(f){let p=e.name("valid"),m=t.subschema({keyword:"oneOf",schemaProp:f},p);return t.mergeEvaluated(m,mn.Name),p}function h(){var f;let p={},m=v(o),g=!0;for(let k=0;k<i.length;k++){let T=i[k];if(T?.$ref&&!(0,FT.schemaHasRulesButRef)(T,s.self.RULES)){let de=T.$ref;if(T=Ig.resolveRef.call(s.self,s.schemaEnv.root,s.baseId,de),T instanceof Ig.SchemaEnv&&(T=T.schema),T===void 0)throw new UT.default(s.opts.uriResolver,s.baseId,de)}let A=(f=T?.properties)===null||f===void 0?void 0:f[a];if(typeof A!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);g=g&&(m||v(T)),x(A,k)}if(!g)throw new Error(`discriminator: "${a}" must be required`);return p;function v({required:k}){return Array.isArray(k)&&k.includes(a)}function x(k,T){if(k.const)b(k.const,T);else if(k.enum)for(let A of k.enum)b(A,T);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function b(k,T){if(typeof k!="string"||k in p)throw new Error(`discriminator: "${a}" values must be unique strings`);p[k]=T}}}};Jl.default=KT});var Rg=z((_1,HT)=>{HT.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var Wl=z((le,Gl)=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.MissingRefError=le.ValidationError=le.CodeGen=le.Name=le.nil=le.stringify=le.str=le._=le.KeywordCxt=le.Ajv=void 0;var BT=Ph(),JT=zg(),GT=Cg(),jg=Rg(),WT=["/properties"],pi="http://json-schema.org/draft-07/schema",hn=class extends BT.default{_addVocabularies(){super._addVocabularies(),JT.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(GT.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let e=this.opts.$data?this.$dataMetaSchema(jg,WT):jg;this.addMetaSchema(e,pi,!1),this.refs["http://json-schema.org/schema"]=pi}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(pi)?pi:void 0)}};le.Ajv=hn;Gl.exports=le=hn;Gl.exports.Ajv=hn;Object.defineProperty(le,"__esModule",{value:!0});le.default=hn;var XT=lo();Object.defineProperty(le,"KeywordCxt",{enumerable:!0,get:function(){return XT.KeywordCxt}});var gn=V();Object.defineProperty(le,"_",{enumerable:!0,get:function(){return gn._}});Object.defineProperty(le,"str",{enumerable:!0,get:function(){return gn.str}});Object.defineProperty(le,"stringify",{enumerable:!0,get:function(){return gn.stringify}});Object.defineProperty(le,"nil",{enumerable:!0,get:function(){return gn.nil}});Object.defineProperty(le,"Name",{enumerable:!0,get:function(){return gn.Name}});Object.defineProperty(le,"CodeGen",{enumerable:!0,get:function(){return gn.CodeGen}});var YT=Vs();Object.defineProperty(le,"ValidationError",{enumerable:!0,get:function(){return YT.default}});var QT=po();Object.defineProperty(le,"MissingRefError",{enumerable:!0,get:function(){return QT.default}})});var Lg=z(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.formatNames=St.fastFormats=St.fullFormats=void 0;function kt(t,e){return{validate:t,compare:e}}St.fullFormats={date:kt(Zg,ed),time:kt(Yl(!0),td),"date-time":kt(Og(!0),Dg),"iso-time":kt(Yl(),Mg),"iso-date-time":kt(Og(),qg),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:sz,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:pz,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:iz,int32:{type:"number",validate:uz},int64:{type:"number",validate:lz},float:{type:"number",validate:Ag},double:{type:"number",validate:Ag},password:!0,binary:!0};St.fastFormats={...St.fullFormats,date:kt(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,ed),time:kt(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,td),"date-time":kt(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,Dg),"iso-time":kt(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,Mg),"iso-date-time":kt(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,qg),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};St.formatNames=Object.keys(St.fullFormats);function ez(t){return t%4===0&&(t%100!==0||t%400===0)}var tz=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,rz=[0,31,28,31,30,31,30,31,31,30,31,30,31];function Zg(t){let e=tz.exec(t);if(!e)return!1;let r=+e[1],n=+e[2],o=+e[3];return n>=1&&n<=12&&o>=1&&o<=(n===2&&ez(r)?29:rz[n])}function ed(t,e){if(t&&e)return t>e?1:t<e?-1:0}var Xl=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function Yl(t){return function(r){let n=Xl.exec(r);if(!n)return!1;let o=+n[1],s=+n[2],i=+n[3],a=n[4],c=n[5]==="-"?-1:1,u=+(n[6]||0),l=+(n[7]||0);if(u>23||l>59||t&&!a)return!1;if(o<=23&&s<=59&&i<60)return!0;let d=s-l*c,h=o-u*c-(d<0?1:0);return(h===23||h===-1)&&(d===59||d===-1)&&i<61}}function td(t,e){if(!(t&&e))return;let r=new Date("2020-01-01T"+t).valueOf(),n=new Date("2020-01-01T"+e).valueOf();if(r&&n)return r-n}function Mg(t,e){if(!(t&&e))return;let r=Xl.exec(t),n=Xl.exec(e);if(r&&n)return t=r[1]+r[2]+r[3],e=n[1]+n[2]+n[3],t>e?1:t<e?-1:0}var Ql=/t|\s/i;function Og(t){let e=Yl(t);return function(n){let o=n.split(Ql);return o.length===2&&Zg(o[0])&&e(o[1])}}function Dg(t,e){if(!(t&&e))return;let r=new Date(t).valueOf(),n=new Date(e).valueOf();if(r&&n)return r-n}function qg(t,e){if(!(t&&e))return;let[r,n]=t.split(Ql),[o,s]=e.split(Ql),i=ed(r,o);if(i!==void 0)return i||td(n,s)}var nz=/\/|:/,oz=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function sz(t){return nz.test(t)&&oz.test(t)}var Ng=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function iz(t){return Ng.lastIndex=0,Ng.test(t)}var az=-(2**31),cz=2**31-1;function uz(t){return Number.isInteger(t)&&t<=cz&&t>=az}function lz(t){return Number.isInteger(t)}function Ag(){return!0}var dz=/[^\\]\\Z/;function pz(t){if(dz.test(t))return!1;try{return new RegExp(t),!0}catch{return!1}}});var Ug=z(yn=>{"use strict";Object.defineProperty(yn,"__esModule",{value:!0});yn.formatLimitDefinition=void 0;var fz=Wl(),ht=V(),rr=ht.operators,fi={formatMaximum:{okStr:"<=",ok:rr.LTE,fail:rr.GT},formatMinimum:{okStr:">=",ok:rr.GTE,fail:rr.LT},formatExclusiveMaximum:{okStr:"<",ok:rr.LT,fail:rr.GTE},formatExclusiveMinimum:{okStr:">",ok:rr.GT,fail:rr.LTE}},mz={message:({keyword:t,schemaCode:e})=>(0,ht.str)`should be ${fi[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,ht._)`{comparison: ${fi[t].okStr}, limit: ${e}}`};yn.formatLimitDefinition={keyword:Object.keys(fi),type:"string",schemaType:"string",$data:!0,error:mz,code(t){let{gen:e,data:r,schemaCode:n,keyword:o,it:s}=t,{opts:i,self:a}=s;if(!i.validateFormats)return;let c=new fz.KeywordCxt(s,a.RULES.all.format.definition,"format");c.$data?u():l();function u(){let h=e.scopeValue("formats",{ref:a.formats,code:i.code.formats}),f=e.const("fmt",(0,ht._)`${h}[${c.schemaCode}]`);t.fail$data((0,ht.or)((0,ht._)`typeof ${f} != "object"`,(0,ht._)`${f} instanceof RegExp`,(0,ht._)`typeof ${f}.compare != "function"`,d(f)))}function l(){let h=c.schema,f=a.formats[h];if(!f||f===!0)return;if(typeof f!="object"||f instanceof RegExp||typeof f.compare!="function")throw new Error(`"${o}": format "${h}" does not define "compare" function`);let p=e.scopeValue("formats",{key:h,ref:f,code:i.code.formats?(0,ht._)`${i.code.formats}${(0,ht.getProperty)(h)}`:void 0});t.fail$data(d(p))}function d(h){return(0,ht._)`${h}.compare(${r}, ${n}) ${fi[o].fail} 0`}},dependencies:["format"]};var hz=t=>(t.addKeyword(yn.formatLimitDefinition),t);yn.default=hz});var Hg=z((To,Kg)=>{"use strict";Object.defineProperty(To,"__esModule",{value:!0});var _n=Lg(),gz=Ug(),rd=V(),Fg=new rd.Name("fullFormats"),yz=new rd.Name("fastFormats"),nd=(t,e={keywords:!0})=>{if(Array.isArray(e))return Vg(t,e,_n.fullFormats,Fg),t;let[r,n]=e.mode==="fast"?[_n.fastFormats,yz]:[_n.fullFormats,Fg],o=e.formats||_n.formatNames;return Vg(t,o,r,n),e.keywords&&(0,gz.default)(t),t};nd.get=(t,e="full")=>{let n=(e==="fast"?_n.fastFormats:_n.fullFormats)[t];if(!n)throw new Error(`Unknown format "${t}"`);return n};function Vg(t,e,r,n){var o,s;(o=(s=t.opts.code).formats)!==null&&o!==void 0||(s.formats=(0,rd._)`require("ajv-formats/dist/formats").${n}`);for(let i of e)t.addFormat(i,r[i])}Kg.exports=To=nd;Object.defineProperty(To,"__esModule",{value:!0});To.default=nd});var N={};Ei(N,{BRAND:()=>o_,DIRTY:()=>or,EMPTY_PATH:()=>Ay,INVALID:()=>Z,NEVER:()=>L_,OK:()=>Ie,ParseStatus:()=>we,Schema:()=>F,ZodAny:()=>Lt,ZodArray:()=>Et,ZodBigInt:()=>ir,ZodBoolean:()=>ar,ZodBranded:()=>Sn,ZodCatch:()=>_r,ZodDate:()=>cr,ZodDefault:()=>yr,ZodDiscriminatedUnion:()=>jo,ZodEffects:()=>Ye,ZodEnum:()=>hr,ZodError:()=>qe,ZodFirstPartyTypeKind:()=>w,ZodFunction:()=>No,ZodIntersection:()=>pr,ZodIssueCode:()=>$,ZodLazy:()=>fr,ZodLiteral:()=>mr,ZodMap:()=>Kr,ZodNaN:()=>Br,ZodNativeEnum:()=>gr,ZodNever:()=>at,ZodNull:()=>lr,ZodNullable:()=>_t,ZodNumber:()=>sr,ZodObject:()=>Ue,ZodOptional:()=>Le,ZodParsedType:()=>P,ZodPipeline:()=>Tn,ZodPromise:()=>Ut,ZodReadonly:()=>vr,ZodRecord:()=>Oo,ZodSchema:()=>F,ZodSet:()=>Hr,ZodString:()=>qt,ZodSymbol:()=>Fr,ZodTransformer:()=>Ye,ZodTuple:()=>yt,ZodType:()=>F,ZodUndefined:()=>ur,ZodUnion:()=>dr,ZodUnknown:()=>Pt,ZodVoid:()=>Vr,addIssueToContext:()=>S,any:()=>f_,array:()=>y_,bigint:()=>c_,boolean:()=>wd,coerce:()=>q_,custom:()=>xd,date:()=>u_,datetimeRegex:()=>_d,defaultErrorMap:()=>Tt,discriminatedUnion:()=>x_,effect:()=>R_,enum:()=>E_,function:()=>T_,getErrorMap:()=>qr,getParsedType:()=>gt,instanceof:()=>i_,intersection:()=>b_,isAborted:()=>Co,isAsync:()=>Lr,isDirty:()=>Ro,isValid:()=>Dt,late:()=>s_,lazy:()=>z_,literal:()=>P_,makeIssue:()=>kn,map:()=>k_,nan:()=>a_,nativeEnum:()=>I_,never:()=>h_,null:()=>p_,nullable:()=>O_,number:()=>$d,object:()=>ji,objectUtil:()=>Ii,oboolean:()=>D_,onumber:()=>M_,optional:()=>j_,ostring:()=>Z_,pipeline:()=>A_,preprocess:()=>N_,promise:()=>C_,quotelessJson:()=>jy,record:()=>w_,set:()=>S_,setErrorMap:()=>Ny,strictObject:()=>__,string:()=>bd,symbol:()=>l_,transformer:()=>R_,tuple:()=>$_,undefined:()=>d_,union:()=>v_,unknown:()=>m_,util:()=>B,void:()=>g_});var B;(function(t){t.assertEqual=o=>{};function e(o){}t.assertIs=e;function r(o){throw new Error}t.assertNever=r,t.arrayToEnum=o=>{let s={};for(let i of o)s[i]=i;return s},t.getValidEnumValues=o=>{let s=t.objectKeys(o).filter(a=>typeof o[o[a]]!="number"),i={};for(let a of s)i[a]=o[a];return t.objectValues(i)},t.objectValues=o=>t.objectKeys(o).map(function(s){return o[s]}),t.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{let s=[];for(let i in o)Object.prototype.hasOwnProperty.call(o,i)&&s.push(i);return s},t.find=(o,s)=>{for(let i of o)if(s(i))return i},t.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function n(o,s=" | "){return o.map(i=>typeof i=="string"?`'${i}'`:i).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(o,s)=>typeof s=="bigint"?s.toString():s})(B||(B={}));var Ii;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Ii||(Ii={}));var P=B.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),gt=t=>{switch(typeof t){case"undefined":return P.undefined;case"string":return P.string;case"number":return Number.isNaN(t)?P.nan:P.number;case"boolean":return P.boolean;case"function":return P.function;case"bigint":return P.bigint;case"symbol":return P.symbol;case"object":return Array.isArray(t)?P.array:t===null?P.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?P.promise:typeof Map<"u"&&t instanceof Map?P.map:typeof Set<"u"&&t instanceof Set?P.set:typeof Date<"u"&&t instanceof Date?P.date:P.object;default:return P.unknown}};var $=B.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),jy=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),qe=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},o=s=>{for(let i of s.issues)if(i.code==="invalid_union")i.unionErrors.map(o);else if(i.code==="invalid_return_type")o(i.returnTypeError);else if(i.code==="invalid_arguments")o(i.argumentsError);else if(i.path.length===0)n._errors.push(r(i));else{let a=n,c=0;for(;c<i.path.length;){let u=i.path[c];c===i.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(i))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return o(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,B.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let o of this.issues)if(o.path.length>0){let s=o.path[0];r[s]=r[s]||[],r[s].push(e(o))}else n.push(e(o));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};qe.create=t=>new qe(t);var Oy=(t,e)=>{let r;switch(t.code){case $.invalid_type:t.received===P.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case $.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,B.jsonStringifyReplacer)}`;break;case $.unrecognized_keys:r=`Unrecognized key(s) in object: ${B.joinValues(t.keys,", ")}`;break;case $.invalid_union:r="Invalid input";break;case $.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${B.joinValues(t.options)}`;break;case $.invalid_enum_value:r=`Invalid enum value. Expected ${B.joinValues(t.options)}, received '${t.received}'`;break;case $.invalid_arguments:r="Invalid function arguments";break;case $.invalid_return_type:r="Invalid function return type";break;case $.invalid_date:r="Invalid date";break;case $.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:B.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case $.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case $.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case $.custom:r="Invalid input";break;case $.invalid_intersection_types:r="Intersection results could not be merged";break;case $.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case $.not_finite:r="Number must be finite";break;default:r=e.defaultError,B.assertNever(t)}return{message:r}},Tt=Oy;var fd=Tt;function Ny(t){fd=t}function qr(){return fd}var kn=t=>{let{data:e,path:r,errorMaps:n,issueData:o}=t,s=[...r,...o.path||[]],i={...o,path:s};if(o.message!==void 0)return{...o,path:s,message:o.message};let a="",c=n.filter(u=>!!u).slice().reverse();for(let u of c)a=u(i,{data:e,defaultError:a}).message;return{...o,path:s,message:a}},Ay=[];function S(t,e){let r=qr(),n=kn({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Tt?void 0:Tt].filter(o=>!!o)});t.common.issues.push(n)}var we=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let o of r){if(o.status==="aborted")return Z;o.status==="dirty"&&e.dirty(),n.push(o.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let o of r){let s=await o.key,i=await o.value;n.push({key:s,value:i})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let o of r){let{key:s,value:i}=o;if(s.status==="aborted"||i.status==="aborted")return Z;s.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof i.value<"u"||o.alwaysSet)&&(n[s.value]=i.value)}return{status:e.value,value:n}}},Z=Object.freeze({status:"aborted"}),or=t=>({status:"dirty",value:t}),Ie=t=>({status:"valid",value:t}),Co=t=>t.status==="aborted",Ro=t=>t.status==="dirty",Dt=t=>t.status==="valid",Lr=t=>typeof Promise<"u"&&t instanceof Promise;var I;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(I||(I={}));var Xe=class{constructor(e,r,n,o){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},md=(t,e)=>{if(Dt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new qe(t.common.issues);return this._error=r,this._error}}};function L(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:o}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:o}:{errorMap:(i,a)=>{let{message:c}=t;return i.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??n??a.defaultError}:i.code!=="invalid_type"?{message:a.defaultError}:{message:c??r??a.defaultError}},description:o}}var F=class{get description(){return this._def.description}_getType(e){return gt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:gt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new we,ctx:{common:e.parent.common,data:e.data,parsedType:gt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(Lr(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){let n={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:gt(e)},o=this._parseSync({data:e,path:n.path,parent:n});return md(n,o)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:gt(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:r});return Dt(n)?{value:n.value}:{issues:r.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(n=>Dt(n)?{value:n.value}:{issues:r.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:gt(e)},o=this._parse({data:e,path:n.path,parent:n}),s=await(Lr(o)?o:Promise.resolve(o));return md(n,s)}refine(e,r){let n=o=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(o):r;return this._refinement((o,s)=>{let i=e(o),a=()=>s.addIssue({code:$.custom,...n(o)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(a(),!1)):i?!0:(a(),!1)})}refinement(e,r){return this._refinement((n,o)=>e(n)?!0:(o.addIssue(typeof r=="function"?r(n,o):r),!1))}_refinement(e){return new Ye({schema:this,typeName:w.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Le.create(this,this._def)}nullable(){return _t.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Et.create(this)}promise(){return Ut.create(this,this._def)}or(e){return dr.create([this,e],this._def)}and(e){return pr.create(this,e,this._def)}transform(e){return new Ye({...L(this._def),schema:this,typeName:w.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new yr({...L(this._def),innerType:this,defaultValue:r,typeName:w.ZodDefault})}brand(){return new Sn({typeName:w.ZodBranded,type:this,...L(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new _r({...L(this._def),innerType:this,catchValue:r,typeName:w.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Tn.create(this,e)}readonly(){return vr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Zy=/^c[^\s-]{8,}$/i,My=/^[0-9a-z]+$/,Dy=/^[0-9A-HJKMNP-TV-Z]{26}$/i,qy=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Ly=/^[a-z0-9_-]{21}$/i,Uy=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Fy=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Vy=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Ky="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Ci,Hy=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,By=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Jy=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Gy=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Wy=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Xy=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,gd="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Yy=new RegExp(`^${gd}$`);function yd(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function Qy(t){return new RegExp(`^${yd(t)}$`)}function _d(t){let e=`${gd}T${yd(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function e_(t,e){return!!((e==="v4"||!e)&&Hy.test(t)||(e==="v6"||!e)&&Jy.test(t))}function t_(t,e){if(!Uy.test(t))return!1;try{let[r]=t.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),o=JSON.parse(atob(n));return!(typeof o!="object"||o===null||"typ"in o&&o?.typ!=="JWT"||!o.alg||e&&o.alg!==e)}catch{return!1}}function r_(t,e){return!!((e==="v4"||!e)&&By.test(t)||(e==="v6"||!e)&&Gy.test(t))}var qt=class t extends F{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==P.string){let s=this._getOrReturnCtx(e);return S(s,{code:$.invalid_type,expected:P.string,received:s.parsedType}),Z}let n=new we,o;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(o=this._getOrReturnCtx(e,o),S(o,{code:$.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(o=this._getOrReturnCtx(e,o),S(o,{code:$.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let i=e.data.length>s.value,a=e.data.length<s.value;(i||a)&&(o=this._getOrReturnCtx(e,o),i?S(o,{code:$.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&S(o,{code:$.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")Vy.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"email",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")Ci||(Ci=new RegExp(Ky,"u")),Ci.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"emoji",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")qy.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"uuid",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")Ly.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"nanoid",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")Zy.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"cuid",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")My.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"cuid2",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")Dy.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"ulid",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{o=this._getOrReturnCtx(e,o),S(o,{validation:"url",code:$.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"regex",code:$.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(o=this._getOrReturnCtx(e,o),S(o,{code:$.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(o=this._getOrReturnCtx(e,o),S(o,{code:$.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(o=this._getOrReturnCtx(e,o),S(o,{code:$.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?_d(s).test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{code:$.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?Yy.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{code:$.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?Qy(s).test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{code:$.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?Fy.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"duration",code:$.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?e_(e.data,s.version)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"ip",code:$.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?t_(e.data,s.alg)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"jwt",code:$.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?r_(e.data,s.version)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"cidr",code:$.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?Wy.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"base64",code:$.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?Xy.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"base64url",code:$.invalid_string,message:s.message}),n.dirty()):B.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(o=>e.test(o),{validation:r,code:$.invalid_string,...I.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...I.errToObj(e)})}url(e){return this._addCheck({kind:"url",...I.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...I.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...I.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...I.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...I.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...I.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...I.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...I.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...I.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...I.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...I.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...I.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...I.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...I.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...I.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...I.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...I.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...I.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...I.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...I.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...I.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...I.errToObj(r)})}nonempty(e){return this.min(1,I.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};qt.create=t=>new qt({checks:[],typeName:w.ZodString,coerce:t?.coerce??!1,...L(t)});function n_(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,s=Number.parseInt(t.toFixed(o).replace(".","")),i=Number.parseInt(e.toFixed(o).replace(".",""));return s%i/10**o}var sr=class t extends F{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==P.number){let s=this._getOrReturnCtx(e);return S(s,{code:$.invalid_type,expected:P.number,received:s.parsedType}),Z}let n,o=new we;for(let s of this._def.checks)s.kind==="int"?B.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{code:$.invalid_type,expected:"integer",received:"float",message:s.message}),o.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),S(n,{code:$.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),S(n,{code:$.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="multipleOf"?n_(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),S(n,{code:$.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{code:$.not_finite,message:s.message}),o.dirty()):B.assertNever(s);return{status:o.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,I.toString(r))}gt(e,r){return this.setLimit("min",e,!1,I.toString(r))}lte(e,r){return this.setLimit("max",e,!0,I.toString(r))}lt(e,r){return this.setLimit("max",e,!1,I.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:I.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:I.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:I.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:I.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:I.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:I.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:I.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:I.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:I.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:I.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&B.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};sr.create=t=>new sr({checks:[],typeName:w.ZodNumber,coerce:t?.coerce||!1,...L(t)});var ir=class t extends F{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==P.bigint)return this._getInvalidInput(e);let n,o=new we;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),S(n,{code:$.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),S(n,{code:$.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),S(n,{code:$.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):B.assertNever(s);return{status:o.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return S(r,{code:$.invalid_type,expected:P.bigint,received:r.parsedType}),Z}gte(e,r){return this.setLimit("min",e,!0,I.toString(r))}gt(e,r){return this.setLimit("min",e,!1,I.toString(r))}lte(e,r){return this.setLimit("max",e,!0,I.toString(r))}lt(e,r){return this.setLimit("max",e,!1,I.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:I.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:I.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:I.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:I.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:I.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:I.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};ir.create=t=>new ir({checks:[],typeName:w.ZodBigInt,coerce:t?.coerce??!1,...L(t)});var ar=class extends F{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==P.boolean){let n=this._getOrReturnCtx(e);return S(n,{code:$.invalid_type,expected:P.boolean,received:n.parsedType}),Z}return Ie(e.data)}};ar.create=t=>new ar({typeName:w.ZodBoolean,coerce:t?.coerce||!1,...L(t)});var cr=class t extends F{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==P.date){let s=this._getOrReturnCtx(e);return S(s,{code:$.invalid_type,expected:P.date,received:s.parsedType}),Z}if(Number.isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return S(s,{code:$.invalid_date}),Z}let n=new we,o;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(o=this._getOrReturnCtx(e,o),S(o,{code:$.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(o=this._getOrReturnCtx(e,o),S(o,{code:$.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):B.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:I.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:I.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};cr.create=t=>new cr({checks:[],coerce:t?.coerce||!1,typeName:w.ZodDate,...L(t)});var Fr=class extends F{_parse(e){if(this._getType(e)!==P.symbol){let n=this._getOrReturnCtx(e);return S(n,{code:$.invalid_type,expected:P.symbol,received:n.parsedType}),Z}return Ie(e.data)}};Fr.create=t=>new Fr({typeName:w.ZodSymbol,...L(t)});var ur=class extends F{_parse(e){if(this._getType(e)!==P.undefined){let n=this._getOrReturnCtx(e);return S(n,{code:$.invalid_type,expected:P.undefined,received:n.parsedType}),Z}return Ie(e.data)}};ur.create=t=>new ur({typeName:w.ZodUndefined,...L(t)});var lr=class extends F{_parse(e){if(this._getType(e)!==P.null){let n=this._getOrReturnCtx(e);return S(n,{code:$.invalid_type,expected:P.null,received:n.parsedType}),Z}return Ie(e.data)}};lr.create=t=>new lr({typeName:w.ZodNull,...L(t)});var Lt=class extends F{constructor(){super(...arguments),this._any=!0}_parse(e){return Ie(e.data)}};Lt.create=t=>new Lt({typeName:w.ZodAny,...L(t)});var Pt=class extends F{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ie(e.data)}};Pt.create=t=>new Pt({typeName:w.ZodUnknown,...L(t)});var at=class extends F{_parse(e){let r=this._getOrReturnCtx(e);return S(r,{code:$.invalid_type,expected:P.never,received:r.parsedType}),Z}};at.create=t=>new at({typeName:w.ZodNever,...L(t)});var Vr=class extends F{_parse(e){if(this._getType(e)!==P.undefined){let n=this._getOrReturnCtx(e);return S(n,{code:$.invalid_type,expected:P.void,received:n.parsedType}),Z}return Ie(e.data)}};Vr.create=t=>new Vr({typeName:w.ZodVoid,...L(t)});var Et=class t extends F{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),o=this._def;if(r.parsedType!==P.array)return S(r,{code:$.invalid_type,expected:P.array,received:r.parsedType}),Z;if(o.exactLength!==null){let i=r.data.length>o.exactLength.value,a=r.data.length<o.exactLength.value;(i||a)&&(S(r,{code:i?$.too_big:$.too_small,minimum:a?o.exactLength.value:void 0,maximum:i?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),n.dirty())}if(o.minLength!==null&&r.data.length<o.minLength.value&&(S(r,{code:$.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),n.dirty()),o.maxLength!==null&&r.data.length>o.maxLength.value&&(S(r,{code:$.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((i,a)=>o.type._parseAsync(new Xe(r,i,r.path,a)))).then(i=>we.mergeArray(n,i));let s=[...r.data].map((i,a)=>o.type._parseSync(new Xe(r,i,r.path,a)));return we.mergeArray(n,s)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:I.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:I.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:I.toString(r)}})}nonempty(e){return this.min(1,e)}};Et.create=(t,e)=>new Et({type:t,minLength:null,maxLength:null,exactLength:null,typeName:w.ZodArray,...L(e)});function Ur(t){if(t instanceof Ue){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=Le.create(Ur(n))}return new Ue({...t._def,shape:()=>e})}else return t instanceof Et?new Et({...t._def,type:Ur(t.element)}):t instanceof Le?Le.create(Ur(t.unwrap())):t instanceof _t?_t.create(Ur(t.unwrap())):t instanceof yt?yt.create(t.items.map(e=>Ur(e))):t}var Ue=class t extends F{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=B.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==P.object){let u=this._getOrReturnCtx(e);return S(u,{code:$.invalid_type,expected:P.object,received:u.parsedType}),Z}let{status:n,ctx:o}=this._processInputParams(e),{shape:s,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof at&&this._def.unknownKeys==="strip"))for(let u in o.data)i.includes(u)||a.push(u);let c=[];for(let u of i){let l=s[u],d=o.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Xe(o,d,o.path,u)),alwaysSet:u in o.data})}if(this._def.catchall instanceof at){let u=this._def.unknownKeys;if(u==="passthrough")for(let l of a)c.push({key:{status:"valid",value:l},value:{status:"valid",value:o.data[l]}});else if(u==="strict")a.length>0&&(S(o,{code:$.unrecognized_keys,keys:a}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let l of a){let d=o.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Xe(o,d,o.path,l)),alwaysSet:l in o.data})}}return o.common.async?Promise.resolve().then(async()=>{let u=[];for(let l of c){let d=await l.key,h=await l.value;u.push({key:d,value:h,alwaysSet:l.alwaysSet})}return u}).then(u=>we.mergeObjectSync(n,u)):we.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return I.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{let o=this._def.errorMap?.(r,n).message??n.defaultError;return r.code==="unrecognized_keys"?{message:I.errToObj(e).message??o}:{message:o}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:w.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};for(let n of B.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}omit(e){let r={};for(let n of B.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}deepPartial(){return Ur(this)}partial(e){let r={};for(let n of B.objectKeys(this.shape)){let o=this.shape[n];e&&!e[n]?r[n]=o:r[n]=o.optional()}return new t({...this._def,shape:()=>r})}required(e){let r={};for(let n of B.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof Le;)s=s._def.innerType;r[n]=s}return new t({...this._def,shape:()=>r})}keyof(){return vd(B.objectKeys(this.shape))}};Ue.create=(t,e)=>new Ue({shape:()=>t,unknownKeys:"strip",catchall:at.create(),typeName:w.ZodObject,...L(e)});Ue.strictCreate=(t,e)=>new Ue({shape:()=>t,unknownKeys:"strict",catchall:at.create(),typeName:w.ZodObject,...L(e)});Ue.lazycreate=(t,e)=>new Ue({shape:t,unknownKeys:"strip",catchall:at.create(),typeName:w.ZodObject,...L(e)});var dr=class extends F{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function o(s){for(let a of s)if(a.result.status==="valid")return a.result;for(let a of s)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;let i=s.map(a=>new qe(a.ctx.common.issues));return S(r,{code:$.invalid_union,unionErrors:i}),Z}if(r.common.async)return Promise.all(n.map(async s=>{let i={...r,common:{...r.common,issues:[]},parent:null};return{result:await s._parseAsync({data:r.data,path:r.path,parent:i}),ctx:i}})).then(o);{let s,i=[];for(let c of n){let u={...r,common:{...r.common,issues:[]},parent:null},l=c._parseSync({data:r.data,path:r.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!s&&(s={result:l,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(s)return r.common.issues.push(...s.ctx.common.issues),s.result;let a=i.map(c=>new qe(c));return S(r,{code:$.invalid_union,unionErrors:a}),Z}}get options(){return this._def.options}};dr.create=(t,e)=>new dr({options:t,typeName:w.ZodUnion,...L(e)});var zt=t=>t instanceof fr?zt(t.schema):t instanceof Ye?zt(t.innerType()):t instanceof mr?[t.value]:t instanceof hr?t.options:t instanceof gr?B.objectValues(t.enum):t instanceof yr?zt(t._def.innerType):t instanceof ur?[void 0]:t instanceof lr?[null]:t instanceof Le?[void 0,...zt(t.unwrap())]:t instanceof _t?[null,...zt(t.unwrap())]:t instanceof Sn||t instanceof vr?zt(t.unwrap()):t instanceof _r?zt(t._def.innerType):[],jo=class t extends F{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==P.object)return S(r,{code:$.invalid_type,expected:P.object,received:r.parsedType}),Z;let n=this.discriminator,o=r.data[n],s=this.optionsMap.get(o);return s?r.common.async?s._parseAsync({data:r.data,path:r.path,parent:r}):s._parseSync({data:r.data,path:r.path,parent:r}):(S(r,{code:$.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),Z)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let o=new Map;for(let s of r){let i=zt(s.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of i){if(o.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);o.set(a,s)}}return new t({typeName:w.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:o,...L(n)})}};function Ri(t,e){let r=gt(t),n=gt(e);if(t===e)return{valid:!0,data:t};if(r===P.object&&n===P.object){let o=B.objectKeys(e),s=B.objectKeys(t).filter(a=>o.indexOf(a)!==-1),i={...t,...e};for(let a of s){let c=Ri(t[a],e[a]);if(!c.valid)return{valid:!1};i[a]=c.data}return{valid:!0,data:i}}else if(r===P.array&&n===P.array){if(t.length!==e.length)return{valid:!1};let o=[];for(let s=0;s<t.length;s++){let i=t[s],a=e[s],c=Ri(i,a);if(!c.valid)return{valid:!1};o.push(c.data)}return{valid:!0,data:o}}else return r===P.date&&n===P.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var pr=class extends F{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=(s,i)=>{if(Co(s)||Co(i))return Z;let a=Ri(s.value,i.value);return a.valid?((Ro(s)||Ro(i))&&r.dirty(),{status:r.value,value:a.data}):(S(n,{code:$.invalid_intersection_types}),Z)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,i])=>o(s,i)):o(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};pr.create=(t,e,r)=>new pr({left:t,right:e,typeName:w.ZodIntersection,...L(r)});var yt=class t extends F{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.array)return S(n,{code:$.invalid_type,expected:P.array,received:n.parsedType}),Z;if(n.data.length<this._def.items.length)return S(n,{code:$.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Z;!this._def.rest&&n.data.length>this._def.items.length&&(S(n,{code:$.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let s=[...n.data].map((i,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new Xe(n,i,n.path,a)):null}).filter(i=>!!i);return n.common.async?Promise.all(s).then(i=>we.mergeArray(r,i)):we.mergeArray(r,s)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};yt.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new yt({items:t,typeName:w.ZodTuple,rest:null,...L(e)})};var Oo=class t extends F{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.object)return S(n,{code:$.invalid_type,expected:P.object,received:n.parsedType}),Z;let o=[],s=this._def.keyType,i=this._def.valueType;for(let a in n.data)o.push({key:s._parse(new Xe(n,a,n.path,a)),value:i._parse(new Xe(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?we.mergeObjectAsync(r,o):we.mergeObjectSync(r,o)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof F?new t({keyType:e,valueType:r,typeName:w.ZodRecord,...L(n)}):new t({keyType:qt.create(),valueType:e,typeName:w.ZodRecord,...L(r)})}},Kr=class extends F{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.map)return S(n,{code:$.invalid_type,expected:P.map,received:n.parsedType}),Z;let o=this._def.keyType,s=this._def.valueType,i=[...n.data.entries()].map(([a,c],u)=>({key:o._parse(new Xe(n,a,n.path,[u,"key"])),value:s._parse(new Xe(n,c,n.path,[u,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of i){let u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return Z;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}})}else{let a=new Map;for(let c of i){let u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return Z;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}}}};Kr.create=(t,e,r)=>new Kr({valueType:e,keyType:t,typeName:w.ZodMap,...L(r)});var Hr=class t extends F{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.set)return S(n,{code:$.invalid_type,expected:P.set,received:n.parsedType}),Z;let o=this._def;o.minSize!==null&&n.data.size<o.minSize.value&&(S(n,{code:$.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),r.dirty()),o.maxSize!==null&&n.data.size>o.maxSize.value&&(S(n,{code:$.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),r.dirty());let s=this._def.valueType;function i(c){let u=new Set;for(let l of c){if(l.status==="aborted")return Z;l.status==="dirty"&&r.dirty(),u.add(l.value)}return{status:r.value,value:u}}let a=[...n.data.values()].map((c,u)=>s._parse(new Xe(n,c,n.path,u)));return n.common.async?Promise.all(a).then(c=>i(c)):i(a)}min(e,r){return new t({...this._def,minSize:{value:e,message:I.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:I.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};Hr.create=(t,e)=>new Hr({valueType:t,minSize:null,maxSize:null,typeName:w.ZodSet,...L(e)});var No=class t extends F{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==P.function)return S(r,{code:$.invalid_type,expected:P.function,received:r.parsedType}),Z;function n(a,c){return kn({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,qr(),Tt].filter(u=>!!u),issueData:{code:$.invalid_arguments,argumentsError:c}})}function o(a,c){return kn({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,qr(),Tt].filter(u=>!!u),issueData:{code:$.invalid_return_type,returnTypeError:c}})}let s={errorMap:r.common.contextualErrorMap},i=r.data;if(this._def.returns instanceof Ut){let a=this;return Ie(async function(...c){let u=new qe([]),l=await a._def.args.parseAsync(c,s).catch(f=>{throw u.addIssue(n(c,f)),u}),d=await Reflect.apply(i,this,l);return await a._def.returns._def.type.parseAsync(d,s).catch(f=>{throw u.addIssue(o(d,f)),u})})}else{let a=this;return Ie(function(...c){let u=a._def.args.safeParse(c,s);if(!u.success)throw new qe([n(c,u.error)]);let l=Reflect.apply(i,this,u.data),d=a._def.returns.safeParse(l,s);if(!d.success)throw new qe([o(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:yt.create(e).rest(Pt.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||yt.create([]).rest(Pt.create()),returns:r||Pt.create(),typeName:w.ZodFunction,...L(n)})}},fr=class extends F{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};fr.create=(t,e)=>new fr({getter:t,typeName:w.ZodLazy,...L(e)});var mr=class extends F{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return S(r,{received:r.data,code:$.invalid_literal,expected:this._def.value}),Z}return{status:"valid",value:e.data}}get value(){return this._def.value}};mr.create=(t,e)=>new mr({value:t,typeName:w.ZodLiteral,...L(e)});function vd(t,e){return new hr({values:t,typeName:w.ZodEnum,...L(e)})}var hr=class t extends F{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return S(r,{expected:B.joinValues(n),received:r.parsedType,code:$.invalid_type}),Z}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return S(r,{received:r.data,code:$.invalid_enum_value,options:n}),Z}return Ie(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};hr.create=vd;var gr=class extends F{_parse(e){let r=B.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==P.string&&n.parsedType!==P.number){let o=B.objectValues(r);return S(n,{expected:B.joinValues(o),received:n.parsedType,code:$.invalid_type}),Z}if(this._cache||(this._cache=new Set(B.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let o=B.objectValues(r);return S(n,{received:n.data,code:$.invalid_enum_value,options:o}),Z}return Ie(e.data)}get enum(){return this._def.values}};gr.create=(t,e)=>new gr({values:t,typeName:w.ZodNativeEnum,...L(e)});var Ut=class extends F{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==P.promise&&r.common.async===!1)return S(r,{code:$.invalid_type,expected:P.promise,received:r.parsedType}),Z;let n=r.parsedType===P.promise?r.data:Promise.resolve(r.data);return Ie(n.then(o=>this._def.type.parseAsync(o,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Ut.create=(t,e)=>new Ut({type:t,typeName:w.ZodPromise,...L(e)});var Ye=class extends F{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===w.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=this._def.effect||null,s={addIssue:i=>{S(n,i),i.fatal?r.abort():r.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),o.type==="preprocess"){let i=o.transform(n.data,s);if(n.common.async)return Promise.resolve(i).then(async a=>{if(r.value==="aborted")return Z;let c=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return c.status==="aborted"?Z:c.status==="dirty"?or(c.value):r.value==="dirty"?or(c.value):c});{if(r.value==="aborted")return Z;let a=this._def.schema._parseSync({data:i,path:n.path,parent:n});return a.status==="aborted"?Z:a.status==="dirty"?or(a.value):r.value==="dirty"?or(a.value):a}}if(o.type==="refinement"){let i=a=>{let c=o.refinement(a,s);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?Z:(a.status==="dirty"&&r.dirty(),i(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?Z:(a.status==="dirty"&&r.dirty(),i(a.value).then(()=>({status:r.value,value:a.value}))))}if(o.type==="transform")if(n.common.async===!1){let i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Dt(i))return Z;let a=o.transform(i.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>Dt(i)?Promise.resolve(o.transform(i.value,s)).then(a=>({status:r.value,value:a})):Z);B.assertNever(o)}};Ye.create=(t,e,r)=>new Ye({schema:t,typeName:w.ZodEffects,effect:e,...L(r)});Ye.createWithPreprocess=(t,e,r)=>new Ye({schema:e,effect:{type:"preprocess",transform:t},typeName:w.ZodEffects,...L(r)});var Le=class extends F{_parse(e){return this._getType(e)===P.undefined?Ie(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Le.create=(t,e)=>new Le({innerType:t,typeName:w.ZodOptional,...L(e)});var _t=class extends F{_parse(e){return this._getType(e)===P.null?Ie(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};_t.create=(t,e)=>new _t({innerType:t,typeName:w.ZodNullable,...L(e)});var yr=class extends F{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===P.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};yr.create=(t,e)=>new yr({innerType:t,typeName:w.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...L(e)});var _r=class extends F{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},o=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Lr(o)?o.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new qe(n.common.issues)},input:n.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new qe(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};_r.create=(t,e)=>new _r({innerType:t,typeName:w.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...L(e)});var Br=class extends F{_parse(e){if(this._getType(e)!==P.nan){let n=this._getOrReturnCtx(e);return S(n,{code:$.invalid_type,expected:P.nan,received:n.parsedType}),Z}return{status:"valid",value:e.data}}};Br.create=t=>new Br({typeName:w.ZodNaN,...L(t)});var o_=Symbol("zod_brand"),Sn=class extends F{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},Tn=class t extends F{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?Z:s.status==="dirty"?(r.dirty(),or(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{let o=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?Z:o.status==="dirty"?(r.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:w.ZodPipeline})}},vr=class extends F{_parse(e){let r=this._def.innerType._parse(e),n=o=>(Dt(o)&&(o.value=Object.freeze(o.value)),o);return Lr(r)?r.then(o=>n(o)):n(r)}unwrap(){return this._def.innerType}};vr.create=(t,e)=>new vr({innerType:t,typeName:w.ZodReadonly,...L(e)});function hd(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function xd(t,e={},r){return t?Lt.create().superRefine((n,o)=>{let s=t(n);if(s instanceof Promise)return s.then(i=>{if(!i){let a=hd(e,n),c=a.fatal??r??!0;o.addIssue({code:"custom",...a,fatal:c})}});if(!s){let i=hd(e,n),a=i.fatal??r??!0;o.addIssue({code:"custom",...i,fatal:a})}}):Lt.create()}var s_={object:Ue.lazycreate},w;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(w||(w={}));var i_=(t,e={message:`Input not instance of ${t.name}`})=>xd(r=>r instanceof t,e),bd=qt.create,$d=sr.create,a_=Br.create,c_=ir.create,wd=ar.create,u_=cr.create,l_=Fr.create,d_=ur.create,p_=lr.create,f_=Lt.create,m_=Pt.create,h_=at.create,g_=Vr.create,y_=Et.create,ji=Ue.create,__=Ue.strictCreate,v_=dr.create,x_=jo.create,b_=pr.create,$_=yt.create,w_=Oo.create,k_=Kr.create,S_=Hr.create,T_=No.create,z_=fr.create,P_=mr.create,E_=hr.create,I_=gr.create,C_=Ut.create,R_=Ye.create,j_=Le.create,O_=_t.create,N_=Ye.createWithPreprocess,A_=Tn.create,Z_=()=>bd().optional(),M_=()=>$d().optional(),D_=()=>wd().optional(),q_={string:(t=>qt.create({...t,coerce:!0})),number:(t=>sr.create({...t,coerce:!0})),boolean:(t=>ar.create({...t,coerce:!0})),bigint:(t=>ir.create({...t,coerce:!0})),date:(t=>cr.create({...t,coerce:!0}))};var L_=Z;var U_=Object.freeze({status:"aborted"});function _(t,e,r){function n(a,c){var u;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(u=a._zod).traits??(u.traits=new Set),a._zod.traits.add(t),e(a,c);for(let l in i.prototype)l in a||Object.defineProperty(a,l,{value:i.prototype[l].bind(a)});a._zod.constr=i,a._zod.def=c}let o=r?.Parent??Object;class s extends o{}Object.defineProperty(s,"name",{value:t});function i(a){var c;let u=r?.Parent?new s:this;n(u,a),(c=u._zod).deferred??(c.deferred=[]);for(let l of u._zod.deferred)l();return u}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(t)}),Object.defineProperty(i,"name",{value:t}),i}var It=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},Ao={};function Je(t){return t&&Object.assign(Ao,t),Ao}var J={};Ei(J,{BIGINT_FORMAT_RANGES:()=>Sd,Class:()=>Ni,NUMBER_FORMAT_RANGES:()=>Ui,aborted:()=>br,allowsEval:()=>Di,assert:()=>B_,assertEqual:()=>F_,assertIs:()=>K_,assertNever:()=>H_,assertNotEqual:()=>V_,assignProp:()=>Mi,cached:()=>En,captureStackTrace:()=>Mo,cleanEnum:()=>iv,cleanRegex:()=>Cn,clone:()=>Ge,createTransparentProxy:()=>Q_,defineLazy:()=>ie,esc:()=>xr,escapeRegex:()=>Ft,extend:()=>rv,finalizeIssue:()=>ct,floatSafeRemainder:()=>Zi,getElementAtPath:()=>J_,getEnumValues:()=>Pn,getLengthableOrigin:()=>Rn,getParsedType:()=>Y_,getSizableOrigin:()=>Td,isObject:()=>Jr,isPlainObject:()=>Gr,issue:()=>Fi,joinValues:()=>Zo,jsonStringifyReplacer:()=>Ai,merge:()=>nv,normalizeParams:()=>M,nullish:()=>In,numKeys:()=>X_,omit:()=>tv,optionalKeys:()=>Li,partial:()=>ov,pick:()=>ev,prefixIssues:()=>vt,primitiveTypes:()=>kd,promiseAllObject:()=>G_,propertyKeyTypes:()=>qi,randomString:()=>W_,required:()=>sv,stringifyPrimitive:()=>Do,unwrapMessage:()=>zn});function F_(t){return t}function V_(t){return t}function K_(t){}function H_(t){throw new Error}function B_(t){}function Pn(t){let e=Object.values(t).filter(n=>typeof n=="number");return Object.entries(t).filter(([n,o])=>e.indexOf(+n)===-1).map(([n,o])=>o)}function Zo(t,e="|"){return t.map(r=>Do(r)).join(e)}function Ai(t,e){return typeof e=="bigint"?e.toString():e}function En(t){return{get value(){{let r=t();return Object.defineProperty(this,"value",{value:r}),r}throw new Error("cached value already set")}}}function In(t){return t==null}function Cn(t){let e=t.startsWith("^")?1:0,r=t.endsWith("$")?t.length-1:t.length;return t.slice(e,r)}function Zi(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,s=Number.parseInt(t.toFixed(o).replace(".","")),i=Number.parseInt(e.toFixed(o).replace(".",""));return s%i/10**o}function ie(t,e,r){Object.defineProperty(t,e,{get(){{let o=r();return t[e]=o,o}throw new Error("cached value already set")},set(o){Object.defineProperty(t,e,{value:o})},configurable:!0})}function Mi(t,e,r){Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}function J_(t,e){return e?e.reduce((r,n)=>r?.[n],t):t}function G_(t){let e=Object.keys(t),r=e.map(n=>t[n]);return Promise.all(r).then(n=>{let o={};for(let s=0;s<e.length;s++)o[e[s]]=n[s];return o})}function W_(t=10){let e="abcdefghijklmnopqrstuvwxyz",r="";for(let n=0;n<t;n++)r+=e[Math.floor(Math.random()*e.length)];return r}function xr(t){return JSON.stringify(t)}var Mo=Error.captureStackTrace?Error.captureStackTrace:(...t)=>{};function Jr(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}var Di=En(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let t=Function;return new t(""),!0}catch{return!1}});function Gr(t){if(Jr(t)===!1)return!1;let e=t.constructor;if(e===void 0)return!0;let r=e.prototype;return!(Jr(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function X_(t){let e=0;for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}var Y_=t=>{let e=typeof t;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(t)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(t)?"array":t===null?"null":t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?"promise":typeof Map<"u"&&t instanceof Map?"map":typeof Set<"u"&&t instanceof Set?"set":typeof Date<"u"&&t instanceof Date?"date":typeof File<"u"&&t instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},qi=new Set(["string","number","symbol"]),kd=new Set(["string","number","bigint","boolean","symbol","undefined"]);function Ft(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ge(t,e,r){let n=new t._zod.constr(e??t._zod.def);return(!e||r?.parent)&&(n._zod.parent=t),n}function M(t){let e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function Q_(t){let e;return new Proxy({},{get(r,n,o){return e??(e=t()),Reflect.get(e,n,o)},set(r,n,o,s){return e??(e=t()),Reflect.set(e,n,o,s)},has(r,n){return e??(e=t()),Reflect.has(e,n)},deleteProperty(r,n){return e??(e=t()),Reflect.deleteProperty(e,n)},ownKeys(r){return e??(e=t()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(r,n){return e??(e=t()),Reflect.getOwnPropertyDescriptor(e,n)},defineProperty(r,n,o){return e??(e=t()),Reflect.defineProperty(e,n,o)}})}function Do(t){return typeof t=="bigint"?t.toString()+"n":typeof t=="string"?`"${t}"`:`${t}`}function Li(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}var Ui={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},Sd={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function ev(t,e){let r={},n=t._zod.def;for(let o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&(r[o]=n.shape[o])}return Ge(t,{...t._zod.def,shape:r,checks:[]})}function tv(t,e){let r={...t._zod.def.shape},n=t._zod.def;for(let o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&delete r[o]}return Ge(t,{...t._zod.def,shape:r,checks:[]})}function rv(t,e){if(!Gr(e))throw new Error("Invalid input to extend: expected a plain object");let r={...t._zod.def,get shape(){let n={...t._zod.def.shape,...e};return Mi(this,"shape",n),n},checks:[]};return Ge(t,r)}function nv(t,e){return Ge(t,{...t._zod.def,get shape(){let r={...t._zod.def.shape,...e._zod.def.shape};return Mi(this,"shape",r),r},catchall:e._zod.def.catchall,checks:[]})}function ov(t,e,r){let n=e._zod.def.shape,o={...n};if(r)for(let s in r){if(!(s in n))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=t?new t({type:"optional",innerType:n[s]}):n[s])}else for(let s in n)o[s]=t?new t({type:"optional",innerType:n[s]}):n[s];return Ge(e,{...e._zod.def,shape:o,checks:[]})}function sv(t,e,r){let n=e._zod.def.shape,o={...n};if(r)for(let s in r){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=new t({type:"nonoptional",innerType:n[s]}))}else for(let s in n)o[s]=new t({type:"nonoptional",innerType:n[s]});return Ge(e,{...e._zod.def,shape:o,checks:[]})}function br(t,e=0){for(let r=e;r<t.issues.length;r++)if(t.issues[r]?.continue!==!0)return!0;return!1}function vt(t,e){return e.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(t),r})}function zn(t){return typeof t=="string"?t:t?.message}function ct(t,e,r){let n={...t,path:t.path??[]};if(!t.message){let o=zn(t.inst?._zod.def?.error?.(t))??zn(e?.error?.(t))??zn(r.customError?.(t))??zn(r.localeError?.(t))??"Invalid input";n.message=o}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}function Td(t){return t instanceof Set?"set":t instanceof Map?"map":t instanceof File?"file":"unknown"}function Rn(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function Fi(...t){let[e,r,n]=t;return typeof e=="string"?{message:e,code:"custom",input:r,inst:n}:{...e}}function iv(t){return Object.entries(t).filter(([e,r])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}var Ni=class{constructor(...e){}};var zd=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),Object.defineProperty(t,"message",{get(){return JSON.stringify(e,Ai,2)},enumerable:!0}),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},qo=_("$ZodError",zd),jn=_("$ZodError",zd,{Parent:Error});function Vi(t,e=r=>r.message){let r={},n=[];for(let o of t.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(e(o))):n.push(e(o));return{formErrors:n,fieldErrors:r}}function Ki(t,e){let r=e||function(s){return s.message},n={_errors:[]},o=s=>{for(let i of s.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(a=>o({issues:a}));else if(i.code==="invalid_key")o({issues:i.issues});else if(i.code==="invalid_element")o({issues:i.issues});else if(i.path.length===0)n._errors.push(r(i));else{let a=n,c=0;for(;c<i.path.length;){let u=i.path[c];c===i.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(i))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return o(t),n}var Hi=t=>(e,r,n,o)=>{let s=n?Object.assign(n,{async:!1}):{async:!1},i=e._zod.run({value:r,issues:[]},s);if(i instanceof Promise)throw new It;if(i.issues.length){let a=new(o?.Err??t)(i.issues.map(c=>ct(c,s,Je())));throw Mo(a,o?.callee),a}return i.value},Bi=Hi(jn),Ji=t=>async(e,r,n,o)=>{let s=n?Object.assign(n,{async:!0}):{async:!0},i=e._zod.run({value:r,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){let a=new(o?.Err??t)(i.issues.map(c=>ct(c,s,Je())));throw Mo(a,o?.callee),a}return i.value},Gi=Ji(jn),Wi=t=>(e,r,n)=>{let o=n?{...n,async:!1}:{async:!1},s=e._zod.run({value:r,issues:[]},o);if(s instanceof Promise)throw new It;return s.issues.length?{success:!1,error:new(t??qo)(s.issues.map(i=>ct(i,o,Je())))}:{success:!0,data:s.value}},$r=Wi(jn),Xi=t=>async(e,r,n)=>{let o=n?Object.assign(n,{async:!0}):{async:!0},s=e._zod.run({value:r,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new t(s.issues.map(i=>ct(i,o,Je())))}:{success:!0,data:s.value}},wr=Xi(jn);var Pd=/^[cC][^\s-]{8,}$/,Ed=/^[0-9a-z]+$/,Id=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Cd=/^[0-9a-vA-V]{20}$/,Rd=/^[A-Za-z0-9]{27}$/,jd=/^[a-zA-Z0-9_-]{21}$/,Od=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/;var Nd=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Yi=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/;var Ad=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;var cv="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Zd(){return new RegExp(cv,"u")}var Md=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Dd=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,qd=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Ld=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ud=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Qi=/^[A-Za-z0-9_-]*$/,Fd=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/;var Vd=/^\+(?:[0-9]){6,14}[0-9]$/,Kd="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",Hd=new RegExp(`^${Kd}$`);function Bd(t){let e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function Jd(t){return new RegExp(`^${Bd(t)}$`)}function Gd(t){let e=Bd({precision:t.precision}),r=["Z"];t.local&&r.push(""),t.offset&&r.push("([+-]\\d{2}:\\d{2})");let n=`${e}(?:${r.join("|")})`;return new RegExp(`^${Kd}T(?:${n})$`)}var Wd=t=>{let e=t?`[\\s\\S]{${t?.minimum??0},${t?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)};var Xd=/^\d+$/,Yd=/^-?\d+(?:\.\d+)?/i,Qd=/true|false/i,ep=/null/i;var tp=/^[^A-Z]*$/,rp=/^[^a-z]*$/;var ke=_("$ZodCheck",(t,e)=>{var r;t._zod??(t._zod={}),t._zod.def=e,(r=t._zod).onattach??(r.onattach=[])}),np={number:"number",bigint:"bigint",object:"date"},ea=_("$ZodCheckLessThan",(t,e)=>{ke.init(t,e);let r=np[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,s=(e.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<s&&(e.inclusive?o.maximum=e.value:o.exclusiveMaximum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value<=e.value:n.value<e.value)||n.issues.push({origin:r,code:"too_big",maximum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),ta=_("$ZodCheckGreaterThan",(t,e)=>{ke.init(t,e);let r=np[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,s=(e.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>s&&(e.inclusive?o.minimum=e.value:o.exclusiveMinimum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value>=e.value:n.value>e.value)||n.issues.push({origin:r,code:"too_small",minimum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),op=_("$ZodCheckMultipleOf",(t,e)=>{ke.init(t,e),t._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=e.value)}),t._zod.check=r=>{if(typeof r.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%e.value===BigInt(0):Zi(r.value,e.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:e.value,input:r.value,inst:t,continue:!e.abort})}}),sp=_("$ZodCheckNumberFormat",(t,e)=>{ke.init(t,e),e.format=e.format||"float64";let r=e.format?.includes("int"),n=r?"int":"number",[o,s]=Ui[e.format];t._zod.onattach.push(i=>{let a=i._zod.bag;a.format=e.format,a.minimum=o,a.maximum=s,r&&(a.pattern=Xd)}),t._zod.check=i=>{let a=i.value;if(r){if(!Number.isInteger(a)){i.issues.push({expected:n,format:e.format,code:"invalid_type",input:a,inst:t});return}if(!Number.isSafeInteger(a)){a>0?i.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort}):i.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort});return}}a<o&&i.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:t,continue:!e.abort}),a>s&&i.issues.push({origin:"number",input:a,code:"too_big",maximum:s,inst:t})}});var ip=_("$ZodCheckMaxLength",(t,e)=>{var r;ke.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!In(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let o=n.value;if(o.length<=e.maximum)return;let i=Rn(o);n.issues.push({origin:i,code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),ap=_("$ZodCheckMinLength",(t,e)=>{var r;ke.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!In(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let o=n.value;if(o.length>=e.minimum)return;let i=Rn(o);n.issues.push({origin:i,code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),cp=_("$ZodCheckLengthEquals",(t,e)=>{var r;ke.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!In(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag;o.minimum=e.length,o.maximum=e.length,o.length=e.length}),t._zod.check=n=>{let o=n.value,s=o.length;if(s===e.length)return;let i=Rn(o),a=s>e.length;n.issues.push({origin:i,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),On=_("$ZodCheckStringFormat",(t,e)=>{var r,n;ke.init(t,e),t._zod.onattach.push(o=>{let s=o._zod.bag;s.format=e.format,e.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(e.pattern))}),e.pattern?(r=t._zod).check??(r.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:e.format,input:o.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(n=t._zod).check??(n.check=()=>{})}),up=_("$ZodCheckRegex",(t,e)=>{On.init(t,e),t._zod.check=r=>{e.pattern.lastIndex=0,!e.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),lp=_("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=tp),On.init(t,e)}),dp=_("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=rp),On.init(t,e)}),pp=_("$ZodCheckIncludes",(t,e)=>{ke.init(t,e);let r=Ft(e.includes),n=new RegExp(typeof e.position=="number"?`^.{${e.position}}${r}`:r);e.pattern=n,t._zod.onattach.push(o=>{let s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),t._zod.check=o=>{o.value.includes(e.includes,e.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:o.value,inst:t,continue:!e.abort})}}),fp=_("$ZodCheckStartsWith",(t,e)=>{ke.init(t,e);let r=new RegExp(`^${Ft(e.prefix)}.*`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.startsWith(e.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:n.value,inst:t,continue:!e.abort})}}),mp=_("$ZodCheckEndsWith",(t,e)=>{ke.init(t,e);let r=new RegExp(`.*${Ft(e.suffix)}$`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.endsWith(e.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:n.value,inst:t,continue:!e.abort})}});var hp=_("$ZodCheckOverwrite",(t,e)=>{ke.init(t,e),t._zod.check=r=>{r.value=e.tx(r.value)}});var Uo=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let n=e.split(`
`).filter(i=>i),o=Math.min(...n.map(i=>i.length-i.trimStart().length)),s=n.map(i=>i.slice(o)).map(i=>" ".repeat(this.indent*2)+i);for(let i of s)this.content.push(i)}compile(){let e=Function,r=this?.args,o=[...(this?.content??[""]).map(s=>`  ${s}`)];return new e(...r,o.join(`
`))}};var yp={major:4,minor:0,patch:0};var ne=_("$ZodType",(t,e)=>{var r;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=yp;let n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(let o of n)for(let s of o._zod.onattach)s(t);if(n.length===0)(r=t._zod).deferred??(r.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{let o=(s,i,a)=>{let c=br(s),u;for(let l of i){if(l._zod.def.when){if(!l._zod.def.when(s))continue}else if(c)continue;let d=s.issues.length,h=l._zod.check(s);if(h instanceof Promise&&a?.async===!1)throw new It;if(u||h instanceof Promise)u=(u??Promise.resolve()).then(async()=>{await h,s.issues.length!==d&&(c||(c=br(s,d)))});else{if(s.issues.length===d)continue;c||(c=br(s,d))}}return u?u.then(()=>s):s};t._zod.run=(s,i)=>{let a=t._zod.parse(s,i);if(a instanceof Promise){if(i.async===!1)throw new It;return a.then(c=>o(c,n,i))}return o(a,n,i)}}t["~standard"]={validate:o=>{try{let s=$r(t,o);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return wr(t,o).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}}),Nn=_("$ZodString",(t,e)=>{ne.init(t,e),t._zod.pattern=[...t?._zod.bag?.patterns??[]].pop()??Wd(t._zod.bag),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),ae=_("$ZodStringFormat",(t,e)=>{On.init(t,e),Nn.init(t,e)}),na=_("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=Nd),ae.init(t,e)}),oa=_("$ZodUUID",(t,e)=>{if(e.version){let n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(n===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=Yi(n))}else e.pattern??(e.pattern=Yi());ae.init(t,e)}),sa=_("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=Ad),ae.init(t,e)}),ia=_("$ZodURL",(t,e)=>{ae.init(t,e),t._zod.check=r=>{try{let n=r.value,o=new URL(n),s=o.href;e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(o.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:Fd.source,input:r.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:r.value,inst:t,continue:!e.abort})),!n.endsWith("/")&&s.endsWith("/")?r.value=s.slice(0,-1):r.value=s;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:t,continue:!e.abort})}}}),aa=_("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=Zd()),ae.init(t,e)}),ca=_("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=jd),ae.init(t,e)}),ua=_("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=Pd),ae.init(t,e)}),la=_("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=Ed),ae.init(t,e)}),da=_("$ZodULID",(t,e)=>{e.pattern??(e.pattern=Id),ae.init(t,e)}),pa=_("$ZodXID",(t,e)=>{e.pattern??(e.pattern=Cd),ae.init(t,e)}),fa=_("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=Rd),ae.init(t,e)}),zp=_("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=Gd(e)),ae.init(t,e)}),Pp=_("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=Hd),ae.init(t,e)}),Ep=_("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=Jd(e)),ae.init(t,e)}),Ip=_("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=Od),ae.init(t,e)}),ma=_("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=Md),ae.init(t,e),t._zod.onattach.push(r=>{let n=r._zod.bag;n.format="ipv4"})}),ha=_("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=Dd),ae.init(t,e),t._zod.onattach.push(r=>{let n=r._zod.bag;n.format="ipv6"}),t._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:t,continue:!e.abort})}}}),ga=_("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=qd),ae.init(t,e)}),ya=_("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=Ld),ae.init(t,e),t._zod.check=r=>{let[n,o]=r.value.split("/");try{if(!o)throw new Error;let s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${n}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:t,continue:!e.abort})}}});function Cp(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}var _a=_("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=Ud),ae.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),t._zod.check=r=>{Cp(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:t,continue:!e.abort})}});function uv(t){if(!Qi.test(t))return!1;let e=t.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=e.padEnd(Math.ceil(e.length/4)*4,"=");return Cp(r)}var va=_("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=Qi),ae.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),t._zod.check=r=>{uv(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:t,continue:!e.abort})}}),xa=_("$ZodE164",(t,e)=>{e.pattern??(e.pattern=Vd),ae.init(t,e)});function lv(t,e=null){try{let r=t.split(".");if(r.length!==3)return!1;let[n]=r;if(!n)return!1;let o=JSON.parse(atob(n));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||e&&(!("alg"in o)||o.alg!==e))}catch{return!1}}var ba=_("$ZodJWT",(t,e)=>{ae.init(t,e),t._zod.check=r=>{lv(r.value,e.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:t,continue:!e.abort})}});var Vo=_("$ZodNumber",(t,e)=>{ne.init(t,e),t._zod.pattern=t._zod.bag.pattern??Yd,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=Number(r.value)}catch{}let o=r.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return r;let s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:o,inst:t,...s?{received:s}:{}}),r}}),$a=_("$ZodNumber",(t,e)=>{sp.init(t,e),Vo.init(t,e)}),wa=_("$ZodBoolean",(t,e)=>{ne.init(t,e),t._zod.pattern=Qd,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=!!r.value}catch{}let o=r.value;return typeof o=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:t}),r}});var ka=_("$ZodNull",(t,e)=>{ne.init(t,e),t._zod.pattern=ep,t._zod.values=new Set([null]),t._zod.parse=(r,n)=>{let o=r.value;return o===null||r.issues.push({expected:"null",code:"invalid_type",input:o,inst:t}),r}});var Sa=_("$ZodUnknown",(t,e)=>{ne.init(t,e),t._zod.parse=r=>r}),Ta=_("$ZodNever",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)});function _p(t,e,r){t.issues.length&&e.issues.push(...vt(r,t.issues)),e.value[r]=t.value}var za=_("$ZodArray",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Array.isArray(o))return r.issues.push({expected:"array",code:"invalid_type",input:o,inst:t}),r;r.value=Array(o.length);let s=[];for(let i=0;i<o.length;i++){let a=o[i],c=e.element._zod.run({value:a,issues:[]},n);c instanceof Promise?s.push(c.then(u=>_p(u,r,i))):_p(c,r,i)}return s.length?Promise.all(s).then(()=>r):r}});function Fo(t,e,r){t.issues.length&&e.issues.push(...vt(r,t.issues)),e.value[r]=t.value}function vp(t,e,r,n){t.issues.length?n[r]===void 0?r in n?e.value[r]=void 0:e.value[r]=t.value:e.issues.push(...vt(r,t.issues)):t.value===void 0?r in n&&(e.value[r]=void 0):e.value[r]=t.value}var Ko=_("$ZodObject",(t,e)=>{ne.init(t,e);let r=En(()=>{let d=Object.keys(e.shape);for(let f of d)if(!(e.shape[f]instanceof ne))throw new Error(`Invalid element at key "${f}": expected a Zod schema`);let h=Li(e.shape);return{shape:e.shape,keys:d,keySet:new Set(d),numKeys:d.length,optionalKeys:new Set(h)}});ie(t._zod,"propValues",()=>{let d=e.shape,h={};for(let f in d){let p=d[f]._zod;if(p.values){h[f]??(h[f]=new Set);for(let m of p.values)h[f].add(m)}}return h});let n=d=>{let h=new Uo(["shape","payload","ctx"]),f=r.value,p=x=>{let b=xr(x);return`shape[${b}]._zod.run({ value: input[${b}], issues: [] }, ctx)`};h.write("const input = payload.value;");let m=Object.create(null),g=0;for(let x of f.keys)m[x]=`key_${g++}`;h.write("const newResult = {}");for(let x of f.keys)if(f.optionalKeys.has(x)){let b=m[x];h.write(`const ${b} = ${p(x)};`);let k=xr(x);h.write(`
        if (${b}.issues.length) {
          if (input[${k}] === undefined) {
            if (${k} in input) {
              newResult[${k}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${b}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${k}, ...iss.path] : [${k}],
              }))
            );
          }
        } else if (${b}.value === undefined) {
          if (${k} in input) newResult[${k}] = undefined;
        } else {
          newResult[${k}] = ${b}.value;
        }
        `)}else{let b=m[x];h.write(`const ${b} = ${p(x)};`),h.write(`
          if (${b}.issues.length) payload.issues = payload.issues.concat(${b}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${xr(x)}, ...iss.path] : [${xr(x)}]
          })));`),h.write(`newResult[${xr(x)}] = ${b}.value`)}h.write("payload.value = newResult;"),h.write("return payload;");let v=h.compile();return(x,b)=>v(d,x,b)},o,s=Jr,i=!Ao.jitless,c=i&&Di.value,u=e.catchall,l;t._zod.parse=(d,h)=>{l??(l=r.value);let f=d.value;if(!s(f))return d.issues.push({expected:"object",code:"invalid_type",input:f,inst:t}),d;let p=[];if(i&&c&&h?.async===!1&&h.jitless!==!0)o||(o=n(e.shape)),d=o(d,h);else{d.value={};let b=l.shape;for(let k of l.keys){let T=b[k],A=T._zod.run({value:f[k],issues:[]},h),de=T._zod.optin==="optional"&&T._zod.optout==="optional";A instanceof Promise?p.push(A.then(Oe=>de?vp(Oe,d,k,f):Fo(Oe,d,k))):de?vp(A,d,k,f):Fo(A,d,k)}}if(!u)return p.length?Promise.all(p).then(()=>d):d;let m=[],g=l.keySet,v=u._zod,x=v.def.type;for(let b of Object.keys(f)){if(g.has(b))continue;if(x==="never"){m.push(b);continue}let k=v.run({value:f[b],issues:[]},h);k instanceof Promise?p.push(k.then(T=>Fo(T,d,b))):Fo(k,d,b)}return m.length&&d.issues.push({code:"unrecognized_keys",keys:m,input:f,inst:t}),p.length?Promise.all(p).then(()=>d):d}});function xp(t,e,r,n){for(let o of t)if(o.issues.length===0)return e.value=o.value,e;return e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(o=>o.issues.map(s=>ct(s,n,Je())))}),e}var Ho=_("$ZodUnion",(t,e)=>{ne.init(t,e),ie(t._zod,"optin",()=>e.options.some(r=>r._zod.optin==="optional")?"optional":void 0),ie(t._zod,"optout",()=>e.options.some(r=>r._zod.optout==="optional")?"optional":void 0),ie(t._zod,"values",()=>{if(e.options.every(r=>r._zod.values))return new Set(e.options.flatMap(r=>Array.from(r._zod.values)))}),ie(t._zod,"pattern",()=>{if(e.options.every(r=>r._zod.pattern)){let r=e.options.map(n=>n._zod.pattern);return new RegExp(`^(${r.map(n=>Cn(n.source)).join("|")})$`)}}),t._zod.parse=(r,n)=>{let o=!1,s=[];for(let i of e.options){let a=i._zod.run({value:r.value,issues:[]},n);if(a instanceof Promise)s.push(a),o=!0;else{if(a.issues.length===0)return a;s.push(a)}}return o?Promise.all(s).then(i=>xp(i,r,t,n)):xp(s,r,t,n)}}),Pa=_("$ZodDiscriminatedUnion",(t,e)=>{Ho.init(t,e);let r=t._zod.parse;ie(t._zod,"propValues",()=>{let o={};for(let s of e.options){let i=s._zod.propValues;if(!i||Object.keys(i).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(let[a,c]of Object.entries(i)){o[a]||(o[a]=new Set);for(let u of c)o[a].add(u)}}return o});let n=En(()=>{let o=e.options,s=new Map;for(let i of o){let a=i._zod.propValues[e.discriminator];if(!a||a.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(i)}"`);for(let c of a){if(s.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);s.set(c,i)}}return s});t._zod.parse=(o,s)=>{let i=o.value;if(!Jr(i))return o.issues.push({code:"invalid_type",expected:"object",input:i,inst:t}),o;let a=n.value.get(i?.[e.discriminator]);return a?a._zod.run(o,s):e.unionFallback?r(o,s):(o.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:i,path:[e.discriminator],inst:t}),o)}}),Ea=_("$ZodIntersection",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=r.value,s=e.left._zod.run({value:o,issues:[]},n),i=e.right._zod.run({value:o,issues:[]},n);return s instanceof Promise||i instanceof Promise?Promise.all([s,i]).then(([c,u])=>bp(r,c,u)):bp(r,s,i)}});function ra(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(Gr(t)&&Gr(e)){let r=Object.keys(e),n=Object.keys(t).filter(s=>r.indexOf(s)!==-1),o={...t,...e};for(let s of n){let i=ra(t[s],e[s]);if(!i.valid)return{valid:!1,mergeErrorPath:[s,...i.mergeErrorPath]};o[s]=i.data}return{valid:!0,data:o}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};let r=[];for(let n=0;n<t.length;n++){let o=t[n],s=e[n],i=ra(o,s);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};r.push(i.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function bp(t,e,r){if(e.issues.length&&t.issues.push(...e.issues),r.issues.length&&t.issues.push(...r.issues),br(t))return t;let n=ra(e.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return t.value=n.data,t}var Ia=_("$ZodRecord",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Gr(o))return r.issues.push({expected:"record",code:"invalid_type",input:o,inst:t}),r;let s=[];if(e.keyType._zod.values){let i=e.keyType._zod.values;r.value={};for(let c of i)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){let u=e.valueType._zod.run({value:o[c],issues:[]},n);u instanceof Promise?s.push(u.then(l=>{l.issues.length&&r.issues.push(...vt(c,l.issues)),r.value[c]=l.value})):(u.issues.length&&r.issues.push(...vt(c,u.issues)),r.value[c]=u.value)}let a;for(let c in o)i.has(c)||(a=a??[],a.push(c));a&&a.length>0&&r.issues.push({code:"unrecognized_keys",input:o,inst:t,keys:a})}else{r.value={};for(let i of Reflect.ownKeys(o)){if(i==="__proto__")continue;let a=e.keyType._zod.run({value:i,issues:[]},n);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){r.issues.push({origin:"record",code:"invalid_key",issues:a.issues.map(u=>ct(u,n,Je())),input:i,path:[i],inst:t}),r.value[a.value]=a.value;continue}let c=e.valueType._zod.run({value:o[i],issues:[]},n);c instanceof Promise?s.push(c.then(u=>{u.issues.length&&r.issues.push(...vt(i,u.issues)),r.value[a.value]=u.value})):(c.issues.length&&r.issues.push(...vt(i,c.issues)),r.value[a.value]=c.value)}}return s.length?Promise.all(s).then(()=>r):r}});var Ca=_("$ZodEnum",(t,e)=>{ne.init(t,e);let r=Pn(e.entries);t._zod.values=new Set(r),t._zod.pattern=new RegExp(`^(${r.filter(n=>qi.has(typeof n)).map(n=>typeof n=="string"?Ft(n):n.toString()).join("|")})$`),t._zod.parse=(n,o)=>{let s=n.value;return t._zod.values.has(s)||n.issues.push({code:"invalid_value",values:r,input:s,inst:t}),n}}),Ra=_("$ZodLiteral",(t,e)=>{ne.init(t,e),t._zod.values=new Set(e.values),t._zod.pattern=new RegExp(`^(${e.values.map(r=>typeof r=="string"?Ft(r):r?r.toString():String(r)).join("|")})$`),t._zod.parse=(r,n)=>{let o=r.value;return t._zod.values.has(o)||r.issues.push({code:"invalid_value",values:e.values,input:o,inst:t}),r}});var ja=_("$ZodTransform",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=e.transform(r.value,r);if(n.async)return(o instanceof Promise?o:Promise.resolve(o)).then(i=>(r.value=i,r));if(o instanceof Promise)throw new It;return r.value=o,r}}),Oa=_("$ZodOptional",(t,e)=>{ne.init(t,e),t._zod.optin="optional",t._zod.optout="optional",ie(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),ie(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Cn(r.source)})?$`):void 0}),t._zod.parse=(r,n)=>e.innerType._zod.optin==="optional"?e.innerType._zod.run(r,n):r.value===void 0?r:e.innerType._zod.run(r,n)}),Na=_("$ZodNullable",(t,e)=>{ne.init(t,e),ie(t._zod,"optin",()=>e.innerType._zod.optin),ie(t._zod,"optout",()=>e.innerType._zod.optout),ie(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Cn(r.source)}|null)$`):void 0}),ie(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(r,n)=>r.value===null?r:e.innerType._zod.run(r,n)}),Aa=_("$ZodDefault",(t,e)=>{ne.init(t,e),t._zod.optin="optional",ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(r.value===void 0)return r.value=e.defaultValue,r;let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>$p(s,e)):$p(o,e)}});function $p(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}var Za=_("$ZodPrefault",(t,e)=>{ne.init(t,e),t._zod.optin="optional",ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>(r.value===void 0&&(r.value=e.defaultValue),e.innerType._zod.run(r,n))}),Ma=_("$ZodNonOptional",(t,e)=>{ne.init(t,e),ie(t._zod,"values",()=>{let r=e.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>wp(s,t)):wp(o,t)}});function wp(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}var Da=_("$ZodCatch",(t,e)=>{ne.init(t,e),t._zod.optin="optional",ie(t._zod,"optout",()=>e.innerType._zod.optout),ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>(r.value=s.value,s.issues.length&&(r.value=e.catchValue({...r,error:{issues:s.issues.map(i=>ct(i,n,Je()))},input:r.value}),r.issues=[]),r)):(r.value=o.value,o.issues.length&&(r.value=e.catchValue({...r,error:{issues:o.issues.map(s=>ct(s,n,Je()))},input:r.value}),r.issues=[]),r)}});var qa=_("$ZodPipe",(t,e)=>{ne.init(t,e),ie(t._zod,"values",()=>e.in._zod.values),ie(t._zod,"optin",()=>e.in._zod.optin),ie(t._zod,"optout",()=>e.out._zod.optout),t._zod.parse=(r,n)=>{let o=e.in._zod.run(r,n);return o instanceof Promise?o.then(s=>kp(s,e,n)):kp(o,e,n)}});function kp(t,e,r){return br(t)?t:e.out._zod.run({value:t.value,issues:t.issues},r)}var La=_("$ZodReadonly",(t,e)=>{ne.init(t,e),ie(t._zod,"propValues",()=>e.innerType._zod.propValues),ie(t._zod,"values",()=>e.innerType._zod.values),ie(t._zod,"optin",()=>e.innerType._zod.optin),ie(t._zod,"optout",()=>e.innerType._zod.optout),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(Sp):Sp(o)}});function Sp(t){return t.value=Object.freeze(t.value),t}var Ua=_("$ZodCustom",(t,e)=>{ke.init(t,e),ne.init(t,e),t._zod.parse=(r,n)=>r,t._zod.check=r=>{let n=r.value,o=e.fn(n);if(o instanceof Promise)return o.then(s=>Tp(s,r,n,t));Tp(o,r,n,t)}});function Tp(t,e,r,n){if(!t){let o={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(o.params=n._zod.def.params),e.issues.push(Fi(o))}}var dv=t=>{let e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return e},pv=()=>{let t={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function e(n){return t[n]??null}let r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return n=>{switch(n.code){case"invalid_type":return`Invalid input: expected ${n.expected}, received ${dv(n.input)}`;case"invalid_value":return n.values.length===1?`Invalid input: expected ${Do(n.values[0])}`:`Invalid option: expected one of ${Zo(n.values,"|")}`;case"too_big":{let o=n.inclusive?"<=":"<",s=e(n.origin);return s?`Too big: expected ${n.origin??"value"} to have ${o}${n.maximum.toString()} ${s.unit??"elements"}`:`Too big: expected ${n.origin??"value"} to be ${o}${n.maximum.toString()}`}case"too_small":{let o=n.inclusive?">=":">",s=e(n.origin);return s?`Too small: expected ${n.origin} to have ${o}${n.minimum.toString()} ${s.unit}`:`Too small: expected ${n.origin} to be ${o}${n.minimum.toString()}`}case"invalid_format":{let o=n;return o.format==="starts_with"?`Invalid string: must start with "${o.prefix}"`:o.format==="ends_with"?`Invalid string: must end with "${o.suffix}"`:o.format==="includes"?`Invalid string: must include "${o.includes}"`:o.format==="regex"?`Invalid string: must match pattern ${o.pattern}`:`Invalid ${r[o.format]??n.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${n.divisor}`;case"unrecognized_keys":return`Unrecognized key${n.keys.length>1?"s":""}: ${Zo(n.keys,", ")}`;case"invalid_key":return`Invalid key in ${n.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${n.origin}`;default:return"Invalid input"}}};function Rp(){return{localeError:pv()}}var An=class{constructor(){this._map=new Map,this._idmap=new Map}add(e,...r){let n=r[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let r=this._map.get(e);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(e),this}get(e){let r=e._zod.parent;if(r){let n={...this.get(r)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}};function jp(){return new An}var Vt=jp();function Fa(t,e){return new t({type:"string",...M(e)})}function Va(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...M(e)})}function Bo(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...M(e)})}function Ka(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...M(e)})}function Ha(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...M(e)})}function Ba(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...M(e)})}function Ja(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...M(e)})}function Ga(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...M(e)})}function Wa(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...M(e)})}function Xa(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...M(e)})}function Ya(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...M(e)})}function Qa(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...M(e)})}function ec(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...M(e)})}function tc(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...M(e)})}function rc(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...M(e)})}function nc(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...M(e)})}function oc(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...M(e)})}function sc(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...M(e)})}function ic(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...M(e)})}function ac(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...M(e)})}function cc(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...M(e)})}function uc(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...M(e)})}function lc(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...M(e)})}function Op(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...M(e)})}function Np(t,e){return new t({type:"string",format:"date",check:"string_format",...M(e)})}function Ap(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...M(e)})}function Zp(t,e){return new t({type:"string",format:"duration",check:"string_format",...M(e)})}function dc(t,e){return new t({type:"number",checks:[],...M(e)})}function pc(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...M(e)})}function fc(t,e){return new t({type:"boolean",...M(e)})}function mc(t,e){return new t({type:"null",...M(e)})}function hc(t){return new t({type:"unknown"})}function gc(t,e){return new t({type:"never",...M(e)})}function Jo(t,e){return new ea({check:"less_than",...M(e),value:t,inclusive:!1})}function Zn(t,e){return new ea({check:"less_than",...M(e),value:t,inclusive:!0})}function Go(t,e){return new ta({check:"greater_than",...M(e),value:t,inclusive:!1})}function Mn(t,e){return new ta({check:"greater_than",...M(e),value:t,inclusive:!0})}function Wo(t,e){return new op({check:"multiple_of",...M(e),value:t})}function Xo(t,e){return new ip({check:"max_length",...M(e),maximum:t})}function Wr(t,e){return new ap({check:"min_length",...M(e),minimum:t})}function Yo(t,e){return new cp({check:"length_equals",...M(e),length:t})}function yc(t,e){return new up({check:"string_format",format:"regex",...M(e),pattern:t})}function _c(t){return new lp({check:"string_format",format:"lowercase",...M(t)})}function vc(t){return new dp({check:"string_format",format:"uppercase",...M(t)})}function xc(t,e){return new pp({check:"string_format",format:"includes",...M(e),includes:t})}function bc(t,e){return new fp({check:"string_format",format:"starts_with",...M(e),prefix:t})}function $c(t,e){return new mp({check:"string_format",format:"ends_with",...M(e),suffix:t})}function kr(t){return new hp({check:"overwrite",tx:t})}function wc(t){return kr(e=>e.normalize(t))}function kc(){return kr(t=>t.trim())}function Sc(){return kr(t=>t.toLowerCase())}function Tc(){return kr(t=>t.toUpperCase())}function Mp(t,e,r){return new t({type:"array",element:e,...M(r)})}function zc(t,e,r){let n=M(r);return n.abort??(n.abort=!0),new t({type:"custom",check:"custom",fn:e,...n})}function Pc(t,e,r){return new t({type:"custom",check:"custom",fn:e,...M(r)})}var Qo=class{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??Vt,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,r={path:[],schemaPath:[]}){var n;let o=e._zod.def,s={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},i=this.seen.get(e);if(i)return i.count++,r.schemaPath.includes(e)&&(i.cycle=r.path),i.schema;let a={schema:{},count:1,cycle:void 0,path:r.path};this.seen.set(e,a);let c=e._zod.toJSONSchema?.();if(c)a.schema=c;else{let d={...r,schemaPath:[...r.schemaPath,e],path:r.path},h=e._zod.parent;if(h)a.ref=h,this.process(h,d),this.seen.get(h).isParent=!0;else{let f=a.schema;switch(o.type){case"string":{let p=f;p.type="string";let{minimum:m,maximum:g,format:v,patterns:x,contentEncoding:b}=e._zod.bag;if(typeof m=="number"&&(p.minLength=m),typeof g=="number"&&(p.maxLength=g),v&&(p.format=s[v]??v,p.format===""&&delete p.format),b&&(p.contentEncoding=b),x&&x.size>0){let k=[...x];k.length===1?p.pattern=k[0].source:k.length>1&&(a.schema.allOf=[...k.map(T=>({...this.target==="draft-7"?{type:"string"}:{},pattern:T.source}))])}break}case"number":{let p=f,{minimum:m,maximum:g,format:v,multipleOf:x,exclusiveMaximum:b,exclusiveMinimum:k}=e._zod.bag;typeof v=="string"&&v.includes("int")?p.type="integer":p.type="number",typeof k=="number"&&(p.exclusiveMinimum=k),typeof m=="number"&&(p.minimum=m,typeof k=="number"&&(k>=m?delete p.minimum:delete p.exclusiveMinimum)),typeof b=="number"&&(p.exclusiveMaximum=b),typeof g=="number"&&(p.maximum=g,typeof b=="number"&&(b<=g?delete p.maximum:delete p.exclusiveMaximum)),typeof x=="number"&&(p.multipleOf=x);break}case"boolean":{let p=f;p.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{f.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{f.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{let p=f,{minimum:m,maximum:g}=e._zod.bag;typeof m=="number"&&(p.minItems=m),typeof g=="number"&&(p.maxItems=g),p.type="array",p.items=this.process(o.element,{...d,path:[...d.path,"items"]});break}case"object":{let p=f;p.type="object",p.properties={};let m=o.shape;for(let x in m)p.properties[x]=this.process(m[x],{...d,path:[...d.path,"properties",x]});let g=new Set(Object.keys(m)),v=new Set([...g].filter(x=>{let b=o.shape[x]._zod;return this.io==="input"?b.optin===void 0:b.optout===void 0}));v.size>0&&(p.required=Array.from(v)),o.catchall?._zod.def.type==="never"?p.additionalProperties=!1:o.catchall?o.catchall&&(p.additionalProperties=this.process(o.catchall,{...d,path:[...d.path,"additionalProperties"]})):this.io==="output"&&(p.additionalProperties=!1);break}case"union":{let p=f;p.anyOf=o.options.map((m,g)=>this.process(m,{...d,path:[...d.path,"anyOf",g]}));break}case"intersection":{let p=f,m=this.process(o.left,{...d,path:[...d.path,"allOf",0]}),g=this.process(o.right,{...d,path:[...d.path,"allOf",1]}),v=b=>"allOf"in b&&Object.keys(b).length===1,x=[...v(m)?m.allOf:[m],...v(g)?g.allOf:[g]];p.allOf=x;break}case"tuple":{let p=f;p.type="array";let m=o.items.map((x,b)=>this.process(x,{...d,path:[...d.path,"prefixItems",b]}));if(this.target==="draft-2020-12"?p.prefixItems=m:p.items=m,o.rest){let x=this.process(o.rest,{...d,path:[...d.path,"items"]});this.target==="draft-2020-12"?p.items=x:p.additionalItems=x}o.rest&&(p.items=this.process(o.rest,{...d,path:[...d.path,"items"]}));let{minimum:g,maximum:v}=e._zod.bag;typeof g=="number"&&(p.minItems=g),typeof v=="number"&&(p.maxItems=v);break}case"record":{let p=f;p.type="object",p.propertyNames=this.process(o.keyType,{...d,path:[...d.path,"propertyNames"]}),p.additionalProperties=this.process(o.valueType,{...d,path:[...d.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{let p=f,m=Pn(o.entries);m.every(g=>typeof g=="number")&&(p.type="number"),m.every(g=>typeof g=="string")&&(p.type="string"),p.enum=m;break}case"literal":{let p=f,m=[];for(let g of o.values)if(g===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof g=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");m.push(Number(g))}else m.push(g);if(m.length!==0)if(m.length===1){let g=m[0];p.type=g===null?"null":typeof g,p.const=g}else m.every(g=>typeof g=="number")&&(p.type="number"),m.every(g=>typeof g=="string")&&(p.type="string"),m.every(g=>typeof g=="boolean")&&(p.type="string"),m.every(g=>g===null)&&(p.type="null"),p.enum=m;break}case"file":{let p=f,m={type:"string",format:"binary",contentEncoding:"binary"},{minimum:g,maximum:v,mime:x}=e._zod.bag;g!==void 0&&(m.minLength=g),v!==void 0&&(m.maxLength=v),x?x.length===1?(m.contentMediaType=x[0],Object.assign(p,m)):p.anyOf=x.map(b=>({...m,contentMediaType:b})):Object.assign(p,m);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{let p=this.process(o.innerType,d);f.anyOf=[p,{type:"null"}];break}case"nonoptional":{this.process(o.innerType,d),a.ref=o.innerType;break}case"success":{let p=f;p.type="boolean";break}case"default":{this.process(o.innerType,d),a.ref=o.innerType,f.default=JSON.parse(JSON.stringify(o.defaultValue));break}case"prefault":{this.process(o.innerType,d),a.ref=o.innerType,this.io==="input"&&(f._prefault=JSON.parse(JSON.stringify(o.defaultValue)));break}case"catch":{this.process(o.innerType,d),a.ref=o.innerType;let p;try{p=o.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}f.default=p;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{let p=f,m=e._zod.pattern;if(!m)throw new Error("Pattern not found in template literal");p.type="string",p.pattern=m.source;break}case"pipe":{let p=this.io==="input"?o.in._zod.def.type==="transform"?o.out:o.in:o.out;this.process(p,d),a.ref=p;break}case"readonly":{this.process(o.innerType,d),a.ref=o.innerType,f.readOnly=!0;break}case"promise":{this.process(o.innerType,d),a.ref=o.innerType;break}case"optional":{this.process(o.innerType,d),a.ref=o.innerType;break}case"lazy":{let p=e._zod.innerType;this.process(p,d),a.ref=p;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}default:}}}let u=this.metadataRegistry.get(e);return u&&Object.assign(a.schema,u),this.io==="input"&&xe(e)&&(delete a.schema.examples,delete a.schema.default),this.io==="input"&&a.schema._prefault&&((n=a.schema).default??(n.default=a.schema._prefault)),delete a.schema._prefault,this.seen.get(e).schema}emit(e,r){let n={cycles:r?.cycles??"ref",reused:r?.reused??"inline",external:r?.external??void 0},o=this.seen.get(e);if(!o)throw new Error("Unprocessed schema. This is a bug in Zod.");let s=l=>{let d=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){let m=n.external.registry.get(l[0])?.id,g=n.external.uri??(x=>x);if(m)return{ref:g(m)};let v=l[1].defId??l[1].schema.id??`schema${this.counter++}`;return l[1].defId=v,{defId:v,ref:`${g("__shared")}#/${d}/${v}`}}if(l[1]===o)return{ref:"#"};let f=`#/${d}/`,p=l[1].schema.id??`__schema${this.counter++}`;return{defId:p,ref:f+p}},i=l=>{if(l[1].schema.$ref)return;let d=l[1],{ref:h,defId:f}=s(l);d.def={...d.schema},f&&(d.defId=f);let p=d.schema;for(let m in p)delete p[m];p.$ref=h};if(n.cycles==="throw")for(let l of this.seen.entries()){let d=l[1];if(d.cycle)throw new Error(`Cycle detected: #/${d.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let l of this.seen.entries()){let d=l[1];if(e===l[0]){i(l);continue}if(n.external){let f=n.external.registry.get(l[0])?.id;if(e!==l[0]&&f){i(l);continue}}if(this.metadataRegistry.get(l[0])?.id){i(l);continue}if(d.cycle){i(l);continue}if(d.count>1&&n.reused==="ref"){i(l);continue}}let a=(l,d)=>{let h=this.seen.get(l),f=h.def??h.schema,p={...f};if(h.ref===null)return;let m=h.ref;if(h.ref=null,m){a(m,d);let g=this.seen.get(m).schema;g.$ref&&d.target==="draft-7"?(f.allOf=f.allOf??[],f.allOf.push(g)):(Object.assign(f,g),Object.assign(f,p))}h.isParent||this.override({zodSchema:l,jsonSchema:f,path:h.path??[]})};for(let l of[...this.seen.entries()].reverse())a(l[0],{target:this.target});let c={};if(this.target==="draft-2020-12"?c.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?c.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),n.external?.uri){let l=n.external.registry.get(e)?.id;if(!l)throw new Error("Schema is missing an `id` property");c.$id=n.external.uri(l)}Object.assign(c,o.def);let u=n.external?.defs??{};for(let l of this.seen.entries()){let d=l[1];d.def&&d.defId&&(u[d.defId]=d.def)}n.external||Object.keys(u).length>0&&(this.target==="draft-2020-12"?c.$defs=u:c.definitions=u);try{return JSON.parse(JSON.stringify(c))}catch{throw new Error("Error converting schema to JSON.")}}};function Ec(t,e){if(t instanceof An){let n=new Qo(e),o={};for(let a of t._idmap.entries()){let[c,u]=a;n.process(u)}let s={},i={registry:t,uri:e?.uri,defs:o};for(let a of t._idmap.entries()){let[c,u]=a;s[c]=n.emit(u,{...e,external:i})}if(Object.keys(o).length>0){let a=n.target==="draft-2020-12"?"$defs":"definitions";s.__shared={[a]:o}}return{schemas:s}}let r=new Qo(e);return r.process(t),r.emit(t,e)}function xe(t,e){let r=e??{seen:new Set};if(r.seen.has(t))return!1;r.seen.add(t);let o=t._zod.def;switch(o.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return xe(o.element,r);case"object":{for(let s in o.shape)if(xe(o.shape[s],r))return!0;return!1}case"union":{for(let s of o.options)if(xe(s,r))return!0;return!1}case"intersection":return xe(o.left,r)||xe(o.right,r);case"tuple":{for(let s of o.items)if(xe(s,r))return!0;return!!(o.rest&&xe(o.rest,r))}case"record":return xe(o.keyType,r)||xe(o.valueType,r);case"map":return xe(o.keyType,r)||xe(o.valueType,r);case"set":return xe(o.valueType,r);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return xe(o.innerType,r);case"lazy":return xe(o.getter(),r);case"default":return xe(o.innerType,r);case"prefault":return xe(o.innerType,r);case"custom":return!1;case"transform":return!0;case"pipe":return xe(o.in,r)||xe(o.out,r);case"success":return!1;case"catch":return!1;default:}throw new Error(`Unknown schema type: ${o.type}`)}var Bv=_("ZodMiniType",(t,e)=>{if(!t._zod)throw new Error("Uninitialized schema in ZodMiniType.");ne.init(t,e),t.def=e,t.parse=(r,n)=>Bi(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>$r(t,r,n),t.parseAsync=async(r,n)=>Gi(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>wr(t,r,n),t.check=(...r)=>t.clone({...e,checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),t.clone=(r,n)=>Ge(t,r,n),t.brand=()=>t,t.register=((r,n)=>(r.add(t,n),t))});var Jv=_("ZodMiniObject",(t,e)=>{Ko.init(t,e),Bv.init(t,e),J.defineLazy(t,"shape",()=>e.shape)});function Ic(t,e){let r={type:"object",get shape(){return J.assignProp(this,"shape",{...t}),this.shape},...J.normalizeParams(e)};return new Jv(r)}function Qe(t){return!!t._zod}function Tr(t){let e=Object.values(t);if(e.length===0)return Ic({});let r=e.every(Qe),n=e.every(o=>!Qe(o));if(r)return Ic(t);if(n)return ji(t);throw new Error("Mixed Zod versions detected in object shape.")}function Kt(t,e){return Qe(t)?$r(t,e):t.safeParse(e)}async function es(t,e){return Qe(t)?await wr(t,e):await t.safeParseAsync(e)}function Ht(t){if(!t)return;let e;if(Qe(t)?e=t._zod?.def?.shape:e=t.shape,!!e){if(typeof e=="function")try{return e()}catch{return}return e}}function Xr(t){if(t){if(typeof t=="object"){let e=t,r=t;if(!e._def&&!r._zod){let n=Object.values(t);if(n.length>0&&n.every(o=>typeof o=="object"&&o!==null&&(o._def!==void 0||o._zod!==void 0||typeof o.parse=="function")))return Tr(t)}}if(Qe(t)){let r=t._zod?.def;if(r&&(r.type==="object"||r.shape!==void 0))return t}else if(t.shape!==void 0)return t}}function ts(t){if(t&&typeof t=="object"){if("message"in t&&typeof t.message=="string")return t.message;if("issues"in t&&Array.isArray(t.issues)&&t.issues.length>0){let e=t.issues[0];if(e&&typeof e=="object"&&"message"in e)return String(e.message)}try{return JSON.stringify(t)}catch{return String(t)}}return String(t)}function qp(t){return t.description}function Lp(t){if(Qe(t))return t._zod?.def?.type==="optional";let e=t;return typeof t.isOptional=="function"?t.isOptional():e._def?.typeName==="ZodOptional"}function rs(t){if(Qe(t)){let s=t._zod?.def;if(s){if(s.value!==void 0)return s.value;if(Array.isArray(s.values)&&s.values.length>0)return s.values[0]}}let r=t._def;if(r){if(r.value!==void 0)return r.value;if(Array.isArray(r.values)&&r.values.length>0)return r.values[0]}let n=t.value;if(n!==void 0)return n}var Dn={};Ei(Dn,{ZodISODate:()=>Fp,ZodISODateTime:()=>Up,ZodISODuration:()=>Kp,ZodISOTime:()=>Vp,date:()=>Rc,datetime:()=>Cc,duration:()=>Oc,time:()=>jc});var Up=_("ZodISODateTime",(t,e)=>{zp.init(t,e),pe.init(t,e)});function Cc(t){return Op(Up,t)}var Fp=_("ZodISODate",(t,e)=>{Pp.init(t,e),pe.init(t,e)});function Rc(t){return Np(Fp,t)}var Vp=_("ZodISOTime",(t,e)=>{Ep.init(t,e),pe.init(t,e)});function jc(t){return Ap(Vp,t)}var Kp=_("ZodISODuration",(t,e)=>{Ip.init(t,e),pe.init(t,e)});function Oc(t){return Zp(Kp,t)}var Hp=(t,e)=>{qo.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:r=>Ki(t,r)},flatten:{value:r=>Vi(t,r)},addIssue:{value:r=>t.issues.push(r)},addIssues:{value:r=>t.issues.push(...r)},isEmpty:{get(){return t.issues.length===0}}})},OE=_("ZodError",Hp),qn=_("ZodError",Hp,{Parent:Error});var Bp=Hi(qn),Jp=Ji(qn),Gp=Wi(qn),Wp=Xi(qn);var ye=_("ZodType",(t,e)=>(ne.init(t,e),t.def=e,Object.defineProperty(t,"_def",{value:e}),t.check=(...r)=>t.clone({...e,checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),t.clone=(r,n)=>Ge(t,r,n),t.brand=()=>t,t.register=((r,n)=>(r.add(t,n),t)),t.parse=(r,n)=>Bp(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>Gp(t,r,n),t.parseAsync=async(r,n)=>Jp(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>Wp(t,r,n),t.spa=t.safeParseAsync,t.refine=(r,n)=>t.check(Kx(r,n)),t.superRefine=r=>t.check(Hx(r)),t.overwrite=r=>t.check(kr(r)),t.optional=()=>ge(t),t.nullable=()=>Qp(t),t.nullish=()=>ge(Qp(t)),t.nonoptional=r=>Mx(t,r),t.array=()=>G(t),t.or=r=>ce([t,r]),t.and=r=>os(t,r),t.transform=r=>Ac(t,of(r)),t.default=r=>Nx(t,r),t.prefault=r=>Zx(t,r),t.catch=r=>qx(t,r),t.pipe=r=>Ac(t,r),t.readonly=()=>Fx(t),t.describe=r=>{let n=t.clone();return Vt.add(n,{description:r}),n},Object.defineProperty(t,"description",{get(){return Vt.get(t)?.description},configurable:!0}),t.meta=(...r)=>{if(r.length===0)return Vt.get(t);let n=t.clone();return Vt.add(n,r[0]),n},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),ef=_("_ZodString",(t,e)=>{Nn.init(t,e),ye.init(t,e);let r=t._zod.bag;t.format=r.format??null,t.minLength=r.minimum??null,t.maxLength=r.maximum??null,t.regex=(...n)=>t.check(yc(...n)),t.includes=(...n)=>t.check(xc(...n)),t.startsWith=(...n)=>t.check(bc(...n)),t.endsWith=(...n)=>t.check($c(...n)),t.min=(...n)=>t.check(Wr(...n)),t.max=(...n)=>t.check(Xo(...n)),t.length=(...n)=>t.check(Yo(...n)),t.nonempty=(...n)=>t.check(Wr(1,...n)),t.lowercase=n=>t.check(_c(n)),t.uppercase=n=>t.check(vc(n)),t.trim=()=>t.check(kc()),t.normalize=(...n)=>t.check(wc(...n)),t.toLowerCase=()=>t.check(Sc()),t.toUpperCase=()=>t.check(Tc())}),nx=_("ZodString",(t,e)=>{Nn.init(t,e),ef.init(t,e),t.email=r=>t.check(Va(ox,r)),t.url=r=>t.check(Ga(sx,r)),t.jwt=r=>t.check(lc(xx,r)),t.emoji=r=>t.check(Wa(ix,r)),t.guid=r=>t.check(Bo(Xp,r)),t.uuid=r=>t.check(Ka(ns,r)),t.uuidv4=r=>t.check(Ha(ns,r)),t.uuidv6=r=>t.check(Ba(ns,r)),t.uuidv7=r=>t.check(Ja(ns,r)),t.nanoid=r=>t.check(Xa(ax,r)),t.guid=r=>t.check(Bo(Xp,r)),t.cuid=r=>t.check(Ya(cx,r)),t.cuid2=r=>t.check(Qa(ux,r)),t.ulid=r=>t.check(ec(lx,r)),t.base64=r=>t.check(ac(yx,r)),t.base64url=r=>t.check(cc(_x,r)),t.xid=r=>t.check(tc(dx,r)),t.ksuid=r=>t.check(rc(px,r)),t.ipv4=r=>t.check(nc(fx,r)),t.ipv6=r=>t.check(oc(mx,r)),t.cidrv4=r=>t.check(sc(hx,r)),t.cidrv6=r=>t.check(ic(gx,r)),t.e164=r=>t.check(uc(vx,r)),t.datetime=r=>t.check(Cc(r)),t.date=r=>t.check(Rc(r)),t.time=r=>t.check(jc(r)),t.duration=r=>t.check(Oc(r))});function y(t){return Fa(nx,t)}var pe=_("ZodStringFormat",(t,e)=>{ae.init(t,e),ef.init(t,e)}),ox=_("ZodEmail",(t,e)=>{sa.init(t,e),pe.init(t,e)});var Xp=_("ZodGUID",(t,e)=>{na.init(t,e),pe.init(t,e)});var ns=_("ZodUUID",(t,e)=>{oa.init(t,e),pe.init(t,e)});var sx=_("ZodURL",(t,e)=>{ia.init(t,e),pe.init(t,e)});var ix=_("ZodEmoji",(t,e)=>{aa.init(t,e),pe.init(t,e)});var ax=_("ZodNanoID",(t,e)=>{ca.init(t,e),pe.init(t,e)});var cx=_("ZodCUID",(t,e)=>{ua.init(t,e),pe.init(t,e)});var ux=_("ZodCUID2",(t,e)=>{la.init(t,e),pe.init(t,e)});var lx=_("ZodULID",(t,e)=>{da.init(t,e),pe.init(t,e)});var dx=_("ZodXID",(t,e)=>{pa.init(t,e),pe.init(t,e)});var px=_("ZodKSUID",(t,e)=>{fa.init(t,e),pe.init(t,e)});var fx=_("ZodIPv4",(t,e)=>{ma.init(t,e),pe.init(t,e)});var mx=_("ZodIPv6",(t,e)=>{ha.init(t,e),pe.init(t,e)});var hx=_("ZodCIDRv4",(t,e)=>{ga.init(t,e),pe.init(t,e)});var gx=_("ZodCIDRv6",(t,e)=>{ya.init(t,e),pe.init(t,e)});var yx=_("ZodBase64",(t,e)=>{_a.init(t,e),pe.init(t,e)});var _x=_("ZodBase64URL",(t,e)=>{va.init(t,e),pe.init(t,e)});var vx=_("ZodE164",(t,e)=>{xa.init(t,e),pe.init(t,e)});var xx=_("ZodJWT",(t,e)=>{ba.init(t,e),pe.init(t,e)});var tf=_("ZodNumber",(t,e)=>{Vo.init(t,e),ye.init(t,e),t.gt=(n,o)=>t.check(Go(n,o)),t.gte=(n,o)=>t.check(Mn(n,o)),t.min=(n,o)=>t.check(Mn(n,o)),t.lt=(n,o)=>t.check(Jo(n,o)),t.lte=(n,o)=>t.check(Zn(n,o)),t.max=(n,o)=>t.check(Zn(n,o)),t.int=n=>t.check(Yp(n)),t.safe=n=>t.check(Yp(n)),t.positive=n=>t.check(Go(0,n)),t.nonnegative=n=>t.check(Mn(0,n)),t.negative=n=>t.check(Jo(0,n)),t.nonpositive=n=>t.check(Zn(0,n)),t.multipleOf=(n,o)=>t.check(Wo(n,o)),t.step=(n,o)=>t.check(Wo(n,o)),t.finite=()=>t;let r=t._zod.bag;t.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),t.isFinite=!0,t.format=r.format??null});function re(t){return dc(tf,t)}var bx=_("ZodNumberFormat",(t,e)=>{$a.init(t,e),tf.init(t,e)});function Yp(t){return pc(bx,t)}var $x=_("ZodBoolean",(t,e)=>{wa.init(t,e),ye.init(t,e)});function $e(t){return fc($x,t)}var wx=_("ZodNull",(t,e)=>{ka.init(t,e),ye.init(t,e)});function Zc(t){return mc(wx,t)}var kx=_("ZodUnknown",(t,e)=>{Sa.init(t,e),ye.init(t,e)});function fe(){return hc(kx)}var Sx=_("ZodNever",(t,e)=>{Ta.init(t,e),ye.init(t,e)});function Tx(t){return gc(Sx,t)}var zx=_("ZodArray",(t,e)=>{za.init(t,e),ye.init(t,e),t.element=e.element,t.min=(r,n)=>t.check(Wr(r,n)),t.nonempty=r=>t.check(Wr(1,r)),t.max=(r,n)=>t.check(Xo(r,n)),t.length=(r,n)=>t.check(Yo(r,n)),t.unwrap=()=>t.element});function G(t,e){return Mp(zx,t,e)}var rf=_("ZodObject",(t,e)=>{Ko.init(t,e),ye.init(t,e),J.defineLazy(t,"shape",()=>e.shape),t.keyof=()=>Fe(Object.keys(t._zod.def.shape)),t.catchall=r=>t.clone({...t._zod.def,catchall:r}),t.passthrough=()=>t.clone({...t._zod.def,catchall:fe()}),t.loose=()=>t.clone({...t._zod.def,catchall:fe()}),t.strict=()=>t.clone({...t._zod.def,catchall:Tx()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=r=>J.extend(t,r),t.merge=r=>J.merge(t,r),t.pick=r=>J.pick(t,r),t.omit=r=>J.omit(t,r),t.partial=(...r)=>J.partial(sf,t,r[0]),t.required=(...r)=>J.required(af,t,r[0])});function E(t,e){let r={type:"object",get shape(){return J.assignProp(this,"shape",{...t}),this.shape},...J.normalizeParams(e)};return new rf(r)}function Ne(t,e){return new rf({type:"object",get shape(){return J.assignProp(this,"shape",{...t}),this.shape},catchall:fe(),...J.normalizeParams(e)})}var nf=_("ZodUnion",(t,e)=>{Ho.init(t,e),ye.init(t,e),t.options=e.options});function ce(t,e){return new nf({type:"union",options:t,...J.normalizeParams(e)})}var Px=_("ZodDiscriminatedUnion",(t,e)=>{nf.init(t,e),Pa.init(t,e)});function Mc(t,e,r){return new Px({type:"union",options:e,discriminator:t,...J.normalizeParams(r)})}var Ex=_("ZodIntersection",(t,e)=>{Ea.init(t,e),ye.init(t,e)});function os(t,e){return new Ex({type:"intersection",left:t,right:e})}var Ix=_("ZodRecord",(t,e)=>{Ia.init(t,e),ye.init(t,e),t.keyType=e.keyType,t.valueType=e.valueType});function me(t,e,r){return new Ix({type:"record",keyType:t,valueType:e,...J.normalizeParams(r)})}var Nc=_("ZodEnum",(t,e)=>{Ca.init(t,e),ye.init(t,e),t.enum=e.entries,t.options=Object.values(e.entries);let r=new Set(Object.keys(e.entries));t.extract=(n,o)=>{let s={};for(let i of n)if(r.has(i))s[i]=e.entries[i];else throw new Error(`Key ${i} not found in enum`);return new Nc({...e,checks:[],...J.normalizeParams(o),entries:s})},t.exclude=(n,o)=>{let s={...e.entries};for(let i of n)if(r.has(i))delete s[i];else throw new Error(`Key ${i} not found in enum`);return new Nc({...e,checks:[],...J.normalizeParams(o),entries:s})}});function Fe(t,e){let r=Array.isArray(t)?Object.fromEntries(t.map(n=>[n,n])):t;return new Nc({type:"enum",entries:r,...J.normalizeParams(e)})}var Cx=_("ZodLiteral",(t,e)=>{Ra.init(t,e),ye.init(t,e),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function R(t,e){return new Cx({type:"literal",values:Array.isArray(t)?t:[t],...J.normalizeParams(e)})}var Rx=_("ZodTransform",(t,e)=>{ja.init(t,e),ye.init(t,e),t._zod.parse=(r,n)=>{r.addIssue=s=>{if(typeof s=="string")r.issues.push(J.issue(s,r.value,e));else{let i=s;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=t),i.continue??(i.continue=!0),r.issues.push(J.issue(i))}};let o=e.transform(r.value,r);return o instanceof Promise?o.then(s=>(r.value=s,r)):(r.value=o,r)}});function of(t){return new Rx({type:"transform",transform:t})}var sf=_("ZodOptional",(t,e)=>{Oa.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function ge(t){return new sf({type:"optional",innerType:t})}var jx=_("ZodNullable",(t,e)=>{Na.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function Qp(t){return new jx({type:"nullable",innerType:t})}var Ox=_("ZodDefault",(t,e)=>{Aa.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function Nx(t,e){return new Ox({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}var Ax=_("ZodPrefault",(t,e)=>{Za.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function Zx(t,e){return new Ax({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}var af=_("ZodNonOptional",(t,e)=>{Ma.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function Mx(t,e){return new af({type:"nonoptional",innerType:t,...J.normalizeParams(e)})}var Dx=_("ZodCatch",(t,e)=>{Da.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function qx(t,e){return new Dx({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}var Lx=_("ZodPipe",(t,e)=>{qa.init(t,e),ye.init(t,e),t.in=e.in,t.out=e.out});function Ac(t,e){return new Lx({type:"pipe",in:t,out:e})}var Ux=_("ZodReadonly",(t,e)=>{La.init(t,e),ye.init(t,e)});function Fx(t){return new Ux({type:"readonly",innerType:t})}var cf=_("ZodCustom",(t,e)=>{Ua.init(t,e),ye.init(t,e)});function Vx(t){let e=new ke({check:"custom"});return e._zod.check=t,e}function uf(t,e){return zc(cf,t??(()=>!0),e)}function Kx(t,e={}){return Pc(cf,t,e)}function Hx(t){let e=Vx(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(J.issue(n,r.value,e._zod.def));else{let o=n;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=e),o.continue??(o.continue=!e._zod.def.abort),r.issues.push(J.issue(o))}},t(r.value,r)));return e}function Dc(t,e){return Ac(of(t),e)}Je(Rp());var Lc="2025-11-25";var lf=[Lc,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],Bt="io.modelcontextprotocol/related-task",is="2.0",Se=uf(t=>t!==null&&(typeof t=="object"||typeof t=="function")),df=ce([y(),re().int()]),pf=y(),JE=Ne({ttl:ce([re(),Zc()]).optional(),pollInterval:re().optional()}),Bx=E({ttl:re().optional()}),Jx=E({taskId:y()}),Uc=Ne({progressToken:df.optional(),[Bt]:Jx.optional()}),We=E({_meta:Uc.optional()}),Ln=We.extend({task:Bx.optional()}),ff=t=>Ln.safeParse(t).success,Te=E({method:y(),params:We.loose().optional()}),et=E({_meta:Uc.optional()}),tt=E({method:y(),params:et.loose().optional()}),ze=Ne({_meta:Uc.optional()}),as=ce([y(),re().int()]),mf=E({jsonrpc:R(is),id:as,...Te.shape}).strict(),Fc=t=>mf.safeParse(t).success,hf=E({jsonrpc:R(is),...tt.shape}).strict(),gf=t=>hf.safeParse(t).success,Vc=E({jsonrpc:R(is),id:as,result:ze}).strict(),Un=t=>Vc.safeParse(t).success;var O;(function(t){t[t.ConnectionClosed=-32e3]="ConnectionClosed",t[t.RequestTimeout=-32001]="RequestTimeout",t[t.ParseError=-32700]="ParseError",t[t.InvalidRequest=-32600]="InvalidRequest",t[t.MethodNotFound=-32601]="MethodNotFound",t[t.InvalidParams=-32602]="InvalidParams",t[t.InternalError=-32603]="InternalError",t[t.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(O||(O={}));var Kc=E({jsonrpc:R(is),id:as.optional(),error:E({code:re().int(),message:y(),data:fe().optional()})}).strict();var yf=t=>Kc.safeParse(t).success;var _f=ce([mf,hf,Vc,Kc]),GE=ce([Vc,Kc]),cs=ze.strict(),Gx=et.extend({requestId:as.optional(),reason:y().optional()}),us=tt.extend({method:R("notifications/cancelled"),params:Gx}),Wx=E({src:y(),mimeType:y().optional(),sizes:G(y()).optional(),theme:Fe(["light","dark"]).optional()}),Fn=E({icons:G(Wx).optional()}),Yr=E({name:y(),title:y().optional()}),vf=Yr.extend({...Yr.shape,...Fn.shape,version:y(),websiteUrl:y().optional(),description:y().optional()}),Xx=os(E({applyDefaults:$e().optional()}),me(y(),fe())),Yx=Dc(t=>t&&typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).length===0?{form:{}}:t,os(E({form:Xx.optional(),url:Se.optional()}),me(y(),fe()).optional())),Qx=Ne({list:Se.optional(),cancel:Se.optional(),requests:Ne({sampling:Ne({createMessage:Se.optional()}).optional(),elicitation:Ne({create:Se.optional()}).optional()}).optional()}),eb=Ne({list:Se.optional(),cancel:Se.optional(),requests:Ne({tools:Ne({call:Se.optional()}).optional()}).optional()}),tb=E({experimental:me(y(),Se).optional(),sampling:E({context:Se.optional(),tools:Se.optional()}).optional(),elicitation:Yx.optional(),roots:E({listChanged:$e().optional()}).optional(),tasks:Qx.optional()}),rb=We.extend({protocolVersion:y(),capabilities:tb,clientInfo:vf}),Hc=Te.extend({method:R("initialize"),params:rb});var nb=E({experimental:me(y(),Se).optional(),logging:Se.optional(),completions:Se.optional(),prompts:E({listChanged:$e().optional()}).optional(),resources:E({subscribe:$e().optional(),listChanged:$e().optional()}).optional(),tools:E({listChanged:$e().optional()}).optional(),tasks:eb.optional()}),ob=ze.extend({protocolVersion:y(),capabilities:nb,serverInfo:vf,instructions:y().optional()}),Bc=tt.extend({method:R("notifications/initialized"),params:et.optional()});var ls=Te.extend({method:R("ping"),params:We.optional()}),sb=E({progress:re(),total:ge(re()),message:ge(y())}),ib=E({...et.shape,...sb.shape,progressToken:df}),ds=tt.extend({method:R("notifications/progress"),params:ib}),ab=We.extend({cursor:pf.optional()}),Vn=Te.extend({params:ab.optional()}),Kn=ze.extend({nextCursor:pf.optional()}),cb=Fe(["working","input_required","completed","failed","cancelled"]),Hn=E({taskId:y(),status:cb,ttl:ce([re(),Zc()]),createdAt:y(),lastUpdatedAt:y(),pollInterval:ge(re()),statusMessage:ge(y())}),Qr=ze.extend({task:Hn}),ub=et.merge(Hn),Bn=tt.extend({method:R("notifications/tasks/status"),params:ub}),ps=Te.extend({method:R("tasks/get"),params:We.extend({taskId:y()})}),fs=ze.merge(Hn),ms=Te.extend({method:R("tasks/result"),params:We.extend({taskId:y()})}),WE=ze.loose(),hs=Vn.extend({method:R("tasks/list")}),gs=Kn.extend({tasks:G(Hn)}),ys=Te.extend({method:R("tasks/cancel"),params:We.extend({taskId:y()})}),xf=ze.merge(Hn),bf=E({uri:y(),mimeType:ge(y()),_meta:me(y(),fe()).optional()}),$f=bf.extend({text:y()}),Jc=y().refine(t=>{try{return atob(t),!0}catch{return!1}},{message:"Invalid Base64 string"}),wf=bf.extend({blob:Jc}),Jn=Fe(["user","assistant"]),en=E({audience:G(Jn).optional(),priority:re().min(0).max(1).optional(),lastModified:Dn.datetime({offset:!0}).optional()}),kf=E({...Yr.shape,...Fn.shape,uri:y(),description:ge(y()),mimeType:ge(y()),annotations:en.optional(),_meta:ge(Ne({}))}),lb=E({...Yr.shape,...Fn.shape,uriTemplate:y(),description:ge(y()),mimeType:ge(y()),annotations:en.optional(),_meta:ge(Ne({}))}),_s=Vn.extend({method:R("resources/list")}),db=Kn.extend({resources:G(kf)}),vs=Vn.extend({method:R("resources/templates/list")}),pb=Kn.extend({resourceTemplates:G(lb)}),Gc=We.extend({uri:y()}),fb=Gc,xs=Te.extend({method:R("resources/read"),params:fb}),mb=ze.extend({contents:G(ce([$f,wf]))}),hb=tt.extend({method:R("notifications/resources/list_changed"),params:et.optional()}),gb=Gc,yb=Te.extend({method:R("resources/subscribe"),params:gb}),_b=Gc,vb=Te.extend({method:R("resources/unsubscribe"),params:_b}),xb=et.extend({uri:y()}),bb=tt.extend({method:R("notifications/resources/updated"),params:xb}),$b=E({name:y(),description:ge(y()),required:ge($e())}),wb=E({...Yr.shape,...Fn.shape,description:ge(y()),arguments:ge(G($b)),_meta:ge(Ne({}))}),bs=Vn.extend({method:R("prompts/list")}),kb=Kn.extend({prompts:G(wb)}),Sb=We.extend({name:y(),arguments:me(y(),y()).optional()}),$s=Te.extend({method:R("prompts/get"),params:Sb}),Wc=E({type:R("text"),text:y(),annotations:en.optional(),_meta:me(y(),fe()).optional()}),Xc=E({type:R("image"),data:Jc,mimeType:y(),annotations:en.optional(),_meta:me(y(),fe()).optional()}),Yc=E({type:R("audio"),data:Jc,mimeType:y(),annotations:en.optional(),_meta:me(y(),fe()).optional()}),Tb=E({type:R("tool_use"),name:y(),id:y(),input:me(y(),fe()),_meta:me(y(),fe()).optional()}),zb=E({type:R("resource"),resource:ce([$f,wf]),annotations:en.optional(),_meta:me(y(),fe()).optional()}),Pb=kf.extend({type:R("resource_link")}),Qc=ce([Wc,Xc,Yc,Pb,zb]),Eb=E({role:Jn,content:Qc}),Ib=ze.extend({description:y().optional(),messages:G(Eb)}),Cb=tt.extend({method:R("notifications/prompts/list_changed"),params:et.optional()}),Rb=E({title:y().optional(),readOnlyHint:$e().optional(),destructiveHint:$e().optional(),idempotentHint:$e().optional(),openWorldHint:$e().optional()}),jb=E({taskSupport:Fe(["required","optional","forbidden"]).optional()}),Sf=E({...Yr.shape,...Fn.shape,description:y().optional(),inputSchema:E({type:R("object"),properties:me(y(),Se).optional(),required:G(y()).optional()}).catchall(fe()),outputSchema:E({type:R("object"),properties:me(y(),Se).optional(),required:G(y()).optional()}).catchall(fe()).optional(),annotations:Rb.optional(),execution:jb.optional(),_meta:me(y(),fe()).optional()}),ws=Vn.extend({method:R("tools/list")}),Ob=Kn.extend({tools:G(Sf)}),ks=ze.extend({content:G(Qc).default([]),structuredContent:me(y(),fe()).optional(),isError:$e().optional()}),XE=ks.or(ze.extend({toolResult:fe()})),Nb=Ln.extend({name:y(),arguments:me(y(),fe()).optional()}),tn=Te.extend({method:R("tools/call"),params:Nb}),Ab=tt.extend({method:R("notifications/tools/list_changed"),params:et.optional()}),YE=E({autoRefresh:$e().default(!0),debounceMs:re().int().nonnegative().default(300)}),Gn=Fe(["debug","info","notice","warning","error","critical","alert","emergency"]),Zb=We.extend({level:Gn}),eu=Te.extend({method:R("logging/setLevel"),params:Zb}),Mb=et.extend({level:Gn,logger:y().optional(),data:fe()}),Db=tt.extend({method:R("notifications/message"),params:Mb}),qb=E({name:y().optional()}),Lb=E({hints:G(qb).optional(),costPriority:re().min(0).max(1).optional(),speedPriority:re().min(0).max(1).optional(),intelligencePriority:re().min(0).max(1).optional()}),Ub=E({mode:Fe(["auto","required","none"]).optional()}),Fb=E({type:R("tool_result"),toolUseId:y().describe("The unique identifier for the corresponding tool call."),content:G(Qc).default([]),structuredContent:E({}).loose().optional(),isError:$e().optional(),_meta:me(y(),fe()).optional()}),Vb=Mc("type",[Wc,Xc,Yc]),ss=Mc("type",[Wc,Xc,Yc,Tb,Fb]),Kb=E({role:Jn,content:ce([ss,G(ss)]),_meta:me(y(),fe()).optional()}),Hb=Ln.extend({messages:G(Kb),modelPreferences:Lb.optional(),systemPrompt:y().optional(),includeContext:Fe(["none","thisServer","allServers"]).optional(),temperature:re().optional(),maxTokens:re().int(),stopSequences:G(y()).optional(),metadata:Se.optional(),tools:G(Sf).optional(),toolChoice:Ub.optional()}),Bb=Te.extend({method:R("sampling/createMessage"),params:Hb}),tu=ze.extend({model:y(),stopReason:ge(Fe(["endTurn","stopSequence","maxTokens"]).or(y())),role:Jn,content:Vb}),ru=ze.extend({model:y(),stopReason:ge(Fe(["endTurn","stopSequence","maxTokens","toolUse"]).or(y())),role:Jn,content:ce([ss,G(ss)])}),Jb=E({type:R("boolean"),title:y().optional(),description:y().optional(),default:$e().optional()}),Gb=E({type:R("string"),title:y().optional(),description:y().optional(),minLength:re().optional(),maxLength:re().optional(),format:Fe(["email","uri","date","date-time"]).optional(),default:y().optional()}),Wb=E({type:Fe(["number","integer"]),title:y().optional(),description:y().optional(),minimum:re().optional(),maximum:re().optional(),default:re().optional()}),Xb=E({type:R("string"),title:y().optional(),description:y().optional(),enum:G(y()),default:y().optional()}),Yb=E({type:R("string"),title:y().optional(),description:y().optional(),oneOf:G(E({const:y(),title:y()})),default:y().optional()}),Qb=E({type:R("string"),title:y().optional(),description:y().optional(),enum:G(y()),enumNames:G(y()).optional(),default:y().optional()}),e$=ce([Xb,Yb]),t$=E({type:R("array"),title:y().optional(),description:y().optional(),minItems:re().optional(),maxItems:re().optional(),items:E({type:R("string"),enum:G(y())}),default:G(y()).optional()}),r$=E({type:R("array"),title:y().optional(),description:y().optional(),minItems:re().optional(),maxItems:re().optional(),items:E({anyOf:G(E({const:y(),title:y()}))}),default:G(y()).optional()}),n$=ce([t$,r$]),o$=ce([Qb,e$,n$]),s$=ce([o$,Jb,Gb,Wb]),i$=Ln.extend({mode:R("form").optional(),message:y(),requestedSchema:E({type:R("object"),properties:me(y(),s$),required:G(y()).optional()})}),a$=Ln.extend({mode:R("url"),message:y(),elicitationId:y(),url:y().url()}),c$=ce([i$,a$]),u$=Te.extend({method:R("elicitation/create"),params:c$}),l$=et.extend({elicitationId:y()}),d$=tt.extend({method:R("notifications/elicitation/complete"),params:l$}),Ss=ze.extend({action:Fe(["accept","decline","cancel"]),content:Dc(t=>t===null?void 0:t,me(y(),ce([y(),re(),$e(),G(y())])).optional())}),p$=E({type:R("ref/resource"),uri:y()});var f$=E({type:R("ref/prompt"),name:y()}),m$=We.extend({ref:ce([f$,p$]),argument:E({name:y(),value:y()}),context:E({arguments:me(y(),y()).optional()}).optional()}),Ts=Te.extend({method:R("completion/complete"),params:m$});function Tf(t){if(t.params.ref.type!=="ref/prompt")throw new TypeError(`Expected CompleteRequestPrompt, but got ${t.params.ref.type}`)}function zf(t){if(t.params.ref.type!=="ref/resource")throw new TypeError(`Expected CompleteRequestResourceTemplate, but got ${t.params.ref.type}`)}var h$=ze.extend({completion:Ne({values:G(y()).max(100),total:ge(re().int()),hasMore:ge($e())})}),g$=E({uri:y().startsWith("file://"),name:y().optional(),_meta:me(y(),fe()).optional()}),y$=Te.extend({method:R("roots/list"),params:We.optional()}),nu=ze.extend({roots:G(g$)}),_$=tt.extend({method:R("notifications/roots/list_changed"),params:et.optional()}),QE=ce([ls,Hc,Ts,eu,$s,bs,_s,vs,xs,yb,vb,tn,ws,ps,ms,hs,ys]),eI=ce([us,ds,Bc,_$,Bn]),tI=ce([cs,tu,ru,Ss,nu,fs,gs,Qr]),rI=ce([ls,Bb,u$,y$,ps,ms,hs,ys]),nI=ce([us,ds,Db,bb,hb,Ab,Cb,Bn,d$]),oI=ce([cs,ob,h$,Ib,kb,db,pb,mb,ks,Ob,fs,gs,Qr]),C=class t extends Error{constructor(e,r,n){super(`MCP error ${e}: ${r}`),this.code=e,this.data=n,this.name="McpError"}static fromError(e,r,n){if(e===O.UrlElicitationRequired&&n){let o=n;if(o.elicitations)return new qc(o.elicitations,r)}return new t(e,r,n)}},qc=class extends C{constructor(e,r=`URL elicitation${e.length>1?"s":""} required`){super(O.UrlElicitationRequired,r,{elicitations:e})}get elicitations(){return this.data?.elicitations??[]}};function Jt(t){return t==="completed"||t==="failed"||t==="cancelled"}var Ef=Symbol("Let zodToJsonSchema decide on which parser to use");var Pf={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},If=t=>typeof t=="string"?{...Pf,name:t}:{...Pf,...t};var Cf=t=>{let e=If(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,o])=>[o._def,{def:o._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function ou(t,e,r,n){n?.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function W(t,e,r,n,o){t[e]=r,ou(t,e,n,o)}var zs=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")};function he(t){if(t.target!=="openAi")return{};let e=[...t.basePath,t.definitionPath,t.openAiAnyTypeName];return t.flags.hasReferencedOpenAiAnyType=!0,{$ref:t.$refStrategy==="relative"?zs(e,t.currentPath):e.join("/")}}function Rf(t,e){let r={type:"array"};return t.type?._def&&t.type?._def?.typeName!==w.ZodAny&&(r.items=D(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&W(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&W(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(W(r,"minItems",t.exactLength.value,t.exactLength.message,e),W(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function jf(t,e){let r={type:"integer",format:"int64"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?W(r,"minimum",n.value,n.message,e):W(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),W(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?W(r,"maximum",n.value,n.message,e):W(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),W(r,"maximum",n.value,n.message,e));break;case"multipleOf":W(r,"multipleOf",n.value,n.message,e);break}return r}function Of(){return{type:"boolean"}}function Ps(t,e){return D(t.type._def,e)}var Nf=(t,e)=>D(t.innerType._def,e);function su(t,e,r){let n=r??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((o,s)=>su(t,e,o))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return v$(t,e)}}var v$=(t,e)=>{let r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(let n of t.checks)switch(n.kind){case"min":W(r,"minimum",n.value,n.message,e);break;case"max":W(r,"maximum",n.value,n.message,e);break}return r};function Af(t,e){return{...D(t.innerType._def,e),default:t.defaultValue()}}function Zf(t,e){return e.effectStrategy==="input"?D(t.schema._def,e):he(e)}function Mf(t){return{type:"string",enum:Array.from(t.values)}}var x$=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function Df(t,e){let r=[D(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),D(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,o=[];return r.forEach(s=>{if(x$(s))o.push(...s.allOf),s.unevaluatedProperties===void 0&&(n=void 0);else{let i=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:a,...c}=s;i=c}else n=void 0;o.push(i)}}),o.length?{allOf:o,...n}:void 0}function qf(t,e){let r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}var iu,ut={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(iu===void 0&&(iu=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),iu),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Es(t,e){let r={type:"string"};if(t.checks)for(let n of t.checks)switch(n.kind){case"min":W(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e);break;case"max":W(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":lt(r,"email",n.message,e);break;case"format:idn-email":lt(r,"idn-email",n.message,e);break;case"pattern:zod":Ae(r,ut.email,n.message,e);break}break;case"url":lt(r,"uri",n.message,e);break;case"uuid":lt(r,"uuid",n.message,e);break;case"regex":Ae(r,n.regex,n.message,e);break;case"cuid":Ae(r,ut.cuid,n.message,e);break;case"cuid2":Ae(r,ut.cuid2,n.message,e);break;case"startsWith":Ae(r,RegExp(`^${au(n.value,e)}`),n.message,e);break;case"endsWith":Ae(r,RegExp(`${au(n.value,e)}$`),n.message,e);break;case"datetime":lt(r,"date-time",n.message,e);break;case"date":lt(r,"date",n.message,e);break;case"time":lt(r,"time",n.message,e);break;case"duration":lt(r,"duration",n.message,e);break;case"length":W(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e),W(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"includes":{Ae(r,RegExp(au(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&lt(r,"ipv4",n.message,e),n.version!=="v4"&&lt(r,"ipv6",n.message,e);break}case"base64url":Ae(r,ut.base64url,n.message,e);break;case"jwt":Ae(r,ut.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&Ae(r,ut.ipv4Cidr,n.message,e),n.version!=="v4"&&Ae(r,ut.ipv6Cidr,n.message,e);break}case"emoji":Ae(r,ut.emoji(),n.message,e);break;case"ulid":{Ae(r,ut.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{lt(r,"binary",n.message,e);break}case"contentEncoding:base64":{W(r,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{Ae(r,ut.base64,n.message,e);break}}break}case"nanoid":Ae(r,ut.nanoid,n.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}function au(t,e){return e.patternStrategy==="escape"?$$(t):t}var b$=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function $$(t){let e="";for(let r=0;r<t.length;r++)b$.has(t[r])||(e+="\\"),e+=t[r];return e}function lt(t,e,r,n){t.format||t.anyOf?.some(o=>o.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&n.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&n.errorMessages&&{errorMessage:{format:r}}})):W(t,"format",e,r,n)}function Ae(t,e,r,n){t.pattern||t.allOf?.some(o=>o.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&n.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:Lf(e,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):W(t,"pattern",Lf(e,n),r,n)}function Lf(t,e){if(!e.applyRegexFlags||!t.flags)return t.source;let r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},n=r.i?t.source.toLowerCase():t.source,o="",s=!1,i=!1,a=!1;for(let c=0;c<n.length;c++){if(s){o+=n[c],s=!1;continue}if(r.i){if(i){if(n[c].match(/[a-z]/)){a?(o+=n[c],o+=`${n[c-2]}-${n[c]}`.toUpperCase(),a=!1):n[c+1]==="-"&&n[c+2]?.match(/[a-z]/)?(o+=n[c],a=!0):o+=`${n[c]}${n[c].toUpperCase()}`;continue}}else if(n[c].match(/[a-z]/)){o+=`[${n[c]}${n[c].toUpperCase()}]`;continue}}if(r.m){if(n[c]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(n[c]==="$"){o+=`($|(?=[\r
]))`;continue}}if(r.s&&n[c]==="."){o+=i?`${n[c]}\r
`:`[${n[c]}\r
]`;continue}o+=n[c],n[c]==="\\"?s=!0:i&&n[c]==="]"?i=!1:!i&&n[c]==="["&&(i=!0)}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return o}function Is(t,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&t.keyType?._def.typeName===w.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((n,o)=>({...n,[o]:D(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",o]})??he(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let r={type:"object",additionalProperties:D(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return r;if(t.keyType?._def.typeName===w.ZodString&&t.keyType._def.checks?.length){let{type:n,...o}=Es(t.keyType._def,e);return{...r,propertyNames:o}}else{if(t.keyType?._def.typeName===w.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};if(t.keyType?._def.typeName===w.ZodBranded&&t.keyType._def.type._def.typeName===w.ZodString&&t.keyType._def.type._def.checks?.length){let{type:n,...o}=Ps(t.keyType._def,e);return{...r,propertyNames:o}}}return r}function Uf(t,e){if(e.mapStrategy==="record")return Is(t,e);let r=D(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||he(e),n=D(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||he(e);return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function Ff(t){let e=t.values,n=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),o=Array.from(new Set(n.map(s=>typeof s)));return{type:o.length===1?o[0]==="string"?"string":"number":["string","number"],enum:n}}function Vf(t){return t.target==="openAi"?void 0:{not:he({...t,currentPath:[...t.currentPath,"not"]})}}function Kf(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var Wn={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Bf(t,e){if(e.target==="openApi3")return Hf(t,e);let r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(n=>n._def.typeName in Wn&&(!n._def.checks||!n._def.checks.length))){let n=r.reduce((o,s)=>{let i=Wn[s._def.typeName];return i&&!o.includes(i)?[...o,i]:o},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=r.reduce((o,s)=>{let i=typeof s._def.value;switch(i){case"string":case"number":case"boolean":return[...o,i];case"bigint":return[...o,"integer"];case"object":if(s._def.value===null)return[...o,"null"];default:return o}},[]);if(n.length===r.length){let o=n.filter((s,i,a)=>a.indexOf(s)===i);return{type:o.length>1?o:o[0],enum:r.reduce((s,i)=>s.includes(i._def.value)?s:[...s,i._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,o)=>[...n,...o._def.values.filter(s=>!n.includes(s))],[])};return Hf(t,e)}var Hf=(t,e)=>{let r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((n,o)=>D(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${o}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function Jf(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:Wn[t.innerType._def.typeName],nullable:!0}:{type:[Wn[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=D(t.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let r=D(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function Gf(t,e){let r={type:"number"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"int":r.type="integer",ou(r,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?W(r,"minimum",n.value,n.message,e):W(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),W(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?W(r,"maximum",n.value,n.message,e):W(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),W(r,"maximum",n.value,n.message,e));break;case"multipleOf":W(r,"multipleOf",n.value,n.message,e);break}return r}function Wf(t,e){let r=e.target==="openAi",n={type:"object",properties:{}},o=[],s=t.shape();for(let a in s){let c=s[a];if(c===void 0||c._def===void 0)continue;let u=k$(c);u&&r&&(c._def.typeName==="ZodOptional"&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),u=!1);let l=D(c._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});l!==void 0&&(n.properties[a]=l,u||o.push(a))}o.length&&(n.required=o);let i=w$(t,e);return i!==void 0&&(n.additionalProperties=i),n}function w$(t,e){if(t.catchall._def.typeName!=="ZodNever")return D(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function k$(t){try{return t.isOptional()}catch{return!0}}var Xf=(t,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return D(t.innerType._def,e);let r=D(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:he(e)},r]}:he(e)};var Yf=(t,e)=>{if(e.pipeStrategy==="input")return D(t.in._def,e);if(e.pipeStrategy==="output")return D(t.out._def,e);let r=D(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=D(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(o=>o!==void 0)}};function Qf(t,e){return D(t.type._def,e)}function em(t,e){let n={type:"array",uniqueItems:!0,items:D(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&W(n,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&W(n,"maxItems",t.maxSize.value,t.maxSize.message,e),n}function tm(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,n)=>D(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:D(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,n)=>D(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function rm(t){return{not:he(t)}}function nm(t){return he(t)}var om=(t,e)=>D(t.innerType._def,e);var sm=(t,e,r)=>{switch(e){case w.ZodString:return Es(t,r);case w.ZodNumber:return Gf(t,r);case w.ZodObject:return Wf(t,r);case w.ZodBigInt:return jf(t,r);case w.ZodBoolean:return Of();case w.ZodDate:return su(t,r);case w.ZodUndefined:return rm(r);case w.ZodNull:return Kf(r);case w.ZodArray:return Rf(t,r);case w.ZodUnion:case w.ZodDiscriminatedUnion:return Bf(t,r);case w.ZodIntersection:return Df(t,r);case w.ZodTuple:return tm(t,r);case w.ZodRecord:return Is(t,r);case w.ZodLiteral:return qf(t,r);case w.ZodEnum:return Mf(t);case w.ZodNativeEnum:return Ff(t);case w.ZodNullable:return Jf(t,r);case w.ZodOptional:return Xf(t,r);case w.ZodMap:return Uf(t,r);case w.ZodSet:return em(t,r);case w.ZodLazy:return()=>t.getter()._def;case w.ZodPromise:return Qf(t,r);case w.ZodNaN:case w.ZodNever:return Vf(r);case w.ZodEffects:return Zf(t,r);case w.ZodAny:return he(r);case w.ZodUnknown:return nm(r);case w.ZodDefault:return Af(t,r);case w.ZodBranded:return Ps(t,r);case w.ZodReadonly:return om(t,r);case w.ZodCatch:return Nf(t,r);case w.ZodPipeline:return Yf(t,r);case w.ZodFunction:case w.ZodVoid:case w.ZodSymbol:return;default:return(n=>{})(e)}};function D(t,e,r=!1){let n=e.seen.get(t);if(e.override){let a=e.override?.(t,e,n,r);if(a!==Ef)return a}if(n&&!r){let a=S$(n,e);if(a!==void 0)return a}let o={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,o);let s=sm(t,t.typeName,e),i=typeof s=="function"?D(s(),e):s;if(i&&T$(t,e,i),e.postProcess){let a=e.postProcess(i,t,e);return o.jsonSchema=i,a}return o.jsonSchema=i,i}var S$=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:zs(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,n)=>e.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),he(e)):e.$refStrategy==="seen"?he(e):void 0}},T$=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r);var cu=(t,e)=>{let r=Cf(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((c,[u,l])=>({...c,[u]:D(l._def,{...r,currentPath:[...r.basePath,r.definitionPath,u]},!0)??he(r)}),{}):void 0,o=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,s=D(t._def,o===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,o]},!1)??he(r),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i),r.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[r.openAiAnyTypeName]||(n[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:r.$refStrategy==="relative"?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));let a=o===void 0?n?{...s,[r.definitionPath]:n}:s:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,o].join("/"),[r.definitionPath]:{...n,[o]:s}};return r.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function z$(t){return!t||t==="jsonSchema7"||t==="draft-7"?"draft-7":t==="jsonSchema2019-09"||t==="draft-2020-12"?"draft-2020-12":"draft-7"}function uu(t,e){return Qe(t)?Ec(t,{target:z$(e?.target),io:e?.pipeStrategy??"input"}):cu(t,{strictUnions:e?.strictUnions??!0,pipeStrategy:e?.pipeStrategy??"input"})}function lu(t){let r=Ht(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=rs(r);if(typeof n!="string")throw new Error("Schema method literal must be a string");return n}function du(t,e){let r=Kt(t,e);if(!r.success)throw r.error;return r.data}var P$=6e4,Cs=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(us,r=>{this._oncancel(r)}),this.setNotificationHandler(ds,r=>{this._onprogress(r)}),this.setRequestHandler(ls,r=>({})),this._taskStore=e?.taskStore,this._taskMessageQueue=e?.taskMessageQueue,this._taskStore&&(this.setRequestHandler(ps,async(r,n)=>{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new C(O.InvalidParams,"Failed to retrieve task: Task not found");return{...o}}),this.setRequestHandler(ms,async(r,n)=>{let o=async()=>{let s=r.params.taskId;if(this._taskMessageQueue){let a;for(;a=await this._taskMessageQueue.dequeue(s,n.sessionId);){if(a.type==="response"||a.type==="error"){let c=a.message,u=c.id,l=this._requestResolvers.get(u);if(l)if(this._requestResolvers.delete(u),a.type==="response")l(c);else{let d=c,h=new C(d.error.code,d.error.message,d.error.data);l(h)}else{let d=a.type==="response"?"Response":"Error";this._onerror(new Error(`${d} handler missing for request ${u}`))}continue}await this._transport?.send(a.message,{relatedRequestId:n.requestId})}}let i=await this._taskStore.getTask(s,n.sessionId);if(!i)throw new C(O.InvalidParams,`Task not found: ${s}`);if(!Jt(i.status))return await this._waitForTaskUpdate(s,n.signal),await o();if(Jt(i.status)){let a=await this._taskStore.getTaskResult(s,n.sessionId);return this._clearTaskQueue(s),{...a,_meta:{...a._meta,[Bt]:{taskId:s}}}}return await o()};return await o()}),this.setRequestHandler(hs,async(r,n)=>{try{let{tasks:o,nextCursor:s}=await this._taskStore.listTasks(r.params?.cursor,n.sessionId);return{tasks:o,nextCursor:s,_meta:{}}}catch(o){throw new C(O.InvalidParams,`Failed to list tasks: ${o instanceof Error?o.message:String(o)}`)}}),this.setRequestHandler(ys,async(r,n)=>{try{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new C(O.InvalidParams,`Task not found: ${r.params.taskId}`);if(Jt(o.status))throw new C(O.InvalidParams,`Cannot cancel task in terminal status: ${o.status}`);await this._taskStore.updateTaskStatus(r.params.taskId,"cancelled","Client cancelled task execution.",n.sessionId),this._clearTaskQueue(r.params.taskId);let s=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!s)throw new C(O.InvalidParams,`Task not found after cancellation: ${r.params.taskId}`);return{_meta:{},...s}}catch(o){throw o instanceof C?o:new C(O.InvalidRequest,`Failed to cancel task: ${o instanceof Error?o.message:String(o)}`)}}))}async _oncancel(e){if(!e.params.requestId)return;this._requestHandlerAbortControllers.get(e.params.requestId)?.abort(e.params.reason)}_setupTimeout(e,r,n,o,s=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(o,r),startTime:Date.now(),timeout:r,maxTotalTimeout:n,resetTimeoutOnProgress:s,onTimeout:o})}_resetTimeout(e){let r=this._timeoutInfo.get(e);if(!r)return!1;let n=Date.now()-r.startTime;if(r.maxTotalTimeout&&n>=r.maxTotalTimeout)throw this._timeoutInfo.delete(e),C.fromError(O.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:n});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(e){let r=this._timeoutInfo.get(e);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(e))}async connect(e){if(this._transport)throw new Error("Already connected to a transport. Call close() before connecting to a new transport, or use a separate Protocol instance per connection.");this._transport=e;let r=this.transport?.onclose;this._transport.onclose=()=>{r?.(),this._onclose()};let n=this.transport?.onerror;this._transport.onerror=s=>{n?.(s),this._onerror(s)};let o=this._transport?.onmessage;this._transport.onmessage=(s,i)=>{o?.(s,i),Un(s)||yf(s)?this._onresponse(s):Fc(s)?this._onrequest(s,i):gf(s)?this._onnotification(s):this._onerror(new Error(`Unknown message type: ${JSON.stringify(s)}`))},await this._transport.start()}_onclose(){let e=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();for(let n of this._requestHandlerAbortControllers.values())n.abort();this._requestHandlerAbortControllers.clear();let r=C.fromError(O.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(let n of e.values())n(r)}_onerror(e){this.onerror?.(e)}_onnotification(e){let r=this._notificationHandlers.get(e.method)??this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(e)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(e,r){let n=this._requestHandlers.get(e.method)??this.fallbackRequestHandler,o=this._transport,s=e.params?._meta?.[Bt]?.taskId;if(n===void 0){let l={jsonrpc:"2.0",id:e.id,error:{code:O.MethodNotFound,message:"Method not found"}};s&&this._taskMessageQueue?this._enqueueTaskMessage(s,{type:"error",message:l,timestamp:Date.now()},o?.sessionId).catch(d=>this._onerror(new Error(`Failed to enqueue error response: ${d}`))):o?.send(l).catch(d=>this._onerror(new Error(`Failed to send an error response: ${d}`)));return}let i=new AbortController;this._requestHandlerAbortControllers.set(e.id,i);let a=ff(e.params)?e.params.task:void 0,c=this._taskStore?this.requestTaskStore(e,o?.sessionId):void 0,u={signal:i.signal,sessionId:o?.sessionId,_meta:e.params?._meta,sendNotification:async l=>{if(i.signal.aborted)return;let d={relatedRequestId:e.id};s&&(d.relatedTask={taskId:s}),await this.notification(l,d)},sendRequest:async(l,d,h)=>{if(i.signal.aborted)throw new C(O.ConnectionClosed,"Request was cancelled");let f={...h,relatedRequestId:e.id};s&&!f.relatedTask&&(f.relatedTask={taskId:s});let p=f.relatedTask?.taskId??s;return p&&c&&await c.updateTaskStatus(p,"input_required"),await this.request(l,d,f)},authInfo:r?.authInfo,requestId:e.id,requestInfo:r?.requestInfo,taskId:s,taskStore:c,taskRequestedTtl:a?.ttl,closeSSEStream:r?.closeSSEStream,closeStandaloneSSEStream:r?.closeStandaloneSSEStream};Promise.resolve().then(()=>{a&&this.assertTaskHandlerCapability(e.method)}).then(()=>n(e,u)).then(async l=>{if(i.signal.aborted)return;let d={result:l,jsonrpc:"2.0",id:e.id};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"response",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)},async l=>{if(i.signal.aborted)return;let d={jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(l.code)?l.code:O.InternalError,message:l.message??"Internal error",...l.data!==void 0&&{data:l.data}}};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"error",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)}).catch(l=>this._onerror(new Error(`Failed to send response: ${l}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progressToken:r,...n}=e.params,o=Number(r),s=this._progressHandlers.get(o);if(!s){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}let i=this._responseHandlers.get(o),a=this._timeoutInfo.get(o);if(a&&i&&a.resetTimeoutOnProgress)try{this._resetTimeout(o)}catch(c){this._responseHandlers.delete(o),this._progressHandlers.delete(o),this._cleanupTimeout(o),i(c);return}s(n)}_onresponse(e){let r=Number(e.id),n=this._requestResolvers.get(r);if(n){if(this._requestResolvers.delete(r),Un(e))n(e);else{let i=new C(e.error.code,e.error.message,e.error.data);n(i)}return}let o=this._responseHandlers.get(r);if(o===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}this._responseHandlers.delete(r),this._cleanupTimeout(r);let s=!1;if(Un(e)&&e.result&&typeof e.result=="object"){let i=e.result;if(i.task&&typeof i.task=="object"){let a=i.task;typeof a.taskId=="string"&&(s=!0,this._taskProgressTokens.set(a.taskId,r))}}if(s||this._progressHandlers.delete(r),Un(e))o(e);else{let i=C.fromError(e.error.code,e.error.message,e.error.data);o(i)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(e,r,n){let{task:o}=n??{};if(!o){try{yield{type:"result",result:await this.request(e,r,n)}}catch(i){yield{type:"error",error:i instanceof C?i:new C(O.InternalError,String(i))}}return}let s;try{let i=await this.request(e,Qr,n);if(i.task)s=i.task.taskId,yield{type:"taskCreated",task:i.task};else throw new C(O.InternalError,"Task creation did not return a task");for(;;){let a=await this.getTask({taskId:s},n);if(yield{type:"taskStatus",task:a},Jt(a.status)){a.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)}:a.status==="failed"?yield{type:"error",error:new C(O.InternalError,`Task ${s} failed`)}:a.status==="cancelled"&&(yield{type:"error",error:new C(O.InternalError,`Task ${s} was cancelled`)});return}if(a.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)};return}let c=a.pollInterval??this._options?.defaultTaskPollInterval??1e3;await new Promise(u=>setTimeout(u,c)),n?.signal?.throwIfAborted()}}catch(i){yield{type:"error",error:i instanceof C?i:new C(O.InternalError,String(i))}}}request(e,r,n){let{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i,task:a,relatedTask:c}=n??{};return new Promise((u,l)=>{let d=x=>{l(x)};if(!this._transport){d(new Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{this.assertCapabilityForMethod(e.method),a&&this.assertTaskCapability(e.method)}catch(x){d(x);return}n?.signal?.throwIfAborted();let h=this._requestMessageId++,f={...e,jsonrpc:"2.0",id:h};n?.onprogress&&(this._progressHandlers.set(h,n.onprogress),f.params={...e.params,_meta:{...e.params?._meta||{},progressToken:h}}),a&&(f.params={...f.params,task:a}),c&&(f.params={...f.params,_meta:{...f.params?._meta||{},[Bt]:c}});let p=x=>{this._responseHandlers.delete(h),this._progressHandlers.delete(h),this._cleanupTimeout(h),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:h,reason:String(x)}},{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i}).catch(k=>this._onerror(new Error(`Failed to send cancellation: ${k}`)));let b=x instanceof C?x:new C(O.RequestTimeout,String(x));l(b)};this._responseHandlers.set(h,x=>{if(!n?.signal?.aborted){if(x instanceof Error)return l(x);try{let b=Kt(r,x.result);b.success?u(b.data):l(b.error)}catch(b){l(b)}}}),n?.signal?.addEventListener("abort",()=>{p(n?.signal?.reason)});let m=n?.timeout??P$,g=()=>p(C.fromError(O.RequestTimeout,"Request timed out",{timeout:m}));this._setupTimeout(h,m,n?.maxTotalTimeout,g,n?.resetTimeoutOnProgress??!1);let v=c?.taskId;if(v){let x=b=>{let k=this._responseHandlers.get(h);k?k(b):this._onerror(new Error(`Response handler missing for side-channeled request ${h}`))};this._requestResolvers.set(h,x),this._enqueueTaskMessage(v,{type:"request",message:f,timestamp:Date.now()}).catch(b=>{this._cleanupTimeout(h),l(b)})}else this._transport.send(f,{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i}).catch(x=>{this._cleanupTimeout(h),l(x)})})}async getTask(e,r){return this.request({method:"tasks/get",params:e},fs,r)}async getTaskResult(e,r,n){return this.request({method:"tasks/result",params:e},r,n)}async listTasks(e,r){return this.request({method:"tasks/list",params:e},gs,r)}async cancelTask(e,r){return this.request({method:"tasks/cancel",params:e},xf,r)}async notification(e,r){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);let n=r?.relatedTask?.taskId;if(n){let a={...e,jsonrpc:"2.0",params:{...e.params,_meta:{...e.params?._meta||{},[Bt]:r.relatedTask}}};await this._enqueueTaskMessage(n,{type:"notification",message:a,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(e.method)&&!e.params&&!r?.relatedRequestId&&!r?.relatedTask){if(this._pendingDebouncedNotifications.has(e.method))return;this._pendingDebouncedNotifications.add(e.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(e.method),!this._transport)return;let a={...e,jsonrpc:"2.0"};r?.relatedTask&&(a={...a,params:{...a.params,_meta:{...a.params?._meta||{},[Bt]:r.relatedTask}}}),this._transport?.send(a,r).catch(c=>this._onerror(c))});return}let i={...e,jsonrpc:"2.0"};r?.relatedTask&&(i={...i,params:{...i.params,_meta:{...i.params?._meta||{},[Bt]:r.relatedTask}}}),await this._transport.send(i,r)}setRequestHandler(e,r){let n=lu(e);this.assertRequestHandlerCapability(n),this._requestHandlers.set(n,(o,s)=>{let i=du(e,o);return Promise.resolve(r(i,s))})}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,r){let n=lu(e);this._notificationHandlers.set(n,o=>{let s=du(e,o);return Promise.resolve(r(s))})}removeNotificationHandler(e){this._notificationHandlers.delete(e)}_cleanupTaskProgressHandler(e){let r=this._taskProgressTokens.get(e);r!==void 0&&(this._progressHandlers.delete(r),this._taskProgressTokens.delete(e))}async _enqueueTaskMessage(e,r,n){if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let o=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(e,r,n,o)}async _clearTaskQueue(e,r){if(this._taskMessageQueue){let n=await this._taskMessageQueue.dequeueAll(e,r);for(let o of n)if(o.type==="request"&&Fc(o.message)){let s=o.message.id,i=this._requestResolvers.get(s);i?(i(new C(O.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(s)):this._onerror(new Error(`Resolver missing for request ${s} during task ${e} cleanup`))}}}async _waitForTaskUpdate(e,r){let n=this._options?.defaultTaskPollInterval??1e3;try{let o=await this._taskStore?.getTask(e);o?.pollInterval&&(n=o.pollInterval)}catch{}return new Promise((o,s)=>{if(r.aborted){s(new C(O.InvalidRequest,"Request cancelled"));return}let i=setTimeout(o,n);r.addEventListener("abort",()=>{clearTimeout(i),s(new C(O.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(e,r){let n=this._taskStore;if(!n)throw new Error("No task store configured");return{createTask:async o=>{if(!e)throw new Error("No request provided");return await n.createTask(o,e.id,{method:e.method,params:e.params},r)},getTask:async o=>{let s=await n.getTask(o,r);if(!s)throw new C(O.InvalidParams,"Failed to retrieve task: Task not found");return s},storeTaskResult:async(o,s,i)=>{await n.storeTaskResult(o,s,i,r);let a=await n.getTask(o,r);if(a){let c=Bn.parse({method:"notifications/tasks/status",params:a});await this.notification(c),Jt(a.status)&&this._cleanupTaskProgressHandler(o)}},getTaskResult:o=>n.getTaskResult(o,r),updateTaskStatus:async(o,s,i)=>{let a=await n.getTask(o,r);if(!a)throw new C(O.InvalidParams,`Task "${o}" not found - it may have been cleaned up`);if(Jt(a.status))throw new C(O.InvalidParams,`Cannot update task "${o}" from terminal status "${a.status}" to "${s}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await n.updateTaskStatus(o,s,i,r);let c=await n.getTask(o,r);if(c){let u=Bn.parse({method:"notifications/tasks/status",params:c});await this.notification(u),Jt(c.status)&&this._cleanupTaskProgressHandler(o)}},listTasks:o=>n.listTasks(o,r)}}};function im(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function am(t,e){let r={...t};for(let n in e){let o=n,s=e[o];if(s===void 0)continue;let i=r[o];im(i)&&im(s)?r[o]={...i,...s}:r[o]=s}return r}var Bg=Io(Wl(),1),Jg=Io(Hg(),1);function _z(){let t=new Bg.default({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return(0,Jg.default)(t),t}var mi=class{constructor(e){this._ajv=e??_z()}getValidator(e){let r="$id"in e&&typeof e.$id=="string"?this._ajv.getSchema(e.$id)??this._ajv.compile(e):this._ajv.compile(e);return n=>r(n)?{valid:!0,data:n,errorMessage:void 0}:{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(r.errors)}}};var hi=class{constructor(e){this._server=e}requestStream(e,r,n){return this._server.requestStream(e,r,n)}async getTask(e,r){return this._server.getTask({taskId:e},r)}async getTaskResult(e,r,n){return this._server.getTaskResult({taskId:e},r,n)}async listTasks(e,r){return this._server.listTasks(e?{cursor:e}:void 0,r)}async cancelTask(e,r){return this._server.cancelTask({taskId:e},r)}};function Gg(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"tools/call":if(!t.tools?.call)throw new Error(`${r} does not support task creation for tools/call (required for ${e})`);break;default:break}}function Wg(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"sampling/createMessage":if(!t.sampling?.createMessage)throw new Error(`${r} does not support task creation for sampling/createMessage (required for ${e})`);break;case"elicitation/create":if(!t.elicitation?.create)throw new Error(`${r} does not support task creation for elicitation/create (required for ${e})`);break;default:break}}var gi=class extends Cs{constructor(e,r){super(r),this._serverInfo=e,this._loggingLevels=new Map,this.LOG_LEVEL_SEVERITY=new Map(Gn.options.map((n,o)=>[n,o])),this.isMessageIgnored=(n,o)=>{let s=this._loggingLevels.get(o);return s?this.LOG_LEVEL_SEVERITY.get(n)<this.LOG_LEVEL_SEVERITY.get(s):!1},this._capabilities=r?.capabilities??{},this._instructions=r?.instructions,this._jsonSchemaValidator=r?.jsonSchemaValidator??new mi,this.setRequestHandler(Hc,n=>this._oninitialize(n)),this.setNotificationHandler(Bc,()=>this.oninitialized?.()),this._capabilities.logging&&this.setRequestHandler(eu,async(n,o)=>{let s=o.sessionId||o.requestInfo?.headers["mcp-session-id"]||void 0,{level:i}=n.params,a=Gn.safeParse(i);return a.success&&this._loggingLevels.set(s,a.data),{}})}get experimental(){return this._experimental||(this._experimental={tasks:new hi(this)}),this._experimental}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=am(this._capabilities,e)}setRequestHandler(e,r){let o=Ht(e)?.method;if(!o)throw new Error("Schema is missing a method literal");let s;if(Qe(o)){let a=o;s=a._zod?.def?.value??a.value}else{let a=o;s=a._def?.value??a.value}if(typeof s!="string")throw new Error("Schema method literal must be a string");if(s==="tools/call"){let a=async(c,u)=>{let l=Kt(tn,c);if(!l.success){let p=l.error instanceof Error?l.error.message:String(l.error);throw new C(O.InvalidParams,`Invalid tools/call request: ${p}`)}let{params:d}=l.data,h=await Promise.resolve(r(c,u));if(d.task){let p=Kt(Qr,h);if(!p.success){let m=p.error instanceof Error?p.error.message:String(p.error);throw new C(O.InvalidParams,`Invalid task creation result: ${m}`)}return p.data}let f=Kt(ks,h);if(!f.success){let p=f.error instanceof Error?f.error.message:String(f.error);throw new C(O.InvalidParams,`Invalid tools/call result: ${p}`)}return f.data};return super.setRequestHandler(e,a)}return super.setRequestHandler(e,r)}assertCapabilityForMethod(e){switch(e){case"sampling/createMessage":if(!this._clientCapabilities?.sampling)throw new Error(`Client does not support sampling (required for ${e})`);break;case"elicitation/create":if(!this._clientCapabilities?.elicitation)throw new Error(`Client does not support elicitation (required for ${e})`);break;case"roots/list":if(!this._clientCapabilities?.roots)throw new Error(`Client does not support listing roots (required for ${e})`);break;case"ping":break}}assertNotificationCapability(e){switch(e){case"notifications/message":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw new Error(`Server does not support notifying about resources (required for ${e})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw new Error(`Server does not support notifying of tool list changes (required for ${e})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw new Error(`Server does not support notifying of prompt list changes (required for ${e})`);break;case"notifications/elicitation/complete":if(!this._clientCapabilities?.elicitation?.url)throw new Error(`Client does not support URL elicitation (required for ${e})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){if(this._capabilities)switch(e){case"completion/complete":if(!this._capabilities.completions)throw new Error(`Server does not support completions (required for ${e})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw new Error(`Server does not support resources (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw new Error(`Server does not support tasks capability (required for ${e})`);break;case"ping":case"initialize":break}}assertTaskCapability(e){Wg(this._clientCapabilities?.tasks?.requests,e,"Client")}assertTaskHandlerCapability(e){this._capabilities&&Gg(this._capabilities.tasks?.requests,e,"Server")}async _oninitialize(e){let r=e.params.protocolVersion;return this._clientCapabilities=e.params.capabilities,this._clientVersion=e.params.clientInfo,{protocolVersion:lf.includes(r)?r:Lc,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},cs)}async createMessage(e,r){if((e.tools||e.toolChoice)&&!this._clientCapabilities?.sampling?.tools)throw new Error("Client does not support sampling tools capability.");if(e.messages.length>0){let n=e.messages[e.messages.length-1],o=Array.isArray(n.content)?n.content:[n.content],s=o.some(u=>u.type==="tool_result"),i=e.messages.length>1?e.messages[e.messages.length-2]:void 0,a=i?Array.isArray(i.content)?i.content:[i.content]:[],c=a.some(u=>u.type==="tool_use");if(s){if(o.some(u=>u.type!=="tool_result"))throw new Error("The last message must contain only tool_result content if any is present");if(!c)throw new Error("tool_result blocks are not matching any tool_use from the previous message")}if(c){let u=new Set(a.filter(d=>d.type==="tool_use").map(d=>d.id)),l=new Set(o.filter(d=>d.type==="tool_result").map(d=>d.toolUseId));if(u.size!==l.size||![...u].every(d=>l.has(d)))throw new Error("ids of tool_result blocks and tool_use blocks from previous message do not match")}}return e.tools?this.request({method:"sampling/createMessage",params:e},ru,r):this.request({method:"sampling/createMessage",params:e},tu,r)}async elicitInput(e,r){switch(e.mode??"form"){case"url":{if(!this._clientCapabilities?.elicitation?.url)throw new Error("Client does not support url elicitation.");let o=e;return this.request({method:"elicitation/create",params:o},Ss,r)}case"form":{if(!this._clientCapabilities?.elicitation?.form)throw new Error("Client does not support form elicitation.");let o=e.mode==="form"?e:{...e,mode:"form"},s=await this.request({method:"elicitation/create",params:o},Ss,r);if(s.action==="accept"&&s.content&&o.requestedSchema)try{let a=this._jsonSchemaValidator.getValidator(o.requestedSchema)(s.content);if(!a.valid)throw new C(O.InvalidParams,`Elicitation response content does not match requested schema: ${a.errorMessage}`)}catch(i){throw i instanceof C?i:new C(O.InternalError,`Error validating elicitation response: ${i instanceof Error?i.message:String(i)}`)}return s}}}createElicitationCompletionNotifier(e,r){if(!this._clientCapabilities?.elicitation?.url)throw new Error("Client does not support URL elicitation (required for notifications/elicitation/complete)");return()=>this.notification({method:"notifications/elicitation/complete",params:{elicitationId:e}},r)}async listRoots(e,r){return this.request({method:"roots/list",params:e},nu,r)}async sendLoggingMessage(e,r){if(this._capabilities.logging&&!this.isMessageIgnored(e.level,r))return this.notification({method:"notifications/message",params:e})}async sendResourceUpdated(e){return this.notification({method:"notifications/resources/updated",params:e})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}};var Yg=Symbol.for("mcp.completable");function od(t){return!!t&&typeof t=="object"&&Yg in t}function Qg(t){return t[Yg]?.complete}var Xg;(function(t){t.Completable="McpCompletable"})(Xg||(Xg={}));var vz=/^[A-Za-z0-9._-]{1,128}$/;function xz(t){let e=[];if(t.length===0)return{isValid:!1,warnings:["Tool name cannot be empty"]};if(t.length>128)return{isValid:!1,warnings:[`Tool name exceeds maximum length of 128 characters (current: ${t.length})`]};if(t.includes(" ")&&e.push("Tool name contains spaces, which may cause parsing issues"),t.includes(",")&&e.push("Tool name contains commas, which may cause parsing issues"),(t.startsWith("-")||t.endsWith("-"))&&e.push("Tool name starts or ends with a dash, which may cause parsing issues in some contexts"),(t.startsWith(".")||t.endsWith("."))&&e.push("Tool name starts or ends with a dot, which may cause parsing issues in some contexts"),!vz.test(t)){let r=t.split("").filter(n=>!/[A-Za-z0-9._-]/.test(n)).filter((n,o,s)=>s.indexOf(n)===o);return e.push(`Tool name contains invalid characters: ${r.map(n=>`"${n}"`).join(", ")}`,"Allowed characters are: A-Z, a-z, 0-9, underscore (_), dash (-), and dot (.)"),{isValid:!1,warnings:e}}return{isValid:!0,warnings:e}}function bz(t,e){if(e.length>0){console.warn(`Tool name validation warning for "${t}":`);for(let r of e)console.warn(`  - ${r}`);console.warn("Tool registration will proceed, but this may cause compatibility issues."),console.warn("Consider updating the tool name to conform to the MCP tool naming standard."),console.warn("See SEP: Specify Format for Tool Names (https://github.com/modelcontextprotocol/modelcontextprotocol/issues/986) for more details.")}}function sd(t){let e=xz(t);return bz(t,e.warnings),e.isValid}var yi=class{constructor(e){this._mcpServer=e}registerToolTask(e,r,n){let o={taskSupport:"required",...r.execution};if(o.taskSupport==="forbidden")throw new Error(`Cannot register task-based tool '${e}' with taskSupport 'forbidden'. Use registerTool() instead.`);return this._mcpServer._createRegisteredTool(e,r.title,r.description,r.inputSchema,r.outputSchema,r.annotations,o,r._meta,n)}};var _i=class{constructor(e,r){this._registeredResources={},this._registeredResourceTemplates={},this._registeredTools={},this._registeredPrompts={},this._toolHandlersInitialized=!1,this._completionHandlerInitialized=!1,this._resourceHandlersInitialized=!1,this._promptHandlersInitialized=!1,this.server=new gi(e,r)}get experimental(){return this._experimental||(this._experimental={tasks:new yi(this)}),this._experimental}async connect(e){return await this.server.connect(e)}async close(){await this.server.close()}setToolRequestHandlers(){this._toolHandlersInitialized||(this.server.assertCanSetRequestHandler(nr(ws)),this.server.assertCanSetRequestHandler(nr(tn)),this.server.registerCapabilities({tools:{listChanged:!0}}),this.server.setRequestHandler(ws,()=>({tools:Object.entries(this._registeredTools).filter(([,e])=>e.enabled).map(([e,r])=>{let n={name:e,title:r.title,description:r.description,inputSchema:(()=>{let o=Xr(r.inputSchema);return o?uu(o,{strictUnions:!0,pipeStrategy:"input"}):$z})(),annotations:r.annotations,execution:r.execution,_meta:r._meta};if(r.outputSchema){let o=Xr(r.outputSchema);o&&(n.outputSchema=uu(o,{strictUnions:!0,pipeStrategy:"output"}))}return n})})),this.server.setRequestHandler(tn,async(e,r)=>{try{let n=this._registeredTools[e.params.name];if(!n)throw new C(O.InvalidParams,`Tool ${e.params.name} not found`);if(!n.enabled)throw new C(O.InvalidParams,`Tool ${e.params.name} disabled`);let o=!!e.params.task,s=n.execution?.taskSupport,i="createTask"in n.handler;if((s==="required"||s==="optional")&&!i)throw new C(O.InternalError,`Tool ${e.params.name} has taskSupport '${s}' but was not registered with registerToolTask`);if(s==="required"&&!o)throw new C(O.MethodNotFound,`Tool ${e.params.name} requires task augmentation (taskSupport: 'required')`);if(s==="optional"&&!o&&i)return await this.handleAutomaticTaskPolling(n,e,r);let a=await this.validateToolInput(n,e.params.arguments,e.params.name),c=await this.executeToolHandler(n,a,r);return o||await this.validateToolOutput(n,c,e.params.name),c}catch(n){if(n instanceof C&&n.code===O.UrlElicitationRequired)throw n;return this.createToolError(n instanceof Error?n.message:String(n))}}),this._toolHandlersInitialized=!0)}createToolError(e){return{content:[{type:"text",text:e}],isError:!0}}async validateToolInput(e,r,n){if(!e.inputSchema)return;let s=Xr(e.inputSchema)??e.inputSchema,i=await es(s,r);if(!i.success){let a="error"in i?i.error:"Unknown error",c=ts(a);throw new C(O.InvalidParams,`Input validation error: Invalid arguments for tool ${n}: ${c}`)}return i.data}async validateToolOutput(e,r,n){if(!e.outputSchema||!("content"in r)||r.isError)return;if(!r.structuredContent)throw new C(O.InvalidParams,`Output validation error: Tool ${n} has an output schema but no structured content was provided`);let o=Xr(e.outputSchema),s=await es(o,r.structuredContent);if(!s.success){let i="error"in s?s.error:"Unknown error",a=ts(i);throw new C(O.InvalidParams,`Output validation error: Invalid structured content for tool ${n}: ${a}`)}}async executeToolHandler(e,r,n){let o=e.handler;if("createTask"in o){if(!n.taskStore)throw new Error("No task store provided.");let i={...n,taskStore:n.taskStore};if(e.inputSchema){let a=o;return await Promise.resolve(a.createTask(r,i))}else{let a=o;return await Promise.resolve(a.createTask(i))}}if(e.inputSchema){let i=o;return await Promise.resolve(i(r,n))}else{let i=o;return await Promise.resolve(i(n))}}async handleAutomaticTaskPolling(e,r,n){if(!n.taskStore)throw new Error("No task store provided for task-capable tool.");let o=await this.validateToolInput(e,r.params.arguments,r.params.name),s=e.handler,i={...n,taskStore:n.taskStore},a=o?await Promise.resolve(s.createTask(o,i)):await Promise.resolve(s.createTask(i)),c=a.task.taskId,u=a.task,l=u.pollInterval??5e3;for(;u.status!=="completed"&&u.status!=="failed"&&u.status!=="cancelled";){await new Promise(h=>setTimeout(h,l));let d=await n.taskStore.getTask(c);if(!d)throw new C(O.InternalError,`Task ${c} not found during polling`);u=d}return await n.taskStore.getTaskResult(c)}setCompletionRequestHandler(){this._completionHandlerInitialized||(this.server.assertCanSetRequestHandler(nr(Ts)),this.server.registerCapabilities({completions:{}}),this.server.setRequestHandler(Ts,async e=>{switch(e.params.ref.type){case"ref/prompt":return Tf(e),this.handlePromptCompletion(e,e.params.ref);case"ref/resource":return zf(e),this.handleResourceCompletion(e,e.params.ref);default:throw new C(O.InvalidParams,`Invalid completion reference: ${e.params.ref}`)}}),this._completionHandlerInitialized=!0)}async handlePromptCompletion(e,r){let n=this._registeredPrompts[r.name];if(!n)throw new C(O.InvalidParams,`Prompt ${r.name} not found`);if(!n.enabled)throw new C(O.InvalidParams,`Prompt ${r.name} disabled`);if(!n.argsSchema)return zo;let s=Ht(n.argsSchema)?.[e.params.argument.name];if(!od(s))return zo;let i=Qg(s);if(!i)return zo;let a=await i(e.params.argument.value,e.params.context);return ty(a)}async handleResourceCompletion(e,r){let n=Object.values(this._registeredResourceTemplates).find(i=>i.resourceTemplate.uriTemplate.toString()===r.uri);if(!n){if(this._registeredResources[r.uri])return zo;throw new C(O.InvalidParams,`Resource template ${e.params.ref.uri} not found`)}let o=n.resourceTemplate.completeCallback(e.params.argument.name);if(!o)return zo;let s=await o(e.params.argument.value,e.params.context);return ty(s)}setResourceRequestHandlers(){this._resourceHandlersInitialized||(this.server.assertCanSetRequestHandler(nr(_s)),this.server.assertCanSetRequestHandler(nr(vs)),this.server.assertCanSetRequestHandler(nr(xs)),this.server.registerCapabilities({resources:{listChanged:!0}}),this.server.setRequestHandler(_s,async(e,r)=>{let n=Object.entries(this._registeredResources).filter(([s,i])=>i.enabled).map(([s,i])=>({uri:s,name:i.name,...i.metadata})),o=[];for(let s of Object.values(this._registeredResourceTemplates)){if(!s.resourceTemplate.listCallback)continue;let i=await s.resourceTemplate.listCallback(r);for(let a of i.resources)o.push({...s.metadata,...a})}return{resources:[...n,...o]}}),this.server.setRequestHandler(vs,async()=>({resourceTemplates:Object.entries(this._registeredResourceTemplates).map(([r,n])=>({name:r,uriTemplate:n.resourceTemplate.uriTemplate.toString(),...n.metadata}))})),this.server.setRequestHandler(xs,async(e,r)=>{let n=new URL(e.params.uri),o=this._registeredResources[n.toString()];if(o){if(!o.enabled)throw new C(O.InvalidParams,`Resource ${n} disabled`);return o.readCallback(n,r)}for(let s of Object.values(this._registeredResourceTemplates)){let i=s.resourceTemplate.uriTemplate.match(n.toString());if(i)return s.readCallback(n,i,r)}throw new C(O.InvalidParams,`Resource ${n} not found`)}),this._resourceHandlersInitialized=!0)}setPromptRequestHandlers(){this._promptHandlersInitialized||(this.server.assertCanSetRequestHandler(nr(bs)),this.server.assertCanSetRequestHandler(nr($s)),this.server.registerCapabilities({prompts:{listChanged:!0}}),this.server.setRequestHandler(bs,()=>({prompts:Object.entries(this._registeredPrompts).filter(([,e])=>e.enabled).map(([e,r])=>({name:e,title:r.title,description:r.description,arguments:r.argsSchema?kz(r.argsSchema):void 0}))})),this.server.setRequestHandler($s,async(e,r)=>{let n=this._registeredPrompts[e.params.name];if(!n)throw new C(O.InvalidParams,`Prompt ${e.params.name} not found`);if(!n.enabled)throw new C(O.InvalidParams,`Prompt ${e.params.name} disabled`);if(n.argsSchema){let o=Xr(n.argsSchema),s=await es(o,e.params.arguments);if(!s.success){let c="error"in s?s.error:"Unknown error",u=ts(c);throw new C(O.InvalidParams,`Invalid arguments for prompt ${e.params.name}: ${u}`)}let i=s.data,a=n.callback;return await Promise.resolve(a(i,r))}else{let o=n.callback;return await Promise.resolve(o(r))}}),this._promptHandlersInitialized=!0)}resource(e,r,...n){let o;typeof n[0]=="object"&&(o=n.shift());let s=n[0];if(typeof r=="string"){if(this._registeredResources[r])throw new Error(`Resource ${r} is already registered`);let i=this._createRegisteredResource(e,void 0,r,o,s);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),i}else{if(this._registeredResourceTemplates[e])throw new Error(`Resource template ${e} is already registered`);let i=this._createRegisteredResourceTemplate(e,void 0,r,o,s);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),i}}registerResource(e,r,n,o){if(typeof r=="string"){if(this._registeredResources[r])throw new Error(`Resource ${r} is already registered`);let s=this._createRegisteredResource(e,n.title,r,n,o);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),s}else{if(this._registeredResourceTemplates[e])throw new Error(`Resource template ${e} is already registered`);let s=this._createRegisteredResourceTemplate(e,n.title,r,n,o);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),s}}_createRegisteredResource(e,r,n,o,s){let i={name:e,title:r,metadata:o,readCallback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({uri:null}),update:a=>{typeof a.uri<"u"&&a.uri!==n&&(delete this._registeredResources[n],a.uri&&(this._registeredResources[a.uri]=i)),typeof a.name<"u"&&(i.name=a.name),typeof a.title<"u"&&(i.title=a.title),typeof a.metadata<"u"&&(i.metadata=a.metadata),typeof a.callback<"u"&&(i.readCallback=a.callback),typeof a.enabled<"u"&&(i.enabled=a.enabled),this.sendResourceListChanged()}};return this._registeredResources[n]=i,i}_createRegisteredResourceTemplate(e,r,n,o,s){let i={resourceTemplate:n,title:r,metadata:o,readCallback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({name:null}),update:u=>{typeof u.name<"u"&&u.name!==e&&(delete this._registeredResourceTemplates[e],u.name&&(this._registeredResourceTemplates[u.name]=i)),typeof u.title<"u"&&(i.title=u.title),typeof u.template<"u"&&(i.resourceTemplate=u.template),typeof u.metadata<"u"&&(i.metadata=u.metadata),typeof u.callback<"u"&&(i.readCallback=u.callback),typeof u.enabled<"u"&&(i.enabled=u.enabled),this.sendResourceListChanged()}};this._registeredResourceTemplates[e]=i;let a=n.uriTemplate.variableNames;return Array.isArray(a)&&a.some(u=>!!n.completeCallback(u))&&this.setCompletionRequestHandler(),i}_createRegisteredPrompt(e,r,n,o,s){let i={title:r,description:n,argsSchema:o===void 0?void 0:Tr(o),callback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({name:null}),update:a=>{typeof a.name<"u"&&a.name!==e&&(delete this._registeredPrompts[e],a.name&&(this._registeredPrompts[a.name]=i)),typeof a.title<"u"&&(i.title=a.title),typeof a.description<"u"&&(i.description=a.description),typeof a.argsSchema<"u"&&(i.argsSchema=Tr(a.argsSchema)),typeof a.callback<"u"&&(i.callback=a.callback),typeof a.enabled<"u"&&(i.enabled=a.enabled),this.sendPromptListChanged()}};return this._registeredPrompts[e]=i,o&&Object.values(o).some(c=>{let u=c instanceof Le?c._def?.innerType:c;return od(u)})&&this.setCompletionRequestHandler(),i}_createRegisteredTool(e,r,n,o,s,i,a,c,u){sd(e);let l={title:r,description:n,inputSchema:ey(o),outputSchema:ey(s),annotations:i,execution:a,_meta:c,handler:u,enabled:!0,disable:()=>l.update({enabled:!1}),enable:()=>l.update({enabled:!0}),remove:()=>l.update({name:null}),update:d=>{typeof d.name<"u"&&d.name!==e&&(typeof d.name=="string"&&sd(d.name),delete this._registeredTools[e],d.name&&(this._registeredTools[d.name]=l)),typeof d.title<"u"&&(l.title=d.title),typeof d.description<"u"&&(l.description=d.description),typeof d.paramsSchema<"u"&&(l.inputSchema=Tr(d.paramsSchema)),typeof d.outputSchema<"u"&&(l.outputSchema=Tr(d.outputSchema)),typeof d.callback<"u"&&(l.handler=d.callback),typeof d.annotations<"u"&&(l.annotations=d.annotations),typeof d._meta<"u"&&(l._meta=d._meta),typeof d.enabled<"u"&&(l.enabled=d.enabled),this.sendToolListChanged()}};return this._registeredTools[e]=l,this.setToolRequestHandlers(),this.sendToolListChanged(),l}tool(e,...r){if(this._registeredTools[e])throw new Error(`Tool ${e} is already registered`);let n,o,s,i;if(typeof r[0]=="string"&&(n=r.shift()),r.length>1){let c=r[0];id(c)?(o=r.shift(),r.length>1&&typeof r[0]=="object"&&r[0]!==null&&!id(r[0])&&(i=r.shift())):typeof c=="object"&&c!==null&&(i=r.shift())}let a=r[0];return this._createRegisteredTool(e,void 0,n,o,s,i,{taskSupport:"forbidden"},void 0,a)}registerTool(e,r,n){if(this._registeredTools[e])throw new Error(`Tool ${e} is already registered`);let{title:o,description:s,inputSchema:i,outputSchema:a,annotations:c,_meta:u}=r;return this._createRegisteredTool(e,o,s,i,a,c,{taskSupport:"forbidden"},u,n)}prompt(e,...r){if(this._registeredPrompts[e])throw new Error(`Prompt ${e} is already registered`);let n;typeof r[0]=="string"&&(n=r.shift());let o;r.length>1&&(o=r.shift());let s=r[0],i=this._createRegisteredPrompt(e,void 0,n,o,s);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),i}registerPrompt(e,r,n){if(this._registeredPrompts[e])throw new Error(`Prompt ${e} is already registered`);let{title:o,description:s,argsSchema:i}=r,a=this._createRegisteredPrompt(e,o,s,i,n);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),a}isConnected(){return this.server.transport!==void 0}async sendLoggingMessage(e,r){return this.server.sendLoggingMessage(e,r)}sendResourceListChanged(){this.isConnected()&&this.server.sendResourceListChanged()}sendToolListChanged(){this.isConnected()&&this.server.sendToolListChanged()}sendPromptListChanged(){this.isConnected()&&this.server.sendPromptListChanged()}};var $z={type:"object",properties:{}};function ry(t){return t!==null&&typeof t=="object"&&"parse"in t&&typeof t.parse=="function"&&"safeParse"in t&&typeof t.safeParse=="function"}function wz(t){return"_def"in t||"_zod"in t||ry(t)}function id(t){return typeof t!="object"||t===null||wz(t)?!1:Object.keys(t).length===0?!0:Object.values(t).some(ry)}function ey(t){if(t)return id(t)?Tr(t):t}function kz(t){let e=Ht(t);return e?Object.entries(e).map(([r,n])=>{let o=qp(n),s=Lp(n);return{name:r,description:o,required:!s}}):[]}function nr(t){let r=Ht(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=rs(r);if(typeof n=="string")return n;throw new Error("Schema method literal must be a string")}function ty(t){return{completion:{values:t.slice(0,100),total:t.length,hasMore:t.length>100}}}var zo={completion:{values:[],hasMore:!1}};var ad=Io(require("node:process"),1);var vi=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;let e=this._buffer.indexOf(`
`);if(e===-1)return null;let r=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),Sz(r)}clear(){this._buffer=void 0}};function Sz(t){return _f.parse(JSON.parse(t))}function ny(t){return JSON.stringify(t)+`
`}var xi=class{constructor(e=ad.default.stdin,r=ad.default.stdout){this._stdin=e,this._stdout=r,this._readBuffer=new vi,this._started=!1,this._ondata=n=>{this._readBuffer.append(n),this.processReadBuffer()},this._onerror=n=>{this.onerror?.(n)}}async start(){if(this._started)throw new Error("StdioServerTransport already started! If using Server class, note that connect() calls start() automatically.");this._started=!0,this._stdin.on("data",this._ondata),this._stdin.on("error",this._onerror)}processReadBuffer(){for(;;)try{let e=this._readBuffer.readMessage();if(e===null)break;this.onmessage?.(e)}catch(e){this.onerror?.(e)}}async close(){this._stdin.off("data",this._ondata),this._stdin.off("error",this._onerror),this._stdin.listenerCount("data")===0&&this._stdin.pause(),this._readBuffer.clear(),this.onclose?.()}send(e){return new Promise(r=>{let n=ny(e);this._stdout.write(n)?r():this._stdout.once("drain",r)})}};var Po=Io(require("node:crypto"),1);var sy="0123456789ABCDEFGHJKMNPQRSTVWXYZ",bi=32;var Tz=16,iy=10,oy=0xffffffffffff;var Zr;(function(t){t.Base32IncorrectEncoding="B32_ENC_INVALID",t.DecodeTimeInvalidCharacter="DEC_TIME_CHAR",t.DecodeTimeValueMalformed="DEC_TIME_MALFORMED",t.EncodeTimeNegative="ENC_TIME_NEG",t.EncodeTimeSizeExceeded="ENC_TIME_SIZE_EXCEED",t.EncodeTimeValueMalformed="ENC_TIME_MALFORMED",t.PRNGDetectFailure="PRNG_DETECT",t.ULIDInvalid="ULID_INVALID",t.Unexpected="UNEXPECTED",t.UUIDInvalid="UUID_INVALID"})(Zr||(Zr={}));var Mr=class extends Error{constructor(e,r){super(`${r} (${e})`),this.name="ULIDError",this.code=e}};function zz(t){let e=Math.floor(t()*bi)%bi;return sy.charAt(e)}function Pz(t){let e=Ez(),r=e&&(e.crypto||e.msCrypto)||(typeof Po.default<"u"?Po.default:null);if(typeof r?.getRandomValues=="function")return()=>{let n=new Uint8Array(1);return r.getRandomValues(n),n[0]/256};if(typeof r?.randomBytes=="function")return()=>r.randomBytes(1).readUInt8()/256;if(Po.default?.randomBytes)return()=>Po.default.randomBytes(1).readUInt8()/256;throw new Mr(Zr.PRNGDetectFailure,"Failed to find a reliable PRNG")}function Ez(){return Rz()?self:typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:null}function Iz(t,e){let r="";for(;t>0;t--)r=zz(e)+r;return r}function Cz(t,e=iy){if(isNaN(t))throw new Mr(Zr.EncodeTimeValueMalformed,`Time must be a number: ${t}`);if(t>oy)throw new Mr(Zr.EncodeTimeSizeExceeded,`Cannot encode a time larger than ${oy}: ${t}`);if(t<0)throw new Mr(Zr.EncodeTimeNegative,`Time must be positive: ${t}`);if(Number.isInteger(t)===!1)throw new Mr(Zr.EncodeTimeValueMalformed,`Time must be an integer: ${t}`);let r,n="";for(let o=e;o>0;o--)r=t%bi,n=sy.charAt(r)+n,t=(t-r)/bi;return n}function Rz(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}function ay(t,e){let r=e||Pz(),n=!t||isNaN(t)?Date.now():t;return Cz(n,iy)+Iz(Tz,r)}var $i=class{baseUrl;apiKey;teamId;projectId;brainETag=null;brainCache=null;brainParamsKey=null;constructor(e){if(this.apiKey=e?.apiKey??process.env.CONTOX_API_KEY??"",this.baseUrl=(e?.apiUrl??process.env.CONTOX_API_URL??"https://contox.dev").replace(/\/$/,""),this.teamId=e?.teamId??process.env.CONTOX_TEAM_ID??"",this.projectId=e?.projectId??process.env.CONTOX_PROJECT_ID??"",!this.apiKey)throw new Error("CONTOX_API_KEY is required. Set it as an environment variable.");if(!this.teamId)throw new Error("CONTOX_TEAM_ID is required. Set it as an environment variable.");if(!this.projectId)throw new Error("CONTOX_PROJECT_ID is required. Set it as an environment variable.")}async request(e,r={}){let n=`${this.baseUrl}/api${e}`,o=await fetch(n,{...r,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...r.headers}});if(!o.ok){let s=await o.json().catch(()=>({})),i=typeof s.error=="string"?s.error:o.statusText;throw new Error(`API error (${String(o.status)}): ${i}`)}return o.json()}async listContexts(e){let r=new URLSearchParams({teamId:this.teamId,projectId:this.projectId});return e?.schemaKey&&r.set("schemaKey",e.schemaKey),e?.tier!==void 0&&r.set("tier",String(e.tier)),e?.state&&r.set("state",e.state),e?.contextType&&r.set("contextType",e.contextType),e?.parentContextId&&r.set("parentContextId",e.parentContextId),this.request(`/contexts?${r.toString()}`)}async getContext(e){return this.request(`/contexts/${encodeURIComponent(e)}`)}async createContext(e){return this.request("/contexts",{method:"POST",body:JSON.stringify(e)})}async updateContext(e,r){return this.request(`/contexts/${encodeURIComponent(e)}`,{method:"PATCH",body:JSON.stringify(r)})}async deleteContext(e){await this.request(`/contexts/${encodeURIComponent(e)}`,{method:"DELETE"})}async findBySchemaKey(e){return(await this.listContexts({schemaKey:e}))[0]??null}async findContextByName(e){return(await this.listContexts()).find(n=>n.name===e)??null}async searchContexts(e){let r=await this.listContexts(),n=e.toLowerCase();return r.filter(o=>o.name.toLowerCase().includes(n)||(o.description?.toLowerCase().includes(n)??!1))}async searchContent(e){return this.request(`/contexts/search?q=${encodeURIComponent(e)}&projectId=${encodeURIComponent(this.projectId)}`)}async getBrain(e,r){let n=new URLSearchParams({teamId:this.teamId,projectId:this.projectId});if(r&&n.set("includeDrafts","true"),e){let u=Object.entries(e).map(([l,d])=>`${l}:${String(d)}`).join(",");n.set("entriesLimit",u)}let o=n.toString();o!==this.brainParamsKey&&(this.brainETag=null,this.brainCache=null,this.brainParamsKey=o);let s={};this.brainETag&&(s["If-None-Match"]=this.brainETag);let i=`${this.baseUrl}/api/contexts/brain?${o}`,a=await fetch(i,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...s}});if(a.status===304&&this.brainCache)return this.brainCache;if(!a.ok){let u=await a.json().catch(()=>({})),l=typeof u.error=="string"?u.error:a.statusText;throw new Error(`API error (${String(a.status)}): ${l}`)}let c=await a.json();return this.brainETag=a.headers.get("etag"),this.brainCache=c,c}async createEntry(e){return this.request("/context-entries",{method:"POST",body:JSON.stringify(e)})}async listEntries(e,r){let n=new URLSearchParams({contextId:e});return r?.limit&&n.set("limit",String(r.limit)),r?.cursorAfter&&n.set("cursorAfter",r.cursorAfter),r?.entryType&&n.set("entryType",r.entryType),this.request(`/context-entries?${n.toString()}`)}async optimisticUpdate(e,r,n,o){for(let i=0;i<3;i++){let a=await this.getContext(e),c=a.content??"",u=r(c);try{return await this.updateContext(e,{content:u,version:a.version,source:n,sourceRef:o})}catch(l){if((l instanceof Error?l.message:String(l)).includes("409")&&i<2)continue;throw l}}throw new Error("OCC: max retries exceeded")}async populate(e,r,n){return this.request("/contexts/populate",{method:"POST",body:JSON.stringify({teamId:this.teamId,projectId:this.projectId,nodes:e,dryRun:r,source:n})})}async approveContext(e){await this.request(`/contexts/${encodeURIComponent(e)}/approve?action=approve`,{method:"POST"})}async deprecateContext(e){await this.request(`/contexts/${encodeURIComponent(e)}/approve?action=deprecate`,{method:"POST"})}async getTree(){return this.request(`/contexts/tree?teamId=${encodeURIComponent(this.teamId)}&projectId=${encodeURIComponent(this.projectId)}`)}async createLink(e,r,n,o,s){await this.request("/context-links",{method:"POST",body:JSON.stringify({teamId:this.teamId,projectId:this.projectId,fromSchemaKey:e,toSchemaKey:r,linkType:n,reason:o,confidence:s,source:"mcp"})})}async getLinks(e,r){let n=new URLSearchParams({teamId:this.teamId,projectId:this.projectId,schemaKey:e});return r&&n.set("direction",r),this.request(`/context-links?${n.toString()}`)}async compactContext(e){return this.request(`/contexts/${encodeURIComponent(e)}/compact`,{method:"POST"})}static generateUlid(){return ay()}};var At=[{id:"architecture",name:"Architecture",description:"Tech stack, architecture decisions, design patterns, project structure, infrastructure",order:0},{id:"conventions",name:"Conventions & Rules",description:"Coding conventions, style rules, linter gotchas, naming patterns, team agreements",order:1},{id:"implementation",name:"Implementation Log",description:"Features built, components created, APIs implemented, integrations added",order:2},{id:"decisions",name:"Technical Decisions",description:"Key decisions with rationale: why X over Y, trade-offs considered, constraints",order:3},{id:"bugs",name:"Bugs & Fixes",description:"Bugs found and how they were fixed, edge cases discovered, workarounds applied",order:4},{id:"todo",name:"Todo & Next Steps",description:"Pending tasks, known issues, planned improvements, tech debt to address",order:5},{id:"sessions",name:"Session Log",description:"Chronological log of all AI sessions with date and summary",order:6}],Dr="Project Memory",cy="Root context for AI project memory \u2014 contains all sub-contexts";function vn(t){return`[Memory] ${t.name}`}function wi(t){return At.find(e=>e.id===t)}async function uy(t){try{return await jz(t)}catch{return Oz(t)}}async function jz(t){let e=await t.getBrain({bugs:10,sessions:3});return{document:e.document,tokenEstimate:e.tokenEstimate,subContextCount:e.loadedContexts,rootId:e.tree[0]?.id??null}}async function Oz(t){let e=await t.listContexts();if(e.length===0)return{document:`# Project Memory

_No context saved yet. This is the first session._
`,tokenEstimate:15,subContextCount:0,rootId:null};let r=e.find(l=>l.name===Dr),n=r?.id??null,o=[];if(o.push(`# Project Memory
`),r){let l=await cd(t,r);if(l){let d=l.match(/\*\*Latest session\*\*: (.+)/);d&&o.push(`> Last session: ${d[1]}
`)}}let s=0;for(let l of At){let d=vn(l),h=e.find(p=>p.name===d);if(!h)continue;let f=await cd(t,h);!f||f.trim().length===0||(s++,o.push(`## ${l.name}
`),o.push(f.trim()),o.push(""))}let i=new Set([Dr,...At.map(l=>vn(l))]),a=e.filter(l=>!i.has(l.name));if(a.length>0){o.push(`## Custom Contexts
`);for(let l of a){let d=await cd(t,l);d&&d.trim().length>0&&(s++,o.push(`### ${l.name}`),l.description&&o.push(`> ${l.description}
`),o.push(d.trim()),o.push(""))}}let c=o.join(`
`),u=Math.ceil(c.length/4);return{document:c,tokenEstimate:u,subContextCount:s,rootId:n}}async function cd(t,e){if(e.content!=null&&e.content.length>0)return e.content;try{return(await t.getContext(e.id)).content??""}catch{return""}}var ki=require("node:crypto");var ly={architecture:"root/stack",conventions:"root/conventions",implementation:"root/journal",decisions:"root/decisions",bugs:"root/bugs",todo:"root/todo",sessions:"root/sessions"},dy=new Map,ud={schemaKey:"root",name:"Project Memory",contextType:"system",tier:1,order:0,description:"Root context \u2014 project overview and metadata",storageModel:"content",writePolicy:"mcp",children:[{schemaKey:"root/cortex",name:"Cortex",contextType:"system",tier:1,order:1,description:"Auto-generated project summary \u2014 current focus, recent sessions",storageModel:"content",writePolicy:"mcp"},{schemaKey:"root/stack",name:"Stack & Infrastructure",contextType:"reference",tier:1,order:2,description:"Tech stack, architecture decisions, design patterns, project structure",storageModel:"content",writePolicy:"both",children:[{schemaKey:"root/stack/database",name:"Database Schema",contextType:"reference",tier:2,order:0,description:"Database schema, collections, indexes, relationships",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/stack/environment",name:"Environment & Config",contextType:"reference",tier:2,order:1,description:"Environment variables, configuration files, deployment settings",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/stack/deployment",name:"Deployment & CI/CD",contextType:"reference",tier:2,order:2,description:"Deployment setup, CI/CD pipelines, hosting infrastructure",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/api",name:"API Surface",contextType:"reference",tier:1,order:3,description:"API endpoints, request/response schemas, authentication",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/backend/auth",linkType:"see-also"},{toSchemaKey:"root/stack/database",linkType:"depends-on"}],children:[{schemaKey:"root/api/auth",name:"Auth & User Endpoints",contextType:"reference",tier:2,order:0,description:"Authentication, registration, password reset, session management",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/api/core",name:"Core Resource Endpoints",contextType:"reference",tier:2,order:1,description:"CRUD endpoints for core business entities",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/api/integrations",name:"Integration Endpoints",contextType:"reference",tier:2,order:2,description:"Third-party integration endpoints (Slack, VS Code, etc.)",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/frontend",name:"Frontend Architecture",contextType:"reference",tier:1,order:4,description:"Frontend components, pages, hooks, design system",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/frontend/design",linkType:"depends-on"},{toSchemaKey:"root/api",linkType:"see-also"}],children:[{schemaKey:"root/frontend/ui",name:"UI Component Library",contextType:"reference",tier:2,order:0,description:"Reusable UI components, their props and usage patterns",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/frontend/pages",name:"Page Components & Routes",contextType:"reference",tier:2,order:1,description:"Page-level components and routing structure",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/frontend/hooks",name:"Hooks & State Management",contextType:"reference",tier:2,order:2,description:"Custom hooks, state management patterns, data fetching",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/frontend/design",name:"Design System Tokens",contextType:"reference",tier:2,order:3,description:"Colors, typography, spacing, design tokens and variables",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/backend",name:"Backend Architecture",contextType:"reference",tier:1,order:5,description:"Backend modules, business logic, external integrations",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/stack/database",linkType:"depends-on"},{toSchemaKey:"root/api",linkType:"see-also"}],children:[{schemaKey:"root/backend/auth",name:"Auth & Security",contextType:"reference",tier:2,order:0,description:"Authentication middleware, RBAC, security patterns",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/backend/logic",name:"Business Logic Modules",contextType:"reference",tier:2,order:1,description:"Core business logic, validation, data processing",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/backend/integrations",name:"External Integrations",contextType:"reference",tier:2,order:2,description:"Third-party service integrations (Stripe, Appwrite, etc.)",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/packages",name:"Packages & Extensions",contextType:"reference",tier:1,order:6,description:"MCP server, CLI, Claude plugin, VS Code extension",storageModel:"content",writePolicy:"scanner",children:[{schemaKey:"root/packages/mcp",name:"MCP Server Package",contextType:"reference",tier:2,order:0,description:"MCP server implementation, tools, API client",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/packages/cli",name:"CLI Package",contextType:"reference",tier:2,order:1,description:"CLI commands, options, configuration",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/packages/plugin",name:"Claude Plugin Package",contextType:"reference",tier:2,order:2,description:"Claude Code plugin configuration and marketplace metadata",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/packages/vscode",name:"VS Code Extension",contextType:"reference",tier:2,order:3,description:"VS Code extension functionality and configuration",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/conventions",name:"Conventions & Patterns",contextType:"memory",tier:1,order:7,description:"Coding conventions, style rules, naming patterns, team agreements",storageModel:"entries",writePolicy:"both"},{schemaKey:"root/decisions",name:"Architecture Decisions",contextType:"memory",tier:1,order:8,description:"Key decisions with rationale: why X over Y, trade-offs, constraints",storageModel:"entries",writePolicy:"both"},{schemaKey:"root/todo",name:"Active Todo & Roadmap",contextType:"memory",tier:1,order:9,description:"Pending tasks, known issues, planned improvements, tech debt",storageModel:"entries",writePolicy:"both"},{schemaKey:"root/bugs",name:"Bug Registry",contextType:"memory",tier:1,order:10,description:"Bugs found and how they were fixed, edge cases, workarounds",storageModel:"entries",writePolicy:"mcp"},{schemaKey:"root/journal",name:"Implementation Journal",contextType:"memory",tier:2,order:11,description:"Features built, components created, APIs implemented",storageModel:"entries",writePolicy:"mcp"},{schemaKey:"root/sessions",name:"Session Chronicle",contextType:"system",tier:2,order:12,description:"Chronological log of all AI sessions with date and summary",storageModel:"entries",writePolicy:"mcp"},{schemaKey:"root/contracts",name:"API Contracts",contextType:"reference",tier:1,order:13,description:"Contract documents per domain \u2014 identity, IO, invariants, failure modes, SLOs",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/api",linkType:"depends-on"}],children:[{schemaKey:"root/contracts/auth",name:"Auth Contract",contextType:"reference",tier:2,order:0,description:"Cookie/bearer auth, derivation, RBAC contract",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/backend/auth",linkType:"see-also"}]},{schemaKey:"root/contracts/brain-endpoint",name:"Brain Endpoint Contract",contextType:"reference",tier:2,order:1,description:"GET /brain contract \u2014 ETag, tier assembly, token budget",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/entries",name:"Entries Contract",contextType:"reference",tier:2,order:2,description:"Context entries CRUD \u2014 ULID ordering, idempotency, cursor pagination",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/populate",name:"Populate Contract",contextType:"reference",tier:2,order:3,description:"Batch upsert contract \u2014 diffStats, dryRun, contentHash dedup",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/search",name:"Search Contract",contextType:"reference",tier:2,order:4,description:"Unified search contract \u2014 proof objects, relevance, link boost",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/links",name:"Links Contract",contextType:"reference",tier:2,order:5,description:"Context links CRUD \u2014 bidirectional queries, confidence scoring",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/compaction",name:"Compaction Contract",contextType:"reference",tier:2,order:6,description:"Entries compaction contract \u2014 rolling summary, no deletion",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/runbooks",name:"Runbooks",contextType:"reference",tier:1,order:14,description:"Operational runbooks for incident response and diagnostics",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/ops",linkType:"see-also"}],children:[{schemaKey:"root/runbooks/brain-5xx",name:"Runbook: Brain 5xx",contextType:"reference",tier:2,order:0,description:"Brain endpoint returns 500 \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/populate-stuck",name:"Runbook: Populate Stuck",contextType:"reference",tier:2,order:1,description:"Populate run stuck or failing \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/search-low-recall",name:"Runbook: Search Low Recall",contextType:"reference",tier:2,order:2,description:"Search returns poor results \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/drafts-never-approved",name:"Runbook: Drafts Never Approved",contextType:"reference",tier:2,order:3,description:"Draft contexts accumulate without approval \u2014 diagnosis",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/audit-mismatch",name:"Runbook: Audit Mismatch",contextType:"reference",tier:2,order:4,description:"Mutation audit log inconsistent \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/appwrite-throttling",name:"Runbook: Appwrite Throttling",contextType:"reference",tier:2,order:5,description:"Appwrite rate limits hit \u2014 diagnosis and mitigation",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/ops",name:"Operations & SLOs",contextType:"reference",tier:1,order:15,description:"SLOs per CUJ, error budget policy, golden signals, observability",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/contracts",linkType:"depends-on"}]},{schemaKey:"root/security",name:"Security & Threat Model",contextType:"reference",tier:1,order:16,description:"STRIDE threat model, ASVS checklist, auth surface, mitigations",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/backend/auth",linkType:"see-also"}]},{schemaKey:"root/governance",name:"Data Governance",contextType:"reference",tier:1,order:17,description:"Lifecycle rules, immutable fields, integrity jobs, state machine",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/quality",name:"Quality Gates",contextType:"reference",tier:1,order:18,description:"Test suites, contract tests, retrieval eval, populate gates",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/performance",name:"Performance & Cost",contextType:"reference",tier:1,order:19,description:"Token budgets, degradation strategy, cheap retrieval, cost tracking",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/patterns",name:"Patterns Cookbook",contextType:"reference",tier:1,order:20,description:"Canonical code patterns with snippets \u2014 OCC, idempotency, ETag, pagination",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/conventions",linkType:"see-also"}]},{schemaKey:"root/flows",name:"Data Flows",contextType:"reference",tier:1,order:21,description:"Mermaid sequence diagrams for critical paths \u2014 auth, save, populate, search",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/api",linkType:"see-also"}]},{schemaKey:"root/schema",name:"DB Schema Docs",contextType:"reference",tier:1,order:22,description:"Appwrite collections, attributes, types, indexes with justifications",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/stack/database",linkType:"see-also"}]},{schemaKey:"root/adrs",name:"Architecture Decision Records",contextType:"memory",tier:1,order:23,description:"Formal ADRs \u2014 context, options, decision, tradeoffs, consequences",storageModel:"content",writePolicy:"both",links:[{toSchemaKey:"root/decisions",linkType:"see-also"}]}]};function py(t){if(dy.set(t.schemaKey,t),t.children)for(let e of t.children)py(e)}py(ud);function fy(t){return dy.get(t)?.storageModel==="entries"}var my=48e3;async function gy(t,e){try{return await Nz(t,e)}catch{return Az(t,e)}}async function Nz(t,e){let r=0,n=0,o=[],s=await t.findBySchemaKey("root");s||(s=await t.createContext({name:"Project Memory",teamId:t.teamId,projectId:t.projectId,schemaKey:"root",contextType:"system",tier:1,state:"approved"}),r++);let i=yy(e.summary,0,e.changes);await t.updateContext(s.id,{content:i,source:"session-analyzer"});let a=new Map;for(let h of e.changes){let f=a.get(h.category)??[];f.push(h),a.set(h.category,f)}let c=(0,ki.createHash)("sha256").update(`${e.summary}:${new Date().toISOString()}`).digest("hex").slice(0,12);for(let[h,f]of a){let p=ly[h];if(!p)continue;let m=await t.findBySchemaKey(p);if(!m){let g=wi(h);m=await t.createContext({name:g?.name??h,teamId:t.teamId,projectId:t.projectId,description:g?.description,parentContextId:s.id,schemaKey:p,contextType:"memory",tier:p.split("/").length<=2?1:2,state:"approved"}),r++}if(fy(p)){for(let g of f){let v=(0,ki.createHash)("sha256").update(`${m.id}:${c}:${g.title}`).digest("hex");await t.createEntry({contextId:m.id,title:g.title,content:g.content,entryType:h,source:"session-analyzer",sourceRef:c,idempotencyKey:v})}n++,o.push(p)}else{let g=`### ${new Date().toISOString().split("T")[0]} \u2014 ${e.summary.slice(0,80)}
`,v=f.map(b=>`**${b.title}**

${b.content.trim()}`).join(`

---

`),x=`${g}
${v}
`;await t.optimisticUpdate(m.id,b=>ld(b,x),"session-analyzer",c),n++,o.push(p)}}let u=await t.findBySchemaKey("root/sessions");u||(u=await t.createContext({name:"Session Chronicle",teamId:t.teamId,projectId:t.projectId,description:"Chronological log of all AI sessions",parentContextId:s.id,schemaKey:"root/sessions",contextType:"system",tier:2,state:"approved"}),r++);let l=e.changes.map(h=>h.category).join(", "),d=(0,ki.createHash)("sha256").update(`${u.id}:${c}:session-log`).digest("hex");return await t.createEntry({contextId:u.id,title:e.summary.slice(0,200),content:`**Summary**: ${e.summary}
**Categories**: ${l}
**Affected**: ${o.join(", ")}`,entryType:"session",source:"session-analyzer",sourceRef:c,idempotencyKey:d}),o.includes("root/sessions")||o.push("root/sessions"),await Zz(t,e.summary,s.id,u.id),o.includes("root/cortex")||o.push("root/cortex"),{created:r,updated:n,affected:o,rootId:s.id}}async function Az(t,e){let r=await t.listContexts(),n=new Map;for(let k of r)n.set(k.name,k);let o=n.get(Dr),s=0,i=0,a=[];o||(o=await t.createContext({name:Dr,teamId:t.teamId,projectId:t.projectId,description:cy}),s++,a.push(Dr));let c=r.filter(k=>k.parentContextId===o.id).length,u=yy(e.summary,c,e.changes);await t.updateContext(o.id,{content:u});let l=`### ${new Date().toISOString().split("T")[0]} \u2014 ${e.summary.slice(0,80)}
`,d=new Map;for(let k of e.changes){let T=wi(k.category);if(!T)continue;let A=d.get(T.id)??[];A.push(k),d.set(T.id,A)}for(let[k,T]of d){let A=wi(k),de=vn(A),Oe=n.get(de);Oe||(Oe=await t.createContext({name:de,teamId:t.teamId,projectId:t.projectId,description:A.description,parentContextId:o.id}),n.set(de,Oe),s++);let te=await hy(t,Oe),it=T.map(wn=>`**${wn.title}**

${wn.content.trim()}`).join(`

---

`),$n=`${l}
${it}
`,Eo=ld(te,$n);await t.updateContext(Oe.id,{content:Eo,order:A.order}),i++,a.push(de)}let h=At.find(k=>k.id==="sessions"),f=vn(h),p=n.get(f);p||(p=await t.createContext({name:f,teamId:t.teamId,projectId:t.projectId,description:h.description,parentContextId:o.id}),s++);let m=await hy(t,p),g=new Date().toISOString(),v=e.changes.map(k=>k.category).join(", "),x=`- **${g}**: ${e.summary} _(${v})_
`,b=ld(m,x);return await t.updateContext(p.id,{content:b,order:h.order}),a.includes(f)||(i++,a.push(f)),{created:s,updated:i,affected:a,rootId:o.id}}async function Zz(t,e,r,n){try{let o=await t.findBySchemaKey("root/cortex");o||(o=await t.createContext({name:"Cortex",teamId:t.teamId,projectId:t.projectId,description:"Auto-generated project summary \u2014 current focus, recent sessions",parentContextId:r,schemaKey:"root/cortex",contextType:"system",tier:1,state:"approved"}));let i=(await t.listEntries(n,{limit:3})).entries.map(c=>`- **${c.createdAt.split("T")[0]??c.createdAt}**: ${c.title}`),a=[`# Cortex \u2014 Project Focus
`,`> Last updated: ${new Date().toISOString()}
`,`## Current Focus
`,e,"",`## Recent Sessions
`,...i.length>0?i:["_No sessions recorded yet._"],""].join(`
`);await t.optimisticUpdate(o.id,()=>a,"session-analyzer")}catch{}}function yy(t,e,r){let n=[];n.push(`# Project Memory
`),n.push(`> Last session: ${new Date().toISOString()}
`),n.push(`**Sub-contexts**: ${String(e+1)}
`),n.push(`**Latest session**: ${t}
`),n.push(`## Categories
`);for(let o of At){let i=r.some(a=>a.category===o.id)?"(updated)":"";n.push(`- **${o.name}** \u2014 ${o.description} ${i}`)}return n.push(""),n.join(`
`)}async function hy(t,e){if(e.content!==null)return e.content;try{return(await t.getContext(e.id)).content??""}catch{return""}}function ld(t,e){if(!t)return e;let r=`${t}
${e}`;if(r.length<=my)return r;let n=r.length-my,o=r.slice(n),s=o.indexOf(`
`);return s>0?`[...older entries trimmed...]
${o.slice(s+1)}`:o}async function _y(t,e={}){let r=e.since??new Date(Date.now()-864e5).toISOString(),n=[];n.push("# On-Call View"),n.push(""),n.push(`> Since: ${r}`),n.push("");try{let o=await t.findBySchemaKey("root/sessions");if(o){let s=await t.listEntries(o.id,{limit:5});if(n.push("## Recent Sessions"),n.push(""),s.entries.length===0)n.push("No recent sessions.");else for(let i of s.entries)n.push(`- **${i.title}** (${i.createdAt})`),i.tags&&i.tags.length>0&&n.push(`  Tags: ${i.tags.join(", ")}`);n.push("")}}catch{n.push("## Recent Sessions"),n.push(""),n.push("_Unable to fetch sessions._"),n.push("")}try{let o=await t.listContexts({state:"draft"}),s=new Date(Date.now()-10080*60*1e3).toISOString(),i=o.filter(a=>(a.createdAt??"")<s);if(n.push("## Stale Drafts (>7 days)"),n.push(""),i.length===0)n.push("No stale drafts.");else{n.push(`Found ${i.length} stale draft(s):`),n.push("");for(let a of i.slice(0,10))n.push(`- **${a.name}** (schemaKey: ${a.schemaKey??"none"}, created: ${a.createdAt??"unknown"})`);i.length>10&&n.push(`- ... and ${i.length-10} more`)}n.push("")}catch{n.push("## Stale Drafts"),n.push(""),n.push("_Unable to fetch drafts._"),n.push("")}try{let o=await t.findBySchemaKey("root/bugs");if(o){let s=await t.listEntries(o.id,{limit:5});if(n.push("## Recent Bugs"),n.push(""),s.entries.length===0)n.push("No recent bugs recorded.");else for(let i of s.entries)n.push(`- **${i.title}** (${i.createdAt})`);n.push("")}}catch{n.push("## Recent Bugs"),n.push(""),n.push("_Unable to fetch bugs._"),n.push("")}try{let s=(await t.getTree()).total,i=await t.listContexts(),a=i.filter(l=>l.state==="approved").length,c=i.filter(l=>l.state==="draft").length,u=i.filter(l=>l.state==="deprecated").length;n.push("## Brain Health"),n.push(""),n.push("| Metric | Value |"),n.push("|--------|-------|"),n.push(`| Total contexts | ${s} |`),n.push(`| Approved | ${a} |`),n.push(`| Draft | ${c} |`),n.push(`| Deprecated | ${u} |`),n.push("")}catch{n.push("## Brain Health"),n.push(""),n.push("_Unable to fetch brain stats._"),n.push("")}return n.join(`
`)}function vy(t,e){if(t.schemaKey===e)return t;if(t.children)for(let r of t.children){let n=vy(r,e);if(n)return n}return null}async function xy(t,e){let r=[];r.push(`# Explain: ${e}`),r.push("");let n=vy(ud,e);if(n){if(r.push("## Schema Metadata"),r.push(""),r.push("| Property | Value |"),r.push("|----------|-------|"),r.push(`| SchemaKey | \`${n.schemaKey}\` |`),r.push(`| Name | ${n.name} |`),n.tier!==void 0&&r.push(`| Tier | ${n.tier} |`),n.contextType&&r.push(`| Context Type | ${n.contextType} |`),n.writePolicy&&r.push(`| Write Policy | ${n.writePolicy} |`),n.storageModel&&r.push(`| Storage Model | ${n.storageModel} |`),n.description&&r.push(`| Description | ${n.description} |`),n.children&&r.push(`| Children | ${n.children.length} |`),r.push(""),n.links&&n.links.length>0){r.push("### Links (Schema-Declared)"),r.push("");for(let o of n.links)r.push(`- **${o.linkType}** \u2192 \`${o.toSchemaKey}\``);r.push("")}}else r.push("> SchemaKey not found in brain-schema.ts"),r.push("");try{let o=await t.findBySchemaKey(e);if(o){if(r.push("## Context"),r.push(""),r.push("| Property | Value |"),r.push("|----------|-------|"),r.push(`| ID | ${o.id} |`),r.push(`| State | ${o.state??"unknown"} |`),r.push(`| Version | ${o.version??0} |`),o.contentHash&&r.push(`| Content Hash | ${o.contentHash.slice(0,12)}... |`),o.lastEntryAt&&r.push(`| Last Entry | ${o.lastEntryAt} |`),r.push(""),o.content){let s=o.content.length>500?o.content.slice(0,500)+"...":o.content;r.push("### Content Preview"),r.push(""),r.push(s),r.push("")}try{let s=await t.getLinks(e);if(s.outgoing.length>0||s.incoming.length>0){if(r.push("## Links (Runtime)"),r.push(""),s.outgoing.length>0){r.push("**Outgoing:**");for(let i of s.outgoing)r.push(`- ${i.linkType} \u2192 \`${i.toSchemaKey}\``);r.push("")}if(s.incoming.length>0){r.push("**Incoming:**");for(let i of s.incoming)r.push(`- ${i.linkType} \u2190 \`${i.fromSchemaKey}\``);r.push("")}}}catch{}try{let s=await t.listEntries(o.id,{limit:5});if(s.entries.length>0){r.push("## Recent Entries"),r.push("");for(let i of s.entries){r.push(`### ${i.title}`),r.push(`> ${i.entryType??"entry"} | ${i.createdAt}`);let a=i.content.length>200?i.content.slice(0,200)+"...":i.content;r.push(a),r.push("")}}}catch{}}else r.push("## Context"),r.push(""),r.push("_No context found for this schemaKey in the current project._"),r.push("")}catch(o){r.push("## Context"),r.push(""),r.push(`_Error fetching context: ${String(o)}_`),r.push("")}if(e.startsWith("root/contracts/")){r.push("## Related Contract"),r.push("");let o=e.replace("root/contracts/","");r.push(`This is a contract domain. See generated contract: \`generated/contracts/${o}.md\``),r.push("")}else{let o=e.replace("root/","").split("/")[0];if(o)try{await t.findBySchemaKey(`root/contracts/${o}`)&&(r.push("## Related Contract"),r.push(""),r.push(`See: \`root/contracts/${o}\``),r.push(""))}catch{}}return r.join(`
`)}var Mt=require("node:fs"),De=require("node:path"),Mz=new Set(["node_modules",".next",".git","dist","out","build",".cache",".turbo","coverage",".nyc_output",".storybook","storybook-static","__pycache__",".venv","vendor",".svn",".hg","test-results","playwright-report",".playwright"]),Dz=new Set(["package-lock.json","pnpm-lock.yaml","yarn.lock","bun.lockb",".DS_Store","Thumbs.db","nul"]),qz=new Set([".png",".jpg",".jpeg",".gif",".svg",".ico",".webp",".avif",".woff",".woff2",".ttf",".eot",".otf",".mp3",".mp4",".wav",".ogg",".webm",".zip",".tar",".gz",".br",".7z",".rar",".pdf",".doc",".docx",".xls",".xlsx",".exe",".dll",".so",".dylib",".wasm",".map"]),Lz=32*1024,Uz=[{pattern:/^README\.md$/i,reason:"Project documentation"},{pattern:/^ARCHITECTURE\.md$/i,reason:"Architecture documentation"},{pattern:/^CLAUDE\.md$/i,reason:"AI assistant instructions"},{pattern:/^AGENTS\.md$/i,reason:"AI agent instructions"},{pattern:/^RULES\.md$/i,reason:"Project rules"},{pattern:/^CONTRIBUTING\.md$/i,reason:"Contribution guidelines"},{pattern:/^\.cursorrules$/i,reason:"AI assistant rules"},{pattern:/^\.clinerules$/i,reason:"AI assistant rules"},{pattern:/^Dockerfile$/i,reason:"Container configuration"},{pattern:/^docker-compose\.ya?ml$/i,reason:"Container orchestration"},{pattern:/^\.env\.example$/i,reason:"Environment template"},{pattern:/^schema\.prisma$/i,reason:"Database schema"},{pattern:/^drizzle\.config\.\w+$/i,reason:"Database configuration"}];function Fz(t){return Mz.has(t)||t.startsWith(".")}function Vz(t){if(Dz.has(t))return!0;let e=(0,De.extname)(t).toLowerCase();return!!qz.has(e)}function Kz(t){for(let{pattern:e,reason:r}of Uz)if(e.test(t))return{match:!0,reason:r};return{match:!1,reason:""}}function Hz(t){let e=(0,De.extname)(t).toLowerCase();return{".ts":"TypeScript",".tsx":"TypeScript (JSX)",".js":"JavaScript",".jsx":"JavaScript (JSX)",".py":"Python",".rb":"Ruby",".go":"Go",".rs":"Rust",".java":"Java",".kt":"Kotlin",".swift":"Swift",".cs":"C#",".cpp":"C++",".c":"C",".php":"PHP",".vue":"Vue",".svelte":"Svelte",".astro":"Astro",".css":"CSS",".scss":"SCSS",".less":"LESS",".html":"HTML",".md":"Markdown",".json":"JSON",".yaml":"YAML",".yml":"YAML",".toml":"TOML",".xml":"XML",".sql":"SQL",".graphql":"GraphQL",".gql":"GraphQL",".sh":"Shell",".bash":"Shell",".zsh":"Shell",".dockerfile":"Dockerfile"}[e]??null}function Bz(t,e,r){let n=[],o=[],s=[],i=/export\s+(?:const|function)\s+(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)\b/g,a;for(;(a=i.exec(t))!==null;)n.push(a[1]);let c=/export\s+const\s+(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)\s*=\s*(\w+)\(/g;for(;(a=c.exec(t))!==null;)n.includes(a[1])||n.push(a[1]),s.push(a[2]);let u=/(?:const|let)\s+(\w+Schema)\s*=\s*z\.\w+\(\{([^}]*(?:\{[^}]*\}[^}]*)*)\}\)/g;for(;(a=u.exec(t))!==null;){let d=a[1],f=a[2].replace(/\s+/g," ").trim();o.push(`${d}: { ${f.length>200?f.slice(0,200)+"...":f} }`)}let l=[...new Set(s)];return{path:e,methods:n,filePath:r,schemas:o,middleware:l}}function Jz(t,e){let r=(0,De.basename)(e).replace(/\.(tsx|jsx)$/,""),n=null,o=null,s=t.match(/export\s+default\s+function\s+(\w+)/),i=t.match(/export\s+function\s+(\w+)/);s?r=s[1]:i&&(r=i[1]);let a=[/(?:export\s+)?interface\s+(\w*Props\w*)\s*\{([^}]*(?:\{[^}]*\}[^}]*)*)\}/,/(?:export\s+)?type\s+(\w*Props\w*)\s*=\s*\{([^}]*(?:\{[^}]*\}[^}]*)*)\}/];for(let u of a){let l=t.match(u);if(l){let h=l[2].trim().split(`
`).map(f=>f.trim()).filter(f=>f&&!f.startsWith("//")&&!f.startsWith("/*"));h.length>0&&(n=h.slice(0,15).join(`
`),h.length>15&&(n+=`
// ... ${String(h.length-15)} more props`));break}}let c=t.match(/\/\*\*\s*\n([^*]*(?:\*[^/][^*]*)*)\*\/\s*\n\s*(?:export\s+)?(?:default\s+)?function/);return c&&(o=c[1].replace(/^\s*\*\s?/gm,"").trim().split(`
`)[0]??null),{name:r,filePath:e,props:n,description:o}}function Si(t,e){let r=[],n=null,o=t.match(/^\/\*\*\s*\n([^*]*(?:\*[^/][^*]*)*)\*\/\s*\n/);o&&(n=o[1].replace(/^\s*\*\s?/gm,"").trim().split(`
`)[0]??null);let s=/export\s+(async\s+)?function\s+(\w+)\s*(<[^>]*>)?\s*\(([^)]*)\)\s*:\s*([^\n{]+)/g,i;for(;(i=s.exec(t))!==null;){let h=i[1]?"async ":"",f=i[2],p=i[3]??"",m=i[4].replace(/\s+/g," ").trim(),g=i[5].trim().replace(/\s*\{$/,"");r.push({name:f,signature:`${h}function ${f}${p}(${m}): ${g}`,kind:"function"})}let a=/export\s+const\s+(\w+)\s*(?::\s*[^=]+)?\s*=\s*(async\s+)?\(([^)]*)\)\s*(?::\s*([^\n=>]+))?\s*=>/g;for(;(i=a.exec(t))!==null;){let h=i[1],f=i[2]?"async ":"",p=i[3].replace(/\s+/g," ").trim(),m=i[4]?.trim()??"unknown";r.some(g=>g.name===h)||r.push({name:h,signature:`${f}const ${h} = (${p}): ${m}`,kind:"function"})}let c=/export\s+const\s+(\w+)\s*(?::\s*([^=\n]+))?\s*=/g;for(;(i=c.exec(t))!==null;){let h=i[1],f=i[2]?.trim();r.some(p=>p.name===h)||r.push({name:h,signature:f?`const ${h}: ${f}`:`const ${h}`,kind:"const"})}let u=/export\s+interface\s+(\w+)\s*(?:<[^>]*>)?\s*\{([^}]*(?:\{[^}]*\}[^}]*)*)\}/g;for(;(i=u.exec(t))!==null;){let h=i[1],p=i[2].trim().split(`
`).map(g=>g.trim()).filter(g=>g&&!g.startsWith("//")),m=p.slice(0,8).join("; ");r.push({name:h,signature:`interface ${h} { ${m}${p.length>8?"; ...":""} }`,kind:"interface"})}let l=/export\s+type\s+(\w+)\s*(?:<[^>]*>)?\s*=\s*([^\n;]+)/g;for(;(i=l.exec(t))!==null;){let h=i[1],f=i[2].trim();r.push({name:h,signature:`type ${h} = ${f.length>100?f.slice(0,100)+"...":f}`,kind:"type"})}let d=/export\s+(?:abstract\s+)?class\s+(\w+)(?:\s+extends\s+(\w+))?(?:\s+implements\s+(\w+))?/g;for(;(i=d.exec(t))!==null;){let h=i[1],f=i[2]?` extends ${i[2]}`:"",p=i[3]?` implements ${i[3]}`:"";r.push({name:h,signature:`class ${h}${f}${p}`,kind:"class"})}return{filePath:e,exports:r,description:n}}function $y(t){let e=[],r=[],n=[],o=[],s=[],i=[],a=[],c=[],u={},l=0,d=0;function h(g,v){if(v>8)return;let x;try{x=(0,Mt.readdirSync)(g)}catch{return}let b=x.sort((k,T)=>{let A=dd((0,De.join)(g,k)),de=dd((0,De.join)(g,T));return A&&!de?-1:!A&&de?1:k.localeCompare(T)});for(let k of b){let T=(0,De.join)(g,k),A=(0,De.relative)(t,T).replace(/\\/g,"/");if(dd(T)){if(Fz(k))continue;d++,e.push(A+"/"),h(T,v+1)}else{if(Vz(k))continue;l++,e.push(A);let de=Hz(k);if(de&&(u[de]=(u[de]??0)+1),A.startsWith("src/app/")&&(k==="page.tsx"||k==="route.ts")){let te=A.replace("src/app","").replace("/page.tsx","").replace("/route.ts","").replace(/\/\[([^\]]+)\]/g,"/:$1");if(k==="route.ts"){let it=Zt(T);it&&!it.startsWith("[File too large")?r.push(Bz(it,te||"/",A)):r.push({path:te||"/",methods:[],filePath:A,schemas:[],middleware:[]})}else r.push({path:te||"/",methods:["PAGE"],filePath:A,schemas:[],middleware:[]})}if(A.match(/src\/components\/.*\.(tsx|jsx)$/)&&!A.includes(".test.")&&!A.includes(".stories.")){let te=Zt(T);te&&!te.startsWith("[File too large")?n.push(Jz(te,A)):n.push({name:(0,De.basename)(A).replace(/\.(tsx|jsx)$/,""),filePath:A,props:null,description:null})}if(A.match(/src\/hooks\/.*\.(ts|js)$/)&&!A.includes(".test.")){let te=Zt(T);te&&!te.startsWith("[File too large")&&s.push(Si(te,A))}if(A.match(/src\/stores\/.*\.(ts|js)$/)&&!A.includes(".test.")){let te=Zt(T);te&&!te.startsWith("[File too large")&&i.push(Si(te,A))}if(A==="src/middleware.ts"||A==="middleware.ts"){let te=Zt(T);te&&!te.startsWith("[File too large")&&a.push(Si(te,A))}if(A.match(/src\/lib\/.*\.(ts|js)$/)&&!A.includes(".test.")){let te=Zt(T);te&&!te.startsWith("[File too large")?o.push(Si(te,A)):o.push({filePath:A,exports:[],description:null})}let Oe=Kz(k);if(Oe.match){let te=Zt(T);te&&c.push({path:A,content:te,reason:Oe.reason})}}}}h(t,0);let f=by((0,De.join)(t,"package.json")),p=by((0,De.join)(t,"tsconfig.json")),m=Zt((0,De.join)(t,".env.example"));return{root:t,tree:e,packageJson:f,tsConfig:p,envExample:m,routes:r,components:n,libs:o,hooks:s,stores:i,middlewares:a,keyFiles:c,stats:{totalFiles:l,totalDirs:d,languages:u}}}function dd(t){try{return(0,Mt.statSync)(t).isDirectory()}catch{return!1}}function Zt(t){try{if(!(0,Mt.existsSync)(t))return null;let e=(0,Mt.statSync)(t);return e.size>Lz?`[File too large: ${Math.round(e.size/1024)}KB]`:(0,Mt.readFileSync)(t,"utf-8")}catch{return null}}function by(t){let e=Zt(t);if(!e||e.startsWith("[File too large"))return null;try{return JSON.parse(e)}catch{return null}}var bn=require("node:path");function pd(t){return Math.ceil(t.length/4)}function Sy(t){let e=t.packageJson?String(t.packageJson.name??(0,bn.basename)(t.root)):(0,bn.basename)(t.root),r=[],n=new Date().toISOString(),o=Xz(t),s=t.routes.filter(a=>!a.methods.includes("PAGE")),i=t.routes.filter(a=>a.methods.includes("PAGE"));{let a=[];a.push(`# ${e} \u2014 Project Overview
`),a.push(`> Scanned: ${n}
`),t.packageJson?.description&&a.push(`**Description**: ${String(t.packageJson.description)}
`),o.length>0&&a.push(`**Stack**: ${o.join(", ")}
`),a.push(`**Stats**: ${String(t.stats.totalFiles)} files, ${String(t.stats.totalDirs)} directories`),a.push(`**Routes**: ${String(s.length)} API endpoints, ${String(i.length)} pages`),a.push(`**Components**: ${String(t.components.length)} React components`),a.push(`**Libraries**: ${String(t.libs.length)} modules in src/lib/`),t.hooks.length>0&&a.push(`**Hooks**: ${String(t.hooks.length)} custom hooks`),t.stores.length>0&&a.push(`**Stores**: ${String(t.stores.length)} state stores`),a.push("");let c=Object.entries(t.stats.languages).sort(([,u],[,l])=>l-u).slice(0,8);c.length>0&&a.push("**Languages**: "+c.map(([u,l])=>`${u} (${String(l)})`).join(", ")+`
`),a.push(`## Project Structure
`),a.push("```"),a.push(Yz(t.tree)),a.push("```\n"),a.push(`## Architecture Notes
`),t.routes.some(u=>u.middleware.includes("withRateLimit"))&&a.push("- API routes use `withRateLimit` middleware for rate limiting"),t.routes.some(u=>u.schemas.length>0)&&a.push("- Request validation via Zod schemas"),t.middlewares.length>0&&a.push("- Next.js middleware active at `src/middleware.ts`"),t.stores.length>0&&a.push(`- Client state management: ${String(t.stores.length)} Zustand stores`),t.hooks.length>0&&a.push(`- ${String(t.hooks.length)} custom React hooks in src/hooks/`),a.push(""),r.push({name:"[Scan] Overview",description:`Project overview: ${o.slice(0,3).join(", ")}, ${String(t.stats.totalFiles)} files`,content:a.join(`
`),order:0,schemaKey:"root/scan",tier:1,contextType:"reference"})}if(i.length>0){let a=[];a.push(`## Pages
`),a.push("| Route | File |"),a.push("|-------|------|");for(let c of i.sort((u,l)=>u.path.localeCompare(l.path)))a.push(`| \`${c.path}\` | ${c.filePath} |`);a.push(""),r.push({name:"[Scan] Pages & Routes",description:`${String(i.length)} Next.js page routes`,content:a.join(`
`),order:1,schemaKey:"root/frontend/pages",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"})}if(s.length>0){let a=s.filter(f=>/^\/api\/(auth|user|team|orgs)/.test(f.path)),c=s.filter(f=>/^\/api\/(contexts|projects|context-entries|context-links)/.test(f.path)),u=s.filter(f=>/^\/api\/(billing|integrations|webhooks|keys|ai)/.test(f.path)),l=new Set([...a,...c,...u]),d=s.filter(f=>!l.has(f)),h=d.length>0?Ti("API: System & Admin",d):`## API Overview

${String(s.length)} API endpoints across ${String(a.length>0?1:0)+String(c.length>0?1:0)+String(u.length>0?1:0)} domains.`;r.push({name:"[Scan] API: System",description:`${String(s.length)} total API endpoints (${String(d.length)} system)`,content:h,order:2,schemaKey:"root/api",tier:2,contextType:"reference"}),a.length>0&&r.push({name:"[Scan] API: Auth & User",description:`${String(a.length)} endpoints: auth, user, team, orgs`,content:Ti("API: Auth & User Management",a),order:3,schemaKey:"root/api/auth",parentSchemaKey:"root/api",tier:2,contextType:"reference"}),c.length>0&&r.push({name:"[Scan] API: Core CRUD",description:`${String(c.length)} endpoints: contexts, projects, entries, links`,content:Ti("API: Core CRUD",c),order:4,schemaKey:"root/api/core",parentSchemaKey:"root/api",tier:2,contextType:"reference"}),u.length>0&&r.push({name:"[Scan] API: Integrations",description:`${String(u.length)} endpoints: billing, integrations, webhooks, keys, AI`,content:Ti("API: Integrations",u),order:5,schemaKey:"root/api/integrations",parentSchemaKey:"root/api",tier:2,contextType:"reference"})}if(t.components.length>0){let a=t.components.filter(h=>h.filePath.includes("/contox/")),c=t.components.filter(h=>h.filePath.includes("/ui/")),u=t.components.filter(h=>h.filePath.includes("/pages/")||h.filePath.includes("/landing/")||h.filePath.includes("/providers/")||h.filePath.includes("/skeletons/")||h.filePath.includes("/icons/")),l=new Set([...a,...c,...u]),d=t.components.filter(h=>!l.has(h));if(a.length>0&&r.push({name:"[Scan] Components: Domain",description:`${String(a.length)} domain components (brain, editor, entries, etc.)`,content:zi(a),order:6,schemaKey:"root/frontend",tier:2,contextType:"reference"}),c.length>0&&r.push({name:"[Scan] Components: UI Library",description:`${String(c.length)} UI primitives (buttons, cards, dialogs, etc.)`,content:zi(c),order:7,schemaKey:"root/frontend/ui",parentSchemaKey:"root/frontend",tier:3,contextType:"reference"}),u.length>0){let h=[...u,...d];r.push({name:"[Scan] Components: Pages & Layout",description:`${String(h.length)} page, landing, provider, and layout components`,content:zi(h),order:8,schemaKey:"root/frontend/layout",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"})}else d.length>0&&r.push({name:"[Scan] Components: Other",description:`${String(d.length)} uncategorized components`,content:zi(d),order:8,schemaKey:"root/frontend/layout",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"})}if(t.hooks.length>0&&r.push({name:"[Scan] Hooks",description:`${String(t.hooks.length)} custom React hooks`,content:xn("Custom Hooks (src/hooks/)",t.hooks),order:9,schemaKey:"root/frontend/hooks",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"}),t.stores.length>0&&r.push({name:"[Scan] State Stores",description:`${String(t.stores.length)} Zustand stores`,content:xn("State Stores (src/stores/)",t.stores),order:10,schemaKey:"root/frontend/stores",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"}),t.libs.length>0||t.middlewares.length>0){let a=t.libs.filter(m=>m.filePath.includes("/middleware/")),c=t.libs.filter(m=>/\/(stripe|email|openrouter|rate-limiter|quotas|webhook-dispatcher|activity-logger)/.test(m.filePath)),u=t.libs.filter(m=>m.filePath.includes("/validations/")),l=new Set([...a,...c,...u]),d=t.libs.filter(m=>!l.has(m)),h=t.libs.length+t.middlewares.length,f=[...t.libs,...t.middlewares].reduce((m,g)=>m+g.exports.length,0),p=[];if(p.push(`## Backend Overview
`),p.push(`**${String(h)} modules** \u2014 ${String(f)} exported functions/types
`),p.push("| Category | Count | Key Modules |"),p.push("|----------|-------|-------------|"),d.length>0){let m=d.slice(0,5).map(g=>`\`${(0,bn.basename)(g.filePath).replace(/\.(ts|js)$/,"")}\``).join(", ");p.push(`| Core | ${String(d.length)} | ${m} |`)}if(c.length>0){let m=c.map(g=>`\`${(0,bn.basename)(g.filePath).replace(/\.(ts|js)$/,"")}\``).join(", ");p.push(`| Services | ${String(c.length)} | ${m} |`)}if(u.length>0&&p.push(`| Validations | ${String(u.length)} | Zod schemas for API input |`),a.length>0||t.middlewares.length>0){let m=a.length+t.middlewares.length;p.push(`| Middleware | ${String(m)} | auth-derive, brain-invariants |`)}if(p.push(""),r.push({name:"[Scan] Backend Overview",description:`${String(h)} backend modules, ${String(f)} exports`,content:p.join(`
`),order:11,schemaKey:"root/backend",tier:2,contextType:"reference"}),d.length>0&&r.push({name:"[Scan] Libs: Core",description:`${String(d.length)} core libraries (appwrite, auth, utils, etc.)`,content:xn("Core Libraries",d),order:12,schemaKey:"root/backend/logic",parentSchemaKey:"root/backend",tier:2,contextType:"reference"}),c.length>0&&r.push({name:"[Scan] Libs: Services",description:`${String(c.length)} service integrations (stripe, email, AI, etc.)`,content:xn("Service Integrations",c),order:13,schemaKey:"root/backend/integrations",parentSchemaKey:"root/backend",tier:2,contextType:"reference"}),u.length>0&&r.push({name:"[Scan] Libs: Validations",description:`${String(u.length)} Zod validation schemas`,content:xn("Validation Schemas",u),order:14,schemaKey:"root/backend/validations",parentSchemaKey:"root/backend",tier:2,contextType:"reference"}),a.length>0||t.middlewares.length>0){let m=[...a,...t.middlewares];r.push({name:"[Scan] Auth & Middleware",description:`${String(m.length)} auth/middleware modules`,content:xn("Auth & Middleware",m),order:15,schemaKey:"root/backend/auth",parentSchemaKey:"root/backend",tier:2,contextType:"reference"})}}if(t.packageJson){let a=Gz(t.packageJson);if(a){let c=t.packageJson.dependencies;r.push({name:"[Scan] Dependencies",description:`${String(Object.keys(c??{}).length)} runtime deps, npm scripts`,content:a,order:16,schemaKey:"root/stack",tier:2,contextType:"reference"})}}if((t.tsConfig||t.envExample)&&r.push({name:"[Scan] Configuration",description:"TypeScript config, environment variables",content:Wz(t),order:17,schemaKey:"root/stack/environment",parentSchemaKey:"root/stack",tier:2,contextType:"reference"}),t.keyFiles.some(a=>a.path.startsWith("packages/"))){let a=t.keyFiles.filter(c=>c.path.startsWith("packages/"));r.push({name:"[Scan] Packages",description:`${String(a.length)} monorepo packages (CLI, MCP, plugins)`,content:wy(a),order:18,schemaKey:"root/packages",tier:2,contextType:"reference"})}{let a=t.keyFiles.filter(c=>!c.path.startsWith("packages/"));a.length>0&&r.push({name:"[Scan] Documentation",description:`Key docs: ${a.map(c=>c.path).join(", ")}`,content:wy(a),order:19,schemaKey:"root/scan/docs",parentSchemaKey:"root/scan",tier:3,contextType:"reference"})}return r}function Ti(t,e){let r=[];r.push(`## ${t}
`);for(let n of e.sort((o,s)=>o.path.localeCompare(s.path))){let o=n.methods.length>0?n.methods.join(", "):"UNKNOWN";if(r.push(`### \`${o}\` ${n.path}`),r.push(`> File: \`${n.filePath}\``),n.middleware.length>0&&r.push(`> Middleware: ${n.middleware.map(s=>`\`${s}\``).join(", ")}`),n.schemas.length>0){r.push(`
**Request schemas:**`),r.push("```typescript");for(let s of n.schemas)r.push(s);r.push("```")}r.push("")}return r.join(`
`)}function zi(t){let e=[];e.push(`## Components
`);let r=Qz(t.map(o=>o.filePath)),n=new Map(t.map(o=>[o.filePath,o]));for(let[o,s]of r){e.push(`### ${o}
`);for(let i of s){let a=n.get(i);if(!a)continue;let c=a.description?` \u2014 ${a.description}`:"";e.push(`#### \`${a.name}\`${c}`),e.push(`> File: \`${a.filePath}\``),a.props&&(e.push(`
**Props:**`),e.push("```typescript"),e.push(a.props),e.push("```")),e.push("")}}return e.join(`
`)}function xn(t,e){let r=[];r.push(`## ${t}
`);for(let n of e.sort((o,s)=>o.filePath.localeCompare(s.filePath))){let o=(0,bn.basename)(n.filePath).replace(/\.(ts|js)$/,""),s=n.description?` \u2014 ${n.description}`:"";if(r.push(`### \`${o}\`${s}`),r.push(`> File: \`${n.filePath}\``),n.exports.length>0){r.push(""),r.push("```typescript");for(let i of n.exports)r.push(`export ${i.signature}`);r.push("```")}else r.push(`
*No public exports detected*`);r.push("")}return r.join(`
`)}function Gz(t){let e=[],r=t.dependencies,n=t.devDependencies;if(r&&Object.keys(r).length>0){e.push(`## Runtime Dependencies
`);let s=ky(r);for(let[i,a]of s)e.push(`**${i}**: ${a.map(([c,u])=>`${c} ${u}`).join(", ")}`);e.push("")}if(n&&Object.keys(n).length>0){e.push(`## Dev Dependencies
`);let s=ky(n);for(let[i,a]of s)e.push(`**${i}**: ${a.map(([c,u])=>`${c} ${u}`).join(", ")}`);e.push("")}let o=t.scripts;if(o&&Object.keys(o).length>0){e.push(`## NPM Scripts
`),e.push("```");for(let[s,i]of Object.entries(o))e.push(`${s}: ${i}`);e.push("```")}return e.length>0?e.join(`
`):null}function Wz(t){let e=[];if(t.tsConfig){let r=t.tsConfig.compilerOptions;r&&(e.push(`## TypeScript Configuration
`),e.push("```json"),e.push(JSON.stringify({compilerOptions:r},null,2)),e.push("```\n"))}return t.envExample&&(e.push(`## Environment Variables
`),e.push("```env"),e.push(t.envExample.trim()),e.push("```")),e.join(`
`)}function wy(t){let e=[];e.push(`## Key Documentation
`);for(let r of t){e.push(`### ${r.path}`),e.push(`> ${r.reason}
`);let n=r.path.split(".").pop()??"",o=n==="md"?"markdown":n;e.push(`\`\`\`${o}`);let s=8e3;r.content.length>s?(e.push(r.content.slice(0,s)),e.push(`
... [truncated, ${String(Math.round(r.content.length/1024))}KB total]`)):e.push(r.content),e.push("```\n")}return e.join(`
`)}function Xz(t){let e=[];if(!t.packageJson)return e;let r={...t.packageJson.dependencies??{},...t.packageJson.devDependencies??{}};return r.next?e.push(`Next.js ${r.next}`):r.nuxt?e.push(`Nuxt ${r.nuxt}`):r["@angular/core"]?e.push(`Angular ${r["@angular/core"]}`):r.svelte?e.push(`Svelte ${r.svelte}`):r.astro?e.push(`Astro ${r.astro}`):r.react?e.push(`React ${r.react}`):r.vue&&e.push(`Vue ${r.vue}`),r.typescript&&e.push("TypeScript"),r.tailwindcss?e.push("Tailwind CSS"):r["styled-components"]&&e.push("styled-components"),r.prisma||r["@prisma/client"]?e.push("Prisma"):r["drizzle-orm"]?e.push("Drizzle"):r.mongoose?e.push("MongoDB"):r.pg&&e.push("PostgreSQL"),r.appwrite||r["node-appwrite"]?e.push("Appwrite"):r.firebase||r["firebase-admin"]?e.push("Firebase"):r["@supabase/supabase-js"]&&e.push("Supabase"),r["next-auth"]?e.push("NextAuth"):r["@clerk/nextjs"]&&e.push("Clerk"),r.zustand?e.push("Zustand"):r["@reduxjs/toolkit"]?e.push("Redux"):r.jotai&&e.push("Jotai"),r.vitest?e.push("Vitest"):r.jest&&e.push("Jest"),r.stripe&&e.push("Stripe"),r.resend&&e.push("Resend"),r["@sentry/nextjs"]&&e.push("Sentry"),e}function Yz(t){let e=[],r=new Map;r.set("",{dirs:[],fileCount:0});for(let s of t){let i=s.endsWith("/"),a=s.replace(/\/$/,"").split("/");if(i&&a.length<=3){let c=a.slice(0,-1).join("/"),u=a[a.length-1]??"";r.has(c)||r.set(c,{dirs:[],fileCount:0}),r.get(c).dirs.push(u),r.has(s.replace(/\/$/,""))||r.set(s.replace(/\/$/,""),{dirs:[],fileCount:0})}else if(!i){let u=a.slice(0,-1).join("/");for(;u&&!r.has(u);)u=u.split("/").slice(0,-1).join("/");r.has(u)&&r.get(u).fileCount++}}function n(s,i){let a=r.get(s);if(a)for(let c of a.dirs.sort()){let u=s?`${s}/${c}`:c,l=r.get(u),d="  ".repeat(i),h=l?.fileCount?` (${String(l.fileCount)} files)`:"";e.push(`${d}${c}/${h}`),n(u,i+1)}}let o=r.get("");return o?.fileCount&&e.push(`(${String(o.fileCount)} root files)`),n("",0),e.join(`
`)}function Qz(t){let e=new Map;for(let r of t){let o=r.split("/").slice(0,3).join("/");e.has(o)||e.set(o,[]),e.get(o).push(r)}return[...e.entries()].sort(([r],[n])=>r.localeCompare(n))}function ky(t){let e=new Map;for(let[n,o]of Object.entries(t)){let s="Other";n.match(/^(next|react|react-dom|vue|nuxt|svelte|astro|@angular)/)?s="Framework":n.match(/^(@dnd-kit|framer-motion|@radix|@headlessui|lucide|@heroicons)/)?s="UI":n.match(/^(tailwindcss|postcss|autoprefixer|sass|styled-)/)?s="Styling":n.match(/^(prisma|drizzle|mongoose|pg|@prisma|typeorm)/)?s="Database":n.match(/^(appwrite|node-appwrite|firebase|@supabase)/)?s="Backend/BaaS":n.match(/^(next-auth|@clerk|passport|bcrypt|jsonwebtoken)/)?s="Auth":n.match(/^(zustand|@reduxjs|jotai|recoil|mobx)/)?s="State":n.match(/^(vitest|jest|@testing|playwright|cypress|@playwright)/)?s="Testing":n.match(/^(typescript|@types\/|eslint|prettier|@eslint)/)?s="Tooling":n.match(/^(stripe|@stripe)/)?s="Payments":n.match(/^(resend|nodemailer|@sendgrid)/)?s="Email":n.match(/^(@sentry|sentry)/)?s="Monitoring":n.match(/^(zod|yup|joi|class-validator)/)?s="Validation":n.match(/^(next-intl|i18next|react-intl)/)?s="i18n":n.match(/^(@storybook|storybook|chromatic)/)&&(s="Storybook"),e.has(s)||e.set(s,[]),e.get(s).push([n,o])}let r=["Framework","Backend/BaaS","Auth","Database","State","UI","Styling","Validation","Payments","Email","i18n","Monitoring","Testing","Storybook","Tooling","Other"];return[...e.entries()].sort(([n],[o])=>{let s=r.indexOf(n),i=r.indexOf(o);return(s===-1?99:s)-(i===-1?99:i)})}var be=new _i({name:"contox",version:"3.2.0"}),_e=new $i;be.tool("contox_get_memory","Load the complete project memory. Call this at the START of every session to remember previous work. Returns a markdown document with: Architecture, Conventions, Implementation Log, Decisions, Bugs & Fixes, Todo, and Session Log.",{},async()=>{try{let t=await uy(_e);return{content:[{type:"text",text:`${t.document}
---
_${String(t.subContextCount)} sub-contexts loaded (~${String(t.tokenEstimate)} tokens)_
`}]}}catch(t){return{content:[{type:"text",text:`Error loading memory: ${String(t)}`}],isError:!0}}});var eP=At.filter(t=>t.id!=="sessions").map(t=>`"${t.id}": ${t.description}`).join(`
`);be.tool("contox_save_session",`Save this session's work into persistent project memory. Call this at the END of every session.

Provide a summary and structured changes. Each change has a category, title, and content.

Available categories:
${eP}

The session log is updated automatically. Content is APPENDED to existing sub-contexts (never overwritten).`,{summary:N.string().describe("Brief session summary (1-3 sentences): what was accomplished"),changes:N.array(N.object({category:N.enum(["architecture","conventions","implementation","decisions","bugs","todo"]).describe("Category for this change"),title:N.string().describe('Brief title (e.g. "Added auth middleware", "Fixed CSS z-index bug")'),content:N.string().describe("Detailed content to save. Use markdown. Be specific and include file paths, patterns, key decisions.")})).describe("List of changes to save, organized by category")},async t=>{try{let e=await gy(_e,{summary:t.summary,changes:t.changes});return{content:[{type:"text",text:["Session saved successfully.",`- Created: ${String(e.created)} new sub-contexts`,`- Updated: ${String(e.updated)} existing sub-contexts`,`- Affected: ${e.affected.join(", ")}`].join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error saving session: ${String(e)}`}],isError:!0}}});be.tool("contox_list_contexts","List all contexts for the current project (including sub-contexts)",{},async()=>{try{let e=(await _e.listContexts()).map(r=>({id:r.id,name:r.name,description:r.description,parentContextId:r.parentContextId,schemaKey:r.schemaKey,tier:r.tier,state:r.state,tokens:r.tokens,updatedAt:r.updatedAt}));return{content:[{type:"text",text:JSON.stringify(e,null,2)}]}}catch(t){return{content:[{type:"text",text:`Error: ${String(t)}`}],isError:!0}}});be.tool("contox_get_context","Get a specific context by ID, including its full content",{id:N.string().describe("The context ID")},async t=>{try{let e=await _e.getContext(t.id);return{content:[{type:"text",text:JSON.stringify(e,null,2)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});be.tool("contox_create_context","Create a new context manually. For session-based memory, prefer contox_save_session.",{name:N.string().describe("Context name"),description:N.string().optional().describe("Optional description"),content:N.string().optional().describe("Optional initial content"),parentContextId:N.string().optional().describe("Optional parent context ID for hierarchy")},async t=>{try{let e=await _e.createContext({name:t.name,teamId:_e.teamId,projectId:_e.projectId,description:t.description,parentContextId:t.parentContextId});return t.content&&await _e.updateContext(e.id,{content:t.content}),{content:[{type:"text",text:`Context created: ${e.name} (${e.id})`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});be.tool("contox_update_context","Update an existing context (name, description, or content). Content is replaced, not appended. For incremental updates, prefer contox_save_session.",{id:N.string().describe("The context ID to update"),name:N.string().optional().describe("New name"),description:N.string().optional().describe("New description"),content:N.string().optional().describe("New content (replaces existing)")},async t=>{try{let e={};t.name!==void 0&&(e.name=t.name),t.description!==void 0&&(e.description=t.description),t.content!==void 0&&(e.content=t.content);let r=await _e.updateContext(t.id,e);return{content:[{type:"text",text:`Context updated: ${r.name} (${r.id})`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});be.tool("contox_delete_context","Delete a context by ID. This is irreversible.",{id:N.string().describe("The context ID to delete")},async t=>{try{return await _e.deleteContext(t.id),{content:[{type:"text",text:`Context deleted: ${t.id}`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});be.tool("contox_search",`Search contexts by name, description, AND content. Use this to find specific code patterns, function signatures, API endpoints, component props, or any information stored in the project memory. Returns matching snippets with surrounding context.

Examples: "useAuth", "stripe", "password reset", "Button props", "GET /api/contexts"`,{query:N.string().describe("Search query \u2014 searches across all context content, names, and descriptions")},async t=>{try{let e=await _e.searchContent(t.query);if(e.length===0)return{content:[{type:"text",text:`No results found for "${t.query}"`}]};let r=[];r.push(`Found ${String(e.length)} matching context(s) for "${t.query}":
`);for(let n of e){if(r.push(`## ${n.name}`),r.push(`> ID: ${n.id} | Match: ${n.matchType}`),n.description&&r.push(`> ${n.description}`),n.snippets.length>0){r.push("");for(let o of n.snippets)r.push("```"),r.push(o),r.push("```")}r.push("")}return{content:[{type:"text",text:r.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});be.tool("contox_populate","Populate the brain hierarchy with structured contexts. Used by scanners and CLI to batch-create/update contexts by schemaKey. Created contexts default to state 'draft'. Returns audit trail with runId and diff stats.",{nodes:N.array(N.object({schemaKey:N.string().describe('Unique schema key (e.g. "root/api/auth")'),name:N.string().describe("Display name for the context"),content:N.string().optional().describe("Markdown content"),description:N.string().optional().describe("Brief description"),contextType:N.enum(["system","reference","memory"]).optional().describe("Context type"),tier:N.number().optional().describe("Tier (1=always loaded, 2=on-demand, 3=archive)"),parentSchemaKey:N.string().optional().describe("Parent schema key for hierarchy")})).describe("List of nodes to populate"),dryRun:N.boolean().optional().describe("If true, only return diff stats without writing"),source:N.string().optional().describe('Source identifier (e.g. "cli-scan", "mcp-populate")')},async t=>{try{let e=await _e.populate(t.nodes,t.dryRun,t.source);return{content:[{type:"text",text:[`Populate ${t.dryRun?"(dry run) ":""}completed.`,`- Run ID: ${e.runId}`,`- Created: ${String(e.created)}`,`- Updated: ${String(e.updated)}`,`- Unchanged: ${String(e.unchanged)}`,`- Errors: ${String(e.errors)}`].join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});be.tool("contox_add_entry","Add an entry to a journal-like context (bugs, implementation journal, sessions). Entries are INSERT-only (event-sourced) and idempotent via idempotencyKey. Uses client-generated ULID for monotone ordering.",{contextId:N.string().describe("Target context ID"),title:N.string().describe("Entry title (max 200 chars)"),content:N.string().describe("Entry content in markdown"),entryType:N.string().optional().describe('Entry type (e.g. "bug-fix", "feature", "session")'),tags:N.array(N.string()).optional().describe("Tags for categorization"),idempotencyKey:N.string().optional().describe("Idempotency key for retry safety"),source:N.string().optional().describe("Source identifier"),sourceRef:N.string().optional().describe("Source reference (commit SHA, session ID, etc.)")},async t=>{try{let e=await _e.createEntry({contextId:t.contextId,title:t.title,content:t.content,entryType:t.entryType,tags:t.tags,idempotencyKey:t.idempotencyKey,source:t.source,sourceRef:t.sourceRef});return{content:[{type:"text",text:`Entry added: ${e.title} (${e.id})`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});be.tool("contox_get_tree","Get the hierarchical brain tree for the current project. Returns a nested tree of contexts with schemaKey, tier, state, contextType, and children. Useful for understanding the project knowledge structure at a glance.",{},async()=>{try{let t=await _e.getTree();return{content:[{type:"text",text:JSON.stringify(t.tree,null,2)}]}}catch(t){return{content:[{type:"text",text:`Error: ${String(t)}`}],isError:!0}}});be.tool("contox_approve","Approve or deprecate a context (state machine). Approved contexts are included in the brain document. Deprecated contexts are hidden. Only works on contexts with a state (draft \u2192 approved \u2192 deprecated).",{id:N.string().describe("The context ID"),action:N.enum(["approve","deprecate"]).describe('"approve" to make visible in brain, "deprecate" to hide')},async t=>{try{return t.action==="approve"?await _e.approveContext(t.id):await _e.deprecateContext(t.id),{content:[{type:"text",text:`Context ${t.action==="approve"?"approved":"deprecated"}: ${t.id}`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});be.tool("contox_get_links","Get links for a context by its schemaKey. Returns incoming and outgoing links with linkType, reason, and confidence. Links represent relationships between contexts (see-also, depends-on, child-of, related).",{schemaKey:N.string().describe('The schemaKey of the context (e.g. "root/api/auth")'),direction:N.enum(["both","outgoing","incoming"]).optional().describe("Filter direction (default: both)")},async t=>{try{let e=await _e.getLinks(t.schemaKey,t.direction),r=[];if(e.outgoing.length>0){r.push(`## Outgoing (${String(e.outgoing.length)})`);for(let n of e.outgoing)r.push(`- \u2192 ${n.toSchemaKey} [${n.linkType}]${n.reason?` \u2014 ${n.reason}`:""}${n.confidence!==null?` (conf: ${String(n.confidence)})`:""}`)}if(e.incoming.length>0){r.push(`## Incoming (${String(e.incoming.length)})`);for(let n of e.incoming)r.push(`- \u2190 ${n.fromSchemaKey} [${n.linkType}]${n.reason?` \u2014 ${n.reason}`:""}${n.confidence!==null?` (conf: ${String(n.confidence)})`:""}`)}return r.length===0&&r.push(`No links found for "${t.schemaKey}"`),{content:[{type:"text",text:r.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});be.tool("contox_add_link",'Create a directed link between two contexts by their schemaKeys. Links form a knowledge graph \u2014 use them to express relationships like "depends-on", "see-also", "child-of", or "related".',{from:N.string().describe('Source schemaKey (e.g. "root/frontend/hooks")'),to:N.string().describe('Target schemaKey (e.g. "root/api/auth")'),linkType:N.enum(["see-also","depends-on","child-of","related"]).describe("Type of relationship"),reason:N.string().optional().describe("Why this link exists"),confidence:N.number().optional().describe("Confidence score 0-1 (e.g. 0.9 = very confident)")},async t=>{try{return await _e.createLink(t.from,t.to,t.linkType,t.reason,t.confidence),{content:[{type:"text",text:`Link created: ${t.from} \u2192 ${t.to} [${t.linkType}]`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});be.tool("contox_compact","Compact entries for a journal-like context (bugs, journal, sessions). Summarizes all entries into a single content block, reducing token count while preserving key information. Use when a context has too many entries.",{id:N.string().describe("The context ID to compact")},async t=>{try{let e=await _e.compactContext(t.id);return{content:[{type:"text",text:[`Compaction completed for context ${t.id}:`,`- Entries processed: ${String(e.entriesCount)}`,`- Summary length: ${String(e.summaryLength)} chars`,`- ${e.message}`].join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});be.tool("contox_oncall_view","View on-call operational summary for the current project. Shows recent sessions, stale drafts (>7 days), recent bugs, and brain health stats. Use this for a quick project health check.",{since:N.string().optional().describe("ISO date string \u2014 show data since this time (default: last 24h)")},async t=>{try{return{content:[{type:"text",text:await _y(_e,{since:t.since})}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});be.tool("contox_explain_schemakey","Deep-dive into any brain schemaKey. Returns: schema metadata (tier, contextType, writePolicy), context content preview, runtime links (incoming/outgoing), recent entries, and related contracts. Use this to understand any part of the brain.",{schemaKey:N.string().describe('The schemaKey to explain (e.g. "root/contracts/auth", "root/bugs")')},async t=>{try{return{content:[{type:"text",text:await xy(_e,t.schemaKey)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});be.tool("contox_scan",`Scan a local codebase directory and push ~15-20 hierarchical sub-contexts to the project brain. Walks the filesystem to extract routes, components, libraries, hooks, stores, dependencies, and key documentation files. Results are organized into granular sub-contexts mapped to brain schemaKeys and pushed via the populate API with content-hash dedup.

Use this to index a codebase so the AI can understand the project structure without reading source files. The scan respects .gitignore-like exclusions (node_modules, .next, dist, etc.) and reads files up to 32KB.`,{directory:N.string().optional().describe("Absolute path to the project root directory to scan. Defaults to the current working directory."),dryRun:N.boolean().optional().describe("If true, scan and build sub-contexts but do not push to the API. Returns what would be created/updated.")},async t=>{try{let e=t.directory??process.cwd(),r=$y(e),n=r.routes.filter(m=>!m.methods.includes("PAGE")),o=r.routes.filter(m=>m.methods.includes("PAGE")),s=[...r.libs,...r.hooks,...r.stores].reduce((m,g)=>m+g.exports.length,0),i=Sy(r),a=0;for(let m of i)a+=pd(m.content);let c=[`Scan completed for: ${e}`,`- Files: ${String(r.stats.totalFiles)}, Directories: ${String(r.stats.totalDirs)}`,`- API endpoints: ${String(n.length)}, Pages: ${String(o.length)}`,`- Components: ${String(r.components.length)}, Libraries: ${String(r.libs.length)}, Hooks: ${String(r.hooks.length)}, Stores: ${String(r.stores.length)}`,`- Exported functions/types: ${String(s)}`,`- Key documentation files: ${String(r.keyFiles.length)}`,`- Sub-contexts generated: ${String(i.length)} (~${String(a)} tokens)`];if(t.dryRun){c.push(""),c.push("Sub-contexts (dry run \u2014 not pushed):");for(let m of i){let g=pd(m.content);c.push(`  - ${m.name} [${m.schemaKey}] (~${String(g)} tokens)`)}return{content:[{type:"text",text:c.join(`
`)}]}}let u=i.sort((m,g)=>{let v=m.schemaKey.split("/").length,x=g.schemaKey.split("/").length;return v!==x?v-x:m.order-g.order}).map(m=>({schemaKey:m.schemaKey,name:m.name,content:m.content,description:m.description,contextType:m.contextType??"reference",tier:m.tier??2,parentSchemaKey:m.parentSchemaKey})),l=50,d=0,h=0,f=0,p=0;for(let m=0;m<u.length;m+=l){let g=u.slice(m,m+l),v=await _e.populate(g,!1,"mcp-scan");d+=v.created,h+=v.updated,f+=v.unchanged,p+=v.errors}return c.push(""),c.push("Populate results:"),c.push(`- Created: ${String(d)}`),c.push(`- Updated: ${String(h)}`),c.push(`- Unchanged: ${String(f)}`),p>0&&c.push(`- Errors: ${String(p)}`),{content:[{type:"text",text:c.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error scanning codebase: ${String(e)}`}],isError:!0}}});async function tP(){let t=new xi;await be.connect(t)}tP().catch(t=>{console.error("Fatal error:",t),process.exit(1)});
