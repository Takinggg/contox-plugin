#!/usr/bin/env node
"use strict";var qy=Object.create;var Ri=Object.defineProperty;var Ly=Object.getOwnPropertyDescriptor;var Uy=Object.getOwnPropertyNames;var Vy=Object.getPrototypeOf,Fy=Object.prototype.hasOwnProperty;var T=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ci=(t,e)=>{for(var r in e)Ri(t,r,{get:e[r],enumerable:!0})},Ky=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Uy(e))!Fy.call(t,o)&&o!==r&&Ri(t,o,{get:()=>e[o],enumerable:!(n=Ly(e,o))||n.enumerable});return t};var Io=(t,e,r)=>(r=t!=null?qy(Vy(t)):{},Ky(e||!t||!t.__esModule?Ri(r,"default",{value:t,enumerable:!0}):r,t));var Qn=T(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.regexpCode=Q.getEsmExportName=Q.getProperty=Q.safeStringify=Q.stringify=Q.strConcat=Q.addCodeArg=Q.str=Q._=Q.nil=Q._Code=Q.Name=Q.IDENTIFIER=Q._CodeOrName=void 0;var Xn=class{};Q._CodeOrName=Xn;Q.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var Er=class extends Xn{constructor(e){if(super(),!Q.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};Q.Name=Er;var nt=class extends Xn{constructor(e){super(),this._items=typeof e=="string"?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let e=this._items[0];return e===""||e==='""'}get str(){var e;return(e=this._str)!==null&&e!==void 0?e:this._str=this._items.reduce((r,n)=>`${r}${n}`,"")}get names(){var e;return(e=this._names)!==null&&e!==void 0?e:this._names=this._items.reduce((r,n)=>(n instanceof Er&&(r[n.str]=(r[n.str]||0)+1),r),{})}};Q._Code=nt;Q.nil=new nt("");function gm(t,...e){let r=[t[0]],n=0;for(;n<e.length;)gu(r,e[n]),r.push(t[++n]);return new nt(r)}Q._=gm;var hu=new nt("+");function ym(t,...e){let r=[Yn(t[0])],n=0;for(;n<e.length;)r.push(hu),gu(r,e[n]),r.push(hu,Yn(t[++n]));return U$(r),new nt(r)}Q.str=ym;function gu(t,e){e instanceof nt?t.push(...e._items):e instanceof Er?t.push(e):t.push(K$(e))}Q.addCodeArg=gu;function U$(t){let e=1;for(;e<t.length-1;){if(t[e]===hu){let r=V$(t[e-1],t[e+1]);if(r!==void 0){t.splice(e-1,3,r);continue}t[e++]="+"}e++}}function V$(t,e){if(e==='""')return t;if(t==='""')return e;if(typeof t=="string")return e instanceof Er||t[t.length-1]!=='"'?void 0:typeof e!="string"?`${t.slice(0,-1)}${e}"`:e[0]==='"'?t.slice(0,-1)+e.slice(1):void 0;if(typeof e=="string"&&e[0]==='"'&&!(t instanceof Er))return`"${t}${e.slice(1)}`}function F$(t,e){return e.emptyStr()?t:t.emptyStr()?e:ym`${t}${e}`}Q.strConcat=F$;function K$(t){return typeof t=="number"||typeof t=="boolean"||t===null?t:Yn(Array.isArray(t)?t.join(","):t)}function H$(t){return new nt(Yn(t))}Q.stringify=H$;function Yn(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}Q.safeStringify=Yn;function B$(t){return typeof t=="string"&&Q.IDENTIFIER.test(t)?new nt(`.${t}`):gm`[${t}]`}Q.getProperty=B$;function J$(t){if(typeof t=="string"&&Q.IDENTIFIER.test(t))return new nt(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)}Q.getEsmExportName=J$;function G$(t){return new nt(t.toString())}Q.regexpCode=G$});var vu=T(Ke=>{"use strict";Object.defineProperty(Ke,"__esModule",{value:!0});Ke.ValueScope=Ke.ValueScopeName=Ke.Scope=Ke.varKinds=Ke.UsedValueState=void 0;var Fe=Qn(),yu=class extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}},Cs;(function(t){t[t.Started=0]="Started",t[t.Completed=1]="Completed"})(Cs||(Ke.UsedValueState=Cs={}));Ke.varKinds={const:new Fe.Name("const"),let:new Fe.Name("let"),var:new Fe.Name("var")};var js=class{constructor({prefixes:e,parent:r}={}){this._names={},this._prefixes=e,this._parent=r}toName(e){return e instanceof Fe.Name?e:this.name(e)}name(e){return new Fe.Name(this._newName(e))}_newName(e){let r=this._names[e]||this._nameGroup(e);return`${e}${r.index++}`}_nameGroup(e){var r,n;if(!((n=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||n===void 0)&&n.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}};Ke.Scope=js;var Os=class extends Fe.Name{constructor(e,r){super(r),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=(0,Fe._)`.${new Fe.Name(r)}[${n}]`}};Ke.ValueScopeName=Os;var W$=(0,Fe._)`\n`,_u=class extends js{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?W$:Fe.nil}}get(){return this._scope}name(e){return new Os(e,this._newName(e))}value(e,r){var n;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let o=this.toName(e),{prefix:s}=o,i=(n=r.key)!==null&&n!==void 0?n:r.ref,a=this._values[s];if(a){let l=a.get(i);if(l)return l}else a=this._values[s]=new Map;a.set(i,o);let c=this._scope[s]||(this._scope[s]=[]),u=c.length;return c[u]=r.ref,o.setValue(r,{property:s,itemIndex:u}),o}getValue(e,r){let n=this._values[e];if(n)return n.get(r)}scopeRefs(e,r=this._values){return this._reduceValues(r,n=>{if(n.scopePath===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return(0,Fe._)`${e}${n.scopePath}`})}scopeCode(e=this._values,r,n){return this._reduceValues(e,o=>{if(o.value===void 0)throw new Error(`CodeGen: name "${o}" has no value`);return o.value.code},r,n)}_reduceValues(e,r,n={},o){let s=Fe.nil;for(let i in e){let a=e[i];if(!a)continue;let c=n[i]=n[i]||new Map;a.forEach(u=>{if(c.has(u))return;c.set(u,Cs.Started);let l=r(u);if(l){let d=this.opts.es5?Ke.varKinds.var:Ke.varKinds.const;s=(0,Fe._)`${s}${d} ${u} = ${l};${this.opts._n}`}else if(l=o?.(u))s=(0,Fe._)`${s}${l}${this.opts._n}`;else throw new yu(u);c.set(u,Cs.Completed)})}return s}};Ke.ValueScope=_u});var F=T(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.or=K.and=K.not=K.CodeGen=K.operators=K.varKinds=K.ValueScopeName=K.ValueScope=K.Scope=K.Name=K.regexpCode=K.stringify=K.getProperty=K.nil=K.strConcat=K.str=K._=void 0;var X=Qn(),dt=vu(),Wt=Qn();Object.defineProperty(K,"_",{enumerable:!0,get:function(){return Wt._}});Object.defineProperty(K,"str",{enumerable:!0,get:function(){return Wt.str}});Object.defineProperty(K,"strConcat",{enumerable:!0,get:function(){return Wt.strConcat}});Object.defineProperty(K,"nil",{enumerable:!0,get:function(){return Wt.nil}});Object.defineProperty(K,"getProperty",{enumerable:!0,get:function(){return Wt.getProperty}});Object.defineProperty(K,"stringify",{enumerable:!0,get:function(){return Wt.stringify}});Object.defineProperty(K,"regexpCode",{enumerable:!0,get:function(){return Wt.regexpCode}});Object.defineProperty(K,"Name",{enumerable:!0,get:function(){return Wt.Name}});var Ms=vu();Object.defineProperty(K,"Scope",{enumerable:!0,get:function(){return Ms.Scope}});Object.defineProperty(K,"ValueScope",{enumerable:!0,get:function(){return Ms.ValueScope}});Object.defineProperty(K,"ValueScopeName",{enumerable:!0,get:function(){return Ms.ValueScopeName}});Object.defineProperty(K,"varKinds",{enumerable:!0,get:function(){return Ms.varKinds}});K.operators={GT:new X._Code(">"),GTE:new X._Code(">="),LT:new X._Code("<"),LTE:new X._Code("<="),EQ:new X._Code("==="),NEQ:new X._Code("!=="),NOT:new X._Code("!"),OR:new X._Code("||"),AND:new X._Code("&&"),ADD:new X._Code("+")};var Ct=class{optimizeNodes(){return this}optimizeNames(e,r){return this}},xu=class extends Ct{constructor(e,r,n){super(),this.varKind=e,this.name=r,this.rhs=n}render({es5:e,_n:r}){let n=e?dt.varKinds.var:this.varKind,o=this.rhs===void 0?"":` = ${this.rhs}`;return`${n} ${this.name}${o};`+r}optimizeNames(e,r){if(e[this.name.str])return this.rhs&&(this.rhs=on(this.rhs,e,r)),this}get names(){return this.rhs instanceof X._CodeOrName?this.rhs.names:{}}},Ns=class extends Ct{constructor(e,r,n){super(),this.lhs=e,this.rhs=r,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof X.Name&&!e[this.lhs.str]&&!this.sideEffects))return this.rhs=on(this.rhs,e,r),this}get names(){let e=this.lhs instanceof X.Name?{}:{...this.lhs.names};return Zs(e,this.rhs)}},bu=class extends Ns{constructor(e,r,n,o){super(e,n,o),this.op=r}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}},$u=class extends Ct{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}},wu=class extends Ct{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}},ku=class extends Ct{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}},Su=class extends Ct{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,r){return this.code=on(this.code,e,r),this}get names(){return this.code instanceof X._CodeOrName?this.code.names:{}}},eo=class extends Ct{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((r,n)=>r+n.render(e),"")}optimizeNodes(){let{nodes:e}=this,r=e.length;for(;r--;){let n=e[r].optimizeNodes();Array.isArray(n)?e.splice(r,1,...n):n?e[r]=n:e.splice(r,1)}return e.length>0?this:void 0}optimizeNames(e,r){let{nodes:n}=this,o=n.length;for(;o--;){let s=n[o];s.optimizeNames(e,r)||(X$(e,s.names),n.splice(o,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,r)=>Cr(e,r.names),{})}},jt=class extends eo{render(e){return"{"+e._n+super.render(e)+"}"+e._n}},Tu=class extends eo{},nn=class extends jt{};nn.kind="else";var Ir=class t extends jt{constructor(e,r){super(r),this.condition=e}render(e){let r=`if(${this.condition})`+super.render(e);return this.else&&(r+="else "+this.else.render(e)),r}optimizeNodes(){super.optimizeNodes();let e=this.condition;if(e===!0)return this.nodes;let r=this.else;if(r){let n=r.optimizeNodes();r=this.else=Array.isArray(n)?new nn(n):n}if(r)return e===!1?r instanceof t?r:r.nodes:this.nodes.length?this:new t(_m(e),r instanceof t?[r]:r.nodes);if(!(e===!1||!this.nodes.length))return this}optimizeNames(e,r){var n;if(this.else=(n=this.else)===null||n===void 0?void 0:n.optimizeNames(e,r),!!(super.optimizeNames(e,r)||this.else))return this.condition=on(this.condition,e,r),this}get names(){let e=super.names;return Zs(e,this.condition),this.else&&Cr(e,this.else.names),e}};Ir.kind="if";var Rr=class extends jt{};Rr.kind="for";var Pu=class extends Rr{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iteration=on(this.iteration,e,r),this}get names(){return Cr(super.names,this.iteration.names)}},zu=class extends Rr{constructor(e,r,n,o){super(),this.varKind=e,this.name=r,this.from=n,this.to=o}render(e){let r=e.es5?dt.varKinds.var:this.varKind,{name:n,from:o,to:s}=this;return`for(${r} ${n}=${o}; ${n}<${s}; ${n}++)`+super.render(e)}get names(){let e=Zs(super.names,this.from);return Zs(e,this.to)}},As=class extends Rr{constructor(e,r,n,o){super(),this.loop=e,this.varKind=r,this.name=n,this.iterable=o}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iterable=on(this.iterable,e,r),this}get names(){return Cr(super.names,this.iterable.names)}},to=class extends jt{constructor(e,r,n){super(),this.name=e,this.args=r,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}};to.kind="func";var ro=class extends eo{render(e){return"return "+super.render(e)}};ro.kind="return";var Eu=class extends jt{render(e){let r="try"+super.render(e);return this.catch&&(r+=this.catch.render(e)),this.finally&&(r+=this.finally.render(e)),r}optimizeNodes(){var e,r;return super.optimizeNodes(),(e=this.catch)===null||e===void 0||e.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(e,r){var n,o;return super.optimizeNames(e,r),(n=this.catch)===null||n===void 0||n.optimizeNames(e,r),(o=this.finally)===null||o===void 0||o.optimizeNames(e,r),this}get names(){let e=super.names;return this.catch&&Cr(e,this.catch.names),this.finally&&Cr(e,this.finally.names),e}},no=class extends jt{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}};no.kind="catch";var oo=class extends jt{render(e){return"finally"+super.render(e)}};oo.kind="finally";var Iu=class{constructor(e,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=e,this._scope=new dt.Scope({parent:e}),this._nodes=[new Tu]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,r){let n=this._extScope.value(e,r);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,r){return this._extScope.getValue(e,r)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,r,n,o){let s=this._scope.toName(r);return n!==void 0&&o&&(this._constants[s.str]=n),this._leafNode(new xu(e,s,n)),s}const(e,r,n){return this._def(dt.varKinds.const,e,r,n)}let(e,r,n){return this._def(dt.varKinds.let,e,r,n)}var(e,r,n){return this._def(dt.varKinds.var,e,r,n)}assign(e,r,n){return this._leafNode(new Ns(e,r,n))}add(e,r){return this._leafNode(new bu(e,K.operators.ADD,r))}code(e){return typeof e=="function"?e():e!==X.nil&&this._leafNode(new Su(e)),this}object(...e){let r=["{"];for(let[n,o]of e)r.length>1&&r.push(","),r.push(n),(n!==o||this.opts.es5)&&(r.push(":"),(0,X.addCodeArg)(r,o));return r.push("}"),new X._Code(r)}if(e,r,n){if(this._blockNode(new Ir(e)),r&&n)this.code(r).else().code(n).endIf();else if(r)this.code(r).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new Ir(e))}else(){return this._elseNode(new nn)}endIf(){return this._endBlockNode(Ir,nn)}_for(e,r){return this._blockNode(e),r&&this.code(r).endFor(),this}for(e,r){return this._for(new Pu(e),r)}forRange(e,r,n,o,s=this.opts.es5?dt.varKinds.var:dt.varKinds.let){let i=this._scope.toName(e);return this._for(new zu(s,i,r,n),()=>o(i))}forOf(e,r,n,o=dt.varKinds.const){let s=this._scope.toName(e);if(this.opts.es5){let i=r instanceof X.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,X._)`${i}.length`,a=>{this.var(s,(0,X._)`${i}[${a}]`),n(s)})}return this._for(new As("of",o,s,r),()=>n(s))}forIn(e,r,n,o=this.opts.es5?dt.varKinds.var:dt.varKinds.const){if(this.opts.ownProperties)return this.forOf(e,(0,X._)`Object.keys(${r})`,n);let s=this._scope.toName(e);return this._for(new As("in",o,s,r),()=>n(s))}endFor(){return this._endBlockNode(Rr)}label(e){return this._leafNode(new $u(e))}break(e){return this._leafNode(new wu(e))}return(e){let r=new ro;if(this._blockNode(r),this.code(e),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(ro)}try(e,r,n){if(!r&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');let o=new Eu;if(this._blockNode(o),this.code(e),r){let s=this.name("e");this._currNode=o.catch=new no(s),r(s)}return n&&(this._currNode=o.finally=new oo,this.code(n)),this._endBlockNode(no,oo)}throw(e){return this._leafNode(new ku(e))}block(e,r){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(r),this}endBlock(e){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let n=this._nodes.length-r;if(n<0||e!==void 0&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=r,this}func(e,r=X.nil,n,o){return this._blockNode(new to(e,r,n)),o&&this.code(o).endFunc(),this}endFunc(){return this._endBlockNode(to)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,r){let n=this._currNode;if(n instanceof e||r&&n instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${e.kind}/${r.kind}`:e.kind}"`)}_elseNode(e){let r=this._currNode;if(!(r instanceof Ir))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=e,this}get _root(){return this._nodes[0]}get _currNode(){let e=this._nodes;return e[e.length-1]}set _currNode(e){let r=this._nodes;r[r.length-1]=e}};K.CodeGen=Iu;function Cr(t,e){for(let r in e)t[r]=(t[r]||0)+(e[r]||0);return t}function Zs(t,e){return e instanceof X._CodeOrName?Cr(t,e.names):t}function on(t,e,r){if(t instanceof X.Name)return n(t);if(!o(t))return t;return new X._Code(t._items.reduce((s,i)=>(i instanceof X.Name&&(i=n(i)),i instanceof X._Code?s.push(...i._items):s.push(i),s),[]));function n(s){let i=r[s.str];return i===void 0||e[s.str]!==1?s:(delete e[s.str],i)}function o(s){return s instanceof X._Code&&s._items.some(i=>i instanceof X.Name&&e[i.str]===1&&r[i.str]!==void 0)}}function X$(t,e){for(let r in e)t[r]=(t[r]||0)-(e[r]||0)}function _m(t){return typeof t=="boolean"||typeof t=="number"||t===null?!t:(0,X._)`!${Ru(t)}`}K.not=_m;var Y$=vm(K.operators.AND);function Q$(...t){return t.reduce(Y$)}K.and=Q$;var ew=vm(K.operators.OR);function tw(...t){return t.reduce(ew)}K.or=tw;function vm(t){return(e,r)=>e===X.nil?r:r===X.nil?e:(0,X._)`${Ru(e)} ${t} ${Ru(r)}`}function Ru(t){return t instanceof X.Name?t:(0,X._)`(${t})`}});var ee=T(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.checkStrictMode=H.getErrorPath=H.Type=H.useFunc=H.setEvaluated=H.evaluatedPropsToName=H.mergeEvaluated=H.eachItem=H.unescapeJsonPointer=H.escapeJsonPointer=H.escapeFragment=H.unescapeFragment=H.schemaRefOrVal=H.schemaHasRulesButRef=H.schemaHasRules=H.checkUnknownRules=H.alwaysValidSchema=H.toHash=void 0;var se=F(),rw=Qn();function nw(t){let e={};for(let r of t)e[r]=!0;return e}H.toHash=nw;function ow(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:($m(t,e),!wm(e,t.self.RULES.all))}H.alwaysValidSchema=ow;function $m(t,e=t.schema){let{opts:r,self:n}=t;if(!r.strictSchema||typeof e=="boolean")return;let o=n.RULES.keywords;for(let s in e)o[s]||Tm(t,`unknown keyword: "${s}"`)}H.checkUnknownRules=$m;function wm(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(e[r])return!0;return!1}H.schemaHasRules=wm;function sw(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}H.schemaHasRulesButRef=sw;function iw({topSchemaRef:t,schemaPath:e},r,n,o){if(!o){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,se._)`${r}`}return(0,se._)`${t}${e}${(0,se.getProperty)(n)}`}H.schemaRefOrVal=iw;function aw(t){return km(decodeURIComponent(t))}H.unescapeFragment=aw;function cw(t){return encodeURIComponent(ju(t))}H.escapeFragment=cw;function ju(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}H.escapeJsonPointer=ju;function km(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}H.unescapeJsonPointer=km;function uw(t,e){if(Array.isArray(t))for(let r of t)e(r);else e(t)}H.eachItem=uw;function xm({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:n}){return(o,s,i,a)=>{let c=i===void 0?s:i instanceof se.Name?(s instanceof se.Name?t(o,s,i):e(o,s,i),i):s instanceof se.Name?(e(o,i,s),s):r(s,i);return a===se.Name&&!(c instanceof se.Name)?n(o,c):c}}H.mergeEvaluated={props:xm({mergeNames:(t,e,r)=>t.if((0,se._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,se._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,se._)`${r} || {}`).code((0,se._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,se._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,se._)`${r} || {}`),Ou(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:Sm}),items:xm({mergeNames:(t,e,r)=>t.if((0,se._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,se._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,se._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,se._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function Sm(t,e){if(e===!0)return t.var("props",!0);let r=t.var("props",(0,se._)`{}`);return e!==void 0&&Ou(t,r,e),r}H.evaluatedPropsToName=Sm;function Ou(t,e,r){Object.keys(r).forEach(n=>t.assign((0,se._)`${e}${(0,se.getProperty)(n)}`,!0))}H.setEvaluated=Ou;var bm={};function lw(t,e){return t.scopeValue("func",{ref:e,code:bm[e.code]||(bm[e.code]=new rw._Code(e.code))})}H.useFunc=lw;var Cu;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(Cu||(H.Type=Cu={}));function dw(t,e,r){if(t instanceof se.Name){let n=e===Cu.Num;return r?n?(0,se._)`"[" + ${t} + "]"`:(0,se._)`"['" + ${t} + "']"`:n?(0,se._)`"/" + ${t}`:(0,se._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,se.getProperty)(t).toString():"/"+ju(t)}H.getErrorPath=dw;function Tm(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}H.checkStrictMode=Tm});var Ot=T(Nu=>{"use strict";Object.defineProperty(Nu,"__esModule",{value:!0});var Ce=F(),pw={data:new Ce.Name("data"),valCxt:new Ce.Name("valCxt"),instancePath:new Ce.Name("instancePath"),parentData:new Ce.Name("parentData"),parentDataProperty:new Ce.Name("parentDataProperty"),rootData:new Ce.Name("rootData"),dynamicAnchors:new Ce.Name("dynamicAnchors"),vErrors:new Ce.Name("vErrors"),errors:new Ce.Name("errors"),this:new Ce.Name("this"),self:new Ce.Name("self"),scope:new Ce.Name("scope"),json:new Ce.Name("json"),jsonPos:new Ce.Name("jsonPos"),jsonLen:new Ce.Name("jsonLen"),jsonPart:new Ce.Name("jsonPart")};Nu.default=pw});var so=T(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.extendErrors=je.resetErrorsCount=je.reportExtraError=je.reportError=je.keyword$DataError=je.keywordError=void 0;var Y=F(),Ds=ee(),Ze=Ot();je.keywordError={message:({keyword:t})=>(0,Y.str)`must pass "${t}" keyword validation`};je.keyword$DataError={message:({keyword:t,schemaType:e})=>e?(0,Y.str)`"${t}" keyword must be ${e} ($data)`:(0,Y.str)`"${t}" keyword is invalid ($data)`};function fw(t,e=je.keywordError,r,n){let{it:o}=t,{gen:s,compositeRule:i,allErrors:a}=o,c=Em(t,e,r);n??(i||a)?Pm(s,c):zm(o,(0,Y._)`[${c}]`)}je.reportError=fw;function mw(t,e=je.keywordError,r){let{it:n}=t,{gen:o,compositeRule:s,allErrors:i}=n,a=Em(t,e,r);Pm(o,a),s||i||zm(n,Ze.default.vErrors)}je.reportExtraError=mw;function hw(t,e){t.assign(Ze.default.errors,e),t.if((0,Y._)`${Ze.default.vErrors} !== null`,()=>t.if(e,()=>t.assign((0,Y._)`${Ze.default.vErrors}.length`,e),()=>t.assign(Ze.default.vErrors,null)))}je.resetErrorsCount=hw;function gw({gen:t,keyword:e,schemaValue:r,data:n,errsCount:o,it:s}){if(o===void 0)throw new Error("ajv implementation error");let i=t.name("err");t.forRange("i",o,Ze.default.errors,a=>{t.const(i,(0,Y._)`${Ze.default.vErrors}[${a}]`),t.if((0,Y._)`${i}.instancePath === undefined`,()=>t.assign((0,Y._)`${i}.instancePath`,(0,Y.strConcat)(Ze.default.instancePath,s.errorPath))),t.assign((0,Y._)`${i}.schemaPath`,(0,Y.str)`${s.errSchemaPath}/${e}`),s.opts.verbose&&(t.assign((0,Y._)`${i}.schema`,r),t.assign((0,Y._)`${i}.data`,n))})}je.extendErrors=gw;function Pm(t,e){let r=t.const("err",e);t.if((0,Y._)`${Ze.default.vErrors} === null`,()=>t.assign(Ze.default.vErrors,(0,Y._)`[${r}]`),(0,Y._)`${Ze.default.vErrors}.push(${r})`),t.code((0,Y._)`${Ze.default.errors}++`)}function zm(t,e){let{gen:r,validateName:n,schemaEnv:o}=t;o.$async?r.throw((0,Y._)`new ${t.ValidationError}(${e})`):(r.assign((0,Y._)`${n}.errors`,e),r.return(!1))}var jr={keyword:new Y.Name("keyword"),schemaPath:new Y.Name("schemaPath"),params:new Y.Name("params"),propertyName:new Y.Name("propertyName"),message:new Y.Name("message"),schema:new Y.Name("schema"),parentSchema:new Y.Name("parentSchema")};function Em(t,e,r){let{createErrors:n}=t.it;return n===!1?(0,Y._)`{}`:yw(t,e,r)}function yw(t,e,r={}){let{gen:n,it:o}=t,s=[_w(o,r),vw(t,r)];return xw(t,e,s),n.object(...s)}function _w({errorPath:t},{instancePath:e}){let r=e?(0,Y.str)`${t}${(0,Ds.getErrorPath)(e,Ds.Type.Str)}`:t;return[Ze.default.instancePath,(0,Y.strConcat)(Ze.default.instancePath,r)]}function vw({keyword:t,it:{errSchemaPath:e}},{schemaPath:r,parentSchema:n}){let o=n?e:(0,Y.str)`${e}/${t}`;return r&&(o=(0,Y.str)`${o}${(0,Ds.getErrorPath)(r,Ds.Type.Str)}`),[jr.schemaPath,o]}function xw(t,{params:e,message:r},n){let{keyword:o,data:s,schemaValue:i,it:a}=t,{opts:c,propertyName:u,topSchemaRef:l,schemaPath:d}=a;n.push([jr.keyword,o],[jr.params,typeof e=="function"?e(t):e||(0,Y._)`{}`]),c.messages&&n.push([jr.message,typeof r=="function"?r(t):r]),c.verbose&&n.push([jr.schema,i],[jr.parentSchema,(0,Y._)`${l}${d}`],[Ze.default.data,s]),u&&n.push([jr.propertyName,u])}});var Rm=T(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});sn.boolOrEmptySchema=sn.topBoolOrEmptySchema=void 0;var bw=so(),$w=F(),ww=Ot(),kw={message:"boolean schema is false"};function Sw(t){let{gen:e,schema:r,validateName:n}=t;r===!1?Im(t,!1):typeof r=="object"&&r.$async===!0?e.return(ww.default.data):(e.assign((0,$w._)`${n}.errors`,null),e.return(!0))}sn.topBoolOrEmptySchema=Sw;function Tw(t,e){let{gen:r,schema:n}=t;n===!1?(r.var(e,!1),Im(t)):r.var(e,!0)}sn.boolOrEmptySchema=Tw;function Im(t,e){let{gen:r,data:n}=t,o={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,bw.reportError)(o,kw,void 0,e)}});var Au=T(an=>{"use strict";Object.defineProperty(an,"__esModule",{value:!0});an.getRules=an.isJSONType=void 0;var Pw=["string","number","integer","boolean","null","object","array"],zw=new Set(Pw);function Ew(t){return typeof t=="string"&&zw.has(t)}an.isJSONType=Ew;function Iw(){let t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}an.getRules=Iw});var Zu=T(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.shouldUseRule=Xt.shouldUseGroup=Xt.schemaHasRulesForType=void 0;function Rw({schema:t,self:e},r){let n=e.RULES.types[r];return n&&n!==!0&&Cm(t,n)}Xt.schemaHasRulesForType=Rw;function Cm(t,e){return e.rules.some(r=>jm(t,r))}Xt.shouldUseGroup=Cm;function jm(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(n=>t[n]!==void 0))}Xt.shouldUseRule=jm});var io=T(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.reportTypeError=Oe.checkDataTypes=Oe.checkDataType=Oe.coerceAndCheckDataType=Oe.getJSONTypes=Oe.getSchemaTypes=Oe.DataType=void 0;var Cw=Au(),jw=Zu(),Ow=so(),U=F(),Om=ee(),cn;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(cn||(Oe.DataType=cn={}));function Nw(t){let e=Nm(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}Oe.getSchemaTypes=Nw;function Nm(t){let e=Array.isArray(t)?t:t?[t]:[];if(e.every(Cw.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}Oe.getJSONTypes=Nm;function Aw(t,e){let{gen:r,data:n,opts:o}=t,s=Zw(e,o.coerceTypes),i=e.length>0&&!(s.length===0&&e.length===1&&(0,jw.schemaHasRulesForType)(t,e[0]));if(i){let a=Du(e,n,o.strictNumbers,cn.Wrong);r.if(a,()=>{s.length?Mw(t,e,s):qu(t)})}return i}Oe.coerceAndCheckDataType=Aw;var Am=new Set(["string","number","integer","boolean","null"]);function Zw(t,e){return e?t.filter(r=>Am.has(r)||e==="array"&&r==="array"):[]}function Mw(t,e,r){let{gen:n,data:o,opts:s}=t,i=n.let("dataType",(0,U._)`typeof ${o}`),a=n.let("coerced",(0,U._)`undefined`);s.coerceTypes==="array"&&n.if((0,U._)`${i} == 'object' && Array.isArray(${o}) && ${o}.length == 1`,()=>n.assign(o,(0,U._)`${o}[0]`).assign(i,(0,U._)`typeof ${o}`).if(Du(e,o,s.strictNumbers),()=>n.assign(a,o))),n.if((0,U._)`${a} !== undefined`);for(let u of r)(Am.has(u)||u==="array"&&s.coerceTypes==="array")&&c(u);n.else(),qu(t),n.endIf(),n.if((0,U._)`${a} !== undefined`,()=>{n.assign(o,a),Dw(t,a)});function c(u){switch(u){case"string":n.elseIf((0,U._)`${i} == "number" || ${i} == "boolean"`).assign(a,(0,U._)`"" + ${o}`).elseIf((0,U._)`${o} === null`).assign(a,(0,U._)`""`);return;case"number":n.elseIf((0,U._)`${i} == "boolean" || ${o} === null
              || (${i} == "string" && ${o} && ${o} == +${o})`).assign(a,(0,U._)`+${o}`);return;case"integer":n.elseIf((0,U._)`${i} === "boolean" || ${o} === null
              || (${i} === "string" && ${o} && ${o} == +${o} && !(${o} % 1))`).assign(a,(0,U._)`+${o}`);return;case"boolean":n.elseIf((0,U._)`${o} === "false" || ${o} === 0 || ${o} === null`).assign(a,!1).elseIf((0,U._)`${o} === "true" || ${o} === 1`).assign(a,!0);return;case"null":n.elseIf((0,U._)`${o} === "" || ${o} === 0 || ${o} === false`),n.assign(a,null);return;case"array":n.elseIf((0,U._)`${i} === "string" || ${i} === "number"
              || ${i} === "boolean" || ${o} === null`).assign(a,(0,U._)`[${o}]`)}}}function Dw({gen:t,parentData:e,parentDataProperty:r},n){t.if((0,U._)`${e} !== undefined`,()=>t.assign((0,U._)`${e}[${r}]`,n))}function Mu(t,e,r,n=cn.Correct){let o=n===cn.Correct?U.operators.EQ:U.operators.NEQ,s;switch(t){case"null":return(0,U._)`${e} ${o} null`;case"array":s=(0,U._)`Array.isArray(${e})`;break;case"object":s=(0,U._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":s=i((0,U._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":s=i();break;default:return(0,U._)`typeof ${e} ${o} ${t}`}return n===cn.Correct?s:(0,U.not)(s);function i(a=U.nil){return(0,U.and)((0,U._)`typeof ${e} == "number"`,a,r?(0,U._)`isFinite(${e})`:U.nil)}}Oe.checkDataType=Mu;function Du(t,e,r,n){if(t.length===1)return Mu(t[0],e,r,n);let o,s=(0,Om.toHash)(t);if(s.array&&s.object){let i=(0,U._)`typeof ${e} != "object"`;o=s.null?i:(0,U._)`!${e} || ${i}`,delete s.null,delete s.array,delete s.object}else o=U.nil;s.number&&delete s.integer;for(let i in s)o=(0,U.and)(o,Mu(i,e,r,n));return o}Oe.checkDataTypes=Du;var qw={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,U._)`{type: ${t}}`:(0,U._)`{type: ${e}}`};function qu(t){let e=Lw(t);(0,Ow.reportError)(e,qw)}Oe.reportTypeError=qu;function Lw(t){let{gen:e,data:r,schema:n}=t,o=(0,Om.schemaRefOrVal)(t,n,"type");return{gen:e,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:t}}});var Mm=T(qs=>{"use strict";Object.defineProperty(qs,"__esModule",{value:!0});qs.assignDefaults=void 0;var un=F(),Uw=ee();function Vw(t,e){let{properties:r,items:n}=t.schema;if(e==="object"&&r)for(let o in r)Zm(t,o,r[o].default);else e==="array"&&Array.isArray(n)&&n.forEach((o,s)=>Zm(t,s,o.default))}qs.assignDefaults=Vw;function Zm(t,e,r){let{gen:n,compositeRule:o,data:s,opts:i}=t;if(r===void 0)return;let a=(0,un._)`${s}${(0,un.getProperty)(e)}`;if(o){(0,Uw.checkStrictMode)(t,`default is ignored for: ${a}`);return}let c=(0,un._)`${a} === undefined`;i.useDefaults==="empty"&&(c=(0,un._)`${c} || ${a} === null || ${a} === ""`),n.if(c,(0,un._)`${a} = ${(0,un.stringify)(r)}`)}});var ot=T(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.validateUnion=oe.validateArray=oe.usePattern=oe.callValidateCode=oe.schemaProperties=oe.allSchemaProperties=oe.noPropertyInData=oe.propertyInData=oe.isOwnProperty=oe.hasPropFunc=oe.reportMissingProp=oe.checkMissingProp=oe.checkReportMissingProp=void 0;var ue=F(),Lu=ee(),Yt=Ot(),Fw=ee();function Kw(t,e){let{gen:r,data:n,it:o}=t;r.if(Vu(r,n,e,o.opts.ownProperties),()=>{t.setParams({missingProperty:(0,ue._)`${e}`},!0),t.error()})}oe.checkReportMissingProp=Kw;function Hw({gen:t,data:e,it:{opts:r}},n,o){return(0,ue.or)(...n.map(s=>(0,ue.and)(Vu(t,e,s,r.ownProperties),(0,ue._)`${o} = ${s}`)))}oe.checkMissingProp=Hw;function Bw(t,e){t.setParams({missingProperty:e},!0),t.error()}oe.reportMissingProp=Bw;function Dm(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,ue._)`Object.prototype.hasOwnProperty`})}oe.hasPropFunc=Dm;function Uu(t,e,r){return(0,ue._)`${Dm(t)}.call(${e}, ${r})`}oe.isOwnProperty=Uu;function Jw(t,e,r,n){let o=(0,ue._)`${e}${(0,ue.getProperty)(r)} !== undefined`;return n?(0,ue._)`${o} && ${Uu(t,e,r)}`:o}oe.propertyInData=Jw;function Vu(t,e,r,n){let o=(0,ue._)`${e}${(0,ue.getProperty)(r)} === undefined`;return n?(0,ue.or)(o,(0,ue.not)(Uu(t,e,r))):o}oe.noPropertyInData=Vu;function qm(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}oe.allSchemaProperties=qm;function Gw(t,e){return qm(e).filter(r=>!(0,Lu.alwaysValidSchema)(t,e[r]))}oe.schemaProperties=Gw;function Ww({schemaCode:t,data:e,it:{gen:r,topSchemaRef:n,schemaPath:o,errorPath:s},it:i},a,c,u){let l=u?(0,ue._)`${t}, ${e}, ${n}${o}`:e,d=[[Yt.default.instancePath,(0,ue.strConcat)(Yt.default.instancePath,s)],[Yt.default.parentData,i.parentData],[Yt.default.parentDataProperty,i.parentDataProperty],[Yt.default.rootData,Yt.default.rootData]];i.opts.dynamicRef&&d.push([Yt.default.dynamicAnchors,Yt.default.dynamicAnchors]);let m=(0,ue._)`${l}, ${r.object(...d)}`;return c!==ue.nil?(0,ue._)`${a}.call(${c}, ${m})`:(0,ue._)`${a}(${m})`}oe.callValidateCode=Ww;var Xw=(0,ue._)`new RegExp`;function Yw({gen:t,it:{opts:e}},r){let n=e.unicodeRegExp?"u":"",{regExp:o}=e.code,s=o(r,n);return t.scopeValue("pattern",{key:s.toString(),ref:s,code:(0,ue._)`${o.code==="new RegExp"?Xw:(0,Fw.useFunc)(t,o)}(${r}, ${n})`})}oe.usePattern=Yw;function Qw(t){let{gen:e,data:r,keyword:n,it:o}=t,s=e.name("valid");if(o.allErrors){let a=e.let("valid",!0);return i(()=>e.assign(a,!1)),a}return e.var(s,!0),i(()=>e.break()),s;function i(a){let c=e.const("len",(0,ue._)`${r}.length`);e.forRange("i",0,c,u=>{t.subschema({keyword:n,dataProp:u,dataPropType:Lu.Type.Num},s),e.if((0,ue.not)(s),a)})}}oe.validateArray=Qw;function e0(t){let{gen:e,schema:r,keyword:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(c=>(0,Lu.alwaysValidSchema)(o,c))&&!o.opts.unevaluated)return;let i=e.let("valid",!1),a=e.name("_valid");e.block(()=>r.forEach((c,u)=>{let l=t.subschema({keyword:n,schemaProp:u,compositeRule:!0},a);e.assign(i,(0,ue._)`${i} || ${a}`),t.mergeValidEvaluated(l,a)||e.if((0,ue.not)(i))})),t.result(i,()=>t.reset(),()=>t.error(!0))}oe.validateUnion=e0});var Vm=T(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.validateKeywordUsage=xt.validSchemaType=xt.funcKeywordCode=xt.macroKeywordCode=void 0;var Me=F(),Or=Ot(),t0=ot(),r0=so();function n0(t,e){let{gen:r,keyword:n,schema:o,parentSchema:s,it:i}=t,a=e.macro.call(i.self,o,s,i),c=Um(r,n,a);i.opts.validateSchema!==!1&&i.self.validateSchema(a,!0);let u=r.name("valid");t.subschema({schema:a,schemaPath:Me.nil,errSchemaPath:`${i.errSchemaPath}/${n}`,topSchemaRef:c,compositeRule:!0},u),t.pass(u,()=>t.error(!0))}xt.macroKeywordCode=n0;function o0(t,e){var r;let{gen:n,keyword:o,schema:s,parentSchema:i,$data:a,it:c}=t;i0(c,e);let u=!a&&e.compile?e.compile.call(c.self,s,i,c):e.validate,l=Um(n,o,u),d=n.let("valid");t.block$data(d,m),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function m(){if(e.errors===!1)f(),e.modifying&&Lm(t),g(()=>t.error());else{let v=e.async?h():p();e.modifying&&Lm(t),g(()=>s0(t,v))}}function h(){let v=n.let("ruleErrs",null);return n.try(()=>f((0,Me._)`await `),x=>n.assign(d,!1).if((0,Me._)`${x} instanceof ${c.ValidationError}`,()=>n.assign(v,(0,Me._)`${x}.errors`),()=>n.throw(x))),v}function p(){let v=(0,Me._)`${l}.errors`;return n.assign(v,null),f(Me.nil),v}function f(v=e.async?(0,Me._)`await `:Me.nil){let x=c.opts.passContext?Or.default.this:Or.default.self,$=!("compile"in e&&!a||e.schema===!1);n.assign(d,(0,Me._)`${v}${(0,t0.callValidateCode)(t,l,x,$)}`,e.modifying)}function g(v){var x;n.if((0,Me.not)((x=e.valid)!==null&&x!==void 0?x:d),v)}}xt.funcKeywordCode=o0;function Lm(t){let{gen:e,data:r,it:n}=t;e.if(n.parentData,()=>e.assign(r,(0,Me._)`${n.parentData}[${n.parentDataProperty}]`))}function s0(t,e){let{gen:r}=t;r.if((0,Me._)`Array.isArray(${e})`,()=>{r.assign(Or.default.vErrors,(0,Me._)`${Or.default.vErrors} === null ? ${e} : ${Or.default.vErrors}.concat(${e})`).assign(Or.default.errors,(0,Me._)`${Or.default.vErrors}.length`),(0,r0.extendErrors)(t)},()=>t.error())}function i0({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function Um(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,Me.stringify)(r)})}function a0(t,e,r=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(t):n==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==n||r&&typeof t>"u")}xt.validSchemaType=a0;function c0({schema:t,opts:e,self:r,errSchemaPath:n},o,s){if(Array.isArray(o.keyword)?!o.keyword.includes(s):o.keyword!==s)throw new Error("ajv implementation error");let i=o.dependencies;if(i?.some(a=>!Object.prototype.hasOwnProperty.call(t,a)))throw new Error(`parent schema must have dependencies of ${s}: ${i.join(",")}`);if(o.validateSchema&&!o.validateSchema(t[s])){let c=`keyword "${s}" value is invalid at path "${n}": `+r.errorsText(o.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(c);else throw new Error(c)}}xt.validateKeywordUsage=c0});var Km=T(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.extendSubschemaMode=Qt.extendSubschemaData=Qt.getSubschema=void 0;var bt=F(),Fm=ee();function u0(t,{keyword:e,schemaProp:r,schema:n,schemaPath:o,errSchemaPath:s,topSchemaRef:i}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){let a=t.schema[e];return r===void 0?{schema:a,schemaPath:(0,bt._)`${t.schemaPath}${(0,bt.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:a[r],schemaPath:(0,bt._)`${t.schemaPath}${(0,bt.getProperty)(e)}${(0,bt.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,Fm.escapeFragment)(r)}`}}if(n!==void 0){if(o===void 0||s===void 0||i===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:o,topSchemaRef:i,errSchemaPath:s}}throw new Error('either "keyword" or "schema" must be passed')}Qt.getSubschema=u0;function l0(t,e,{dataProp:r,dataPropType:n,data:o,dataTypes:s,propertyName:i}){if(o!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=e;if(r!==void 0){let{errorPath:u,dataPathArr:l,opts:d}=e,m=a.let("data",(0,bt._)`${e.data}${(0,bt.getProperty)(r)}`,!0);c(m),t.errorPath=(0,bt.str)`${u}${(0,Fm.getErrorPath)(r,n,d.jsPropertySyntax)}`,t.parentDataProperty=(0,bt._)`${r}`,t.dataPathArr=[...l,t.parentDataProperty]}if(o!==void 0){let u=o instanceof bt.Name?o:a.let("data",o,!0);c(u),i!==void 0&&(t.propertyName=i)}s&&(t.dataTypes=s);function c(u){t.data=u,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,u]}}Qt.extendSubschemaData=l0;function d0(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:n,createErrors:o,allErrors:s}){n!==void 0&&(t.compositeRule=n),o!==void 0&&(t.createErrors=o),s!==void 0&&(t.allErrors=s),t.jtdDiscriminator=e,t.jtdMetadata=r}Qt.extendSubschemaMode=d0});var Fu=T((Jj,Hm)=>{"use strict";Hm.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,o,s;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(o=n;o--!==0;)if(!t(e[o],r[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(r).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(r,s[o]))return!1;for(o=n;o--!==0;){var i=s[o];if(!t(e[i],r[i]))return!1}return!0}return e!==e&&r!==r}});var Jm=T((Gj,Bm)=>{"use strict";var er=Bm.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var n=typeof r=="function"?r:r.pre||function(){},o=r.post||function(){};Ls(e,n,o,t,"",t)};er.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};er.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};er.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};er.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function Ls(t,e,r,n,o,s,i,a,c,u){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,o,s,i,a,c,u);for(var l in n){var d=n[l];if(Array.isArray(d)){if(l in er.arrayKeywords)for(var m=0;m<d.length;m++)Ls(t,e,r,d[m],o+"/"+l+"/"+m,s,o,l,n,m)}else if(l in er.propsKeywords){if(d&&typeof d=="object")for(var h in d)Ls(t,e,r,d[h],o+"/"+l+"/"+p0(h),s,o,l,n,h)}else(l in er.keywords||t.allKeys&&!(l in er.skipKeywords))&&Ls(t,e,r,d,o+"/"+l,s,o,l,n)}r(n,o,s,i,a,c,u)}}function p0(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}});var ao=T(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.getSchemaRefs=He.resolveUrl=He.normalizeId=He._getFullPath=He.getFullPath=He.inlineRef=void 0;var f0=ee(),m0=Fu(),h0=Jm(),g0=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function y0(t,e=!0){return typeof t=="boolean"?!0:e===!0?!Ku(t):e?Gm(t)<=e:!1}He.inlineRef=y0;var _0=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function Ku(t){for(let e in t){if(_0.has(e))return!0;let r=t[e];if(Array.isArray(r)&&r.some(Ku)||typeof r=="object"&&Ku(r))return!0}return!1}function Gm(t){let e=0;for(let r in t){if(r==="$ref")return 1/0;if(e++,!g0.has(r)&&(typeof t[r]=="object"&&(0,f0.eachItem)(t[r],n=>e+=Gm(n)),e===1/0))return 1/0}return e}function Wm(t,e="",r){r!==!1&&(e=ln(e));let n=t.parse(e);return Xm(t,n)}He.getFullPath=Wm;function Xm(t,e){return t.serialize(e).split("#")[0]+"#"}He._getFullPath=Xm;var v0=/#\/?$/;function ln(t){return t?t.replace(v0,""):""}He.normalizeId=ln;function x0(t,e,r){return r=ln(r),t.resolve(e,r)}He.resolveUrl=x0;var b0=/^[a-z_][-a-z0-9._]*$/i;function $0(t,e){if(typeof t=="boolean")return{};let{schemaId:r,uriResolver:n}=this.opts,o=ln(t[r]||e),s={"":o},i=Wm(n,o,!1),a={},c=new Set;return h0(t,{allKeys:!0},(d,m,h,p)=>{if(p===void 0)return;let f=i+m,g=s[p];typeof d[r]=="string"&&(g=v.call(this,d[r])),x.call(this,d.$anchor),x.call(this,d.$dynamicAnchor),s[m]=g;function v($){let k=this.opts.uriResolver.resolve;if($=ln(g?k(g,$):$),c.has($))throw l($);c.add($);let E=this.refs[$];return typeof E=="string"&&(E=this.refs[E]),typeof E=="object"?u(d,E.schema,$):$!==ln(f)&&($[0]==="#"?(u(d,a[$],$),a[$]=d):this.refs[$]=f),$}function x($){if(typeof $=="string"){if(!b0.test($))throw new Error(`invalid anchor "${$}"`);v.call(this,`#${$}`)}}}),a;function u(d,m,h){if(m!==void 0&&!m0(d,m))throw l(h)}function l(d){return new Error(`reference "${d}" resolves to more than one schema`)}}He.getSchemaRefs=$0});var lo=T(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.getData=tr.KeywordCxt=tr.validateFunctionCode=void 0;var rh=Rm(),Ym=io(),Bu=Zu(),Us=io(),w0=Mm(),uo=Vm(),Hu=Km(),O=F(),q=Ot(),k0=ao(),Nt=ee(),co=so();function S0(t){if(sh(t)&&(ih(t),oh(t))){z0(t);return}nh(t,()=>(0,rh.topBoolOrEmptySchema)(t))}tr.validateFunctionCode=S0;function nh({gen:t,validateName:e,schema:r,schemaEnv:n,opts:o},s){o.code.es5?t.func(e,(0,O._)`${q.default.data}, ${q.default.valCxt}`,n.$async,()=>{t.code((0,O._)`"use strict"; ${Qm(r,o)}`),P0(t,o),t.code(s)}):t.func(e,(0,O._)`${q.default.data}, ${T0(o)}`,n.$async,()=>t.code(Qm(r,o)).code(s))}function T0(t){return(0,O._)`{${q.default.instancePath}="", ${q.default.parentData}, ${q.default.parentDataProperty}, ${q.default.rootData}=${q.default.data}${t.dynamicRef?(0,O._)`, ${q.default.dynamicAnchors}={}`:O.nil}}={}`}function P0(t,e){t.if(q.default.valCxt,()=>{t.var(q.default.instancePath,(0,O._)`${q.default.valCxt}.${q.default.instancePath}`),t.var(q.default.parentData,(0,O._)`${q.default.valCxt}.${q.default.parentData}`),t.var(q.default.parentDataProperty,(0,O._)`${q.default.valCxt}.${q.default.parentDataProperty}`),t.var(q.default.rootData,(0,O._)`${q.default.valCxt}.${q.default.rootData}`),e.dynamicRef&&t.var(q.default.dynamicAnchors,(0,O._)`${q.default.valCxt}.${q.default.dynamicAnchors}`)},()=>{t.var(q.default.instancePath,(0,O._)`""`),t.var(q.default.parentData,(0,O._)`undefined`),t.var(q.default.parentDataProperty,(0,O._)`undefined`),t.var(q.default.rootData,q.default.data),e.dynamicRef&&t.var(q.default.dynamicAnchors,(0,O._)`{}`)})}function z0(t){let{schema:e,opts:r,gen:n}=t;nh(t,()=>{r.$comment&&e.$comment&&ch(t),j0(t),n.let(q.default.vErrors,null),n.let(q.default.errors,0),r.unevaluated&&E0(t),ah(t),A0(t)})}function E0(t){let{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,O._)`${r}.evaluated`),e.if((0,O._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,O._)`${t.evaluated}.props`,(0,O._)`undefined`)),e.if((0,O._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,O._)`${t.evaluated}.items`,(0,O._)`undefined`))}function Qm(t,e){let r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,O._)`/*# sourceURL=${r} */`:O.nil}function I0(t,e){if(sh(t)&&(ih(t),oh(t))){R0(t,e);return}(0,rh.boolOrEmptySchema)(t,e)}function oh({schema:t,self:e}){if(typeof t=="boolean")return!t;for(let r in t)if(e.RULES.all[r])return!0;return!1}function sh(t){return typeof t.schema!="boolean"}function R0(t,e){let{schema:r,gen:n,opts:o}=t;o.$comment&&r.$comment&&ch(t),O0(t),N0(t);let s=n.const("_errs",q.default.errors);ah(t,s),n.var(e,(0,O._)`${s} === ${q.default.errors}`)}function ih(t){(0,Nt.checkUnknownRules)(t),C0(t)}function ah(t,e){if(t.opts.jtd)return eh(t,[],!1,e);let r=(0,Ym.getSchemaTypes)(t.schema),n=(0,Ym.coerceAndCheckDataType)(t,r);eh(t,r,!n,e)}function C0(t){let{schema:e,errSchemaPath:r,opts:n,self:o}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,Nt.schemaHasRulesButRef)(e,o.RULES)&&o.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function j0(t){let{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,Nt.checkStrictMode)(t,"default is ignored in the schema root")}function O0(t){let e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,k0.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function N0(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function ch({gen:t,schemaEnv:e,schema:r,errSchemaPath:n,opts:o}){let s=r.$comment;if(o.$comment===!0)t.code((0,O._)`${q.default.self}.logger.log(${s})`);else if(typeof o.$comment=="function"){let i=(0,O.str)`${n}/$comment`,a=t.scopeValue("root",{ref:e.root});t.code((0,O._)`${q.default.self}.opts.$comment(${s}, ${i}, ${a}.schema)`)}}function A0(t){let{gen:e,schemaEnv:r,validateName:n,ValidationError:o,opts:s}=t;r.$async?e.if((0,O._)`${q.default.errors} === 0`,()=>e.return(q.default.data),()=>e.throw((0,O._)`new ${o}(${q.default.vErrors})`)):(e.assign((0,O._)`${n}.errors`,q.default.vErrors),s.unevaluated&&Z0(t),e.return((0,O._)`${q.default.errors} === 0`))}function Z0({gen:t,evaluated:e,props:r,items:n}){r instanceof O.Name&&t.assign((0,O._)`${e}.props`,r),n instanceof O.Name&&t.assign((0,O._)`${e}.items`,n)}function eh(t,e,r,n){let{gen:o,schema:s,data:i,allErrors:a,opts:c,self:u}=t,{RULES:l}=u;if(s.$ref&&(c.ignoreKeywordsWithRef||!(0,Nt.schemaHasRulesButRef)(s,l))){o.block(()=>lh(t,"$ref",l.all.$ref.definition));return}c.jtd||M0(t,e),o.block(()=>{for(let m of l.rules)d(m);d(l.post)});function d(m){(0,Bu.shouldUseGroup)(s,m)&&(m.type?(o.if((0,Us.checkDataType)(m.type,i,c.strictNumbers)),th(t,m),e.length===1&&e[0]===m.type&&r&&(o.else(),(0,Us.reportTypeError)(t)),o.endIf()):th(t,m),a||o.if((0,O._)`${q.default.errors} === ${n||0}`))}}function th(t,e){let{gen:r,schema:n,opts:{useDefaults:o}}=t;o&&(0,w0.assignDefaults)(t,e.type),r.block(()=>{for(let s of e.rules)(0,Bu.shouldUseRule)(n,s)&&lh(t,s.keyword,s.definition,e.type)})}function M0(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(D0(t,e),t.opts.allowUnionTypes||q0(t,e),L0(t,t.dataTypes))}function D0(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{uh(t.dataTypes,r)||Ju(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),V0(t,e)}}function q0(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&Ju(t,"use allowUnionTypes to allow union type keyword")}function L0(t,e){let r=t.self.RULES.all;for(let n in r){let o=r[n];if(typeof o=="object"&&(0,Bu.shouldUseRule)(t.schema,o)){let{type:s}=o.definition;s.length&&!s.some(i=>U0(e,i))&&Ju(t,`missing type "${s.join(",")}" for keyword "${n}"`)}}}function U0(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function uh(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function V0(t,e){let r=[];for(let n of t.dataTypes)uh(e,n)?r.push(n):e.includes("integer")&&n==="number"&&r.push("integer");t.dataTypes=r}function Ju(t,e){let r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,Nt.checkStrictMode)(t,e,t.opts.strictTypes)}var Vs=class{constructor(e,r,n){if((0,uo.validateKeywordUsage)(e,r,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Nt.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",dh(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,uo.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",q.default.errors))}result(e,r,n){this.failResult((0,O.not)(e),r,n)}failResult(e,r,n){this.gen.if(e),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,O.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:r}=this;this.fail((0,O._)`${r} !== undefined && (${(0,O.or)(this.invalid$data(),e)})`)}error(e,r,n){if(r){this.setParams(r),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,r){(e?co.reportExtraError:co.reportError)(this,this.def.error,r)}$dataError(){(0,co.reportError)(this,this.def.$dataError||co.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,co.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,n=O.nil){this.gen.block(()=>{this.check$data(e,n),r()})}check$data(e=O.nil,r=O.nil){if(!this.$data)return;let{gen:n,schemaCode:o,schemaType:s,def:i}=this;n.if((0,O.or)((0,O._)`${o} === undefined`,r)),e!==O.nil&&n.assign(e,!0),(s.length||i.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==O.nil&&n.assign(e,!1)),n.else()}invalid$data(){let{gen:e,schemaCode:r,schemaType:n,def:o,it:s}=this;return(0,O.or)(i(),a());function i(){if(n.length){if(!(r instanceof O.Name))throw new Error("ajv implementation error");let c=Array.isArray(n)?n:[n];return(0,O._)`${(0,Us.checkDataTypes)(c,r,s.opts.strictNumbers,Us.DataType.Wrong)}`}return O.nil}function a(){if(o.validateSchema){let c=e.scopeValue("validate$data",{ref:o.validateSchema});return(0,O._)`!${c}(${r})`}return O.nil}}subschema(e,r){let n=(0,Hu.getSubschema)(this.it,e);(0,Hu.extendSubschemaData)(n,this.it,e),(0,Hu.extendSubschemaMode)(n,e);let o={...this.it,...n,items:void 0,props:void 0};return I0(o,r),o}mergeEvaluated(e,r){let{it:n,gen:o}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=Nt.mergeEvaluated.props(o,e.props,n.props,r)),n.items!==!0&&e.items!==void 0&&(n.items=Nt.mergeEvaluated.items(o,e.items,n.items,r)))}mergeValidEvaluated(e,r){let{it:n,gen:o}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return o.if(r,()=>this.mergeEvaluated(e,O.Name)),!0}};tr.KeywordCxt=Vs;function lh(t,e,r,n){let o=new Vs(t,r,e);"code"in r?r.code(o,n):o.$data&&r.validate?(0,uo.funcKeywordCode)(o,r):"macro"in r?(0,uo.macroKeywordCode)(o,r):(r.compile||r.validate)&&(0,uo.funcKeywordCode)(o,r)}var F0=/^\/(?:[^~]|~0|~1)*$/,K0=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function dh(t,{dataLevel:e,dataNames:r,dataPathArr:n}){let o,s;if(t==="")return q.default.rootData;if(t[0]==="/"){if(!F0.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);o=t,s=q.default.rootData}else{let u=K0.exec(t);if(!u)throw new Error(`Invalid JSON-pointer: ${t}`);let l=+u[1];if(o=u[2],o==="#"){if(l>=e)throw new Error(c("property/index",l));return n[e-l]}if(l>e)throw new Error(c("data",l));if(s=r[e-l],!o)return s}let i=s,a=o.split("/");for(let u of a)u&&(s=(0,O._)`${s}${(0,O.getProperty)((0,Nt.unescapeJsonPointer)(u))}`,i=(0,O._)`${i} && ${s}`);return i;function c(u,l){return`Cannot access ${u} ${l} levels up, current level is ${e}`}}tr.getData=dh});var Fs=T(Wu=>{"use strict";Object.defineProperty(Wu,"__esModule",{value:!0});var Gu=class extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}};Wu.default=Gu});var po=T(Qu=>{"use strict";Object.defineProperty(Qu,"__esModule",{value:!0});var Xu=ao(),Yu=class extends Error{constructor(e,r,n,o){super(o||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,Xu.resolveUrl)(e,r,n),this.missingSchema=(0,Xu.normalizeId)((0,Xu.getFullPath)(e,this.missingRef))}};Qu.default=Yu});var Hs=T(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});st.resolveSchema=st.getCompilingSchema=st.resolveRef=st.compileSchema=st.SchemaEnv=void 0;var pt=F(),H0=Fs(),Nr=Ot(),ft=ao(),ph=ee(),B0=lo(),dn=class{constructor(e){var r;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,ft.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}};st.SchemaEnv=dn;function tl(t){let e=fh.call(this,t);if(e)return e;let r=(0,ft.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:o}=this.opts.code,{ownProperties:s}=this.opts,i=new pt.CodeGen(this.scope,{es5:n,lines:o,ownProperties:s}),a;t.$async&&(a=i.scopeValue("Error",{ref:H0.default,code:(0,pt._)`require("ajv/dist/runtime/validation_error").default`}));let c=i.scopeName("validate");t.validateName=c;let u={gen:i,allErrors:this.opts.allErrors,data:Nr.default.data,parentData:Nr.default.parentData,parentDataProperty:Nr.default.parentDataProperty,dataNames:[Nr.default.data],dataPathArr:[pt.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:i.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,pt.stringify)(t.schema)}:{ref:t.schema}),validateName:c,ValidationError:a,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:pt.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,pt._)`""`,opts:this.opts,self:this},l;try{this._compilations.add(t),(0,B0.validateFunctionCode)(u),i.optimize(this.opts.code.optimize);let d=i.toString();l=`${i.scopeRefs(Nr.default.scope)}return ${d}`,this.opts.code.process&&(l=this.opts.code.process(l,t));let h=new Function(`${Nr.default.self}`,`${Nr.default.scope}`,l)(this,this.scope.get());if(this.scope.value(c,{ref:h}),h.errors=null,h.schema=t.schema,h.schemaEnv=t,t.$async&&(h.$async=!0),this.opts.code.source===!0&&(h.source={validateName:c,validateCode:d,scopeValues:i._values}),this.opts.unevaluated){let{props:p,items:f}=u;h.evaluated={props:p instanceof pt.Name?void 0:p,items:f instanceof pt.Name?void 0:f,dynamicProps:p instanceof pt.Name,dynamicItems:f instanceof pt.Name},h.source&&(h.source.evaluated=(0,pt.stringify)(h.evaluated))}return t.validate=h,t}catch(d){throw delete t.validate,delete t.validateName,l&&this.logger.error("Error compiling schema, function code:",l),d}finally{this._compilations.delete(t)}}st.compileSchema=tl;function J0(t,e,r){var n;r=(0,ft.resolveUrl)(this.opts.uriResolver,e,r);let o=t.refs[r];if(o)return o;let s=X0.call(this,t,r);if(s===void 0){let i=(n=t.localRefs)===null||n===void 0?void 0:n[r],{schemaId:a}=this.opts;i&&(s=new dn({schema:i,schemaId:a,root:t,baseId:e}))}if(s!==void 0)return t.refs[r]=G0.call(this,s)}st.resolveRef=J0;function G0(t){return(0,ft.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:tl.call(this,t)}function fh(t){for(let e of this._compilations)if(W0(e,t))return e}st.getCompilingSchema=fh;function W0(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function X0(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||Ks.call(this,t,e)}function Ks(t,e){let r=this.opts.uriResolver.parse(e),n=(0,ft._getFullPath)(this.opts.uriResolver,r),o=(0,ft.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===o)return el.call(this,r,t);let s=(0,ft.normalizeId)(n),i=this.refs[s]||this.schemas[s];if(typeof i=="string"){let a=Ks.call(this,t,i);return typeof a?.schema!="object"?void 0:el.call(this,r,a)}if(typeof i?.schema=="object"){if(i.validate||tl.call(this,i),s===(0,ft.normalizeId)(e)){let{schema:a}=i,{schemaId:c}=this.opts,u=a[c];return u&&(o=(0,ft.resolveUrl)(this.opts.uriResolver,o,u)),new dn({schema:a,schemaId:c,root:t,baseId:o})}return el.call(this,r,i)}}st.resolveSchema=Ks;var Y0=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function el(t,{baseId:e,schema:r,root:n}){var o;if(((o=t.fragment)===null||o===void 0?void 0:o[0])!=="/")return;for(let a of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let c=r[(0,ph.unescapeFragment)(a)];if(c===void 0)return;r=c;let u=typeof r=="object"&&r[this.opts.schemaId];!Y0.has(a)&&u&&(e=(0,ft.resolveUrl)(this.opts.uriResolver,e,u))}let s;if(typeof r!="boolean"&&r.$ref&&!(0,ph.schemaHasRulesButRef)(r,this.RULES)){let a=(0,ft.resolveUrl)(this.opts.uriResolver,e,r.$ref);s=Ks.call(this,n,a)}let{schemaId:i}=this.opts;if(s=s||new dn({schema:r,schemaId:i,root:n,baseId:e}),s.schema!==s.root.schema)return s}});var mh=T((tO,Q0)=>{Q0.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var nl=T((rO,_h)=>{"use strict";var ek=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),gh=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function rl(t){let e="",r=0,n=0;for(n=0;n<t.length;n++)if(r=t[n].charCodeAt(0),r!==48){if(!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n];break}for(n+=1;n<t.length;n++){if(r=t[n].charCodeAt(0),!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n]}return e}var tk=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function hh(t){return t.length=0,!0}function rk(t,e,r){if(t.length){let n=rl(t);if(n!=="")e.push(n);else return r.error=!0,!1;t.length=0}return!0}function nk(t){let e=0,r={error:!1,address:"",zone:""},n=[],o=[],s=!1,i=!1,a=rk;for(let c=0;c<t.length;c++){let u=t[c];if(!(u==="["||u==="]"))if(u===":"){if(s===!0&&(i=!0),!a(o,n,r))break;if(++e>7){r.error=!0;break}c>0&&t[c-1]===":"&&(s=!0),n.push(":");continue}else if(u==="%"){if(!a(o,n,r))break;a=hh}else{o.push(u);continue}}return o.length&&(a===hh?r.zone=o.join(""):i?n.push(o.join("")):n.push(rl(o))),r.address=n.join(""),r}function yh(t){if(ok(t,":")<2)return{host:t,isIPV6:!1};let e=nk(t);if(e.error)return{host:t,isIPV6:!1};{let r=e.address,n=e.address;return e.zone&&(r+="%"+e.zone,n+="%25"+e.zone),{host:r,isIPV6:!0,escapedHost:n}}}function ok(t,e){let r=0;for(let n=0;n<t.length;n++)t[n]===e&&r++;return r}function sk(t){let e=t,r=[],n=-1,o=0;for(;o=e.length;){if(o===1){if(e===".")break;if(e==="/"){r.push("/");break}else{r.push(e);break}}else if(o===2){if(e[0]==="."){if(e[1]===".")break;if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&(e[1]==="."||e[1]==="/")){r.push("/");break}}else if(o===3&&e==="/.."){r.length!==0&&r.pop(),r.push("/");break}if(e[0]==="."){if(e[1]==="."){if(e[2]==="/"){e=e.slice(3);continue}}else if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&e[1]==="."){if(e[2]==="/"){e=e.slice(2);continue}else if(e[2]==="."&&e[3]==="/"){e=e.slice(3),r.length!==0&&r.pop();continue}}if((n=e.indexOf("/",1))===-1){r.push(e);break}else r.push(e.slice(0,n)),e=e.slice(n)}return r.join("")}function ik(t,e){let r=e!==!0?escape:unescape;return t.scheme!==void 0&&(t.scheme=r(t.scheme)),t.userinfo!==void 0&&(t.userinfo=r(t.userinfo)),t.host!==void 0&&(t.host=r(t.host)),t.path!==void 0&&(t.path=r(t.path)),t.query!==void 0&&(t.query=r(t.query)),t.fragment!==void 0&&(t.fragment=r(t.fragment)),t}function ak(t){let e=[];if(t.userinfo!==void 0&&(e.push(t.userinfo),e.push("@")),t.host!==void 0){let r=unescape(t.host);if(!gh(r)){let n=yh(r);n.isIPV6===!0?r=`[${n.escapedHost}]`:r=t.host}e.push(r)}return(typeof t.port=="number"||typeof t.port=="string")&&(e.push(":"),e.push(String(t.port))),e.length?e.join(""):void 0}_h.exports={nonSimpleDomain:tk,recomposeAuthority:ak,normalizeComponentEncoding:ik,removeDotSegments:sk,isIPv4:gh,isUUID:ek,normalizeIPv6:yh,stringArrayToHexStripped:rl}});var wh=T((nO,$h)=>{"use strict";var{isUUID:ck}=nl(),uk=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,lk=["http","https","ws","wss","urn","urn:uuid"];function dk(t){return lk.indexOf(t)!==-1}function ol(t){return t.secure===!0?!0:t.secure===!1?!1:t.scheme?t.scheme.length===3&&(t.scheme[0]==="w"||t.scheme[0]==="W")&&(t.scheme[1]==="s"||t.scheme[1]==="S")&&(t.scheme[2]==="s"||t.scheme[2]==="S"):!1}function vh(t){return t.host||(t.error=t.error||"HTTP URIs must have a host."),t}function xh(t){let e=String(t.scheme).toLowerCase()==="https";return(t.port===(e?443:80)||t.port==="")&&(t.port=void 0),t.path||(t.path="/"),t}function pk(t){return t.secure=ol(t),t.resourceName=(t.path||"/")+(t.query?"?"+t.query:""),t.path=void 0,t.query=void 0,t}function fk(t){if((t.port===(ol(t)?443:80)||t.port==="")&&(t.port=void 0),typeof t.secure=="boolean"&&(t.scheme=t.secure?"wss":"ws",t.secure=void 0),t.resourceName){let[e,r]=t.resourceName.split("?");t.path=e&&e!=="/"?e:void 0,t.query=r,t.resourceName=void 0}return t.fragment=void 0,t}function mk(t,e){if(!t.path)return t.error="URN can not be parsed",t;let r=t.path.match(uk);if(r){let n=e.scheme||t.scheme||"urn";t.nid=r[1].toLowerCase(),t.nss=r[2];let o=`${n}:${e.nid||t.nid}`,s=sl(o);t.path=void 0,s&&(t=s.parse(t,e))}else t.error=t.error||"URN can not be parsed.";return t}function hk(t,e){if(t.nid===void 0)throw new Error("URN without nid cannot be serialized");let r=e.scheme||t.scheme||"urn",n=t.nid.toLowerCase(),o=`${r}:${e.nid||n}`,s=sl(o);s&&(t=s.serialize(t,e));let i=t,a=t.nss;return i.path=`${n||e.nid}:${a}`,e.skipEscape=!0,i}function gk(t,e){let r=t;return r.uuid=r.nss,r.nss=void 0,!e.tolerant&&(!r.uuid||!ck(r.uuid))&&(r.error=r.error||"UUID is not valid."),r}function yk(t){let e=t;return e.nss=(t.uuid||"").toLowerCase(),e}var bh={scheme:"http",domainHost:!0,parse:vh,serialize:xh},_k={scheme:"https",domainHost:bh.domainHost,parse:vh,serialize:xh},Bs={scheme:"ws",domainHost:!0,parse:pk,serialize:fk},vk={scheme:"wss",domainHost:Bs.domainHost,parse:Bs.parse,serialize:Bs.serialize},xk={scheme:"urn",parse:mk,serialize:hk,skipNormalize:!0},bk={scheme:"urn:uuid",parse:gk,serialize:yk,skipNormalize:!0},Js={http:bh,https:_k,ws:Bs,wss:vk,urn:xk,"urn:uuid":bk};Object.setPrototypeOf(Js,null);function sl(t){return t&&(Js[t]||Js[t.toLowerCase()])||void 0}$h.exports={wsIsSecure:ol,SCHEMES:Js,isValidSchemeName:dk,getSchemeHandler:sl}});var Th=T((oO,Ws)=>{"use strict";var{normalizeIPv6:$k,removeDotSegments:fo,recomposeAuthority:wk,normalizeComponentEncoding:Gs,isIPv4:kk,nonSimpleDomain:Sk}=nl(),{SCHEMES:Tk,getSchemeHandler:kh}=wh();function Pk(t,e){return typeof t=="string"?t=$t(At(t,e),e):typeof t=="object"&&(t=At($t(t,e),e)),t}function zk(t,e,r){let n=r?Object.assign({scheme:"null"},r):{scheme:"null"},o=Sh(At(t,n),At(e,n),n,!0);return n.skipEscape=!0,$t(o,n)}function Sh(t,e,r,n){let o={};return n||(t=At($t(t,r),r),e=At($t(e,r),r)),r=r||{},!r.tolerant&&e.scheme?(o.scheme=e.scheme,o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=fo(e.path||""),o.query=e.query):(e.userinfo!==void 0||e.host!==void 0||e.port!==void 0?(o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=fo(e.path||""),o.query=e.query):(e.path?(e.path[0]==="/"?o.path=fo(e.path):((t.userinfo!==void 0||t.host!==void 0||t.port!==void 0)&&!t.path?o.path="/"+e.path:t.path?o.path=t.path.slice(0,t.path.lastIndexOf("/")+1)+e.path:o.path=e.path,o.path=fo(o.path)),o.query=e.query):(o.path=t.path,e.query!==void 0?o.query=e.query:o.query=t.query),o.userinfo=t.userinfo,o.host=t.host,o.port=t.port),o.scheme=t.scheme),o.fragment=e.fragment,o}function Ek(t,e,r){return typeof t=="string"?(t=unescape(t),t=$t(Gs(At(t,r),!0),{...r,skipEscape:!0})):typeof t=="object"&&(t=$t(Gs(t,!0),{...r,skipEscape:!0})),typeof e=="string"?(e=unescape(e),e=$t(Gs(At(e,r),!0),{...r,skipEscape:!0})):typeof e=="object"&&(e=$t(Gs(e,!0),{...r,skipEscape:!0})),t.toLowerCase()===e.toLowerCase()}function $t(t,e){let r={host:t.host,scheme:t.scheme,userinfo:t.userinfo,port:t.port,path:t.path,query:t.query,nid:t.nid,nss:t.nss,uuid:t.uuid,fragment:t.fragment,reference:t.reference,resourceName:t.resourceName,secure:t.secure,error:""},n=Object.assign({},e),o=[],s=kh(n.scheme||r.scheme);s&&s.serialize&&s.serialize(r,n),r.path!==void 0&&(n.skipEscape?r.path=unescape(r.path):(r.path=escape(r.path),r.scheme!==void 0&&(r.path=r.path.split("%3A").join(":")))),n.reference!=="suffix"&&r.scheme&&o.push(r.scheme,":");let i=wk(r);if(i!==void 0&&(n.reference!=="suffix"&&o.push("//"),o.push(i),r.path&&r.path[0]!=="/"&&o.push("/")),r.path!==void 0){let a=r.path;!n.absolutePath&&(!s||!s.absolutePath)&&(a=fo(a)),i===void 0&&a[0]==="/"&&a[1]==="/"&&(a="/%2F"+a.slice(2)),o.push(a)}return r.query!==void 0&&o.push("?",r.query),r.fragment!==void 0&&o.push("#",r.fragment),o.join("")}var Ik=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function At(t,e){let r=Object.assign({},e),n={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},o=!1;r.reference==="suffix"&&(r.scheme?t=r.scheme+":"+t:t="//"+t);let s=t.match(Ik);if(s){if(n.scheme=s[1],n.userinfo=s[3],n.host=s[4],n.port=parseInt(s[5],10),n.path=s[6]||"",n.query=s[7],n.fragment=s[8],isNaN(n.port)&&(n.port=s[5]),n.host)if(kk(n.host)===!1){let c=$k(n.host);n.host=c.host.toLowerCase(),o=c.isIPV6}else o=!0;n.scheme===void 0&&n.userinfo===void 0&&n.host===void 0&&n.port===void 0&&n.query===void 0&&!n.path?n.reference="same-document":n.scheme===void 0?n.reference="relative":n.fragment===void 0?n.reference="absolute":n.reference="uri",r.reference&&r.reference!=="suffix"&&r.reference!==n.reference&&(n.error=n.error||"URI is not a "+r.reference+" reference.");let i=kh(r.scheme||n.scheme);if(!r.unicodeSupport&&(!i||!i.unicodeSupport)&&n.host&&(r.domainHost||i&&i.domainHost)&&o===!1&&Sk(n.host))try{n.host=URL.domainToASCII(n.host.toLowerCase())}catch(a){n.error=n.error||"Host's domain name can not be converted to ASCII: "+a}(!i||i&&!i.skipNormalize)&&(t.indexOf("%")!==-1&&(n.scheme!==void 0&&(n.scheme=unescape(n.scheme)),n.host!==void 0&&(n.host=unescape(n.host))),n.path&&(n.path=escape(unescape(n.path))),n.fragment&&(n.fragment=encodeURI(decodeURIComponent(n.fragment)))),i&&i.parse&&i.parse(n,r)}else n.error=n.error||"URI can not be parsed.";return n}var il={SCHEMES:Tk,normalize:Pk,resolve:zk,resolveComponent:Sh,equal:Ek,serialize:$t,parse:At};Ws.exports=il;Ws.exports.default=il;Ws.exports.fastUri=il});var zh=T(al=>{"use strict";Object.defineProperty(al,"__esModule",{value:!0});var Ph=Th();Ph.code='require("ajv/dist/runtime/uri").default';al.default=Ph});var Ah=T(ze=>{"use strict";Object.defineProperty(ze,"__esModule",{value:!0});ze.CodeGen=ze.Name=ze.nil=ze.stringify=ze.str=ze._=ze.KeywordCxt=void 0;var Rk=lo();Object.defineProperty(ze,"KeywordCxt",{enumerable:!0,get:function(){return Rk.KeywordCxt}});var pn=F();Object.defineProperty(ze,"_",{enumerable:!0,get:function(){return pn._}});Object.defineProperty(ze,"str",{enumerable:!0,get:function(){return pn.str}});Object.defineProperty(ze,"stringify",{enumerable:!0,get:function(){return pn.stringify}});Object.defineProperty(ze,"nil",{enumerable:!0,get:function(){return pn.nil}});Object.defineProperty(ze,"Name",{enumerable:!0,get:function(){return pn.Name}});Object.defineProperty(ze,"CodeGen",{enumerable:!0,get:function(){return pn.CodeGen}});var Ck=Fs(),jh=po(),jk=Au(),mo=Hs(),Ok=F(),ho=ao(),Xs=io(),ul=ee(),Eh=mh(),Nk=zh(),Oh=(t,e)=>new RegExp(t,e);Oh.code="new RegExp";var Ak=["removeAdditional","useDefaults","coerceTypes"],Zk=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),Mk={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},Dk={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},Ih=200;function qk(t){var e,r,n,o,s,i,a,c,u,l,d,m,h,p,f,g,v,x,$,k,E,M,ve,Xe,te;let Tt=t.strict,Ii=(e=t.code)===null||e===void 0?void 0:e.optimize,vd=Ii===!0||Ii===void 0?1:Ii||0,xd=(n=(r=t.code)===null||r===void 0?void 0:r.regExp)!==null&&n!==void 0?n:Oh,Dy=(o=t.uriResolver)!==null&&o!==void 0?o:Nk.default;return{strictSchema:(i=(s=t.strictSchema)!==null&&s!==void 0?s:Tt)!==null&&i!==void 0?i:!0,strictNumbers:(c=(a=t.strictNumbers)!==null&&a!==void 0?a:Tt)!==null&&c!==void 0?c:!0,strictTypes:(l=(u=t.strictTypes)!==null&&u!==void 0?u:Tt)!==null&&l!==void 0?l:"log",strictTuples:(m=(d=t.strictTuples)!==null&&d!==void 0?d:Tt)!==null&&m!==void 0?m:"log",strictRequired:(p=(h=t.strictRequired)!==null&&h!==void 0?h:Tt)!==null&&p!==void 0?p:!1,code:t.code?{...t.code,optimize:vd,regExp:xd}:{optimize:vd,regExp:xd},loopRequired:(f=t.loopRequired)!==null&&f!==void 0?f:Ih,loopEnum:(g=t.loopEnum)!==null&&g!==void 0?g:Ih,meta:(v=t.meta)!==null&&v!==void 0?v:!0,messages:(x=t.messages)!==null&&x!==void 0?x:!0,inlineRefs:($=t.inlineRefs)!==null&&$!==void 0?$:!0,schemaId:(k=t.schemaId)!==null&&k!==void 0?k:"$id",addUsedSchema:(E=t.addUsedSchema)!==null&&E!==void 0?E:!0,validateSchema:(M=t.validateSchema)!==null&&M!==void 0?M:!0,validateFormats:(ve=t.validateFormats)!==null&&ve!==void 0?ve:!0,unicodeRegExp:(Xe=t.unicodeRegExp)!==null&&Xe!==void 0?Xe:!0,int32range:(te=t.int32range)!==null&&te!==void 0?te:!0,uriResolver:Dy}}var go=class{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...qk(e)};let{es5:r,lines:n}=this.opts.code;this.scope=new Ok.ValueScope({scope:{},prefixes:Zk,es5:r,lines:n}),this.logger=Hk(e.logger);let o=e.validateFormats;e.validateFormats=!1,this.RULES=(0,jk.getRules)(),Rh.call(this,Mk,e,"NOT SUPPORTED"),Rh.call(this,Dk,e,"DEPRECATED","warn"),this._metaOpts=Fk.call(this),e.formats&&Uk.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&Vk.call(this,e.keywords),typeof e.meta=="object"&&this.addMetaSchema(e.meta),Lk.call(this),e.validateFormats=o}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:e,meta:r,schemaId:n}=this.opts,o=Eh;n==="id"&&(o={...Eh},o.id=o.$id,delete o.$id),r&&e&&this.addMetaSchema(o,o[n],!1)}defaultMeta(){let{meta:e,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof e=="object"?e[r]||e:void 0}validate(e,r){let n;if(typeof e=="string"){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);let o=n(r);return"$async"in n||(this.errors=n.errors),o}compile(e,r){let n=this._addSchema(e,r);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:n}=this.opts;return o.call(this,e,r);async function o(l,d){await s.call(this,l.$schema);let m=this._addSchema(l,d);return m.validate||i.call(this,m)}async function s(l){l&&!this.getSchema(l)&&await o.call(this,{$ref:l},!0)}async function i(l){try{return this._compileSchemaEnv(l)}catch(d){if(!(d instanceof jh.default))throw d;return a.call(this,d),await c.call(this,d.missingSchema),i.call(this,l)}}function a({missingSchema:l,missingRef:d}){if(this.refs[l])throw new Error(`AnySchema ${l} is loaded but ${d} cannot be resolved`)}async function c(l){let d=await u.call(this,l);this.refs[l]||await s.call(this,d.$schema),this.refs[l]||this.addSchema(d,l,r)}async function u(l){let d=this._loading[l];if(d)return d;try{return await(this._loading[l]=n(l))}finally{delete this._loading[l]}}}addSchema(e,r,n,o=this.opts.validateSchema){if(Array.isArray(e)){for(let i of e)this.addSchema(i,void 0,n,o);return this}let s;if(typeof e=="object"){let{schemaId:i}=this.opts;if(s=e[i],s!==void 0&&typeof s!="string")throw new Error(`schema ${i} must be string`)}return r=(0,ho.normalizeId)(r||s),this._checkUnique(r),this.schemas[r]=this._addSchema(e,n,r,o,!0),this}addMetaSchema(e,r,n=this.opts.validateSchema){return this.addSchema(e,r,!0,n),this}validateSchema(e,r){if(typeof e=="boolean")return!0;let n;if(n=e.$schema,n!==void 0&&typeof n!="string")throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let o=this.validate(n,e);if(!o&&r){let s="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(s);else throw new Error(s)}return o}getSchema(e){let r;for(;typeof(r=Ch.call(this,e))=="string";)e=r;if(r===void 0){let{schemaId:n}=this.opts,o=new mo.SchemaEnv({schema:{},schemaId:n});if(r=mo.resolveSchema.call(this,o,e),!r)return;this.refs[e]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=Ch.call(this,e);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{let r=e;this._cache.delete(r);let n=e[this.opts.schemaId];return n&&(n=(0,ho.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(let r of e)this.addKeyword(r);return this}addKeyword(e,r){let n;if(typeof e=="string")n=e,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=n);else if(typeof e=="object"&&r===void 0){if(r=e,n=r.keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(Jk.call(this,n,r),!r)return(0,ul.eachItem)(n,s=>cl.call(this,s)),this;Wk.call(this,r);let o={...r,type:(0,Xs.getJSONTypes)(r.type),schemaType:(0,Xs.getJSONTypes)(r.schemaType)};return(0,ul.eachItem)(n,o.type.length===0?s=>cl.call(this,s,o):s=>o.type.forEach(i=>cl.call(this,s,o,i))),this}getKeyword(e){let r=this.RULES.all[e];return typeof r=="object"?r.definition:!!r}removeKeyword(e){let{RULES:r}=this;delete r.keywords[e],delete r.all[e];for(let n of r.rules){let o=n.rules.findIndex(s=>s.keyword===e);o>=0&&n.rules.splice(o,1)}return this}addFormat(e,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[e]=r,this}errorsText(e=this.errors,{separator:r=", ",dataVar:n="data"}={}){return!e||e.length===0?"No errors":e.map(o=>`${n}${o.instancePath} ${o.message}`).reduce((o,s)=>o+r+s)}$dataMetaSchema(e,r){let n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(let o of r){let s=o.split("/").slice(1),i=e;for(let a of s)i=i[a];for(let a in n){let c=n[a];if(typeof c!="object")continue;let{$data:u}=c.definition,l=i[a];u&&l&&(i[a]=Nh(l))}}return e}_removeAllSchemas(e,r){for(let n in e){let o=e[n];(!r||r.test(n))&&(typeof o=="string"?delete e[n]:o&&!o.meta&&(this._cache.delete(o.schema),delete e[n]))}}_addSchema(e,r,n,o=this.opts.validateSchema,s=this.opts.addUsedSchema){let i,{schemaId:a}=this.opts;if(typeof e=="object")i=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof e!="boolean")throw new Error("schema must be object or boolean")}let c=this._cache.get(e);if(c!==void 0)return c;n=(0,ho.normalizeId)(i||n);let u=ho.getSchemaRefs.call(this,e,n);return c=new mo.SchemaEnv({schema:e,schemaId:a,meta:r,baseId:n,localRefs:u}),this._cache.set(c.schema,c),s&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=c),o&&this.validateSchema(e,!0),c}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):mo.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){let r=this.opts;this.opts=this._metaOpts;try{mo.compileSchema.call(this,e)}finally{this.opts=r}}};go.ValidationError=Ck.default;go.MissingRefError=jh.default;ze.default=go;function Rh(t,e,r,n="error"){for(let o in t){let s=o;s in e&&this.logger[n](`${r}: option ${o}. ${t[s]}`)}}function Ch(t){return t=(0,ho.normalizeId)(t),this.schemas[t]||this.refs[t]}function Lk(){let t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(let e in t)this.addSchema(t[e],e)}function Uk(){for(let t in this.opts.formats){let e=this.opts.formats[t];e&&this.addFormat(t,e)}}function Vk(t){if(Array.isArray(t)){this.addVocabulary(t);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let e in t){let r=t[e];r.keyword||(r.keyword=e),this.addKeyword(r)}}function Fk(){let t={...this.opts};for(let e of Ak)delete t[e];return t}var Kk={log(){},warn(){},error(){}};function Hk(t){if(t===!1)return Kk;if(t===void 0)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}var Bk=/^[a-z_$][a-z0-9_$:-]*$/i;function Jk(t,e){let{RULES:r}=this;if((0,ul.eachItem)(t,n=>{if(r.keywords[n])throw new Error(`Keyword ${n} is already defined`);if(!Bk.test(n))throw new Error(`Keyword ${n} has invalid name`)}),!!e&&e.$data&&!("code"in e||"validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function cl(t,e,r){var n;let o=e?.post;if(r&&o)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:s}=this,i=o?s.post:s.rules.find(({type:c})=>c===r);if(i||(i={type:r,rules:[]},s.rules.push(i)),s.keywords[t]=!0,!e)return;let a={keyword:t,definition:{...e,type:(0,Xs.getJSONTypes)(e.type),schemaType:(0,Xs.getJSONTypes)(e.schemaType)}};e.before?Gk.call(this,i,a,e.before):i.rules.push(a),s.all[t]=a,(n=e.implements)===null||n===void 0||n.forEach(c=>this.addKeyword(c))}function Gk(t,e,r){let n=t.rules.findIndex(o=>o.keyword===r);n>=0?t.rules.splice(n,0,e):(t.rules.push(e),this.logger.warn(`rule ${r} is not defined`))}function Wk(t){let{metaSchema:e}=t;e!==void 0&&(t.$data&&this.opts.$data&&(e=Nh(e)),t.validateSchema=this.compile(e,!0))}var Xk={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function Nh(t){return{anyOf:[t,Xk]}}});var Zh=T(ll=>{"use strict";Object.defineProperty(ll,"__esModule",{value:!0});var Yk={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};ll.default=Yk});var Lh=T(Ar=>{"use strict";Object.defineProperty(Ar,"__esModule",{value:!0});Ar.callRef=Ar.getValidate=void 0;var Qk=po(),Mh=ot(),Be=F(),fn=Ot(),Dh=Hs(),Ys=ee(),eS={keyword:"$ref",schemaType:"string",code(t){let{gen:e,schema:r,it:n}=t,{baseId:o,schemaEnv:s,validateName:i,opts:a,self:c}=n,{root:u}=s;if((r==="#"||r==="#/")&&o===u.baseId)return d();let l=Dh.resolveRef.call(c,u,o,r);if(l===void 0)throw new Qk.default(n.opts.uriResolver,o,r);if(l instanceof Dh.SchemaEnv)return m(l);return h(l);function d(){if(s===u)return Qs(t,i,s,s.$async);let p=e.scopeValue("root",{ref:u});return Qs(t,(0,Be._)`${p}.validate`,u,u.$async)}function m(p){let f=qh(t,p);Qs(t,f,p,p.$async)}function h(p){let f=e.scopeValue("schema",a.code.source===!0?{ref:p,code:(0,Be.stringify)(p)}:{ref:p}),g=e.name("valid"),v=t.subschema({schema:p,dataTypes:[],schemaPath:Be.nil,topSchemaRef:f,errSchemaPath:r},g);t.mergeEvaluated(v),t.ok(g)}}};function qh(t,e){let{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,Be._)`${r.scopeValue("wrapper",{ref:e})}.validate`}Ar.getValidate=qh;function Qs(t,e,r,n){let{gen:o,it:s}=t,{allErrors:i,schemaEnv:a,opts:c}=s,u=c.passContext?fn.default.this:Be.nil;n?l():d();function l(){if(!a.$async)throw new Error("async schema referenced by sync schema");let p=o.let("valid");o.try(()=>{o.code((0,Be._)`await ${(0,Mh.callValidateCode)(t,e,u)}`),h(e),i||o.assign(p,!0)},f=>{o.if((0,Be._)`!(${f} instanceof ${s.ValidationError})`,()=>o.throw(f)),m(f),i||o.assign(p,!1)}),t.ok(p)}function d(){t.result((0,Mh.callValidateCode)(t,e,u),()=>h(e),()=>m(e))}function m(p){let f=(0,Be._)`${p}.errors`;o.assign(fn.default.vErrors,(0,Be._)`${fn.default.vErrors} === null ? ${f} : ${fn.default.vErrors}.concat(${f})`),o.assign(fn.default.errors,(0,Be._)`${fn.default.vErrors}.length`)}function h(p){var f;if(!s.opts.unevaluated)return;let g=(f=r?.validate)===null||f===void 0?void 0:f.evaluated;if(s.props!==!0)if(g&&!g.dynamicProps)g.props!==void 0&&(s.props=Ys.mergeEvaluated.props(o,g.props,s.props));else{let v=o.var("props",(0,Be._)`${p}.evaluated.props`);s.props=Ys.mergeEvaluated.props(o,v,s.props,Be.Name)}if(s.items!==!0)if(g&&!g.dynamicItems)g.items!==void 0&&(s.items=Ys.mergeEvaluated.items(o,g.items,s.items));else{let v=o.var("items",(0,Be._)`${p}.evaluated.items`);s.items=Ys.mergeEvaluated.items(o,v,s.items,Be.Name)}}}Ar.callRef=Qs;Ar.default=eS});var Uh=T(dl=>{"use strict";Object.defineProperty(dl,"__esModule",{value:!0});var tS=Zh(),rS=Lh(),nS=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",tS.default,rS.default];dl.default=nS});var Vh=T(pl=>{"use strict";Object.defineProperty(pl,"__esModule",{value:!0});var ei=F(),rr=ei.operators,ti={maximum:{okStr:"<=",ok:rr.LTE,fail:rr.GT},minimum:{okStr:">=",ok:rr.GTE,fail:rr.LT},exclusiveMaximum:{okStr:"<",ok:rr.LT,fail:rr.GTE},exclusiveMinimum:{okStr:">",ok:rr.GT,fail:rr.LTE}},oS={message:({keyword:t,schemaCode:e})=>(0,ei.str)`must be ${ti[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,ei._)`{comparison: ${ti[t].okStr}, limit: ${e}}`},sS={keyword:Object.keys(ti),type:"number",schemaType:"number",$data:!0,error:oS,code(t){let{keyword:e,data:r,schemaCode:n}=t;t.fail$data((0,ei._)`${r} ${ti[e].fail} ${n} || isNaN(${r})`)}};pl.default=sS});var Fh=T(fl=>{"use strict";Object.defineProperty(fl,"__esModule",{value:!0});var yo=F(),iS={message:({schemaCode:t})=>(0,yo.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,yo._)`{multipleOf: ${t}}`},aS={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:iS,code(t){let{gen:e,data:r,schemaCode:n,it:o}=t,s=o.opts.multipleOfPrecision,i=e.let("res"),a=s?(0,yo._)`Math.abs(Math.round(${i}) - ${i}) > 1e-${s}`:(0,yo._)`${i} !== parseInt(${i})`;t.fail$data((0,yo._)`(${n} === 0 || (${i} = ${r}/${n}, ${a}))`)}};fl.default=aS});var Hh=T(ml=>{"use strict";Object.defineProperty(ml,"__esModule",{value:!0});function Kh(t){let e=t.length,r=0,n=0,o;for(;n<e;)r++,o=t.charCodeAt(n++),o>=55296&&o<=56319&&n<e&&(o=t.charCodeAt(n),(o&64512)===56320&&n++);return r}ml.default=Kh;Kh.code='require("ajv/dist/runtime/ucs2length").default'});var Bh=T(hl=>{"use strict";Object.defineProperty(hl,"__esModule",{value:!0});var Zr=F(),cS=ee(),uS=Hh(),lS={message({keyword:t,schemaCode:e}){let r=t==="maxLength"?"more":"fewer";return(0,Zr.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,Zr._)`{limit: ${t}}`},dS={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:lS,code(t){let{keyword:e,data:r,schemaCode:n,it:o}=t,s=e==="maxLength"?Zr.operators.GT:Zr.operators.LT,i=o.opts.unicode===!1?(0,Zr._)`${r}.length`:(0,Zr._)`${(0,cS.useFunc)(t.gen,uS.default)}(${r})`;t.fail$data((0,Zr._)`${i} ${s} ${n}`)}};hl.default=dS});var Jh=T(gl=>{"use strict";Object.defineProperty(gl,"__esModule",{value:!0});var pS=ot(),ri=F(),fS={message:({schemaCode:t})=>(0,ri.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,ri._)`{pattern: ${t}}`},mS={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:fS,code(t){let{data:e,$data:r,schema:n,schemaCode:o,it:s}=t,i=s.opts.unicodeRegExp?"u":"",a=r?(0,ri._)`(new RegExp(${o}, ${i}))`:(0,pS.usePattern)(t,n);t.fail$data((0,ri._)`!${a}.test(${e})`)}};gl.default=mS});var Gh=T(yl=>{"use strict";Object.defineProperty(yl,"__esModule",{value:!0});var _o=F(),hS={message({keyword:t,schemaCode:e}){let r=t==="maxProperties"?"more":"fewer";return(0,_o.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,_o._)`{limit: ${t}}`},gS={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:hS,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxProperties"?_o.operators.GT:_o.operators.LT;t.fail$data((0,_o._)`Object.keys(${r}).length ${o} ${n}`)}};yl.default=gS});var Wh=T(_l=>{"use strict";Object.defineProperty(_l,"__esModule",{value:!0});var vo=ot(),xo=F(),yS=ee(),_S={message:({params:{missingProperty:t}})=>(0,xo.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,xo._)`{missingProperty: ${t}}`},vS={keyword:"required",type:"object",schemaType:"array",$data:!0,error:_S,code(t){let{gen:e,schema:r,schemaCode:n,data:o,$data:s,it:i}=t,{opts:a}=i;if(!s&&r.length===0)return;let c=r.length>=a.loopRequired;if(i.allErrors?u():l(),a.strictRequired){let h=t.parentSchema.properties,{definedProperties:p}=t.it;for(let f of r)if(h?.[f]===void 0&&!p.has(f)){let g=i.schemaEnv.baseId+i.errSchemaPath,v=`required property "${f}" is not defined at "${g}" (strictRequired)`;(0,yS.checkStrictMode)(i,v,i.opts.strictRequired)}}function u(){if(c||s)t.block$data(xo.nil,d);else for(let h of r)(0,vo.checkReportMissingProp)(t,h)}function l(){let h=e.let("missing");if(c||s){let p=e.let("valid",!0);t.block$data(p,()=>m(h,p)),t.ok(p)}else e.if((0,vo.checkMissingProp)(t,r,h)),(0,vo.reportMissingProp)(t,h),e.else()}function d(){e.forOf("prop",n,h=>{t.setParams({missingProperty:h}),e.if((0,vo.noPropertyInData)(e,o,h,a.ownProperties),()=>t.error())})}function m(h,p){t.setParams({missingProperty:h}),e.forOf(h,n,()=>{e.assign(p,(0,vo.propertyInData)(e,o,h,a.ownProperties)),e.if((0,xo.not)(p),()=>{t.error(),e.break()})},xo.nil)}}};_l.default=vS});var Xh=T(vl=>{"use strict";Object.defineProperty(vl,"__esModule",{value:!0});var bo=F(),xS={message({keyword:t,schemaCode:e}){let r=t==="maxItems"?"more":"fewer";return(0,bo.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,bo._)`{limit: ${t}}`},bS={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:xS,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxItems"?bo.operators.GT:bo.operators.LT;t.fail$data((0,bo._)`${r}.length ${o} ${n}`)}};vl.default=bS});var ni=T(xl=>{"use strict";Object.defineProperty(xl,"__esModule",{value:!0});var Yh=Fu();Yh.code='require("ajv/dist/runtime/equal").default';xl.default=Yh});var Qh=T($l=>{"use strict";Object.defineProperty($l,"__esModule",{value:!0});var bl=io(),Ee=F(),$S=ee(),wS=ni(),kS={message:({params:{i:t,j:e}})=>(0,Ee.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,Ee._)`{i: ${t}, j: ${e}}`},SS={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:kS,code(t){let{gen:e,data:r,$data:n,schema:o,parentSchema:s,schemaCode:i,it:a}=t;if(!n&&!o)return;let c=e.let("valid"),u=s.items?(0,bl.getSchemaTypes)(s.items):[];t.block$data(c,l,(0,Ee._)`${i} === false`),t.ok(c);function l(){let p=e.let("i",(0,Ee._)`${r}.length`),f=e.let("j");t.setParams({i:p,j:f}),e.assign(c,!0),e.if((0,Ee._)`${p} > 1`,()=>(d()?m:h)(p,f))}function d(){return u.length>0&&!u.some(p=>p==="object"||p==="array")}function m(p,f){let g=e.name("item"),v=(0,bl.checkDataTypes)(u,g,a.opts.strictNumbers,bl.DataType.Wrong),x=e.const("indices",(0,Ee._)`{}`);e.for((0,Ee._)`;${p}--;`,()=>{e.let(g,(0,Ee._)`${r}[${p}]`),e.if(v,(0,Ee._)`continue`),u.length>1&&e.if((0,Ee._)`typeof ${g} == "string"`,(0,Ee._)`${g} += "_"`),e.if((0,Ee._)`typeof ${x}[${g}] == "number"`,()=>{e.assign(f,(0,Ee._)`${x}[${g}]`),t.error(),e.assign(c,!1).break()}).code((0,Ee._)`${x}[${g}] = ${p}`)})}function h(p,f){let g=(0,$S.useFunc)(e,wS.default),v=e.name("outer");e.label(v).for((0,Ee._)`;${p}--;`,()=>e.for((0,Ee._)`${f} = ${p}; ${f}--;`,()=>e.if((0,Ee._)`${g}(${r}[${p}], ${r}[${f}])`,()=>{t.error(),e.assign(c,!1).break(v)})))}}};$l.default=SS});var eg=T(kl=>{"use strict";Object.defineProperty(kl,"__esModule",{value:!0});var wl=F(),TS=ee(),PS=ni(),zS={message:"must be equal to constant",params:({schemaCode:t})=>(0,wl._)`{allowedValue: ${t}}`},ES={keyword:"const",$data:!0,error:zS,code(t){let{gen:e,data:r,$data:n,schemaCode:o,schema:s}=t;n||s&&typeof s=="object"?t.fail$data((0,wl._)`!${(0,TS.useFunc)(e,PS.default)}(${r}, ${o})`):t.fail((0,wl._)`${s} !== ${r}`)}};kl.default=ES});var tg=T(Sl=>{"use strict";Object.defineProperty(Sl,"__esModule",{value:!0});var $o=F(),IS=ee(),RS=ni(),CS={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,$o._)`{allowedValues: ${t}}`},jS={keyword:"enum",schemaType:"array",$data:!0,error:CS,code(t){let{gen:e,data:r,$data:n,schema:o,schemaCode:s,it:i}=t;if(!n&&o.length===0)throw new Error("enum must have non-empty array");let a=o.length>=i.opts.loopEnum,c,u=()=>c??(c=(0,IS.useFunc)(e,RS.default)),l;if(a||n)l=e.let("valid"),t.block$data(l,d);else{if(!Array.isArray(o))throw new Error("ajv implementation error");let h=e.const("vSchema",s);l=(0,$o.or)(...o.map((p,f)=>m(h,f)))}t.pass(l);function d(){e.assign(l,!1),e.forOf("v",s,h=>e.if((0,$o._)`${u()}(${r}, ${h})`,()=>e.assign(l,!0).break()))}function m(h,p){let f=o[p];return typeof f=="object"&&f!==null?(0,$o._)`${u()}(${r}, ${h}[${p}])`:(0,$o._)`${r} === ${f}`}}};Sl.default=jS});var rg=T(Tl=>{"use strict";Object.defineProperty(Tl,"__esModule",{value:!0});var OS=Vh(),NS=Fh(),AS=Bh(),ZS=Jh(),MS=Gh(),DS=Wh(),qS=Xh(),LS=Qh(),US=eg(),VS=tg(),FS=[OS.default,NS.default,AS.default,ZS.default,MS.default,DS.default,qS.default,LS.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},US.default,VS.default];Tl.default=FS});var zl=T(wo=>{"use strict";Object.defineProperty(wo,"__esModule",{value:!0});wo.validateAdditionalItems=void 0;var Mr=F(),Pl=ee(),KS={message:({params:{len:t}})=>(0,Mr.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,Mr._)`{limit: ${t}}`},HS={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:KS,code(t){let{parentSchema:e,it:r}=t,{items:n}=e;if(!Array.isArray(n)){(0,Pl.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}ng(t,n)}};function ng(t,e){let{gen:r,schema:n,data:o,keyword:s,it:i}=t;i.items=!0;let a=r.const("len",(0,Mr._)`${o}.length`);if(n===!1)t.setParams({len:e.length}),t.pass((0,Mr._)`${a} <= ${e.length}`);else if(typeof n=="object"&&!(0,Pl.alwaysValidSchema)(i,n)){let u=r.var("valid",(0,Mr._)`${a} <= ${e.length}`);r.if((0,Mr.not)(u),()=>c(u)),t.ok(u)}function c(u){r.forRange("i",e.length,a,l=>{t.subschema({keyword:s,dataProp:l,dataPropType:Pl.Type.Num},u),i.allErrors||r.if((0,Mr.not)(u),()=>r.break())})}}wo.validateAdditionalItems=ng;wo.default=HS});var El=T(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});ko.validateTuple=void 0;var og=F(),oi=ee(),BS=ot(),JS={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){let{schema:e,it:r}=t;if(Array.isArray(e))return sg(t,"additionalItems",e);r.items=!0,!(0,oi.alwaysValidSchema)(r,e)&&t.ok((0,BS.validateArray)(t))}};function sg(t,e,r=t.schema){let{gen:n,parentSchema:o,data:s,keyword:i,it:a}=t;l(o),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=oi.mergeEvaluated.items(n,r.length,a.items));let c=n.name("valid"),u=n.const("len",(0,og._)`${s}.length`);r.forEach((d,m)=>{(0,oi.alwaysValidSchema)(a,d)||(n.if((0,og._)`${u} > ${m}`,()=>t.subschema({keyword:i,schemaProp:m,dataProp:m},c)),t.ok(c))});function l(d){let{opts:m,errSchemaPath:h}=a,p=r.length,f=p===d.minItems&&(p===d.maxItems||d[e]===!1);if(m.strictTuples&&!f){let g=`"${i}" is ${p}-tuple, but minItems or maxItems/${e} are not specified or different at path "${h}"`;(0,oi.checkStrictMode)(a,g,m.strictTuples)}}}ko.validateTuple=sg;ko.default=JS});var ig=T(Il=>{"use strict";Object.defineProperty(Il,"__esModule",{value:!0});var GS=El(),WS={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,GS.validateTuple)(t,"items")};Il.default=WS});var cg=T(Rl=>{"use strict";Object.defineProperty(Rl,"__esModule",{value:!0});var ag=F(),XS=ee(),YS=ot(),QS=zl(),eT={message:({params:{len:t}})=>(0,ag.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,ag._)`{limit: ${t}}`},tT={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:eT,code(t){let{schema:e,parentSchema:r,it:n}=t,{prefixItems:o}=r;n.items=!0,!(0,XS.alwaysValidSchema)(n,e)&&(o?(0,QS.validateAdditionalItems)(t,o):t.ok((0,YS.validateArray)(t)))}};Rl.default=tT});var ug=T(Cl=>{"use strict";Object.defineProperty(Cl,"__esModule",{value:!0});var it=F(),si=ee(),rT={message:({params:{min:t,max:e}})=>e===void 0?(0,it.str)`must contain at least ${t} valid item(s)`:(0,it.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,it._)`{minContains: ${t}}`:(0,it._)`{minContains: ${t}, maxContains: ${e}}`},nT={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:rT,code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:s}=t,i,a,{minContains:c,maxContains:u}=n;s.opts.next?(i=c===void 0?1:c,a=u):i=1;let l=e.const("len",(0,it._)`${o}.length`);if(t.setParams({min:i,max:a}),a===void 0&&i===0){(0,si.checkStrictMode)(s,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&i>a){(0,si.checkStrictMode)(s,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,si.alwaysValidSchema)(s,r)){let f=(0,it._)`${l} >= ${i}`;a!==void 0&&(f=(0,it._)`${f} && ${l} <= ${a}`),t.pass(f);return}s.items=!0;let d=e.name("valid");a===void 0&&i===1?h(d,()=>e.if(d,()=>e.break())):i===0?(e.let(d,!0),a!==void 0&&e.if((0,it._)`${o}.length > 0`,m)):(e.let(d,!1),m()),t.result(d,()=>t.reset());function m(){let f=e.name("_valid"),g=e.let("count",0);h(f,()=>e.if(f,()=>p(g)))}function h(f,g){e.forRange("i",0,l,v=>{t.subschema({keyword:"contains",dataProp:v,dataPropType:si.Type.Num,compositeRule:!0},f),g()})}function p(f){e.code((0,it._)`${f}++`),a===void 0?e.if((0,it._)`${f} >= ${i}`,()=>e.assign(d,!0).break()):(e.if((0,it._)`${f} > ${a}`,()=>e.assign(d,!1).break()),i===1?e.assign(d,!0):e.if((0,it._)`${f} >= ${i}`,()=>e.assign(d,!0)))}}};Cl.default=nT});var pg=T(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.validateSchemaDeps=wt.validatePropertyDeps=wt.error=void 0;var jl=F(),oT=ee(),So=ot();wt.error={message:({params:{property:t,depsCount:e,deps:r}})=>{let n=e===1?"property":"properties";return(0,jl.str)`must have ${n} ${r} when property ${t} is present`},params:({params:{property:t,depsCount:e,deps:r,missingProperty:n}})=>(0,jl._)`{property: ${t},
    missingProperty: ${n},
    depsCount: ${e},
    deps: ${r}}`};var sT={keyword:"dependencies",type:"object",schemaType:"object",error:wt.error,code(t){let[e,r]=iT(t);lg(t,e),dg(t,r)}};function iT({schema:t}){let e={},r={};for(let n in t){if(n==="__proto__")continue;let o=Array.isArray(t[n])?e:r;o[n]=t[n]}return[e,r]}function lg(t,e=t.schema){let{gen:r,data:n,it:o}=t;if(Object.keys(e).length===0)return;let s=r.let("missing");for(let i in e){let a=e[i];if(a.length===0)continue;let c=(0,So.propertyInData)(r,n,i,o.opts.ownProperties);t.setParams({property:i,depsCount:a.length,deps:a.join(", ")}),o.allErrors?r.if(c,()=>{for(let u of a)(0,So.checkReportMissingProp)(t,u)}):(r.if((0,jl._)`${c} && (${(0,So.checkMissingProp)(t,a,s)})`),(0,So.reportMissingProp)(t,s),r.else())}}wt.validatePropertyDeps=lg;function dg(t,e=t.schema){let{gen:r,data:n,keyword:o,it:s}=t,i=r.name("valid");for(let a in e)(0,oT.alwaysValidSchema)(s,e[a])||(r.if((0,So.propertyInData)(r,n,a,s.opts.ownProperties),()=>{let c=t.subschema({keyword:o,schemaProp:a},i);t.mergeValidEvaluated(c,i)},()=>r.var(i,!0)),t.ok(i))}wt.validateSchemaDeps=dg;wt.default=sT});var mg=T(Ol=>{"use strict";Object.defineProperty(Ol,"__esModule",{value:!0});var fg=F(),aT=ee(),cT={message:"property name must be valid",params:({params:t})=>(0,fg._)`{propertyName: ${t.propertyName}}`},uT={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:cT,code(t){let{gen:e,schema:r,data:n,it:o}=t;if((0,aT.alwaysValidSchema)(o,r))return;let s=e.name("valid");e.forIn("key",n,i=>{t.setParams({propertyName:i}),t.subschema({keyword:"propertyNames",data:i,dataTypes:["string"],propertyName:i,compositeRule:!0},s),e.if((0,fg.not)(s),()=>{t.error(!0),o.allErrors||e.break()})}),t.ok(s)}};Ol.default=uT});var Al=T(Nl=>{"use strict";Object.defineProperty(Nl,"__esModule",{value:!0});var ii=ot(),mt=F(),lT=Ot(),ai=ee(),dT={message:"must NOT have additional properties",params:({params:t})=>(0,mt._)`{additionalProperty: ${t.additionalProperty}}`},pT={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:dT,code(t){let{gen:e,schema:r,parentSchema:n,data:o,errsCount:s,it:i}=t;if(!s)throw new Error("ajv implementation error");let{allErrors:a,opts:c}=i;if(i.props=!0,c.removeAdditional!=="all"&&(0,ai.alwaysValidSchema)(i,r))return;let u=(0,ii.allSchemaProperties)(n.properties),l=(0,ii.allSchemaProperties)(n.patternProperties);d(),t.ok((0,mt._)`${s} === ${lT.default.errors}`);function d(){e.forIn("key",o,g=>{!u.length&&!l.length?p(g):e.if(m(g),()=>p(g))})}function m(g){let v;if(u.length>8){let x=(0,ai.schemaRefOrVal)(i,n.properties,"properties");v=(0,ii.isOwnProperty)(e,x,g)}else u.length?v=(0,mt.or)(...u.map(x=>(0,mt._)`${g} === ${x}`)):v=mt.nil;return l.length&&(v=(0,mt.or)(v,...l.map(x=>(0,mt._)`${(0,ii.usePattern)(t,x)}.test(${g})`))),(0,mt.not)(v)}function h(g){e.code((0,mt._)`delete ${o}[${g}]`)}function p(g){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){h(g);return}if(r===!1){t.setParams({additionalProperty:g}),t.error(),a||e.break();return}if(typeof r=="object"&&!(0,ai.alwaysValidSchema)(i,r)){let v=e.name("valid");c.removeAdditional==="failing"?(f(g,v,!1),e.if((0,mt.not)(v),()=>{t.reset(),h(g)})):(f(g,v),a||e.if((0,mt.not)(v),()=>e.break()))}}function f(g,v,x){let $={keyword:"additionalProperties",dataProp:g,dataPropType:ai.Type.Str};x===!1&&Object.assign($,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema($,v)}}};Nl.default=pT});var yg=T(Ml=>{"use strict";Object.defineProperty(Ml,"__esModule",{value:!0});var fT=lo(),hg=ot(),Zl=ee(),gg=Al(),mT={keyword:"properties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:s}=t;s.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&gg.default.code(new fT.KeywordCxt(s,gg.default,"additionalProperties"));let i=(0,hg.allSchemaProperties)(r);for(let d of i)s.definedProperties.add(d);s.opts.unevaluated&&i.length&&s.props!==!0&&(s.props=Zl.mergeEvaluated.props(e,(0,Zl.toHash)(i),s.props));let a=i.filter(d=>!(0,Zl.alwaysValidSchema)(s,r[d]));if(a.length===0)return;let c=e.name("valid");for(let d of a)u(d)?l(d):(e.if((0,hg.propertyInData)(e,o,d,s.opts.ownProperties)),l(d),s.allErrors||e.else().var(c,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(c);function u(d){return s.opts.useDefaults&&!s.compositeRule&&r[d].default!==void 0}function l(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},c)}}};Ml.default=mT});var bg=T(Dl=>{"use strict";Object.defineProperty(Dl,"__esModule",{value:!0});var _g=ot(),ci=F(),vg=ee(),xg=ee(),hT={keyword:"patternProperties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,data:n,parentSchema:o,it:s}=t,{opts:i}=s,a=(0,_g.allSchemaProperties)(r),c=a.filter(f=>(0,vg.alwaysValidSchema)(s,r[f]));if(a.length===0||c.length===a.length&&(!s.opts.unevaluated||s.props===!0))return;let u=i.strictSchema&&!i.allowMatchingProperties&&o.properties,l=e.name("valid");s.props!==!0&&!(s.props instanceof ci.Name)&&(s.props=(0,xg.evaluatedPropsToName)(e,s.props));let{props:d}=s;m();function m(){for(let f of a)u&&h(f),s.allErrors?p(f):(e.var(l,!0),p(f),e.if(l))}function h(f){for(let g in u)new RegExp(f).test(g)&&(0,vg.checkStrictMode)(s,`property ${g} matches pattern ${f} (use allowMatchingProperties)`)}function p(f){e.forIn("key",n,g=>{e.if((0,ci._)`${(0,_g.usePattern)(t,f)}.test(${g})`,()=>{let v=c.includes(f);v||t.subschema({keyword:"patternProperties",schemaProp:f,dataProp:g,dataPropType:xg.Type.Str},l),s.opts.unevaluated&&d!==!0?e.assign((0,ci._)`${d}[${g}]`,!0):!v&&!s.allErrors&&e.if((0,ci.not)(l),()=>e.break())})})}}};Dl.default=hT});var $g=T(ql=>{"use strict";Object.defineProperty(ql,"__esModule",{value:!0});var gT=ee(),yT={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){let{gen:e,schema:r,it:n}=t;if((0,gT.alwaysValidSchema)(n,r)){t.fail();return}let o=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),t.failResult(o,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};ql.default=yT});var wg=T(Ll=>{"use strict";Object.defineProperty(Ll,"__esModule",{value:!0});var _T=ot(),vT={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:_T.validateUnion,error:{message:"must match a schema in anyOf"}};Ll.default=vT});var kg=T(Ul=>{"use strict";Object.defineProperty(Ul,"__esModule",{value:!0});var ui=F(),xT=ee(),bT={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,ui._)`{passingSchemas: ${t.passing}}`},$T={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:bT,code(t){let{gen:e,schema:r,parentSchema:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(o.opts.discriminator&&n.discriminator)return;let s=r,i=e.let("valid",!1),a=e.let("passing",null),c=e.name("_valid");t.setParams({passing:a}),e.block(u),t.result(i,()=>t.reset(),()=>t.error(!0));function u(){s.forEach((l,d)=>{let m;(0,xT.alwaysValidSchema)(o,l)?e.var(c,!0):m=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},c),d>0&&e.if((0,ui._)`${c} && ${i}`).assign(i,!1).assign(a,(0,ui._)`[${a}, ${d}]`).else(),e.if(c,()=>{e.assign(i,!0),e.assign(a,d),m&&t.mergeEvaluated(m,ui.Name)})})}}};Ul.default=$T});var Sg=T(Vl=>{"use strict";Object.defineProperty(Vl,"__esModule",{value:!0});var wT=ee(),kT={keyword:"allOf",schemaType:"array",code(t){let{gen:e,schema:r,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");let o=e.name("valid");r.forEach((s,i)=>{if((0,wT.alwaysValidSchema)(n,s))return;let a=t.subschema({keyword:"allOf",schemaProp:i},o);t.ok(o),t.mergeEvaluated(a)})}};Vl.default=kT});var zg=T(Fl=>{"use strict";Object.defineProperty(Fl,"__esModule",{value:!0});var li=F(),Pg=ee(),ST={message:({params:t})=>(0,li.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,li._)`{failingKeyword: ${t.ifClause}}`},TT={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:ST,code(t){let{gen:e,parentSchema:r,it:n}=t;r.then===void 0&&r.else===void 0&&(0,Pg.checkStrictMode)(n,'"if" without "then" and "else" is ignored');let o=Tg(n,"then"),s=Tg(n,"else");if(!o&&!s)return;let i=e.let("valid",!0),a=e.name("_valid");if(c(),t.reset(),o&&s){let l=e.let("ifClause");t.setParams({ifClause:l}),e.if(a,u("then",l),u("else",l))}else o?e.if(a,u("then")):e.if((0,li.not)(a),u("else"));t.pass(i,()=>t.error(!0));function c(){let l=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);t.mergeEvaluated(l)}function u(l,d){return()=>{let m=t.subschema({keyword:l},a);e.assign(i,a),t.mergeValidEvaluated(m,i),d?e.assign(d,(0,li._)`${l}`):t.setParams({ifClause:l})}}}};function Tg(t,e){let r=t.schema[e];return r!==void 0&&!(0,Pg.alwaysValidSchema)(t,r)}Fl.default=TT});var Eg=T(Kl=>{"use strict";Object.defineProperty(Kl,"__esModule",{value:!0});var PT=ee(),zT={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,PT.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};Kl.default=zT});var Ig=T(Hl=>{"use strict";Object.defineProperty(Hl,"__esModule",{value:!0});var ET=zl(),IT=ig(),RT=El(),CT=cg(),jT=ug(),OT=pg(),NT=mg(),AT=Al(),ZT=yg(),MT=bg(),DT=$g(),qT=wg(),LT=kg(),UT=Sg(),VT=zg(),FT=Eg();function KT(t=!1){let e=[DT.default,qT.default,LT.default,UT.default,VT.default,FT.default,NT.default,AT.default,OT.default,ZT.default,MT.default];return t?e.push(IT.default,CT.default):e.push(ET.default,RT.default),e.push(jT.default),e}Hl.default=KT});var Rg=T(Bl=>{"use strict";Object.defineProperty(Bl,"__esModule",{value:!0});var xe=F(),HT={message:({schemaCode:t})=>(0,xe.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,xe._)`{format: ${t}}`},BT={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:HT,code(t,e){let{gen:r,data:n,$data:o,schema:s,schemaCode:i,it:a}=t,{opts:c,errSchemaPath:u,schemaEnv:l,self:d}=a;if(!c.validateFormats)return;o?m():h();function m(){let p=r.scopeValue("formats",{ref:d.formats,code:c.code.formats}),f=r.const("fDef",(0,xe._)`${p}[${i}]`),g=r.let("fType"),v=r.let("format");r.if((0,xe._)`typeof ${f} == "object" && !(${f} instanceof RegExp)`,()=>r.assign(g,(0,xe._)`${f}.type || "string"`).assign(v,(0,xe._)`${f}.validate`),()=>r.assign(g,(0,xe._)`"string"`).assign(v,f)),t.fail$data((0,xe.or)(x(),$()));function x(){return c.strictSchema===!1?xe.nil:(0,xe._)`${i} && !${v}`}function $(){let k=l.$async?(0,xe._)`(${f}.async ? await ${v}(${n}) : ${v}(${n}))`:(0,xe._)`${v}(${n})`,E=(0,xe._)`(typeof ${v} == "function" ? ${k} : ${v}.test(${n}))`;return(0,xe._)`${v} && ${v} !== true && ${g} === ${e} && !${E}`}}function h(){let p=d.formats[s];if(!p){x();return}if(p===!0)return;let[f,g,v]=$(p);f===e&&t.pass(k());function x(){if(c.strictSchema===!1){d.logger.warn(E());return}throw new Error(E());function E(){return`unknown format "${s}" ignored in schema at path "${u}"`}}function $(E){let M=E instanceof RegExp?(0,xe.regexpCode)(E):c.code.formats?(0,xe._)`${c.code.formats}${(0,xe.getProperty)(s)}`:void 0,ve=r.scopeValue("formats",{key:s,ref:E,code:M});return typeof E=="object"&&!(E instanceof RegExp)?[E.type||"string",E.validate,(0,xe._)`${ve}.validate`]:["string",E,ve]}function k(){if(typeof p=="object"&&!(p instanceof RegExp)&&p.async){if(!l.$async)throw new Error("async format in sync schema");return(0,xe._)`await ${v}(${n})`}return typeof g=="function"?(0,xe._)`${v}(${n})`:(0,xe._)`${v}.test(${n})`}}}};Bl.default=BT});var Cg=T(Jl=>{"use strict";Object.defineProperty(Jl,"__esModule",{value:!0});var JT=Rg(),GT=[JT.default];Jl.default=GT});var jg=T(mn=>{"use strict";Object.defineProperty(mn,"__esModule",{value:!0});mn.contentVocabulary=mn.metadataVocabulary=void 0;mn.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];mn.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var Ng=T(Gl=>{"use strict";Object.defineProperty(Gl,"__esModule",{value:!0});var WT=Uh(),XT=rg(),YT=Ig(),QT=Cg(),Og=jg(),eP=[WT.default,XT.default,(0,YT.default)(),QT.default,Og.metadataVocabulary,Og.contentVocabulary];Gl.default=eP});var Zg=T(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});di.DiscrError=void 0;var Ag;(function(t){t.Tag="tag",t.Mapping="mapping"})(Ag||(di.DiscrError=Ag={}))});var Dg=T(Xl=>{"use strict";Object.defineProperty(Xl,"__esModule",{value:!0});var hn=F(),Wl=Zg(),Mg=Hs(),tP=po(),rP=ee(),nP={message:({params:{discrError:t,tagName:e}})=>t===Wl.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,hn._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},oP={keyword:"discriminator",type:"object",schemaType:"object",error:nP,code(t){let{gen:e,data:r,schema:n,parentSchema:o,it:s}=t,{oneOf:i}=o;if(!s.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!i)throw new Error("discriminator: requires oneOf keyword");let c=e.let("valid",!1),u=e.const("tag",(0,hn._)`${r}${(0,hn.getProperty)(a)}`);e.if((0,hn._)`typeof ${u} == "string"`,()=>l(),()=>t.error(!1,{discrError:Wl.DiscrError.Tag,tag:u,tagName:a})),t.ok(c);function l(){let h=m();e.if(!1);for(let p in h)e.elseIf((0,hn._)`${u} === ${p}`),e.assign(c,d(h[p]));e.else(),t.error(!1,{discrError:Wl.DiscrError.Mapping,tag:u,tagName:a}),e.endIf()}function d(h){let p=e.name("valid"),f=t.subschema({keyword:"oneOf",schemaProp:h},p);return t.mergeEvaluated(f,hn.Name),p}function m(){var h;let p={},f=v(o),g=!0;for(let k=0;k<i.length;k++){let E=i[k];if(E?.$ref&&!(0,rP.schemaHasRulesButRef)(E,s.self.RULES)){let ve=E.$ref;if(E=Mg.resolveRef.call(s.self,s.schemaEnv.root,s.baseId,ve),E instanceof Mg.SchemaEnv&&(E=E.schema),E===void 0)throw new tP.default(s.opts.uriResolver,s.baseId,ve)}let M=(h=E?.properties)===null||h===void 0?void 0:h[a];if(typeof M!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);g=g&&(f||v(E)),x(M,k)}if(!g)throw new Error(`discriminator: "${a}" must be required`);return p;function v({required:k}){return Array.isArray(k)&&k.includes(a)}function x(k,E){if(k.const)$(k.const,E);else if(k.enum)for(let M of k.enum)$(M,E);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function $(k,E){if(typeof k!="string"||k in p)throw new Error(`discriminator: "${a}" values must be unique strings`);p[k]=E}}}};Xl.default=oP});var qg=T((HO,sP)=>{sP.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var Ql=T((le,Yl)=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.MissingRefError=le.ValidationError=le.CodeGen=le.Name=le.nil=le.stringify=le.str=le._=le.KeywordCxt=le.Ajv=void 0;var iP=Ah(),aP=Ng(),cP=Dg(),Lg=qg(),uP=["/properties"],pi="http://json-schema.org/draft-07/schema",gn=class extends iP.default{_addVocabularies(){super._addVocabularies(),aP.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(cP.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let e=this.opts.$data?this.$dataMetaSchema(Lg,uP):Lg;this.addMetaSchema(e,pi,!1),this.refs["http://json-schema.org/schema"]=pi}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(pi)?pi:void 0)}};le.Ajv=gn;Yl.exports=le=gn;Yl.exports.Ajv=gn;Object.defineProperty(le,"__esModule",{value:!0});le.default=gn;var lP=lo();Object.defineProperty(le,"KeywordCxt",{enumerable:!0,get:function(){return lP.KeywordCxt}});var yn=F();Object.defineProperty(le,"_",{enumerable:!0,get:function(){return yn._}});Object.defineProperty(le,"str",{enumerable:!0,get:function(){return yn.str}});Object.defineProperty(le,"stringify",{enumerable:!0,get:function(){return yn.stringify}});Object.defineProperty(le,"nil",{enumerable:!0,get:function(){return yn.nil}});Object.defineProperty(le,"Name",{enumerable:!0,get:function(){return yn.Name}});Object.defineProperty(le,"CodeGen",{enumerable:!0,get:function(){return yn.CodeGen}});var dP=Fs();Object.defineProperty(le,"ValidationError",{enumerable:!0,get:function(){return dP.default}});var pP=po();Object.defineProperty(le,"MissingRefError",{enumerable:!0,get:function(){return pP.default}})});var Gg=T(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.formatNames=St.fastFormats=St.fullFormats=void 0;function kt(t,e){return{validate:t,compare:e}}St.fullFormats={date:kt(Kg,nd),time:kt(td(!0),od),"date-time":kt(Ug(!0),Bg),"iso-time":kt(td(),Hg),"iso-date-time":kt(Ug(),Jg),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:_P,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:SP,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:vP,int32:{type:"number",validate:$P},int64:{type:"number",validate:wP},float:{type:"number",validate:Fg},double:{type:"number",validate:Fg},password:!0,binary:!0};St.fastFormats={...St.fullFormats,date:kt(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,nd),time:kt(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,od),"date-time":kt(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,Bg),"iso-time":kt(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,Hg),"iso-date-time":kt(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,Jg),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};St.formatNames=Object.keys(St.fullFormats);function fP(t){return t%4===0&&(t%100!==0||t%400===0)}var mP=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,hP=[0,31,28,31,30,31,30,31,31,30,31,30,31];function Kg(t){let e=mP.exec(t);if(!e)return!1;let r=+e[1],n=+e[2],o=+e[3];return n>=1&&n<=12&&o>=1&&o<=(n===2&&fP(r)?29:hP[n])}function nd(t,e){if(t&&e)return t>e?1:t<e?-1:0}var ed=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function td(t){return function(r){let n=ed.exec(r);if(!n)return!1;let o=+n[1],s=+n[2],i=+n[3],a=n[4],c=n[5]==="-"?-1:1,u=+(n[6]||0),l=+(n[7]||0);if(u>23||l>59||t&&!a)return!1;if(o<=23&&s<=59&&i<60)return!0;let d=s-l*c,m=o-u*c-(d<0?1:0);return(m===23||m===-1)&&(d===59||d===-1)&&i<61}}function od(t,e){if(!(t&&e))return;let r=new Date("2020-01-01T"+t).valueOf(),n=new Date("2020-01-01T"+e).valueOf();if(r&&n)return r-n}function Hg(t,e){if(!(t&&e))return;let r=ed.exec(t),n=ed.exec(e);if(r&&n)return t=r[1]+r[2]+r[3],e=n[1]+n[2]+n[3],t>e?1:t<e?-1:0}var rd=/t|\s/i;function Ug(t){let e=td(t);return function(n){let o=n.split(rd);return o.length===2&&Kg(o[0])&&e(o[1])}}function Bg(t,e){if(!(t&&e))return;let r=new Date(t).valueOf(),n=new Date(e).valueOf();if(r&&n)return r-n}function Jg(t,e){if(!(t&&e))return;let[r,n]=t.split(rd),[o,s]=e.split(rd),i=nd(r,o);if(i!==void 0)return i||od(n,s)}var gP=/\/|:/,yP=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function _P(t){return gP.test(t)&&yP.test(t)}var Vg=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function vP(t){return Vg.lastIndex=0,Vg.test(t)}var xP=-(2**31),bP=2**31-1;function $P(t){return Number.isInteger(t)&&t<=bP&&t>=xP}function wP(t){return Number.isInteger(t)}function Fg(){return!0}var kP=/[^\\]\\Z/;function SP(t){if(kP.test(t))return!1;try{return new RegExp(t),!0}catch{return!1}}});var Wg=T(_n=>{"use strict";Object.defineProperty(_n,"__esModule",{value:!0});_n.formatLimitDefinition=void 0;var TP=Ql(),ht=F(),nr=ht.operators,fi={formatMaximum:{okStr:"<=",ok:nr.LTE,fail:nr.GT},formatMinimum:{okStr:">=",ok:nr.GTE,fail:nr.LT},formatExclusiveMaximum:{okStr:"<",ok:nr.LT,fail:nr.GTE},formatExclusiveMinimum:{okStr:">",ok:nr.GT,fail:nr.LTE}},PP={message:({keyword:t,schemaCode:e})=>(0,ht.str)`should be ${fi[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,ht._)`{comparison: ${fi[t].okStr}, limit: ${e}}`};_n.formatLimitDefinition={keyword:Object.keys(fi),type:"string",schemaType:"string",$data:!0,error:PP,code(t){let{gen:e,data:r,schemaCode:n,keyword:o,it:s}=t,{opts:i,self:a}=s;if(!i.validateFormats)return;let c=new TP.KeywordCxt(s,a.RULES.all.format.definition,"format");c.$data?u():l();function u(){let m=e.scopeValue("formats",{ref:a.formats,code:i.code.formats}),h=e.const("fmt",(0,ht._)`${m}[${c.schemaCode}]`);t.fail$data((0,ht.or)((0,ht._)`typeof ${h} != "object"`,(0,ht._)`${h} instanceof RegExp`,(0,ht._)`typeof ${h}.compare != "function"`,d(h)))}function l(){let m=c.schema,h=a.formats[m];if(!h||h===!0)return;if(typeof h!="object"||h instanceof RegExp||typeof h.compare!="function")throw new Error(`"${o}": format "${m}" does not define "compare" function`);let p=e.scopeValue("formats",{key:m,ref:h,code:i.code.formats?(0,ht._)`${i.code.formats}${(0,ht.getProperty)(m)}`:void 0});t.fail$data(d(p))}function d(m){return(0,ht._)`${m}.compare(${r}, ${n}) ${fi[o].fail} 0`}},dependencies:["format"]};var zP=t=>(t.addKeyword(_n.formatLimitDefinition),t);_n.default=zP});var ey=T((To,Qg)=>{"use strict";Object.defineProperty(To,"__esModule",{value:!0});var vn=Gg(),EP=Wg(),sd=F(),Xg=new sd.Name("fullFormats"),IP=new sd.Name("fastFormats"),id=(t,e={keywords:!0})=>{if(Array.isArray(e))return Yg(t,e,vn.fullFormats,Xg),t;let[r,n]=e.mode==="fast"?[vn.fastFormats,IP]:[vn.fullFormats,Xg],o=e.formats||vn.formatNames;return Yg(t,o,r,n),e.keywords&&(0,EP.default)(t),t};id.get=(t,e="full")=>{let n=(e==="fast"?vn.fastFormats:vn.fullFormats)[t];if(!n)throw new Error(`Unknown format "${t}"`);return n};function Yg(t,e,r,n){var o,s;(o=(s=t.opts.code).formats)!==null&&o!==void 0||(s.formats=(0,sd._)`require("ajv-formats/dist/formats").${n}`);for(let i of e)t.addFormat(i,r[i])}Qg.exports=To=id;Object.defineProperty(To,"__esModule",{value:!0});To.default=id});var I={};Ci(I,{BRAND:()=>y_,DIRTY:()=>ir,EMPTY_PATH:()=>Gy,INVALID:()=>A,NEVER:()=>ev,OK:()=>Re,ParseStatus:()=>we,Schema:()=>V,ZodAny:()=>Ut,ZodArray:()=>It,ZodBigInt:()=>cr,ZodBoolean:()=>ur,ZodBranded:()=>Sn,ZodCatch:()=>xr,ZodDate:()=>lr,ZodDefault:()=>vr,ZodDiscriminatedUnion:()=>jo,ZodEffects:()=>Qe,ZodEnum:()=>yr,ZodError:()=>qe,ZodFirstPartyTypeKind:()=>w,ZodFunction:()=>No,ZodIntersection:()=>mr,ZodIssueCode:()=>b,ZodLazy:()=>hr,ZodLiteral:()=>gr,ZodMap:()=>Hr,ZodNaN:()=>Jr,ZodNativeEnum:()=>_r,ZodNever:()=>at,ZodNull:()=>pr,ZodNullable:()=>_t,ZodNumber:()=>ar,ZodObject:()=>Ue,ZodOptional:()=>Le,ZodParsedType:()=>P,ZodPipeline:()=>Tn,ZodPromise:()=>Vt,ZodReadonly:()=>br,ZodRecord:()=>Oo,ZodSchema:()=>V,ZodSet:()=>Br,ZodString:()=>Lt,ZodSymbol:()=>Fr,ZodTransformer:()=>Qe,ZodTuple:()=>yt,ZodType:()=>V,ZodUndefined:()=>dr,ZodUnion:()=>fr,ZodUnknown:()=>Et,ZodVoid:()=>Kr,addIssueToContext:()=>S,any:()=>T_,array:()=>I_,bigint:()=>b_,boolean:()=>Rd,coerce:()=>Q_,custom:()=>zd,date:()=>$_,datetimeRegex:()=>Td,defaultErrorMap:()=>Pt,discriminatedUnion:()=>j_,effect:()=>K_,enum:()=>U_,function:()=>D_,getErrorMap:()=>Lr,getParsedType:()=>gt,instanceof:()=>v_,intersection:()=>O_,isAborted:()=>Ro,isAsync:()=>Ur,isDirty:()=>Co,isValid:()=>qt,late:()=>__,lazy:()=>q_,literal:()=>L_,makeIssue:()=>kn,map:()=>Z_,nan:()=>x_,nativeEnum:()=>V_,never:()=>z_,null:()=>S_,nullable:()=>B_,number:()=>Id,object:()=>Ai,objectUtil:()=>ji,oboolean:()=>Y_,onumber:()=>X_,optional:()=>H_,ostring:()=>W_,pipeline:()=>G_,preprocess:()=>J_,promise:()=>F_,quotelessJson:()=>Hy,record:()=>A_,set:()=>M_,setErrorMap:()=>Jy,strictObject:()=>R_,string:()=>Ed,symbol:()=>w_,transformer:()=>K_,tuple:()=>N_,undefined:()=>k_,union:()=>C_,unknown:()=>P_,util:()=>B,void:()=>E_});var B;(function(t){t.assertEqual=o=>{};function e(o){}t.assertIs=e;function r(o){throw new Error}t.assertNever=r,t.arrayToEnum=o=>{let s={};for(let i of o)s[i]=i;return s},t.getValidEnumValues=o=>{let s=t.objectKeys(o).filter(a=>typeof o[o[a]]!="number"),i={};for(let a of s)i[a]=o[a];return t.objectValues(i)},t.objectValues=o=>t.objectKeys(o).map(function(s){return o[s]}),t.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{let s=[];for(let i in o)Object.prototype.hasOwnProperty.call(o,i)&&s.push(i);return s},t.find=(o,s)=>{for(let i of o)if(s(i))return i},t.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function n(o,s=" | "){return o.map(i=>typeof i=="string"?`'${i}'`:i).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(o,s)=>typeof s=="bigint"?s.toString():s})(B||(B={}));var ji;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(ji||(ji={}));var P=B.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),gt=t=>{switch(typeof t){case"undefined":return P.undefined;case"string":return P.string;case"number":return Number.isNaN(t)?P.nan:P.number;case"boolean":return P.boolean;case"function":return P.function;case"bigint":return P.bigint;case"symbol":return P.symbol;case"object":return Array.isArray(t)?P.array:t===null?P.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?P.promise:typeof Map<"u"&&t instanceof Map?P.map:typeof Set<"u"&&t instanceof Set?P.set:typeof Date<"u"&&t instanceof Date?P.date:P.object;default:return P.unknown}};var b=B.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Hy=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),qe=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},o=s=>{for(let i of s.issues)if(i.code==="invalid_union")i.unionErrors.map(o);else if(i.code==="invalid_return_type")o(i.returnTypeError);else if(i.code==="invalid_arguments")o(i.argumentsError);else if(i.path.length===0)n._errors.push(r(i));else{let a=n,c=0;for(;c<i.path.length;){let u=i.path[c];c===i.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(i))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return o(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,B.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let o of this.issues)if(o.path.length>0){let s=o.path[0];r[s]=r[s]||[],r[s].push(e(o))}else n.push(e(o));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};qe.create=t=>new qe(t);var By=(t,e)=>{let r;switch(t.code){case b.invalid_type:t.received===P.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case b.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,B.jsonStringifyReplacer)}`;break;case b.unrecognized_keys:r=`Unrecognized key(s) in object: ${B.joinValues(t.keys,", ")}`;break;case b.invalid_union:r="Invalid input";break;case b.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${B.joinValues(t.options)}`;break;case b.invalid_enum_value:r=`Invalid enum value. Expected ${B.joinValues(t.options)}, received '${t.received}'`;break;case b.invalid_arguments:r="Invalid function arguments";break;case b.invalid_return_type:r="Invalid function return type";break;case b.invalid_date:r="Invalid date";break;case b.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:B.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case b.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case b.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case b.custom:r="Invalid input";break;case b.invalid_intersection_types:r="Intersection results could not be merged";break;case b.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case b.not_finite:r="Number must be finite";break;default:r=e.defaultError,B.assertNever(t)}return{message:r}},Pt=By;var bd=Pt;function Jy(t){bd=t}function Lr(){return bd}var kn=t=>{let{data:e,path:r,errorMaps:n,issueData:o}=t,s=[...r,...o.path||[]],i={...o,path:s};if(o.message!==void 0)return{...o,path:s,message:o.message};let a="",c=n.filter(u=>!!u).slice().reverse();for(let u of c)a=u(i,{data:e,defaultError:a}).message;return{...o,path:s,message:a}},Gy=[];function S(t,e){let r=Lr(),n=kn({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Pt?void 0:Pt].filter(o=>!!o)});t.common.issues.push(n)}var we=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let o of r){if(o.status==="aborted")return A;o.status==="dirty"&&e.dirty(),n.push(o.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let o of r){let s=await o.key,i=await o.value;n.push({key:s,value:i})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let o of r){let{key:s,value:i}=o;if(s.status==="aborted"||i.status==="aborted")return A;s.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof i.value<"u"||o.alwaysSet)&&(n[s.value]=i.value)}return{status:e.value,value:n}}},A=Object.freeze({status:"aborted"}),ir=t=>({status:"dirty",value:t}),Re=t=>({status:"valid",value:t}),Ro=t=>t.status==="aborted",Co=t=>t.status==="dirty",qt=t=>t.status==="valid",Ur=t=>typeof Promise<"u"&&t instanceof Promise;var R;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(R||(R={}));var Ye=class{constructor(e,r,n,o){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},$d=(t,e)=>{if(qt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new qe(t.common.issues);return this._error=r,this._error}}};function L(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:o}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:o}:{errorMap:(i,a)=>{let{message:c}=t;return i.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??n??a.defaultError}:i.code!=="invalid_type"?{message:a.defaultError}:{message:c??r??a.defaultError}},description:o}}var V=class{get description(){return this._def.description}_getType(e){return gt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:gt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new we,ctx:{common:e.parent.common,data:e.data,parsedType:gt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(Ur(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){let n={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:gt(e)},o=this._parseSync({data:e,path:n.path,parent:n});return $d(n,o)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:gt(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:r});return qt(n)?{value:n.value}:{issues:r.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(n=>qt(n)?{value:n.value}:{issues:r.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:gt(e)},o=this._parse({data:e,path:n.path,parent:n}),s=await(Ur(o)?o:Promise.resolve(o));return $d(n,s)}refine(e,r){let n=o=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(o):r;return this._refinement((o,s)=>{let i=e(o),a=()=>s.addIssue({code:b.custom,...n(o)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(a(),!1)):i?!0:(a(),!1)})}refinement(e,r){return this._refinement((n,o)=>e(n)?!0:(o.addIssue(typeof r=="function"?r(n,o):r),!1))}_refinement(e){return new Qe({schema:this,typeName:w.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Le.create(this,this._def)}nullable(){return _t.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return It.create(this)}promise(){return Vt.create(this,this._def)}or(e){return fr.create([this,e],this._def)}and(e){return mr.create(this,e,this._def)}transform(e){return new Qe({...L(this._def),schema:this,typeName:w.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new vr({...L(this._def),innerType:this,defaultValue:r,typeName:w.ZodDefault})}brand(){return new Sn({typeName:w.ZodBranded,type:this,...L(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new xr({...L(this._def),innerType:this,catchValue:r,typeName:w.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Tn.create(this,e)}readonly(){return br.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Wy=/^c[^\s-]{8,}$/i,Xy=/^[0-9a-z]+$/,Yy=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Qy=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,e_=/^[a-z0-9_-]{21}$/i,t_=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,r_=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,n_=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,o_="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Oi,s_=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,i_=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,a_=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,c_=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,u_=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,l_=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,kd="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",d_=new RegExp(`^${kd}$`);function Sd(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function p_(t){return new RegExp(`^${Sd(t)}$`)}function Td(t){let e=`${kd}T${Sd(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function f_(t,e){return!!((e==="v4"||!e)&&s_.test(t)||(e==="v6"||!e)&&a_.test(t))}function m_(t,e){if(!t_.test(t))return!1;try{let[r]=t.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),o=JSON.parse(atob(n));return!(typeof o!="object"||o===null||"typ"in o&&o?.typ!=="JWT"||!o.alg||e&&o.alg!==e)}catch{return!1}}function h_(t,e){return!!((e==="v4"||!e)&&i_.test(t)||(e==="v6"||!e)&&c_.test(t))}var Lt=class t extends V{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==P.string){let s=this._getOrReturnCtx(e);return S(s,{code:b.invalid_type,expected:P.string,received:s.parsedType}),A}let n=new we,o;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(o=this._getOrReturnCtx(e,o),S(o,{code:b.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(o=this._getOrReturnCtx(e,o),S(o,{code:b.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let i=e.data.length>s.value,a=e.data.length<s.value;(i||a)&&(o=this._getOrReturnCtx(e,o),i?S(o,{code:b.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&S(o,{code:b.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")n_.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"email",code:b.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")Oi||(Oi=new RegExp(o_,"u")),Oi.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"emoji",code:b.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")Qy.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"uuid",code:b.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")e_.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"nanoid",code:b.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")Wy.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"cuid",code:b.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")Xy.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"cuid2",code:b.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")Yy.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"ulid",code:b.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{o=this._getOrReturnCtx(e,o),S(o,{validation:"url",code:b.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"regex",code:b.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(o=this._getOrReturnCtx(e,o),S(o,{code:b.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(o=this._getOrReturnCtx(e,o),S(o,{code:b.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(o=this._getOrReturnCtx(e,o),S(o,{code:b.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?Td(s).test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{code:b.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?d_.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{code:b.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?p_(s).test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{code:b.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?r_.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"duration",code:b.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?f_(e.data,s.version)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"ip",code:b.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?m_(e.data,s.alg)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"jwt",code:b.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?h_(e.data,s.version)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"cidr",code:b.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?u_.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"base64",code:b.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?l_.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"base64url",code:b.invalid_string,message:s.message}),n.dirty()):B.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(o=>e.test(o),{validation:r,code:b.invalid_string,...R.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...R.errToObj(e)})}url(e){return this._addCheck({kind:"url",...R.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...R.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...R.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...R.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...R.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...R.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...R.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...R.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...R.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...R.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...R.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...R.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...R.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...R.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...R.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...R.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...R.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...R.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...R.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...R.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...R.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...R.errToObj(r)})}nonempty(e){return this.min(1,R.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Lt.create=t=>new Lt({checks:[],typeName:w.ZodString,coerce:t?.coerce??!1,...L(t)});function g_(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,s=Number.parseInt(t.toFixed(o).replace(".","")),i=Number.parseInt(e.toFixed(o).replace(".",""));return s%i/10**o}var ar=class t extends V{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==P.number){let s=this._getOrReturnCtx(e);return S(s,{code:b.invalid_type,expected:P.number,received:s.parsedType}),A}let n,o=new we;for(let s of this._def.checks)s.kind==="int"?B.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{code:b.invalid_type,expected:"integer",received:"float",message:s.message}),o.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),S(n,{code:b.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),S(n,{code:b.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="multipleOf"?g_(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),S(n,{code:b.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{code:b.not_finite,message:s.message}),o.dirty()):B.assertNever(s);return{status:o.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,R.toString(r))}gt(e,r){return this.setLimit("min",e,!1,R.toString(r))}lte(e,r){return this.setLimit("max",e,!0,R.toString(r))}lt(e,r){return this.setLimit("max",e,!1,R.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:R.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:R.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:R.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:R.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:R.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:R.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&B.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};ar.create=t=>new ar({checks:[],typeName:w.ZodNumber,coerce:t?.coerce||!1,...L(t)});var cr=class t extends V{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==P.bigint)return this._getInvalidInput(e);let n,o=new we;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),S(n,{code:b.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),S(n,{code:b.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),S(n,{code:b.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):B.assertNever(s);return{status:o.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return S(r,{code:b.invalid_type,expected:P.bigint,received:r.parsedType}),A}gte(e,r){return this.setLimit("min",e,!0,R.toString(r))}gt(e,r){return this.setLimit("min",e,!1,R.toString(r))}lte(e,r){return this.setLimit("max",e,!0,R.toString(r))}lt(e,r){return this.setLimit("max",e,!1,R.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:R.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:R.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};cr.create=t=>new cr({checks:[],typeName:w.ZodBigInt,coerce:t?.coerce??!1,...L(t)});var ur=class extends V{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==P.boolean){let n=this._getOrReturnCtx(e);return S(n,{code:b.invalid_type,expected:P.boolean,received:n.parsedType}),A}return Re(e.data)}};ur.create=t=>new ur({typeName:w.ZodBoolean,coerce:t?.coerce||!1,...L(t)});var lr=class t extends V{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==P.date){let s=this._getOrReturnCtx(e);return S(s,{code:b.invalid_type,expected:P.date,received:s.parsedType}),A}if(Number.isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return S(s,{code:b.invalid_date}),A}let n=new we,o;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(o=this._getOrReturnCtx(e,o),S(o,{code:b.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(o=this._getOrReturnCtx(e,o),S(o,{code:b.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):B.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:R.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:R.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};lr.create=t=>new lr({checks:[],coerce:t?.coerce||!1,typeName:w.ZodDate,...L(t)});var Fr=class extends V{_parse(e){if(this._getType(e)!==P.symbol){let n=this._getOrReturnCtx(e);return S(n,{code:b.invalid_type,expected:P.symbol,received:n.parsedType}),A}return Re(e.data)}};Fr.create=t=>new Fr({typeName:w.ZodSymbol,...L(t)});var dr=class extends V{_parse(e){if(this._getType(e)!==P.undefined){let n=this._getOrReturnCtx(e);return S(n,{code:b.invalid_type,expected:P.undefined,received:n.parsedType}),A}return Re(e.data)}};dr.create=t=>new dr({typeName:w.ZodUndefined,...L(t)});var pr=class extends V{_parse(e){if(this._getType(e)!==P.null){let n=this._getOrReturnCtx(e);return S(n,{code:b.invalid_type,expected:P.null,received:n.parsedType}),A}return Re(e.data)}};pr.create=t=>new pr({typeName:w.ZodNull,...L(t)});var Ut=class extends V{constructor(){super(...arguments),this._any=!0}_parse(e){return Re(e.data)}};Ut.create=t=>new Ut({typeName:w.ZodAny,...L(t)});var Et=class extends V{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Re(e.data)}};Et.create=t=>new Et({typeName:w.ZodUnknown,...L(t)});var at=class extends V{_parse(e){let r=this._getOrReturnCtx(e);return S(r,{code:b.invalid_type,expected:P.never,received:r.parsedType}),A}};at.create=t=>new at({typeName:w.ZodNever,...L(t)});var Kr=class extends V{_parse(e){if(this._getType(e)!==P.undefined){let n=this._getOrReturnCtx(e);return S(n,{code:b.invalid_type,expected:P.void,received:n.parsedType}),A}return Re(e.data)}};Kr.create=t=>new Kr({typeName:w.ZodVoid,...L(t)});var It=class t extends V{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),o=this._def;if(r.parsedType!==P.array)return S(r,{code:b.invalid_type,expected:P.array,received:r.parsedType}),A;if(o.exactLength!==null){let i=r.data.length>o.exactLength.value,a=r.data.length<o.exactLength.value;(i||a)&&(S(r,{code:i?b.too_big:b.too_small,minimum:a?o.exactLength.value:void 0,maximum:i?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),n.dirty())}if(o.minLength!==null&&r.data.length<o.minLength.value&&(S(r,{code:b.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),n.dirty()),o.maxLength!==null&&r.data.length>o.maxLength.value&&(S(r,{code:b.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((i,a)=>o.type._parseAsync(new Ye(r,i,r.path,a)))).then(i=>we.mergeArray(n,i));let s=[...r.data].map((i,a)=>o.type._parseSync(new Ye(r,i,r.path,a)));return we.mergeArray(n,s)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:R.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:R.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:R.toString(r)}})}nonempty(e){return this.min(1,e)}};It.create=(t,e)=>new It({type:t,minLength:null,maxLength:null,exactLength:null,typeName:w.ZodArray,...L(e)});function Vr(t){if(t instanceof Ue){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=Le.create(Vr(n))}return new Ue({...t._def,shape:()=>e})}else return t instanceof It?new It({...t._def,type:Vr(t.element)}):t instanceof Le?Le.create(Vr(t.unwrap())):t instanceof _t?_t.create(Vr(t.unwrap())):t instanceof yt?yt.create(t.items.map(e=>Vr(e))):t}var Ue=class t extends V{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=B.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==P.object){let u=this._getOrReturnCtx(e);return S(u,{code:b.invalid_type,expected:P.object,received:u.parsedType}),A}let{status:n,ctx:o}=this._processInputParams(e),{shape:s,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof at&&this._def.unknownKeys==="strip"))for(let u in o.data)i.includes(u)||a.push(u);let c=[];for(let u of i){let l=s[u],d=o.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Ye(o,d,o.path,u)),alwaysSet:u in o.data})}if(this._def.catchall instanceof at){let u=this._def.unknownKeys;if(u==="passthrough")for(let l of a)c.push({key:{status:"valid",value:l},value:{status:"valid",value:o.data[l]}});else if(u==="strict")a.length>0&&(S(o,{code:b.unrecognized_keys,keys:a}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let l of a){let d=o.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Ye(o,d,o.path,l)),alwaysSet:l in o.data})}}return o.common.async?Promise.resolve().then(async()=>{let u=[];for(let l of c){let d=await l.key,m=await l.value;u.push({key:d,value:m,alwaysSet:l.alwaysSet})}return u}).then(u=>we.mergeObjectSync(n,u)):we.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return R.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{let o=this._def.errorMap?.(r,n).message??n.defaultError;return r.code==="unrecognized_keys"?{message:R.errToObj(e).message??o}:{message:o}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:w.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};for(let n of B.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}omit(e){let r={};for(let n of B.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}deepPartial(){return Vr(this)}partial(e){let r={};for(let n of B.objectKeys(this.shape)){let o=this.shape[n];e&&!e[n]?r[n]=o:r[n]=o.optional()}return new t({...this._def,shape:()=>r})}required(e){let r={};for(let n of B.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof Le;)s=s._def.innerType;r[n]=s}return new t({...this._def,shape:()=>r})}keyof(){return Pd(B.objectKeys(this.shape))}};Ue.create=(t,e)=>new Ue({shape:()=>t,unknownKeys:"strip",catchall:at.create(),typeName:w.ZodObject,...L(e)});Ue.strictCreate=(t,e)=>new Ue({shape:()=>t,unknownKeys:"strict",catchall:at.create(),typeName:w.ZodObject,...L(e)});Ue.lazycreate=(t,e)=>new Ue({shape:t,unknownKeys:"strip",catchall:at.create(),typeName:w.ZodObject,...L(e)});var fr=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function o(s){for(let a of s)if(a.result.status==="valid")return a.result;for(let a of s)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;let i=s.map(a=>new qe(a.ctx.common.issues));return S(r,{code:b.invalid_union,unionErrors:i}),A}if(r.common.async)return Promise.all(n.map(async s=>{let i={...r,common:{...r.common,issues:[]},parent:null};return{result:await s._parseAsync({data:r.data,path:r.path,parent:i}),ctx:i}})).then(o);{let s,i=[];for(let c of n){let u={...r,common:{...r.common,issues:[]},parent:null},l=c._parseSync({data:r.data,path:r.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!s&&(s={result:l,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(s)return r.common.issues.push(...s.ctx.common.issues),s.result;let a=i.map(c=>new qe(c));return S(r,{code:b.invalid_union,unionErrors:a}),A}}get options(){return this._def.options}};fr.create=(t,e)=>new fr({options:t,typeName:w.ZodUnion,...L(e)});var zt=t=>t instanceof hr?zt(t.schema):t instanceof Qe?zt(t.innerType()):t instanceof gr?[t.value]:t instanceof yr?t.options:t instanceof _r?B.objectValues(t.enum):t instanceof vr?zt(t._def.innerType):t instanceof dr?[void 0]:t instanceof pr?[null]:t instanceof Le?[void 0,...zt(t.unwrap())]:t instanceof _t?[null,...zt(t.unwrap())]:t instanceof Sn||t instanceof br?zt(t.unwrap()):t instanceof xr?zt(t._def.innerType):[],jo=class t extends V{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==P.object)return S(r,{code:b.invalid_type,expected:P.object,received:r.parsedType}),A;let n=this.discriminator,o=r.data[n],s=this.optionsMap.get(o);return s?r.common.async?s._parseAsync({data:r.data,path:r.path,parent:r}):s._parseSync({data:r.data,path:r.path,parent:r}):(S(r,{code:b.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),A)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let o=new Map;for(let s of r){let i=zt(s.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of i){if(o.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);o.set(a,s)}}return new t({typeName:w.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:o,...L(n)})}};function Ni(t,e){let r=gt(t),n=gt(e);if(t===e)return{valid:!0,data:t};if(r===P.object&&n===P.object){let o=B.objectKeys(e),s=B.objectKeys(t).filter(a=>o.indexOf(a)!==-1),i={...t,...e};for(let a of s){let c=Ni(t[a],e[a]);if(!c.valid)return{valid:!1};i[a]=c.data}return{valid:!0,data:i}}else if(r===P.array&&n===P.array){if(t.length!==e.length)return{valid:!1};let o=[];for(let s=0;s<t.length;s++){let i=t[s],a=e[s],c=Ni(i,a);if(!c.valid)return{valid:!1};o.push(c.data)}return{valid:!0,data:o}}else return r===P.date&&n===P.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var mr=class extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=(s,i)=>{if(Ro(s)||Ro(i))return A;let a=Ni(s.value,i.value);return a.valid?((Co(s)||Co(i))&&r.dirty(),{status:r.value,value:a.data}):(S(n,{code:b.invalid_intersection_types}),A)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,i])=>o(s,i)):o(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};mr.create=(t,e,r)=>new mr({left:t,right:e,typeName:w.ZodIntersection,...L(r)});var yt=class t extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.array)return S(n,{code:b.invalid_type,expected:P.array,received:n.parsedType}),A;if(n.data.length<this._def.items.length)return S(n,{code:b.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),A;!this._def.rest&&n.data.length>this._def.items.length&&(S(n,{code:b.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let s=[...n.data].map((i,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new Ye(n,i,n.path,a)):null}).filter(i=>!!i);return n.common.async?Promise.all(s).then(i=>we.mergeArray(r,i)):we.mergeArray(r,s)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};yt.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new yt({items:t,typeName:w.ZodTuple,rest:null,...L(e)})};var Oo=class t extends V{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.object)return S(n,{code:b.invalid_type,expected:P.object,received:n.parsedType}),A;let o=[],s=this._def.keyType,i=this._def.valueType;for(let a in n.data)o.push({key:s._parse(new Ye(n,a,n.path,a)),value:i._parse(new Ye(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?we.mergeObjectAsync(r,o):we.mergeObjectSync(r,o)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof V?new t({keyType:e,valueType:r,typeName:w.ZodRecord,...L(n)}):new t({keyType:Lt.create(),valueType:e,typeName:w.ZodRecord,...L(r)})}},Hr=class extends V{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.map)return S(n,{code:b.invalid_type,expected:P.map,received:n.parsedType}),A;let o=this._def.keyType,s=this._def.valueType,i=[...n.data.entries()].map(([a,c],u)=>({key:o._parse(new Ye(n,a,n.path,[u,"key"])),value:s._parse(new Ye(n,c,n.path,[u,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of i){let u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return A;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}})}else{let a=new Map;for(let c of i){let u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return A;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}}}};Hr.create=(t,e,r)=>new Hr({valueType:e,keyType:t,typeName:w.ZodMap,...L(r)});var Br=class t extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.set)return S(n,{code:b.invalid_type,expected:P.set,received:n.parsedType}),A;let o=this._def;o.minSize!==null&&n.data.size<o.minSize.value&&(S(n,{code:b.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),r.dirty()),o.maxSize!==null&&n.data.size>o.maxSize.value&&(S(n,{code:b.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),r.dirty());let s=this._def.valueType;function i(c){let u=new Set;for(let l of c){if(l.status==="aborted")return A;l.status==="dirty"&&r.dirty(),u.add(l.value)}return{status:r.value,value:u}}let a=[...n.data.values()].map((c,u)=>s._parse(new Ye(n,c,n.path,u)));return n.common.async?Promise.all(a).then(c=>i(c)):i(a)}min(e,r){return new t({...this._def,minSize:{value:e,message:R.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:R.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};Br.create=(t,e)=>new Br({valueType:t,minSize:null,maxSize:null,typeName:w.ZodSet,...L(e)});var No=class t extends V{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==P.function)return S(r,{code:b.invalid_type,expected:P.function,received:r.parsedType}),A;function n(a,c){return kn({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Lr(),Pt].filter(u=>!!u),issueData:{code:b.invalid_arguments,argumentsError:c}})}function o(a,c){return kn({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Lr(),Pt].filter(u=>!!u),issueData:{code:b.invalid_return_type,returnTypeError:c}})}let s={errorMap:r.common.contextualErrorMap},i=r.data;if(this._def.returns instanceof Vt){let a=this;return Re(async function(...c){let u=new qe([]),l=await a._def.args.parseAsync(c,s).catch(h=>{throw u.addIssue(n(c,h)),u}),d=await Reflect.apply(i,this,l);return await a._def.returns._def.type.parseAsync(d,s).catch(h=>{throw u.addIssue(o(d,h)),u})})}else{let a=this;return Re(function(...c){let u=a._def.args.safeParse(c,s);if(!u.success)throw new qe([n(c,u.error)]);let l=Reflect.apply(i,this,u.data),d=a._def.returns.safeParse(l,s);if(!d.success)throw new qe([o(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:yt.create(e).rest(Et.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||yt.create([]).rest(Et.create()),returns:r||Et.create(),typeName:w.ZodFunction,...L(n)})}},hr=class extends V{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};hr.create=(t,e)=>new hr({getter:t,typeName:w.ZodLazy,...L(e)});var gr=class extends V{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return S(r,{received:r.data,code:b.invalid_literal,expected:this._def.value}),A}return{status:"valid",value:e.data}}get value(){return this._def.value}};gr.create=(t,e)=>new gr({value:t,typeName:w.ZodLiteral,...L(e)});function Pd(t,e){return new yr({values:t,typeName:w.ZodEnum,...L(e)})}var yr=class t extends V{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return S(r,{expected:B.joinValues(n),received:r.parsedType,code:b.invalid_type}),A}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return S(r,{received:r.data,code:b.invalid_enum_value,options:n}),A}return Re(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};yr.create=Pd;var _r=class extends V{_parse(e){let r=B.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==P.string&&n.parsedType!==P.number){let o=B.objectValues(r);return S(n,{expected:B.joinValues(o),received:n.parsedType,code:b.invalid_type}),A}if(this._cache||(this._cache=new Set(B.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let o=B.objectValues(r);return S(n,{received:n.data,code:b.invalid_enum_value,options:o}),A}return Re(e.data)}get enum(){return this._def.values}};_r.create=(t,e)=>new _r({values:t,typeName:w.ZodNativeEnum,...L(e)});var Vt=class extends V{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==P.promise&&r.common.async===!1)return S(r,{code:b.invalid_type,expected:P.promise,received:r.parsedType}),A;let n=r.parsedType===P.promise?r.data:Promise.resolve(r.data);return Re(n.then(o=>this._def.type.parseAsync(o,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Vt.create=(t,e)=>new Vt({type:t,typeName:w.ZodPromise,...L(e)});var Qe=class extends V{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===w.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=this._def.effect||null,s={addIssue:i=>{S(n,i),i.fatal?r.abort():r.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),o.type==="preprocess"){let i=o.transform(n.data,s);if(n.common.async)return Promise.resolve(i).then(async a=>{if(r.value==="aborted")return A;let c=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return c.status==="aborted"?A:c.status==="dirty"?ir(c.value):r.value==="dirty"?ir(c.value):c});{if(r.value==="aborted")return A;let a=this._def.schema._parseSync({data:i,path:n.path,parent:n});return a.status==="aborted"?A:a.status==="dirty"?ir(a.value):r.value==="dirty"?ir(a.value):a}}if(o.type==="refinement"){let i=a=>{let c=o.refinement(a,s);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?A:(a.status==="dirty"&&r.dirty(),i(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?A:(a.status==="dirty"&&r.dirty(),i(a.value).then(()=>({status:r.value,value:a.value}))))}if(o.type==="transform")if(n.common.async===!1){let i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!qt(i))return A;let a=o.transform(i.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>qt(i)?Promise.resolve(o.transform(i.value,s)).then(a=>({status:r.value,value:a})):A);B.assertNever(o)}};Qe.create=(t,e,r)=>new Qe({schema:t,typeName:w.ZodEffects,effect:e,...L(r)});Qe.createWithPreprocess=(t,e,r)=>new Qe({schema:e,effect:{type:"preprocess",transform:t},typeName:w.ZodEffects,...L(r)});var Le=class extends V{_parse(e){return this._getType(e)===P.undefined?Re(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Le.create=(t,e)=>new Le({innerType:t,typeName:w.ZodOptional,...L(e)});var _t=class extends V{_parse(e){return this._getType(e)===P.null?Re(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};_t.create=(t,e)=>new _t({innerType:t,typeName:w.ZodNullable,...L(e)});var vr=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===P.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};vr.create=(t,e)=>new vr({innerType:t,typeName:w.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...L(e)});var xr=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},o=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Ur(o)?o.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new qe(n.common.issues)},input:n.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new qe(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};xr.create=(t,e)=>new xr({innerType:t,typeName:w.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...L(e)});var Jr=class extends V{_parse(e){if(this._getType(e)!==P.nan){let n=this._getOrReturnCtx(e);return S(n,{code:b.invalid_type,expected:P.nan,received:n.parsedType}),A}return{status:"valid",value:e.data}}};Jr.create=t=>new Jr({typeName:w.ZodNaN,...L(t)});var y_=Symbol("zod_brand"),Sn=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},Tn=class t extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?A:s.status==="dirty"?(r.dirty(),ir(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{let o=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?A:o.status==="dirty"?(r.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:w.ZodPipeline})}},br=class extends V{_parse(e){let r=this._def.innerType._parse(e),n=o=>(qt(o)&&(o.value=Object.freeze(o.value)),o);return Ur(r)?r.then(o=>n(o)):n(r)}unwrap(){return this._def.innerType}};br.create=(t,e)=>new br({innerType:t,typeName:w.ZodReadonly,...L(e)});function wd(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function zd(t,e={},r){return t?Ut.create().superRefine((n,o)=>{let s=t(n);if(s instanceof Promise)return s.then(i=>{if(!i){let a=wd(e,n),c=a.fatal??r??!0;o.addIssue({code:"custom",...a,fatal:c})}});if(!s){let i=wd(e,n),a=i.fatal??r??!0;o.addIssue({code:"custom",...i,fatal:a})}}):Ut.create()}var __={object:Ue.lazycreate},w;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(w||(w={}));var v_=(t,e={message:`Input not instance of ${t.name}`})=>zd(r=>r instanceof t,e),Ed=Lt.create,Id=ar.create,x_=Jr.create,b_=cr.create,Rd=ur.create,$_=lr.create,w_=Fr.create,k_=dr.create,S_=pr.create,T_=Ut.create,P_=Et.create,z_=at.create,E_=Kr.create,I_=It.create,Ai=Ue.create,R_=Ue.strictCreate,C_=fr.create,j_=jo.create,O_=mr.create,N_=yt.create,A_=Oo.create,Z_=Hr.create,M_=Br.create,D_=No.create,q_=hr.create,L_=gr.create,U_=yr.create,V_=_r.create,F_=Vt.create,K_=Qe.create,H_=Le.create,B_=_t.create,J_=Qe.createWithPreprocess,G_=Tn.create,W_=()=>Ed().optional(),X_=()=>Id().optional(),Y_=()=>Rd().optional(),Q_={string:(t=>Lt.create({...t,coerce:!0})),number:(t=>ar.create({...t,coerce:!0})),boolean:(t=>ur.create({...t,coerce:!0})),bigint:(t=>cr.create({...t,coerce:!0})),date:(t=>lr.create({...t,coerce:!0}))};var ev=A;var tv=Object.freeze({status:"aborted"});function _(t,e,r){function n(a,c){var u;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(u=a._zod).traits??(u.traits=new Set),a._zod.traits.add(t),e(a,c);for(let l in i.prototype)l in a||Object.defineProperty(a,l,{value:i.prototype[l].bind(a)});a._zod.constr=i,a._zod.def=c}let o=r?.Parent??Object;class s extends o{}Object.defineProperty(s,"name",{value:t});function i(a){var c;let u=r?.Parent?new s:this;n(u,a),(c=u._zod).deferred??(c.deferred=[]);for(let l of u._zod.deferred)l();return u}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(t)}),Object.defineProperty(i,"name",{value:t}),i}var Rt=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},Ao={};function Je(t){return t&&Object.assign(Ao,t),Ao}var J={};Ci(J,{BIGINT_FORMAT_RANGES:()=>jd,Class:()=>Mi,NUMBER_FORMAT_RANGES:()=>Ki,aborted:()=>wr,allowsEval:()=>Ui,assert:()=>iv,assertEqual:()=>rv,assertIs:()=>ov,assertNever:()=>sv,assertNotEqual:()=>nv,assignProp:()=>Li,cached:()=>En,captureStackTrace:()=>Mo,cleanEnum:()=>vv,cleanRegex:()=>Rn,clone:()=>Ge,createTransparentProxy:()=>pv,defineLazy:()=>ie,esc:()=>$r,escapeRegex:()=>Ft,extend:()=>hv,finalizeIssue:()=>ct,floatSafeRemainder:()=>qi,getElementAtPath:()=>av,getEnumValues:()=>zn,getLengthableOrigin:()=>Cn,getParsedType:()=>dv,getSizableOrigin:()=>Od,isObject:()=>Gr,isPlainObject:()=>Wr,issue:()=>Hi,joinValues:()=>Zo,jsonStringifyReplacer:()=>Di,merge:()=>gv,normalizeParams:()=>Z,nullish:()=>In,numKeys:()=>lv,omit:()=>mv,optionalKeys:()=>Fi,partial:()=>yv,pick:()=>fv,prefixIssues:()=>vt,primitiveTypes:()=>Cd,promiseAllObject:()=>cv,propertyKeyTypes:()=>Vi,randomString:()=>uv,required:()=>_v,stringifyPrimitive:()=>Do,unwrapMessage:()=>Pn});function rv(t){return t}function nv(t){return t}function ov(t){}function sv(t){throw new Error}function iv(t){}function zn(t){let e=Object.values(t).filter(n=>typeof n=="number");return Object.entries(t).filter(([n,o])=>e.indexOf(+n)===-1).map(([n,o])=>o)}function Zo(t,e="|"){return t.map(r=>Do(r)).join(e)}function Di(t,e){return typeof e=="bigint"?e.toString():e}function En(t){return{get value(){{let r=t();return Object.defineProperty(this,"value",{value:r}),r}throw new Error("cached value already set")}}}function In(t){return t==null}function Rn(t){let e=t.startsWith("^")?1:0,r=t.endsWith("$")?t.length-1:t.length;return t.slice(e,r)}function qi(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,s=Number.parseInt(t.toFixed(o).replace(".","")),i=Number.parseInt(e.toFixed(o).replace(".",""));return s%i/10**o}function ie(t,e,r){Object.defineProperty(t,e,{get(){{let o=r();return t[e]=o,o}throw new Error("cached value already set")},set(o){Object.defineProperty(t,e,{value:o})},configurable:!0})}function Li(t,e,r){Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}function av(t,e){return e?e.reduce((r,n)=>r?.[n],t):t}function cv(t){let e=Object.keys(t),r=e.map(n=>t[n]);return Promise.all(r).then(n=>{let o={};for(let s=0;s<e.length;s++)o[e[s]]=n[s];return o})}function uv(t=10){let e="abcdefghijklmnopqrstuvwxyz",r="";for(let n=0;n<t;n++)r+=e[Math.floor(Math.random()*e.length)];return r}function $r(t){return JSON.stringify(t)}var Mo=Error.captureStackTrace?Error.captureStackTrace:(...t)=>{};function Gr(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}var Ui=En(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let t=Function;return new t(""),!0}catch{return!1}});function Wr(t){if(Gr(t)===!1)return!1;let e=t.constructor;if(e===void 0)return!0;let r=e.prototype;return!(Gr(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function lv(t){let e=0;for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}var dv=t=>{let e=typeof t;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(t)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(t)?"array":t===null?"null":t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?"promise":typeof Map<"u"&&t instanceof Map?"map":typeof Set<"u"&&t instanceof Set?"set":typeof Date<"u"&&t instanceof Date?"date":typeof File<"u"&&t instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},Vi=new Set(["string","number","symbol"]),Cd=new Set(["string","number","bigint","boolean","symbol","undefined"]);function Ft(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ge(t,e,r){let n=new t._zod.constr(e??t._zod.def);return(!e||r?.parent)&&(n._zod.parent=t),n}function Z(t){let e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function pv(t){let e;return new Proxy({},{get(r,n,o){return e??(e=t()),Reflect.get(e,n,o)},set(r,n,o,s){return e??(e=t()),Reflect.set(e,n,o,s)},has(r,n){return e??(e=t()),Reflect.has(e,n)},deleteProperty(r,n){return e??(e=t()),Reflect.deleteProperty(e,n)},ownKeys(r){return e??(e=t()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(r,n){return e??(e=t()),Reflect.getOwnPropertyDescriptor(e,n)},defineProperty(r,n,o){return e??(e=t()),Reflect.defineProperty(e,n,o)}})}function Do(t){return typeof t=="bigint"?t.toString()+"n":typeof t=="string"?`"${t}"`:`${t}`}function Fi(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}var Ki={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},jd={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function fv(t,e){let r={},n=t._zod.def;for(let o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&(r[o]=n.shape[o])}return Ge(t,{...t._zod.def,shape:r,checks:[]})}function mv(t,e){let r={...t._zod.def.shape},n=t._zod.def;for(let o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&delete r[o]}return Ge(t,{...t._zod.def,shape:r,checks:[]})}function hv(t,e){if(!Wr(e))throw new Error("Invalid input to extend: expected a plain object");let r={...t._zod.def,get shape(){let n={...t._zod.def.shape,...e};return Li(this,"shape",n),n},checks:[]};return Ge(t,r)}function gv(t,e){return Ge(t,{...t._zod.def,get shape(){let r={...t._zod.def.shape,...e._zod.def.shape};return Li(this,"shape",r),r},catchall:e._zod.def.catchall,checks:[]})}function yv(t,e,r){let n=e._zod.def.shape,o={...n};if(r)for(let s in r){if(!(s in n))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=t?new t({type:"optional",innerType:n[s]}):n[s])}else for(let s in n)o[s]=t?new t({type:"optional",innerType:n[s]}):n[s];return Ge(e,{...e._zod.def,shape:o,checks:[]})}function _v(t,e,r){let n=e._zod.def.shape,o={...n};if(r)for(let s in r){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=new t({type:"nonoptional",innerType:n[s]}))}else for(let s in n)o[s]=new t({type:"nonoptional",innerType:n[s]});return Ge(e,{...e._zod.def,shape:o,checks:[]})}function wr(t,e=0){for(let r=e;r<t.issues.length;r++)if(t.issues[r]?.continue!==!0)return!0;return!1}function vt(t,e){return e.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(t),r})}function Pn(t){return typeof t=="string"?t:t?.message}function ct(t,e,r){let n={...t,path:t.path??[]};if(!t.message){let o=Pn(t.inst?._zod.def?.error?.(t))??Pn(e?.error?.(t))??Pn(r.customError?.(t))??Pn(r.localeError?.(t))??"Invalid input";n.message=o}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}function Od(t){return t instanceof Set?"set":t instanceof Map?"map":t instanceof File?"file":"unknown"}function Cn(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function Hi(...t){let[e,r,n]=t;return typeof e=="string"?{message:e,code:"custom",input:r,inst:n}:{...e}}function vv(t){return Object.entries(t).filter(([e,r])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}var Mi=class{constructor(...e){}};var Nd=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),Object.defineProperty(t,"message",{get(){return JSON.stringify(e,Di,2)},enumerable:!0}),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},qo=_("$ZodError",Nd),jn=_("$ZodError",Nd,{Parent:Error});function Bi(t,e=r=>r.message){let r={},n=[];for(let o of t.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(e(o))):n.push(e(o));return{formErrors:n,fieldErrors:r}}function Ji(t,e){let r=e||function(s){return s.message},n={_errors:[]},o=s=>{for(let i of s.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(a=>o({issues:a}));else if(i.code==="invalid_key")o({issues:i.issues});else if(i.code==="invalid_element")o({issues:i.issues});else if(i.path.length===0)n._errors.push(r(i));else{let a=n,c=0;for(;c<i.path.length;){let u=i.path[c];c===i.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(i))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return o(t),n}var Gi=t=>(e,r,n,o)=>{let s=n?Object.assign(n,{async:!1}):{async:!1},i=e._zod.run({value:r,issues:[]},s);if(i instanceof Promise)throw new Rt;if(i.issues.length){let a=new(o?.Err??t)(i.issues.map(c=>ct(c,s,Je())));throw Mo(a,o?.callee),a}return i.value},Wi=Gi(jn),Xi=t=>async(e,r,n,o)=>{let s=n?Object.assign(n,{async:!0}):{async:!0},i=e._zod.run({value:r,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){let a=new(o?.Err??t)(i.issues.map(c=>ct(c,s,Je())));throw Mo(a,o?.callee),a}return i.value},Yi=Xi(jn),Qi=t=>(e,r,n)=>{let o=n?{...n,async:!1}:{async:!1},s=e._zod.run({value:r,issues:[]},o);if(s instanceof Promise)throw new Rt;return s.issues.length?{success:!1,error:new(t??qo)(s.issues.map(i=>ct(i,o,Je())))}:{success:!0,data:s.value}},kr=Qi(jn),ea=t=>async(e,r,n)=>{let o=n?Object.assign(n,{async:!0}):{async:!0},s=e._zod.run({value:r,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new t(s.issues.map(i=>ct(i,o,Je())))}:{success:!0,data:s.value}},Sr=ea(jn);var Ad=/^[cC][^\s-]{8,}$/,Zd=/^[0-9a-z]+$/,Md=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Dd=/^[0-9a-vA-V]{20}$/,qd=/^[A-Za-z0-9]{27}$/,Ld=/^[a-zA-Z0-9_-]{21}$/,Ud=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/;var Vd=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,ta=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/;var Fd=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;var bv="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Kd(){return new RegExp(bv,"u")}var Hd=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Bd=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,Jd=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Gd=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Wd=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,ra=/^[A-Za-z0-9_-]*$/,Xd=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/;var Yd=/^\+(?:[0-9]){6,14}[0-9]$/,Qd="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",ep=new RegExp(`^${Qd}$`);function tp(t){let e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function rp(t){return new RegExp(`^${tp(t)}$`)}function np(t){let e=tp({precision:t.precision}),r=["Z"];t.local&&r.push(""),t.offset&&r.push("([+-]\\d{2}:\\d{2})");let n=`${e}(?:${r.join("|")})`;return new RegExp(`^${Qd}T(?:${n})$`)}var op=t=>{let e=t?`[\\s\\S]{${t?.minimum??0},${t?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)};var sp=/^\d+$/,ip=/^-?\d+(?:\.\d+)?/i,ap=/true|false/i,cp=/null/i;var up=/^[^A-Z]*$/,lp=/^[^a-z]*$/;var ke=_("$ZodCheck",(t,e)=>{var r;t._zod??(t._zod={}),t._zod.def=e,(r=t._zod).onattach??(r.onattach=[])}),dp={number:"number",bigint:"bigint",object:"date"},na=_("$ZodCheckLessThan",(t,e)=>{ke.init(t,e);let r=dp[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,s=(e.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<s&&(e.inclusive?o.maximum=e.value:o.exclusiveMaximum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value<=e.value:n.value<e.value)||n.issues.push({origin:r,code:"too_big",maximum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),oa=_("$ZodCheckGreaterThan",(t,e)=>{ke.init(t,e);let r=dp[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,s=(e.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>s&&(e.inclusive?o.minimum=e.value:o.exclusiveMinimum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value>=e.value:n.value>e.value)||n.issues.push({origin:r,code:"too_small",minimum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),pp=_("$ZodCheckMultipleOf",(t,e)=>{ke.init(t,e),t._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=e.value)}),t._zod.check=r=>{if(typeof r.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%e.value===BigInt(0):qi(r.value,e.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:e.value,input:r.value,inst:t,continue:!e.abort})}}),fp=_("$ZodCheckNumberFormat",(t,e)=>{ke.init(t,e),e.format=e.format||"float64";let r=e.format?.includes("int"),n=r?"int":"number",[o,s]=Ki[e.format];t._zod.onattach.push(i=>{let a=i._zod.bag;a.format=e.format,a.minimum=o,a.maximum=s,r&&(a.pattern=sp)}),t._zod.check=i=>{let a=i.value;if(r){if(!Number.isInteger(a)){i.issues.push({expected:n,format:e.format,code:"invalid_type",input:a,inst:t});return}if(!Number.isSafeInteger(a)){a>0?i.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort}):i.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort});return}}a<o&&i.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:t,continue:!e.abort}),a>s&&i.issues.push({origin:"number",input:a,code:"too_big",maximum:s,inst:t})}});var mp=_("$ZodCheckMaxLength",(t,e)=>{var r;ke.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!In(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let o=n.value;if(o.length<=e.maximum)return;let i=Cn(o);n.issues.push({origin:i,code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),hp=_("$ZodCheckMinLength",(t,e)=>{var r;ke.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!In(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let o=n.value;if(o.length>=e.minimum)return;let i=Cn(o);n.issues.push({origin:i,code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),gp=_("$ZodCheckLengthEquals",(t,e)=>{var r;ke.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!In(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag;o.minimum=e.length,o.maximum=e.length,o.length=e.length}),t._zod.check=n=>{let o=n.value,s=o.length;if(s===e.length)return;let i=Cn(o),a=s>e.length;n.issues.push({origin:i,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),On=_("$ZodCheckStringFormat",(t,e)=>{var r,n;ke.init(t,e),t._zod.onattach.push(o=>{let s=o._zod.bag;s.format=e.format,e.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(e.pattern))}),e.pattern?(r=t._zod).check??(r.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:e.format,input:o.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(n=t._zod).check??(n.check=()=>{})}),yp=_("$ZodCheckRegex",(t,e)=>{On.init(t,e),t._zod.check=r=>{e.pattern.lastIndex=0,!e.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),_p=_("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=up),On.init(t,e)}),vp=_("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=lp),On.init(t,e)}),xp=_("$ZodCheckIncludes",(t,e)=>{ke.init(t,e);let r=Ft(e.includes),n=new RegExp(typeof e.position=="number"?`^.{${e.position}}${r}`:r);e.pattern=n,t._zod.onattach.push(o=>{let s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),t._zod.check=o=>{o.value.includes(e.includes,e.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:o.value,inst:t,continue:!e.abort})}}),bp=_("$ZodCheckStartsWith",(t,e)=>{ke.init(t,e);let r=new RegExp(`^${Ft(e.prefix)}.*`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.startsWith(e.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:n.value,inst:t,continue:!e.abort})}}),$p=_("$ZodCheckEndsWith",(t,e)=>{ke.init(t,e);let r=new RegExp(`.*${Ft(e.suffix)}$`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.endsWith(e.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:n.value,inst:t,continue:!e.abort})}});var wp=_("$ZodCheckOverwrite",(t,e)=>{ke.init(t,e),t._zod.check=r=>{r.value=e.tx(r.value)}});var Uo=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let n=e.split(`
`).filter(i=>i),o=Math.min(...n.map(i=>i.length-i.trimStart().length)),s=n.map(i=>i.slice(o)).map(i=>" ".repeat(this.indent*2)+i);for(let i of s)this.content.push(i)}compile(){let e=Function,r=this?.args,o=[...(this?.content??[""]).map(s=>`  ${s}`)];return new e(...r,o.join(`
`))}};var Sp={major:4,minor:0,patch:0};var ne=_("$ZodType",(t,e)=>{var r;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=Sp;let n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(let o of n)for(let s of o._zod.onattach)s(t);if(n.length===0)(r=t._zod).deferred??(r.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{let o=(s,i,a)=>{let c=wr(s),u;for(let l of i){if(l._zod.def.when){if(!l._zod.def.when(s))continue}else if(c)continue;let d=s.issues.length,m=l._zod.check(s);if(m instanceof Promise&&a?.async===!1)throw new Rt;if(u||m instanceof Promise)u=(u??Promise.resolve()).then(async()=>{await m,s.issues.length!==d&&(c||(c=wr(s,d)))});else{if(s.issues.length===d)continue;c||(c=wr(s,d))}}return u?u.then(()=>s):s};t._zod.run=(s,i)=>{let a=t._zod.parse(s,i);if(a instanceof Promise){if(i.async===!1)throw new Rt;return a.then(c=>o(c,n,i))}return o(a,n,i)}}t["~standard"]={validate:o=>{try{let s=kr(t,o);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return Sr(t,o).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}}),Nn=_("$ZodString",(t,e)=>{ne.init(t,e),t._zod.pattern=[...t?._zod.bag?.patterns??[]].pop()??op(t._zod.bag),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),ae=_("$ZodStringFormat",(t,e)=>{On.init(t,e),Nn.init(t,e)}),ia=_("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=Vd),ae.init(t,e)}),aa=_("$ZodUUID",(t,e)=>{if(e.version){let n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(n===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=ta(n))}else e.pattern??(e.pattern=ta());ae.init(t,e)}),ca=_("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=Fd),ae.init(t,e)}),ua=_("$ZodURL",(t,e)=>{ae.init(t,e),t._zod.check=r=>{try{let n=r.value,o=new URL(n),s=o.href;e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(o.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:Xd.source,input:r.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:r.value,inst:t,continue:!e.abort})),!n.endsWith("/")&&s.endsWith("/")?r.value=s.slice(0,-1):r.value=s;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:t,continue:!e.abort})}}}),la=_("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=Kd()),ae.init(t,e)}),da=_("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=Ld),ae.init(t,e)}),pa=_("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=Ad),ae.init(t,e)}),fa=_("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=Zd),ae.init(t,e)}),ma=_("$ZodULID",(t,e)=>{e.pattern??(e.pattern=Md),ae.init(t,e)}),ha=_("$ZodXID",(t,e)=>{e.pattern??(e.pattern=Dd),ae.init(t,e)}),ga=_("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=qd),ae.init(t,e)}),Np=_("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=np(e)),ae.init(t,e)}),Ap=_("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=ep),ae.init(t,e)}),Zp=_("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=rp(e)),ae.init(t,e)}),Mp=_("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=Ud),ae.init(t,e)}),ya=_("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=Hd),ae.init(t,e),t._zod.onattach.push(r=>{let n=r._zod.bag;n.format="ipv4"})}),_a=_("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=Bd),ae.init(t,e),t._zod.onattach.push(r=>{let n=r._zod.bag;n.format="ipv6"}),t._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:t,continue:!e.abort})}}}),va=_("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=Jd),ae.init(t,e)}),xa=_("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=Gd),ae.init(t,e),t._zod.check=r=>{let[n,o]=r.value.split("/");try{if(!o)throw new Error;let s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${n}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:t,continue:!e.abort})}}});function Dp(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}var ba=_("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=Wd),ae.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),t._zod.check=r=>{Dp(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:t,continue:!e.abort})}});function $v(t){if(!ra.test(t))return!1;let e=t.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=e.padEnd(Math.ceil(e.length/4)*4,"=");return Dp(r)}var $a=_("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=ra),ae.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),t._zod.check=r=>{$v(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:t,continue:!e.abort})}}),wa=_("$ZodE164",(t,e)=>{e.pattern??(e.pattern=Yd),ae.init(t,e)});function wv(t,e=null){try{let r=t.split(".");if(r.length!==3)return!1;let[n]=r;if(!n)return!1;let o=JSON.parse(atob(n));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||e&&(!("alg"in o)||o.alg!==e))}catch{return!1}}var ka=_("$ZodJWT",(t,e)=>{ae.init(t,e),t._zod.check=r=>{wv(r.value,e.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:t,continue:!e.abort})}});var Fo=_("$ZodNumber",(t,e)=>{ne.init(t,e),t._zod.pattern=t._zod.bag.pattern??ip,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=Number(r.value)}catch{}let o=r.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return r;let s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:o,inst:t,...s?{received:s}:{}}),r}}),Sa=_("$ZodNumber",(t,e)=>{fp.init(t,e),Fo.init(t,e)}),Ta=_("$ZodBoolean",(t,e)=>{ne.init(t,e),t._zod.pattern=ap,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=!!r.value}catch{}let o=r.value;return typeof o=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:t}),r}});var Pa=_("$ZodNull",(t,e)=>{ne.init(t,e),t._zod.pattern=cp,t._zod.values=new Set([null]),t._zod.parse=(r,n)=>{let o=r.value;return o===null||r.issues.push({expected:"null",code:"invalid_type",input:o,inst:t}),r}});var za=_("$ZodUnknown",(t,e)=>{ne.init(t,e),t._zod.parse=r=>r}),Ea=_("$ZodNever",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)});function Tp(t,e,r){t.issues.length&&e.issues.push(...vt(r,t.issues)),e.value[r]=t.value}var Ia=_("$ZodArray",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Array.isArray(o))return r.issues.push({expected:"array",code:"invalid_type",input:o,inst:t}),r;r.value=Array(o.length);let s=[];for(let i=0;i<o.length;i++){let a=o[i],c=e.element._zod.run({value:a,issues:[]},n);c instanceof Promise?s.push(c.then(u=>Tp(u,r,i))):Tp(c,r,i)}return s.length?Promise.all(s).then(()=>r):r}});function Vo(t,e,r){t.issues.length&&e.issues.push(...vt(r,t.issues)),e.value[r]=t.value}function Pp(t,e,r,n){t.issues.length?n[r]===void 0?r in n?e.value[r]=void 0:e.value[r]=t.value:e.issues.push(...vt(r,t.issues)):t.value===void 0?r in n&&(e.value[r]=void 0):e.value[r]=t.value}var Ko=_("$ZodObject",(t,e)=>{ne.init(t,e);let r=En(()=>{let d=Object.keys(e.shape);for(let h of d)if(!(e.shape[h]instanceof ne))throw new Error(`Invalid element at key "${h}": expected a Zod schema`);let m=Fi(e.shape);return{shape:e.shape,keys:d,keySet:new Set(d),numKeys:d.length,optionalKeys:new Set(m)}});ie(t._zod,"propValues",()=>{let d=e.shape,m={};for(let h in d){let p=d[h]._zod;if(p.values){m[h]??(m[h]=new Set);for(let f of p.values)m[h].add(f)}}return m});let n=d=>{let m=new Uo(["shape","payload","ctx"]),h=r.value,p=x=>{let $=$r(x);return`shape[${$}]._zod.run({ value: input[${$}], issues: [] }, ctx)`};m.write("const input = payload.value;");let f=Object.create(null),g=0;for(let x of h.keys)f[x]=`key_${g++}`;m.write("const newResult = {}");for(let x of h.keys)if(h.optionalKeys.has(x)){let $=f[x];m.write(`const ${$} = ${p(x)};`);let k=$r(x);m.write(`
        if (${$}.issues.length) {
          if (input[${k}] === undefined) {
            if (${k} in input) {
              newResult[${k}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${$}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${k}, ...iss.path] : [${k}],
              }))
            );
          }
        } else if (${$}.value === undefined) {
          if (${k} in input) newResult[${k}] = undefined;
        } else {
          newResult[${k}] = ${$}.value;
        }
        `)}else{let $=f[x];m.write(`const ${$} = ${p(x)};`),m.write(`
          if (${$}.issues.length) payload.issues = payload.issues.concat(${$}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${$r(x)}, ...iss.path] : [${$r(x)}]
          })));`),m.write(`newResult[${$r(x)}] = ${$}.value`)}m.write("payload.value = newResult;"),m.write("return payload;");let v=m.compile();return(x,$)=>v(d,x,$)},o,s=Gr,i=!Ao.jitless,c=i&&Ui.value,u=e.catchall,l;t._zod.parse=(d,m)=>{l??(l=r.value);let h=d.value;if(!s(h))return d.issues.push({expected:"object",code:"invalid_type",input:h,inst:t}),d;let p=[];if(i&&c&&m?.async===!1&&m.jitless!==!0)o||(o=n(e.shape)),d=o(d,m);else{d.value={};let $=l.shape;for(let k of l.keys){let E=$[k],M=E._zod.run({value:h[k],issues:[]},m),ve=E._zod.optin==="optional"&&E._zod.optout==="optional";M instanceof Promise?p.push(M.then(Xe=>ve?Pp(Xe,d,k,h):Vo(Xe,d,k))):ve?Pp(M,d,k,h):Vo(M,d,k)}}if(!u)return p.length?Promise.all(p).then(()=>d):d;let f=[],g=l.keySet,v=u._zod,x=v.def.type;for(let $ of Object.keys(h)){if(g.has($))continue;if(x==="never"){f.push($);continue}let k=v.run({value:h[$],issues:[]},m);k instanceof Promise?p.push(k.then(E=>Vo(E,d,$))):Vo(k,d,$)}return f.length&&d.issues.push({code:"unrecognized_keys",keys:f,input:h,inst:t}),p.length?Promise.all(p).then(()=>d):d}});function zp(t,e,r,n){for(let o of t)if(o.issues.length===0)return e.value=o.value,e;return e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(o=>o.issues.map(s=>ct(s,n,Je())))}),e}var Ho=_("$ZodUnion",(t,e)=>{ne.init(t,e),ie(t._zod,"optin",()=>e.options.some(r=>r._zod.optin==="optional")?"optional":void 0),ie(t._zod,"optout",()=>e.options.some(r=>r._zod.optout==="optional")?"optional":void 0),ie(t._zod,"values",()=>{if(e.options.every(r=>r._zod.values))return new Set(e.options.flatMap(r=>Array.from(r._zod.values)))}),ie(t._zod,"pattern",()=>{if(e.options.every(r=>r._zod.pattern)){let r=e.options.map(n=>n._zod.pattern);return new RegExp(`^(${r.map(n=>Rn(n.source)).join("|")})$`)}}),t._zod.parse=(r,n)=>{let o=!1,s=[];for(let i of e.options){let a=i._zod.run({value:r.value,issues:[]},n);if(a instanceof Promise)s.push(a),o=!0;else{if(a.issues.length===0)return a;s.push(a)}}return o?Promise.all(s).then(i=>zp(i,r,t,n)):zp(s,r,t,n)}}),Ra=_("$ZodDiscriminatedUnion",(t,e)=>{Ho.init(t,e);let r=t._zod.parse;ie(t._zod,"propValues",()=>{let o={};for(let s of e.options){let i=s._zod.propValues;if(!i||Object.keys(i).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(let[a,c]of Object.entries(i)){o[a]||(o[a]=new Set);for(let u of c)o[a].add(u)}}return o});let n=En(()=>{let o=e.options,s=new Map;for(let i of o){let a=i._zod.propValues[e.discriminator];if(!a||a.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(i)}"`);for(let c of a){if(s.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);s.set(c,i)}}return s});t._zod.parse=(o,s)=>{let i=o.value;if(!Gr(i))return o.issues.push({code:"invalid_type",expected:"object",input:i,inst:t}),o;let a=n.value.get(i?.[e.discriminator]);return a?a._zod.run(o,s):e.unionFallback?r(o,s):(o.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:i,path:[e.discriminator],inst:t}),o)}}),Ca=_("$ZodIntersection",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=r.value,s=e.left._zod.run({value:o,issues:[]},n),i=e.right._zod.run({value:o,issues:[]},n);return s instanceof Promise||i instanceof Promise?Promise.all([s,i]).then(([c,u])=>Ep(r,c,u)):Ep(r,s,i)}});function sa(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(Wr(t)&&Wr(e)){let r=Object.keys(e),n=Object.keys(t).filter(s=>r.indexOf(s)!==-1),o={...t,...e};for(let s of n){let i=sa(t[s],e[s]);if(!i.valid)return{valid:!1,mergeErrorPath:[s,...i.mergeErrorPath]};o[s]=i.data}return{valid:!0,data:o}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};let r=[];for(let n=0;n<t.length;n++){let o=t[n],s=e[n],i=sa(o,s);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};r.push(i.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function Ep(t,e,r){if(e.issues.length&&t.issues.push(...e.issues),r.issues.length&&t.issues.push(...r.issues),wr(t))return t;let n=sa(e.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return t.value=n.data,t}var ja=_("$ZodRecord",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Wr(o))return r.issues.push({expected:"record",code:"invalid_type",input:o,inst:t}),r;let s=[];if(e.keyType._zod.values){let i=e.keyType._zod.values;r.value={};for(let c of i)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){let u=e.valueType._zod.run({value:o[c],issues:[]},n);u instanceof Promise?s.push(u.then(l=>{l.issues.length&&r.issues.push(...vt(c,l.issues)),r.value[c]=l.value})):(u.issues.length&&r.issues.push(...vt(c,u.issues)),r.value[c]=u.value)}let a;for(let c in o)i.has(c)||(a=a??[],a.push(c));a&&a.length>0&&r.issues.push({code:"unrecognized_keys",input:o,inst:t,keys:a})}else{r.value={};for(let i of Reflect.ownKeys(o)){if(i==="__proto__")continue;let a=e.keyType._zod.run({value:i,issues:[]},n);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){r.issues.push({origin:"record",code:"invalid_key",issues:a.issues.map(u=>ct(u,n,Je())),input:i,path:[i],inst:t}),r.value[a.value]=a.value;continue}let c=e.valueType._zod.run({value:o[i],issues:[]},n);c instanceof Promise?s.push(c.then(u=>{u.issues.length&&r.issues.push(...vt(i,u.issues)),r.value[a.value]=u.value})):(c.issues.length&&r.issues.push(...vt(i,c.issues)),r.value[a.value]=c.value)}}return s.length?Promise.all(s).then(()=>r):r}});var Oa=_("$ZodEnum",(t,e)=>{ne.init(t,e);let r=zn(e.entries);t._zod.values=new Set(r),t._zod.pattern=new RegExp(`^(${r.filter(n=>Vi.has(typeof n)).map(n=>typeof n=="string"?Ft(n):n.toString()).join("|")})$`),t._zod.parse=(n,o)=>{let s=n.value;return t._zod.values.has(s)||n.issues.push({code:"invalid_value",values:r,input:s,inst:t}),n}}),Na=_("$ZodLiteral",(t,e)=>{ne.init(t,e),t._zod.values=new Set(e.values),t._zod.pattern=new RegExp(`^(${e.values.map(r=>typeof r=="string"?Ft(r):r?r.toString():String(r)).join("|")})$`),t._zod.parse=(r,n)=>{let o=r.value;return t._zod.values.has(o)||r.issues.push({code:"invalid_value",values:e.values,input:o,inst:t}),r}});var Aa=_("$ZodTransform",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=e.transform(r.value,r);if(n.async)return(o instanceof Promise?o:Promise.resolve(o)).then(i=>(r.value=i,r));if(o instanceof Promise)throw new Rt;return r.value=o,r}}),Za=_("$ZodOptional",(t,e)=>{ne.init(t,e),t._zod.optin="optional",t._zod.optout="optional",ie(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),ie(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Rn(r.source)})?$`):void 0}),t._zod.parse=(r,n)=>e.innerType._zod.optin==="optional"?e.innerType._zod.run(r,n):r.value===void 0?r:e.innerType._zod.run(r,n)}),Ma=_("$ZodNullable",(t,e)=>{ne.init(t,e),ie(t._zod,"optin",()=>e.innerType._zod.optin),ie(t._zod,"optout",()=>e.innerType._zod.optout),ie(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Rn(r.source)}|null)$`):void 0}),ie(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(r,n)=>r.value===null?r:e.innerType._zod.run(r,n)}),Da=_("$ZodDefault",(t,e)=>{ne.init(t,e),t._zod.optin="optional",ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(r.value===void 0)return r.value=e.defaultValue,r;let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>Ip(s,e)):Ip(o,e)}});function Ip(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}var qa=_("$ZodPrefault",(t,e)=>{ne.init(t,e),t._zod.optin="optional",ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>(r.value===void 0&&(r.value=e.defaultValue),e.innerType._zod.run(r,n))}),La=_("$ZodNonOptional",(t,e)=>{ne.init(t,e),ie(t._zod,"values",()=>{let r=e.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>Rp(s,t)):Rp(o,t)}});function Rp(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}var Ua=_("$ZodCatch",(t,e)=>{ne.init(t,e),t._zod.optin="optional",ie(t._zod,"optout",()=>e.innerType._zod.optout),ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>(r.value=s.value,s.issues.length&&(r.value=e.catchValue({...r,error:{issues:s.issues.map(i=>ct(i,n,Je()))},input:r.value}),r.issues=[]),r)):(r.value=o.value,o.issues.length&&(r.value=e.catchValue({...r,error:{issues:o.issues.map(s=>ct(s,n,Je()))},input:r.value}),r.issues=[]),r)}});var Va=_("$ZodPipe",(t,e)=>{ne.init(t,e),ie(t._zod,"values",()=>e.in._zod.values),ie(t._zod,"optin",()=>e.in._zod.optin),ie(t._zod,"optout",()=>e.out._zod.optout),t._zod.parse=(r,n)=>{let o=e.in._zod.run(r,n);return o instanceof Promise?o.then(s=>Cp(s,e,n)):Cp(o,e,n)}});function Cp(t,e,r){return wr(t)?t:e.out._zod.run({value:t.value,issues:t.issues},r)}var Fa=_("$ZodReadonly",(t,e)=>{ne.init(t,e),ie(t._zod,"propValues",()=>e.innerType._zod.propValues),ie(t._zod,"values",()=>e.innerType._zod.values),ie(t._zod,"optin",()=>e.innerType._zod.optin),ie(t._zod,"optout",()=>e.innerType._zod.optout),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(jp):jp(o)}});function jp(t){return t.value=Object.freeze(t.value),t}var Ka=_("$ZodCustom",(t,e)=>{ke.init(t,e),ne.init(t,e),t._zod.parse=(r,n)=>r,t._zod.check=r=>{let n=r.value,o=e.fn(n);if(o instanceof Promise)return o.then(s=>Op(s,r,n,t));Op(o,r,n,t)}});function Op(t,e,r,n){if(!t){let o={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(o.params=n._zod.def.params),e.issues.push(Hi(o))}}var kv=t=>{let e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return e},Sv=()=>{let t={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function e(n){return t[n]??null}let r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return n=>{switch(n.code){case"invalid_type":return`Invalid input: expected ${n.expected}, received ${kv(n.input)}`;case"invalid_value":return n.values.length===1?`Invalid input: expected ${Do(n.values[0])}`:`Invalid option: expected one of ${Zo(n.values,"|")}`;case"too_big":{let o=n.inclusive?"<=":"<",s=e(n.origin);return s?`Too big: expected ${n.origin??"value"} to have ${o}${n.maximum.toString()} ${s.unit??"elements"}`:`Too big: expected ${n.origin??"value"} to be ${o}${n.maximum.toString()}`}case"too_small":{let o=n.inclusive?">=":">",s=e(n.origin);return s?`Too small: expected ${n.origin} to have ${o}${n.minimum.toString()} ${s.unit}`:`Too small: expected ${n.origin} to be ${o}${n.minimum.toString()}`}case"invalid_format":{let o=n;return o.format==="starts_with"?`Invalid string: must start with "${o.prefix}"`:o.format==="ends_with"?`Invalid string: must end with "${o.suffix}"`:o.format==="includes"?`Invalid string: must include "${o.includes}"`:o.format==="regex"?`Invalid string: must match pattern ${o.pattern}`:`Invalid ${r[o.format]??n.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${n.divisor}`;case"unrecognized_keys":return`Unrecognized key${n.keys.length>1?"s":""}: ${Zo(n.keys,", ")}`;case"invalid_key":return`Invalid key in ${n.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${n.origin}`;default:return"Invalid input"}}};function qp(){return{localeError:Sv()}}var An=class{constructor(){this._map=new Map,this._idmap=new Map}add(e,...r){let n=r[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let r=this._map.get(e);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(e),this}get(e){let r=e._zod.parent;if(r){let n={...this.get(r)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}};function Lp(){return new An}var Kt=Lp();function Ha(t,e){return new t({type:"string",...Z(e)})}function Ba(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...Z(e)})}function Bo(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...Z(e)})}function Ja(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...Z(e)})}function Ga(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...Z(e)})}function Wa(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...Z(e)})}function Xa(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...Z(e)})}function Ya(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...Z(e)})}function Qa(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...Z(e)})}function ec(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...Z(e)})}function tc(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...Z(e)})}function rc(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...Z(e)})}function nc(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...Z(e)})}function oc(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...Z(e)})}function sc(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...Z(e)})}function ic(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...Z(e)})}function ac(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...Z(e)})}function cc(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...Z(e)})}function uc(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...Z(e)})}function lc(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...Z(e)})}function dc(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...Z(e)})}function pc(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...Z(e)})}function fc(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...Z(e)})}function Up(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...Z(e)})}function Vp(t,e){return new t({type:"string",format:"date",check:"string_format",...Z(e)})}function Fp(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...Z(e)})}function Kp(t,e){return new t({type:"string",format:"duration",check:"string_format",...Z(e)})}function mc(t,e){return new t({type:"number",checks:[],...Z(e)})}function hc(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...Z(e)})}function gc(t,e){return new t({type:"boolean",...Z(e)})}function yc(t,e){return new t({type:"null",...Z(e)})}function _c(t){return new t({type:"unknown"})}function vc(t,e){return new t({type:"never",...Z(e)})}function Jo(t,e){return new na({check:"less_than",...Z(e),value:t,inclusive:!1})}function Zn(t,e){return new na({check:"less_than",...Z(e),value:t,inclusive:!0})}function Go(t,e){return new oa({check:"greater_than",...Z(e),value:t,inclusive:!1})}function Mn(t,e){return new oa({check:"greater_than",...Z(e),value:t,inclusive:!0})}function Wo(t,e){return new pp({check:"multiple_of",...Z(e),value:t})}function Xo(t,e){return new mp({check:"max_length",...Z(e),maximum:t})}function Xr(t,e){return new hp({check:"min_length",...Z(e),minimum:t})}function Yo(t,e){return new gp({check:"length_equals",...Z(e),length:t})}function xc(t,e){return new yp({check:"string_format",format:"regex",...Z(e),pattern:t})}function bc(t){return new _p({check:"string_format",format:"lowercase",...Z(t)})}function $c(t){return new vp({check:"string_format",format:"uppercase",...Z(t)})}function wc(t,e){return new xp({check:"string_format",format:"includes",...Z(e),includes:t})}function kc(t,e){return new bp({check:"string_format",format:"starts_with",...Z(e),prefix:t})}function Sc(t,e){return new $p({check:"string_format",format:"ends_with",...Z(e),suffix:t})}function Tr(t){return new wp({check:"overwrite",tx:t})}function Tc(t){return Tr(e=>e.normalize(t))}function Pc(){return Tr(t=>t.trim())}function zc(){return Tr(t=>t.toLowerCase())}function Ec(){return Tr(t=>t.toUpperCase())}function Hp(t,e,r){return new t({type:"array",element:e,...Z(r)})}function Ic(t,e,r){let n=Z(r);return n.abort??(n.abort=!0),new t({type:"custom",check:"custom",fn:e,...n})}function Rc(t,e,r){return new t({type:"custom",check:"custom",fn:e,...Z(r)})}var Qo=class{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??Kt,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,r={path:[],schemaPath:[]}){var n;let o=e._zod.def,s={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},i=this.seen.get(e);if(i)return i.count++,r.schemaPath.includes(e)&&(i.cycle=r.path),i.schema;let a={schema:{},count:1,cycle:void 0,path:r.path};this.seen.set(e,a);let c=e._zod.toJSONSchema?.();if(c)a.schema=c;else{let d={...r,schemaPath:[...r.schemaPath,e],path:r.path},m=e._zod.parent;if(m)a.ref=m,this.process(m,d),this.seen.get(m).isParent=!0;else{let h=a.schema;switch(o.type){case"string":{let p=h;p.type="string";let{minimum:f,maximum:g,format:v,patterns:x,contentEncoding:$}=e._zod.bag;if(typeof f=="number"&&(p.minLength=f),typeof g=="number"&&(p.maxLength=g),v&&(p.format=s[v]??v,p.format===""&&delete p.format),$&&(p.contentEncoding=$),x&&x.size>0){let k=[...x];k.length===1?p.pattern=k[0].source:k.length>1&&(a.schema.allOf=[...k.map(E=>({...this.target==="draft-7"?{type:"string"}:{},pattern:E.source}))])}break}case"number":{let p=h,{minimum:f,maximum:g,format:v,multipleOf:x,exclusiveMaximum:$,exclusiveMinimum:k}=e._zod.bag;typeof v=="string"&&v.includes("int")?p.type="integer":p.type="number",typeof k=="number"&&(p.exclusiveMinimum=k),typeof f=="number"&&(p.minimum=f,typeof k=="number"&&(k>=f?delete p.minimum:delete p.exclusiveMinimum)),typeof $=="number"&&(p.exclusiveMaximum=$),typeof g=="number"&&(p.maximum=g,typeof $=="number"&&($<=g?delete p.maximum:delete p.exclusiveMaximum)),typeof x=="number"&&(p.multipleOf=x);break}case"boolean":{let p=h;p.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{h.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{h.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{let p=h,{minimum:f,maximum:g}=e._zod.bag;typeof f=="number"&&(p.minItems=f),typeof g=="number"&&(p.maxItems=g),p.type="array",p.items=this.process(o.element,{...d,path:[...d.path,"items"]});break}case"object":{let p=h;p.type="object",p.properties={};let f=o.shape;for(let x in f)p.properties[x]=this.process(f[x],{...d,path:[...d.path,"properties",x]});let g=new Set(Object.keys(f)),v=new Set([...g].filter(x=>{let $=o.shape[x]._zod;return this.io==="input"?$.optin===void 0:$.optout===void 0}));v.size>0&&(p.required=Array.from(v)),o.catchall?._zod.def.type==="never"?p.additionalProperties=!1:o.catchall?o.catchall&&(p.additionalProperties=this.process(o.catchall,{...d,path:[...d.path,"additionalProperties"]})):this.io==="output"&&(p.additionalProperties=!1);break}case"union":{let p=h;p.anyOf=o.options.map((f,g)=>this.process(f,{...d,path:[...d.path,"anyOf",g]}));break}case"intersection":{let p=h,f=this.process(o.left,{...d,path:[...d.path,"allOf",0]}),g=this.process(o.right,{...d,path:[...d.path,"allOf",1]}),v=$=>"allOf"in $&&Object.keys($).length===1,x=[...v(f)?f.allOf:[f],...v(g)?g.allOf:[g]];p.allOf=x;break}case"tuple":{let p=h;p.type="array";let f=o.items.map((x,$)=>this.process(x,{...d,path:[...d.path,"prefixItems",$]}));if(this.target==="draft-2020-12"?p.prefixItems=f:p.items=f,o.rest){let x=this.process(o.rest,{...d,path:[...d.path,"items"]});this.target==="draft-2020-12"?p.items=x:p.additionalItems=x}o.rest&&(p.items=this.process(o.rest,{...d,path:[...d.path,"items"]}));let{minimum:g,maximum:v}=e._zod.bag;typeof g=="number"&&(p.minItems=g),typeof v=="number"&&(p.maxItems=v);break}case"record":{let p=h;p.type="object",p.propertyNames=this.process(o.keyType,{...d,path:[...d.path,"propertyNames"]}),p.additionalProperties=this.process(o.valueType,{...d,path:[...d.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{let p=h,f=zn(o.entries);f.every(g=>typeof g=="number")&&(p.type="number"),f.every(g=>typeof g=="string")&&(p.type="string"),p.enum=f;break}case"literal":{let p=h,f=[];for(let g of o.values)if(g===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof g=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");f.push(Number(g))}else f.push(g);if(f.length!==0)if(f.length===1){let g=f[0];p.type=g===null?"null":typeof g,p.const=g}else f.every(g=>typeof g=="number")&&(p.type="number"),f.every(g=>typeof g=="string")&&(p.type="string"),f.every(g=>typeof g=="boolean")&&(p.type="string"),f.every(g=>g===null)&&(p.type="null"),p.enum=f;break}case"file":{let p=h,f={type:"string",format:"binary",contentEncoding:"binary"},{minimum:g,maximum:v,mime:x}=e._zod.bag;g!==void 0&&(f.minLength=g),v!==void 0&&(f.maxLength=v),x?x.length===1?(f.contentMediaType=x[0],Object.assign(p,f)):p.anyOf=x.map($=>({...f,contentMediaType:$})):Object.assign(p,f);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{let p=this.process(o.innerType,d);h.anyOf=[p,{type:"null"}];break}case"nonoptional":{this.process(o.innerType,d),a.ref=o.innerType;break}case"success":{let p=h;p.type="boolean";break}case"default":{this.process(o.innerType,d),a.ref=o.innerType,h.default=JSON.parse(JSON.stringify(o.defaultValue));break}case"prefault":{this.process(o.innerType,d),a.ref=o.innerType,this.io==="input"&&(h._prefault=JSON.parse(JSON.stringify(o.defaultValue)));break}case"catch":{this.process(o.innerType,d),a.ref=o.innerType;let p;try{p=o.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}h.default=p;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{let p=h,f=e._zod.pattern;if(!f)throw new Error("Pattern not found in template literal");p.type="string",p.pattern=f.source;break}case"pipe":{let p=this.io==="input"?o.in._zod.def.type==="transform"?o.out:o.in:o.out;this.process(p,d),a.ref=p;break}case"readonly":{this.process(o.innerType,d),a.ref=o.innerType,h.readOnly=!0;break}case"promise":{this.process(o.innerType,d),a.ref=o.innerType;break}case"optional":{this.process(o.innerType,d),a.ref=o.innerType;break}case"lazy":{let p=e._zod.innerType;this.process(p,d),a.ref=p;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}default:}}}let u=this.metadataRegistry.get(e);return u&&Object.assign(a.schema,u),this.io==="input"&&be(e)&&(delete a.schema.examples,delete a.schema.default),this.io==="input"&&a.schema._prefault&&((n=a.schema).default??(n.default=a.schema._prefault)),delete a.schema._prefault,this.seen.get(e).schema}emit(e,r){let n={cycles:r?.cycles??"ref",reused:r?.reused??"inline",external:r?.external??void 0},o=this.seen.get(e);if(!o)throw new Error("Unprocessed schema. This is a bug in Zod.");let s=l=>{let d=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){let f=n.external.registry.get(l[0])?.id,g=n.external.uri??(x=>x);if(f)return{ref:g(f)};let v=l[1].defId??l[1].schema.id??`schema${this.counter++}`;return l[1].defId=v,{defId:v,ref:`${g("__shared")}#/${d}/${v}`}}if(l[1]===o)return{ref:"#"};let h=`#/${d}/`,p=l[1].schema.id??`__schema${this.counter++}`;return{defId:p,ref:h+p}},i=l=>{if(l[1].schema.$ref)return;let d=l[1],{ref:m,defId:h}=s(l);d.def={...d.schema},h&&(d.defId=h);let p=d.schema;for(let f in p)delete p[f];p.$ref=m};if(n.cycles==="throw")for(let l of this.seen.entries()){let d=l[1];if(d.cycle)throw new Error(`Cycle detected: #/${d.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let l of this.seen.entries()){let d=l[1];if(e===l[0]){i(l);continue}if(n.external){let h=n.external.registry.get(l[0])?.id;if(e!==l[0]&&h){i(l);continue}}if(this.metadataRegistry.get(l[0])?.id){i(l);continue}if(d.cycle){i(l);continue}if(d.count>1&&n.reused==="ref"){i(l);continue}}let a=(l,d)=>{let m=this.seen.get(l),h=m.def??m.schema,p={...h};if(m.ref===null)return;let f=m.ref;if(m.ref=null,f){a(f,d);let g=this.seen.get(f).schema;g.$ref&&d.target==="draft-7"?(h.allOf=h.allOf??[],h.allOf.push(g)):(Object.assign(h,g),Object.assign(h,p))}m.isParent||this.override({zodSchema:l,jsonSchema:h,path:m.path??[]})};for(let l of[...this.seen.entries()].reverse())a(l[0],{target:this.target});let c={};if(this.target==="draft-2020-12"?c.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?c.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),n.external?.uri){let l=n.external.registry.get(e)?.id;if(!l)throw new Error("Schema is missing an `id` property");c.$id=n.external.uri(l)}Object.assign(c,o.def);let u=n.external?.defs??{};for(let l of this.seen.entries()){let d=l[1];d.def&&d.defId&&(u[d.defId]=d.def)}n.external||Object.keys(u).length>0&&(this.target==="draft-2020-12"?c.$defs=u:c.definitions=u);try{return JSON.parse(JSON.stringify(c))}catch{throw new Error("Error converting schema to JSON.")}}};function Cc(t,e){if(t instanceof An){let n=new Qo(e),o={};for(let a of t._idmap.entries()){let[c,u]=a;n.process(u)}let s={},i={registry:t,uri:e?.uri,defs:o};for(let a of t._idmap.entries()){let[c,u]=a;s[c]=n.emit(u,{...e,external:i})}if(Object.keys(o).length>0){let a=n.target==="draft-2020-12"?"$defs":"definitions";s.__shared={[a]:o}}return{schemas:s}}let r=new Qo(e);return r.process(t),r.emit(t,e)}function be(t,e){let r=e??{seen:new Set};if(r.seen.has(t))return!1;r.seen.add(t);let o=t._zod.def;switch(o.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return be(o.element,r);case"object":{for(let s in o.shape)if(be(o.shape[s],r))return!0;return!1}case"union":{for(let s of o.options)if(be(s,r))return!0;return!1}case"intersection":return be(o.left,r)||be(o.right,r);case"tuple":{for(let s of o.items)if(be(s,r))return!0;return!!(o.rest&&be(o.rest,r))}case"record":return be(o.keyType,r)||be(o.valueType,r);case"map":return be(o.keyType,r)||be(o.valueType,r);case"set":return be(o.valueType,r);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return be(o.innerType,r);case"lazy":return be(o.getter(),r);case"default":return be(o.innerType,r);case"prefault":return be(o.innerType,r);case"custom":return!1;case"transform":return!0;case"pipe":return be(o.in,r)||be(o.out,r);case"success":return!1;case"catch":return!1;default:}throw new Error(`Unknown schema type: ${o.type}`)}var ix=_("ZodMiniType",(t,e)=>{if(!t._zod)throw new Error("Uninitialized schema in ZodMiniType.");ne.init(t,e),t.def=e,t.parse=(r,n)=>Wi(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>kr(t,r,n),t.parseAsync=async(r,n)=>Yi(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>Sr(t,r,n),t.check=(...r)=>t.clone({...e,checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),t.clone=(r,n)=>Ge(t,r,n),t.brand=()=>t,t.register=((r,n)=>(r.add(t,n),t))});var ax=_("ZodMiniObject",(t,e)=>{Ko.init(t,e),ix.init(t,e),J.defineLazy(t,"shape",()=>e.shape)});function jc(t,e){let r={type:"object",get shape(){return J.assignProp(this,"shape",{...t}),this.shape},...J.normalizeParams(e)};return new ax(r)}function et(t){return!!t._zod}function zr(t){let e=Object.values(t);if(e.length===0)return jc({});let r=e.every(et),n=e.every(o=>!et(o));if(r)return jc(t);if(n)return Ai(t);throw new Error("Mixed Zod versions detected in object shape.")}function Ht(t,e){return et(t)?kr(t,e):t.safeParse(e)}async function es(t,e){return et(t)?await Sr(t,e):await t.safeParseAsync(e)}function Bt(t){if(!t)return;let e;if(et(t)?e=t._zod?.def?.shape:e=t.shape,!!e){if(typeof e=="function")try{return e()}catch{return}return e}}function Yr(t){if(t){if(typeof t=="object"){let e=t,r=t;if(!e._def&&!r._zod){let n=Object.values(t);if(n.length>0&&n.every(o=>typeof o=="object"&&o!==null&&(o._def!==void 0||o._zod!==void 0||typeof o.parse=="function")))return zr(t)}}if(et(t)){let r=t._zod?.def;if(r&&(r.type==="object"||r.shape!==void 0))return t}else if(t.shape!==void 0)return t}}function ts(t){if(t&&typeof t=="object"){if("message"in t&&typeof t.message=="string")return t.message;if("issues"in t&&Array.isArray(t.issues)&&t.issues.length>0){let e=t.issues[0];if(e&&typeof e=="object"&&"message"in e)return String(e.message)}try{return JSON.stringify(t)}catch{return String(t)}}return String(t)}function Jp(t){return t.description}function Gp(t){if(et(t))return t._zod?.def?.type==="optional";let e=t;return typeof t.isOptional=="function"?t.isOptional():e._def?.typeName==="ZodOptional"}function rs(t){if(et(t)){let s=t._zod?.def;if(s){if(s.value!==void 0)return s.value;if(Array.isArray(s.values)&&s.values.length>0)return s.values[0]}}let r=t._def;if(r){if(r.value!==void 0)return r.value;if(Array.isArray(r.values)&&r.values.length>0)return r.values[0]}let n=t.value;if(n!==void 0)return n}var Dn={};Ci(Dn,{ZodISODate:()=>Xp,ZodISODateTime:()=>Wp,ZodISODuration:()=>Qp,ZodISOTime:()=>Yp,date:()=>Nc,datetime:()=>Oc,duration:()=>Zc,time:()=>Ac});var Wp=_("ZodISODateTime",(t,e)=>{Np.init(t,e),de.init(t,e)});function Oc(t){return Up(Wp,t)}var Xp=_("ZodISODate",(t,e)=>{Ap.init(t,e),de.init(t,e)});function Nc(t){return Vp(Xp,t)}var Yp=_("ZodISOTime",(t,e)=>{Zp.init(t,e),de.init(t,e)});function Ac(t){return Fp(Yp,t)}var Qp=_("ZodISODuration",(t,e)=>{Mp.init(t,e),de.init(t,e)});function Zc(t){return Kp(Qp,t)}var ef=(t,e)=>{qo.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:r=>Ji(t,r)},flatten:{value:r=>Bi(t,r)},addIssue:{value:r=>t.issues.push(r)},addIssues:{value:r=>t.issues.push(...r)},isEmpty:{get(){return t.issues.length===0}}})},cI=_("ZodError",ef),qn=_("ZodError",ef,{Parent:Error});var tf=Gi(qn),rf=Xi(qn),nf=Qi(qn),of=ea(qn);var ge=_("ZodType",(t,e)=>(ne.init(t,e),t.def=e,Object.defineProperty(t,"_def",{value:e}),t.check=(...r)=>t.clone({...e,checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),t.clone=(r,n)=>Ge(t,r,n),t.brand=()=>t,t.register=((r,n)=>(r.add(t,n),t)),t.parse=(r,n)=>tf(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>nf(t,r,n),t.parseAsync=async(r,n)=>rf(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>of(t,r,n),t.spa=t.safeParseAsync,t.refine=(r,n)=>t.check(ob(r,n)),t.superRefine=r=>t.check(sb(r)),t.overwrite=r=>t.check(Tr(r)),t.optional=()=>he(t),t.nullable=()=>cf(t),t.nullish=()=>he(cf(t)),t.nonoptional=r=>Xx(t,r),t.array=()=>G(t),t.or=r=>ce([t,r]),t.and=r=>os(t,r),t.transform=r=>Dc(t,ff(r)),t.default=r=>Jx(t,r),t.prefault=r=>Wx(t,r),t.catch=r=>Qx(t,r),t.pipe=r=>Dc(t,r),t.readonly=()=>rb(t),t.describe=r=>{let n=t.clone();return Kt.add(n,{description:r}),n},Object.defineProperty(t,"description",{get(){return Kt.get(t)?.description},configurable:!0}),t.meta=(...r)=>{if(r.length===0)return Kt.get(t);let n=t.clone();return Kt.add(n,r[0]),n},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),uf=_("_ZodString",(t,e)=>{Nn.init(t,e),ge.init(t,e);let r=t._zod.bag;t.format=r.format??null,t.minLength=r.minimum??null,t.maxLength=r.maximum??null,t.regex=(...n)=>t.check(xc(...n)),t.includes=(...n)=>t.check(wc(...n)),t.startsWith=(...n)=>t.check(kc(...n)),t.endsWith=(...n)=>t.check(Sc(...n)),t.min=(...n)=>t.check(Xr(...n)),t.max=(...n)=>t.check(Xo(...n)),t.length=(...n)=>t.check(Yo(...n)),t.nonempty=(...n)=>t.check(Xr(1,...n)),t.lowercase=n=>t.check(bc(n)),t.uppercase=n=>t.check($c(n)),t.trim=()=>t.check(Pc()),t.normalize=(...n)=>t.check(Tc(...n)),t.toLowerCase=()=>t.check(zc()),t.toUpperCase=()=>t.check(Ec())}),gx=_("ZodString",(t,e)=>{Nn.init(t,e),uf.init(t,e),t.email=r=>t.check(Ba(yx,r)),t.url=r=>t.check(Ya(_x,r)),t.jwt=r=>t.check(fc(jx,r)),t.emoji=r=>t.check(Qa(vx,r)),t.guid=r=>t.check(Bo(sf,r)),t.uuid=r=>t.check(Ja(ns,r)),t.uuidv4=r=>t.check(Ga(ns,r)),t.uuidv6=r=>t.check(Wa(ns,r)),t.uuidv7=r=>t.check(Xa(ns,r)),t.nanoid=r=>t.check(ec(xx,r)),t.guid=r=>t.check(Bo(sf,r)),t.cuid=r=>t.check(tc(bx,r)),t.cuid2=r=>t.check(rc($x,r)),t.ulid=r=>t.check(nc(wx,r)),t.base64=r=>t.check(lc(Ix,r)),t.base64url=r=>t.check(dc(Rx,r)),t.xid=r=>t.check(oc(kx,r)),t.ksuid=r=>t.check(sc(Sx,r)),t.ipv4=r=>t.check(ic(Tx,r)),t.ipv6=r=>t.check(ac(Px,r)),t.cidrv4=r=>t.check(cc(zx,r)),t.cidrv6=r=>t.check(uc(Ex,r)),t.e164=r=>t.check(pc(Cx,r)),t.datetime=r=>t.check(Oc(r)),t.date=r=>t.check(Nc(r)),t.time=r=>t.check(Ac(r)),t.duration=r=>t.check(Zc(r))});function y(t){return Ha(gx,t)}var de=_("ZodStringFormat",(t,e)=>{ae.init(t,e),uf.init(t,e)}),yx=_("ZodEmail",(t,e)=>{ca.init(t,e),de.init(t,e)});var sf=_("ZodGUID",(t,e)=>{ia.init(t,e),de.init(t,e)});var ns=_("ZodUUID",(t,e)=>{aa.init(t,e),de.init(t,e)});var _x=_("ZodURL",(t,e)=>{ua.init(t,e),de.init(t,e)});var vx=_("ZodEmoji",(t,e)=>{la.init(t,e),de.init(t,e)});var xx=_("ZodNanoID",(t,e)=>{da.init(t,e),de.init(t,e)});var bx=_("ZodCUID",(t,e)=>{pa.init(t,e),de.init(t,e)});var $x=_("ZodCUID2",(t,e)=>{fa.init(t,e),de.init(t,e)});var wx=_("ZodULID",(t,e)=>{ma.init(t,e),de.init(t,e)});var kx=_("ZodXID",(t,e)=>{ha.init(t,e),de.init(t,e)});var Sx=_("ZodKSUID",(t,e)=>{ga.init(t,e),de.init(t,e)});var Tx=_("ZodIPv4",(t,e)=>{ya.init(t,e),de.init(t,e)});var Px=_("ZodIPv6",(t,e)=>{_a.init(t,e),de.init(t,e)});var zx=_("ZodCIDRv4",(t,e)=>{va.init(t,e),de.init(t,e)});var Ex=_("ZodCIDRv6",(t,e)=>{xa.init(t,e),de.init(t,e)});var Ix=_("ZodBase64",(t,e)=>{ba.init(t,e),de.init(t,e)});var Rx=_("ZodBase64URL",(t,e)=>{$a.init(t,e),de.init(t,e)});var Cx=_("ZodE164",(t,e)=>{wa.init(t,e),de.init(t,e)});var jx=_("ZodJWT",(t,e)=>{ka.init(t,e),de.init(t,e)});var lf=_("ZodNumber",(t,e)=>{Fo.init(t,e),ge.init(t,e),t.gt=(n,o)=>t.check(Go(n,o)),t.gte=(n,o)=>t.check(Mn(n,o)),t.min=(n,o)=>t.check(Mn(n,o)),t.lt=(n,o)=>t.check(Jo(n,o)),t.lte=(n,o)=>t.check(Zn(n,o)),t.max=(n,o)=>t.check(Zn(n,o)),t.int=n=>t.check(af(n)),t.safe=n=>t.check(af(n)),t.positive=n=>t.check(Go(0,n)),t.nonnegative=n=>t.check(Mn(0,n)),t.negative=n=>t.check(Jo(0,n)),t.nonpositive=n=>t.check(Zn(0,n)),t.multipleOf=(n,o)=>t.check(Wo(n,o)),t.step=(n,o)=>t.check(Wo(n,o)),t.finite=()=>t;let r=t._zod.bag;t.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),t.isFinite=!0,t.format=r.format??null});function re(t){return mc(lf,t)}var Ox=_("ZodNumberFormat",(t,e)=>{Sa.init(t,e),lf.init(t,e)});function af(t){return hc(Ox,t)}var Nx=_("ZodBoolean",(t,e)=>{Ta.init(t,e),ge.init(t,e)});function $e(t){return gc(Nx,t)}var Ax=_("ZodNull",(t,e)=>{Pa.init(t,e),ge.init(t,e)});function qc(t){return yc(Ax,t)}var Zx=_("ZodUnknown",(t,e)=>{za.init(t,e),ge.init(t,e)});function pe(){return _c(Zx)}var Mx=_("ZodNever",(t,e)=>{Ea.init(t,e),ge.init(t,e)});function Dx(t){return vc(Mx,t)}var qx=_("ZodArray",(t,e)=>{Ia.init(t,e),ge.init(t,e),t.element=e.element,t.min=(r,n)=>t.check(Xr(r,n)),t.nonempty=r=>t.check(Xr(1,r)),t.max=(r,n)=>t.check(Xo(r,n)),t.length=(r,n)=>t.check(Yo(r,n)),t.unwrap=()=>t.element});function G(t,e){return Hp(qx,t,e)}var df=_("ZodObject",(t,e)=>{Ko.init(t,e),ge.init(t,e),J.defineLazy(t,"shape",()=>e.shape),t.keyof=()=>Ve(Object.keys(t._zod.def.shape)),t.catchall=r=>t.clone({...t._zod.def,catchall:r}),t.passthrough=()=>t.clone({...t._zod.def,catchall:pe()}),t.loose=()=>t.clone({...t._zod.def,catchall:pe()}),t.strict=()=>t.clone({...t._zod.def,catchall:Dx()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=r=>J.extend(t,r),t.merge=r=>J.merge(t,r),t.pick=r=>J.pick(t,r),t.omit=r=>J.omit(t,r),t.partial=(...r)=>J.partial(mf,t,r[0]),t.required=(...r)=>J.required(hf,t,r[0])});function z(t,e){let r={type:"object",get shape(){return J.assignProp(this,"shape",{...t}),this.shape},...J.normalizeParams(e)};return new df(r)}function Ne(t,e){return new df({type:"object",get shape(){return J.assignProp(this,"shape",{...t}),this.shape},catchall:pe(),...J.normalizeParams(e)})}var pf=_("ZodUnion",(t,e)=>{Ho.init(t,e),ge.init(t,e),t.options=e.options});function ce(t,e){return new pf({type:"union",options:t,...J.normalizeParams(e)})}var Lx=_("ZodDiscriminatedUnion",(t,e)=>{pf.init(t,e),Ra.init(t,e)});function Lc(t,e,r){return new Lx({type:"union",options:e,discriminator:t,...J.normalizeParams(r)})}var Ux=_("ZodIntersection",(t,e)=>{Ca.init(t,e),ge.init(t,e)});function os(t,e){return new Ux({type:"intersection",left:t,right:e})}var Vx=_("ZodRecord",(t,e)=>{ja.init(t,e),ge.init(t,e),t.keyType=e.keyType,t.valueType=e.valueType});function fe(t,e,r){return new Vx({type:"record",keyType:t,valueType:e,...J.normalizeParams(r)})}var Mc=_("ZodEnum",(t,e)=>{Oa.init(t,e),ge.init(t,e),t.enum=e.entries,t.options=Object.values(e.entries);let r=new Set(Object.keys(e.entries));t.extract=(n,o)=>{let s={};for(let i of n)if(r.has(i))s[i]=e.entries[i];else throw new Error(`Key ${i} not found in enum`);return new Mc({...e,checks:[],...J.normalizeParams(o),entries:s})},t.exclude=(n,o)=>{let s={...e.entries};for(let i of n)if(r.has(i))delete s[i];else throw new Error(`Key ${i} not found in enum`);return new Mc({...e,checks:[],...J.normalizeParams(o),entries:s})}});function Ve(t,e){let r=Array.isArray(t)?Object.fromEntries(t.map(n=>[n,n])):t;return new Mc({type:"enum",entries:r,...J.normalizeParams(e)})}var Fx=_("ZodLiteral",(t,e)=>{Na.init(t,e),ge.init(t,e),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function j(t,e){return new Fx({type:"literal",values:Array.isArray(t)?t:[t],...J.normalizeParams(e)})}var Kx=_("ZodTransform",(t,e)=>{Aa.init(t,e),ge.init(t,e),t._zod.parse=(r,n)=>{r.addIssue=s=>{if(typeof s=="string")r.issues.push(J.issue(s,r.value,e));else{let i=s;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=t),i.continue??(i.continue=!0),r.issues.push(J.issue(i))}};let o=e.transform(r.value,r);return o instanceof Promise?o.then(s=>(r.value=s,r)):(r.value=o,r)}});function ff(t){return new Kx({type:"transform",transform:t})}var mf=_("ZodOptional",(t,e)=>{Za.init(t,e),ge.init(t,e),t.unwrap=()=>t._zod.def.innerType});function he(t){return new mf({type:"optional",innerType:t})}var Hx=_("ZodNullable",(t,e)=>{Ma.init(t,e),ge.init(t,e),t.unwrap=()=>t._zod.def.innerType});function cf(t){return new Hx({type:"nullable",innerType:t})}var Bx=_("ZodDefault",(t,e)=>{Da.init(t,e),ge.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function Jx(t,e){return new Bx({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}var Gx=_("ZodPrefault",(t,e)=>{qa.init(t,e),ge.init(t,e),t.unwrap=()=>t._zod.def.innerType});function Wx(t,e){return new Gx({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}var hf=_("ZodNonOptional",(t,e)=>{La.init(t,e),ge.init(t,e),t.unwrap=()=>t._zod.def.innerType});function Xx(t,e){return new hf({type:"nonoptional",innerType:t,...J.normalizeParams(e)})}var Yx=_("ZodCatch",(t,e)=>{Ua.init(t,e),ge.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function Qx(t,e){return new Yx({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}var eb=_("ZodPipe",(t,e)=>{Va.init(t,e),ge.init(t,e),t.in=e.in,t.out=e.out});function Dc(t,e){return new eb({type:"pipe",in:t,out:e})}var tb=_("ZodReadonly",(t,e)=>{Fa.init(t,e),ge.init(t,e)});function rb(t){return new tb({type:"readonly",innerType:t})}var gf=_("ZodCustom",(t,e)=>{Ka.init(t,e),ge.init(t,e)});function nb(t){let e=new ke({check:"custom"});return e._zod.check=t,e}function yf(t,e){return Ic(gf,t??(()=>!0),e)}function ob(t,e={}){return Rc(gf,t,e)}function sb(t){let e=nb(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(J.issue(n,r.value,e._zod.def));else{let o=n;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=e),o.continue??(o.continue=!e._zod.def.abort),r.issues.push(J.issue(o))}},t(r.value,r)));return e}function Uc(t,e){return Dc(ff(t),e)}Je(qp());var Fc="2025-11-25";var _f=[Fc,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],Jt="io.modelcontextprotocol/related-task",is="2.0",Se=yf(t=>t!==null&&(typeof t=="object"||typeof t=="function")),vf=ce([y(),re().int()]),xf=y(),$I=Ne({ttl:ce([re(),qc()]).optional(),pollInterval:re().optional()}),ib=z({ttl:re().optional()}),ab=z({taskId:y()}),Kc=Ne({progressToken:vf.optional(),[Jt]:ab.optional()}),We=z({_meta:Kc.optional()}),Ln=We.extend({task:ib.optional()}),bf=t=>Ln.safeParse(t).success,Te=z({method:y(),params:We.loose().optional()}),tt=z({_meta:Kc.optional()}),rt=z({method:y(),params:tt.loose().optional()}),Pe=Ne({_meta:Kc.optional()}),as=ce([y(),re().int()]),$f=z({jsonrpc:j(is),id:as,...Te.shape}).strict(),Hc=t=>$f.safeParse(t).success,wf=z({jsonrpc:j(is),...rt.shape}).strict(),kf=t=>wf.safeParse(t).success,Bc=z({jsonrpc:j(is),id:as,result:Pe}).strict(),Un=t=>Bc.safeParse(t).success;var N;(function(t){t[t.ConnectionClosed=-32e3]="ConnectionClosed",t[t.RequestTimeout=-32001]="RequestTimeout",t[t.ParseError=-32700]="ParseError",t[t.InvalidRequest=-32600]="InvalidRequest",t[t.MethodNotFound=-32601]="MethodNotFound",t[t.InvalidParams=-32602]="InvalidParams",t[t.InternalError=-32603]="InternalError",t[t.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(N||(N={}));var Jc=z({jsonrpc:j(is),id:as.optional(),error:z({code:re().int(),message:y(),data:pe().optional()})}).strict();var Sf=t=>Jc.safeParse(t).success;var Tf=ce([$f,wf,Bc,Jc]),wI=ce([Bc,Jc]),cs=Pe.strict(),cb=tt.extend({requestId:as.optional(),reason:y().optional()}),us=rt.extend({method:j("notifications/cancelled"),params:cb}),ub=z({src:y(),mimeType:y().optional(),sizes:G(y()).optional(),theme:Ve(["light","dark"]).optional()}),Vn=z({icons:G(ub).optional()}),Qr=z({name:y(),title:y().optional()}),Pf=Qr.extend({...Qr.shape,...Vn.shape,version:y(),websiteUrl:y().optional(),description:y().optional()}),lb=os(z({applyDefaults:$e().optional()}),fe(y(),pe())),db=Uc(t=>t&&typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).length===0?{form:{}}:t,os(z({form:lb.optional(),url:Se.optional()}),fe(y(),pe()).optional())),pb=Ne({list:Se.optional(),cancel:Se.optional(),requests:Ne({sampling:Ne({createMessage:Se.optional()}).optional(),elicitation:Ne({create:Se.optional()}).optional()}).optional()}),fb=Ne({list:Se.optional(),cancel:Se.optional(),requests:Ne({tools:Ne({call:Se.optional()}).optional()}).optional()}),mb=z({experimental:fe(y(),Se).optional(),sampling:z({context:Se.optional(),tools:Se.optional()}).optional(),elicitation:db.optional(),roots:z({listChanged:$e().optional()}).optional(),tasks:pb.optional()}),hb=We.extend({protocolVersion:y(),capabilities:mb,clientInfo:Pf}),Gc=Te.extend({method:j("initialize"),params:hb});var gb=z({experimental:fe(y(),Se).optional(),logging:Se.optional(),completions:Se.optional(),prompts:z({listChanged:$e().optional()}).optional(),resources:z({subscribe:$e().optional(),listChanged:$e().optional()}).optional(),tools:z({listChanged:$e().optional()}).optional(),tasks:fb.optional()}),yb=Pe.extend({protocolVersion:y(),capabilities:gb,serverInfo:Pf,instructions:y().optional()}),Wc=rt.extend({method:j("notifications/initialized"),params:tt.optional()});var ls=Te.extend({method:j("ping"),params:We.optional()}),_b=z({progress:re(),total:he(re()),message:he(y())}),vb=z({...tt.shape,..._b.shape,progressToken:vf}),ds=rt.extend({method:j("notifications/progress"),params:vb}),xb=We.extend({cursor:xf.optional()}),Fn=Te.extend({params:xb.optional()}),Kn=Pe.extend({nextCursor:xf.optional()}),bb=Ve(["working","input_required","completed","failed","cancelled"]),Hn=z({taskId:y(),status:bb,ttl:ce([re(),qc()]),createdAt:y(),lastUpdatedAt:y(),pollInterval:he(re()),statusMessage:he(y())}),en=Pe.extend({task:Hn}),$b=tt.merge(Hn),Bn=rt.extend({method:j("notifications/tasks/status"),params:$b}),ps=Te.extend({method:j("tasks/get"),params:We.extend({taskId:y()})}),fs=Pe.merge(Hn),ms=Te.extend({method:j("tasks/result"),params:We.extend({taskId:y()})}),kI=Pe.loose(),hs=Fn.extend({method:j("tasks/list")}),gs=Kn.extend({tasks:G(Hn)}),ys=Te.extend({method:j("tasks/cancel"),params:We.extend({taskId:y()})}),zf=Pe.merge(Hn),Ef=z({uri:y(),mimeType:he(y()),_meta:fe(y(),pe()).optional()}),If=Ef.extend({text:y()}),Xc=y().refine(t=>{try{return atob(t),!0}catch{return!1}},{message:"Invalid Base64 string"}),Rf=Ef.extend({blob:Xc}),Jn=Ve(["user","assistant"]),tn=z({audience:G(Jn).optional(),priority:re().min(0).max(1).optional(),lastModified:Dn.datetime({offset:!0}).optional()}),Cf=z({...Qr.shape,...Vn.shape,uri:y(),description:he(y()),mimeType:he(y()),annotations:tn.optional(),_meta:he(Ne({}))}),wb=z({...Qr.shape,...Vn.shape,uriTemplate:y(),description:he(y()),mimeType:he(y()),annotations:tn.optional(),_meta:he(Ne({}))}),_s=Fn.extend({method:j("resources/list")}),kb=Kn.extend({resources:G(Cf)}),vs=Fn.extend({method:j("resources/templates/list")}),Sb=Kn.extend({resourceTemplates:G(wb)}),Yc=We.extend({uri:y()}),Tb=Yc,xs=Te.extend({method:j("resources/read"),params:Tb}),Pb=Pe.extend({contents:G(ce([If,Rf]))}),zb=rt.extend({method:j("notifications/resources/list_changed"),params:tt.optional()}),Eb=Yc,Ib=Te.extend({method:j("resources/subscribe"),params:Eb}),Rb=Yc,Cb=Te.extend({method:j("resources/unsubscribe"),params:Rb}),jb=tt.extend({uri:y()}),Ob=rt.extend({method:j("notifications/resources/updated"),params:jb}),Nb=z({name:y(),description:he(y()),required:he($e())}),Ab=z({...Qr.shape,...Vn.shape,description:he(y()),arguments:he(G(Nb)),_meta:he(Ne({}))}),bs=Fn.extend({method:j("prompts/list")}),Zb=Kn.extend({prompts:G(Ab)}),Mb=We.extend({name:y(),arguments:fe(y(),y()).optional()}),$s=Te.extend({method:j("prompts/get"),params:Mb}),Qc=z({type:j("text"),text:y(),annotations:tn.optional(),_meta:fe(y(),pe()).optional()}),eu=z({type:j("image"),data:Xc,mimeType:y(),annotations:tn.optional(),_meta:fe(y(),pe()).optional()}),tu=z({type:j("audio"),data:Xc,mimeType:y(),annotations:tn.optional(),_meta:fe(y(),pe()).optional()}),Db=z({type:j("tool_use"),name:y(),id:y(),input:fe(y(),pe()),_meta:fe(y(),pe()).optional()}),qb=z({type:j("resource"),resource:ce([If,Rf]),annotations:tn.optional(),_meta:fe(y(),pe()).optional()}),Lb=Cf.extend({type:j("resource_link")}),ru=ce([Qc,eu,tu,Lb,qb]),Ub=z({role:Jn,content:ru}),Vb=Pe.extend({description:y().optional(),messages:G(Ub)}),Fb=rt.extend({method:j("notifications/prompts/list_changed"),params:tt.optional()}),Kb=z({title:y().optional(),readOnlyHint:$e().optional(),destructiveHint:$e().optional(),idempotentHint:$e().optional(),openWorldHint:$e().optional()}),Hb=z({taskSupport:Ve(["required","optional","forbidden"]).optional()}),jf=z({...Qr.shape,...Vn.shape,description:y().optional(),inputSchema:z({type:j("object"),properties:fe(y(),Se).optional(),required:G(y()).optional()}).catchall(pe()),outputSchema:z({type:j("object"),properties:fe(y(),Se).optional(),required:G(y()).optional()}).catchall(pe()).optional(),annotations:Kb.optional(),execution:Hb.optional(),_meta:fe(y(),pe()).optional()}),ws=Fn.extend({method:j("tools/list")}),Bb=Kn.extend({tools:G(jf)}),ks=Pe.extend({content:G(ru).default([]),structuredContent:fe(y(),pe()).optional(),isError:$e().optional()}),SI=ks.or(Pe.extend({toolResult:pe()})),Jb=Ln.extend({name:y(),arguments:fe(y(),pe()).optional()}),rn=Te.extend({method:j("tools/call"),params:Jb}),Gb=rt.extend({method:j("notifications/tools/list_changed"),params:tt.optional()}),TI=z({autoRefresh:$e().default(!0),debounceMs:re().int().nonnegative().default(300)}),Gn=Ve(["debug","info","notice","warning","error","critical","alert","emergency"]),Wb=We.extend({level:Gn}),nu=Te.extend({method:j("logging/setLevel"),params:Wb}),Xb=tt.extend({level:Gn,logger:y().optional(),data:pe()}),Yb=rt.extend({method:j("notifications/message"),params:Xb}),Qb=z({name:y().optional()}),e$=z({hints:G(Qb).optional(),costPriority:re().min(0).max(1).optional(),speedPriority:re().min(0).max(1).optional(),intelligencePriority:re().min(0).max(1).optional()}),t$=z({mode:Ve(["auto","required","none"]).optional()}),r$=z({type:j("tool_result"),toolUseId:y().describe("The unique identifier for the corresponding tool call."),content:G(ru).default([]),structuredContent:z({}).loose().optional(),isError:$e().optional(),_meta:fe(y(),pe()).optional()}),n$=Lc("type",[Qc,eu,tu]),ss=Lc("type",[Qc,eu,tu,Db,r$]),o$=z({role:Jn,content:ce([ss,G(ss)]),_meta:fe(y(),pe()).optional()}),s$=Ln.extend({messages:G(o$),modelPreferences:e$.optional(),systemPrompt:y().optional(),includeContext:Ve(["none","thisServer","allServers"]).optional(),temperature:re().optional(),maxTokens:re().int(),stopSequences:G(y()).optional(),metadata:Se.optional(),tools:G(jf).optional(),toolChoice:t$.optional()}),i$=Te.extend({method:j("sampling/createMessage"),params:s$}),ou=Pe.extend({model:y(),stopReason:he(Ve(["endTurn","stopSequence","maxTokens"]).or(y())),role:Jn,content:n$}),su=Pe.extend({model:y(),stopReason:he(Ve(["endTurn","stopSequence","maxTokens","toolUse"]).or(y())),role:Jn,content:ce([ss,G(ss)])}),a$=z({type:j("boolean"),title:y().optional(),description:y().optional(),default:$e().optional()}),c$=z({type:j("string"),title:y().optional(),description:y().optional(),minLength:re().optional(),maxLength:re().optional(),format:Ve(["email","uri","date","date-time"]).optional(),default:y().optional()}),u$=z({type:Ve(["number","integer"]),title:y().optional(),description:y().optional(),minimum:re().optional(),maximum:re().optional(),default:re().optional()}),l$=z({type:j("string"),title:y().optional(),description:y().optional(),enum:G(y()),default:y().optional()}),d$=z({type:j("string"),title:y().optional(),description:y().optional(),oneOf:G(z({const:y(),title:y()})),default:y().optional()}),p$=z({type:j("string"),title:y().optional(),description:y().optional(),enum:G(y()),enumNames:G(y()).optional(),default:y().optional()}),f$=ce([l$,d$]),m$=z({type:j("array"),title:y().optional(),description:y().optional(),minItems:re().optional(),maxItems:re().optional(),items:z({type:j("string"),enum:G(y())}),default:G(y()).optional()}),h$=z({type:j("array"),title:y().optional(),description:y().optional(),minItems:re().optional(),maxItems:re().optional(),items:z({anyOf:G(z({const:y(),title:y()}))}),default:G(y()).optional()}),g$=ce([m$,h$]),y$=ce([p$,f$,g$]),_$=ce([y$,a$,c$,u$]),v$=Ln.extend({mode:j("form").optional(),message:y(),requestedSchema:z({type:j("object"),properties:fe(y(),_$),required:G(y()).optional()})}),x$=Ln.extend({mode:j("url"),message:y(),elicitationId:y(),url:y().url()}),b$=ce([v$,x$]),$$=Te.extend({method:j("elicitation/create"),params:b$}),w$=tt.extend({elicitationId:y()}),k$=rt.extend({method:j("notifications/elicitation/complete"),params:w$}),Ss=Pe.extend({action:Ve(["accept","decline","cancel"]),content:Uc(t=>t===null?void 0:t,fe(y(),ce([y(),re(),$e(),G(y())])).optional())}),S$=z({type:j("ref/resource"),uri:y()});var T$=z({type:j("ref/prompt"),name:y()}),P$=We.extend({ref:ce([T$,S$]),argument:z({name:y(),value:y()}),context:z({arguments:fe(y(),y()).optional()}).optional()}),Ts=Te.extend({method:j("completion/complete"),params:P$});function Of(t){if(t.params.ref.type!=="ref/prompt")throw new TypeError(`Expected CompleteRequestPrompt, but got ${t.params.ref.type}`)}function Nf(t){if(t.params.ref.type!=="ref/resource")throw new TypeError(`Expected CompleteRequestResourceTemplate, but got ${t.params.ref.type}`)}var z$=Pe.extend({completion:Ne({values:G(y()).max(100),total:he(re().int()),hasMore:he($e())})}),E$=z({uri:y().startsWith("file://"),name:y().optional(),_meta:fe(y(),pe()).optional()}),I$=Te.extend({method:j("roots/list"),params:We.optional()}),iu=Pe.extend({roots:G(E$)}),R$=rt.extend({method:j("notifications/roots/list_changed"),params:tt.optional()}),PI=ce([ls,Gc,Ts,nu,$s,bs,_s,vs,xs,Ib,Cb,rn,ws,ps,ms,hs,ys]),zI=ce([us,ds,Wc,R$,Bn]),EI=ce([cs,ou,su,Ss,iu,fs,gs,en]),II=ce([ls,i$,$$,I$,ps,ms,hs,ys]),RI=ce([us,ds,Yb,Ob,zb,Gb,Fb,Bn,k$]),CI=ce([cs,yb,z$,Vb,Zb,kb,Sb,Pb,ks,Bb,fs,gs,en]),C=class t extends Error{constructor(e,r,n){super(`MCP error ${e}: ${r}`),this.code=e,this.data=n,this.name="McpError"}static fromError(e,r,n){if(e===N.UrlElicitationRequired&&n){let o=n;if(o.elicitations)return new Vc(o.elicitations,r)}return new t(e,r,n)}},Vc=class extends C{constructor(e,r=`URL elicitation${e.length>1?"s":""} required`){super(N.UrlElicitationRequired,r,{elicitations:e})}get elicitations(){return this.data?.elicitations??[]}};function Gt(t){return t==="completed"||t==="failed"||t==="cancelled"}var Zf=Symbol("Let zodToJsonSchema decide on which parser to use");var Af={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Mf=t=>typeof t=="string"?{...Af,name:t}:{...Af,...t};var Df=t=>{let e=Mf(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,o])=>[o._def,{def:o._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function au(t,e,r,n){n?.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function W(t,e,r,n,o){t[e]=r,au(t,e,n,o)}var Ps=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")};function me(t){if(t.target!=="openAi")return{};let e=[...t.basePath,t.definitionPath,t.openAiAnyTypeName];return t.flags.hasReferencedOpenAiAnyType=!0,{$ref:t.$refStrategy==="relative"?Ps(e,t.currentPath):e.join("/")}}function qf(t,e){let r={type:"array"};return t.type?._def&&t.type?._def?.typeName!==w.ZodAny&&(r.items=D(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&W(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&W(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(W(r,"minItems",t.exactLength.value,t.exactLength.message,e),W(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function Lf(t,e){let r={type:"integer",format:"int64"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?W(r,"minimum",n.value,n.message,e):W(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),W(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?W(r,"maximum",n.value,n.message,e):W(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),W(r,"maximum",n.value,n.message,e));break;case"multipleOf":W(r,"multipleOf",n.value,n.message,e);break}return r}function Uf(){return{type:"boolean"}}function zs(t,e){return D(t.type._def,e)}var Vf=(t,e)=>D(t.innerType._def,e);function cu(t,e,r){let n=r??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((o,s)=>cu(t,e,o))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return C$(t,e)}}var C$=(t,e)=>{let r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(let n of t.checks)switch(n.kind){case"min":W(r,"minimum",n.value,n.message,e);break;case"max":W(r,"maximum",n.value,n.message,e);break}return r};function Ff(t,e){return{...D(t.innerType._def,e),default:t.defaultValue()}}function Kf(t,e){return e.effectStrategy==="input"?D(t.schema._def,e):me(e)}function Hf(t){return{type:"string",enum:Array.from(t.values)}}var j$=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function Bf(t,e){let r=[D(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),D(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,o=[];return r.forEach(s=>{if(j$(s))o.push(...s.allOf),s.unevaluatedProperties===void 0&&(n=void 0);else{let i=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:a,...c}=s;i=c}else n=void 0;o.push(i)}}),o.length?{allOf:o,...n}:void 0}function Jf(t,e){let r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}var uu,ut={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(uu===void 0&&(uu=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),uu),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Es(t,e){let r={type:"string"};if(t.checks)for(let n of t.checks)switch(n.kind){case"min":W(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e);break;case"max":W(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":lt(r,"email",n.message,e);break;case"format:idn-email":lt(r,"idn-email",n.message,e);break;case"pattern:zod":Ae(r,ut.email,n.message,e);break}break;case"url":lt(r,"uri",n.message,e);break;case"uuid":lt(r,"uuid",n.message,e);break;case"regex":Ae(r,n.regex,n.message,e);break;case"cuid":Ae(r,ut.cuid,n.message,e);break;case"cuid2":Ae(r,ut.cuid2,n.message,e);break;case"startsWith":Ae(r,RegExp(`^${lu(n.value,e)}`),n.message,e);break;case"endsWith":Ae(r,RegExp(`${lu(n.value,e)}$`),n.message,e);break;case"datetime":lt(r,"date-time",n.message,e);break;case"date":lt(r,"date",n.message,e);break;case"time":lt(r,"time",n.message,e);break;case"duration":lt(r,"duration",n.message,e);break;case"length":W(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e),W(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"includes":{Ae(r,RegExp(lu(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&lt(r,"ipv4",n.message,e),n.version!=="v4"&&lt(r,"ipv6",n.message,e);break}case"base64url":Ae(r,ut.base64url,n.message,e);break;case"jwt":Ae(r,ut.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&Ae(r,ut.ipv4Cidr,n.message,e),n.version!=="v4"&&Ae(r,ut.ipv6Cidr,n.message,e);break}case"emoji":Ae(r,ut.emoji(),n.message,e);break;case"ulid":{Ae(r,ut.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{lt(r,"binary",n.message,e);break}case"contentEncoding:base64":{W(r,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{Ae(r,ut.base64,n.message,e);break}}break}case"nanoid":Ae(r,ut.nanoid,n.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}function lu(t,e){return e.patternStrategy==="escape"?N$(t):t}var O$=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function N$(t){let e="";for(let r=0;r<t.length;r++)O$.has(t[r])||(e+="\\"),e+=t[r];return e}function lt(t,e,r,n){t.format||t.anyOf?.some(o=>o.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&n.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&n.errorMessages&&{errorMessage:{format:r}}})):W(t,"format",e,r,n)}function Ae(t,e,r,n){t.pattern||t.allOf?.some(o=>o.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&n.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:Gf(e,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):W(t,"pattern",Gf(e,n),r,n)}function Gf(t,e){if(!e.applyRegexFlags||!t.flags)return t.source;let r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},n=r.i?t.source.toLowerCase():t.source,o="",s=!1,i=!1,a=!1;for(let c=0;c<n.length;c++){if(s){o+=n[c],s=!1;continue}if(r.i){if(i){if(n[c].match(/[a-z]/)){a?(o+=n[c],o+=`${n[c-2]}-${n[c]}`.toUpperCase(),a=!1):n[c+1]==="-"&&n[c+2]?.match(/[a-z]/)?(o+=n[c],a=!0):o+=`${n[c]}${n[c].toUpperCase()}`;continue}}else if(n[c].match(/[a-z]/)){o+=`[${n[c]}${n[c].toUpperCase()}]`;continue}}if(r.m){if(n[c]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(n[c]==="$"){o+=`($|(?=[\r
]))`;continue}}if(r.s&&n[c]==="."){o+=i?`${n[c]}\r
`:`[${n[c]}\r
]`;continue}o+=n[c],n[c]==="\\"?s=!0:i&&n[c]==="]"?i=!1:!i&&n[c]==="["&&(i=!0)}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return o}function Is(t,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&t.keyType?._def.typeName===w.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((n,o)=>({...n,[o]:D(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",o]})??me(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let r={type:"object",additionalProperties:D(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return r;if(t.keyType?._def.typeName===w.ZodString&&t.keyType._def.checks?.length){let{type:n,...o}=Es(t.keyType._def,e);return{...r,propertyNames:o}}else{if(t.keyType?._def.typeName===w.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};if(t.keyType?._def.typeName===w.ZodBranded&&t.keyType._def.type._def.typeName===w.ZodString&&t.keyType._def.type._def.checks?.length){let{type:n,...o}=zs(t.keyType._def,e);return{...r,propertyNames:o}}}return r}function Wf(t,e){if(e.mapStrategy==="record")return Is(t,e);let r=D(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||me(e),n=D(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||me(e);return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function Xf(t){let e=t.values,n=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),o=Array.from(new Set(n.map(s=>typeof s)));return{type:o.length===1?o[0]==="string"?"string":"number":["string","number"],enum:n}}function Yf(t){return t.target==="openAi"?void 0:{not:me({...t,currentPath:[...t.currentPath,"not"]})}}function Qf(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var Wn={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function tm(t,e){if(e.target==="openApi3")return em(t,e);let r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(n=>n._def.typeName in Wn&&(!n._def.checks||!n._def.checks.length))){let n=r.reduce((o,s)=>{let i=Wn[s._def.typeName];return i&&!o.includes(i)?[...o,i]:o},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=r.reduce((o,s)=>{let i=typeof s._def.value;switch(i){case"string":case"number":case"boolean":return[...o,i];case"bigint":return[...o,"integer"];case"object":if(s._def.value===null)return[...o,"null"];default:return o}},[]);if(n.length===r.length){let o=n.filter((s,i,a)=>a.indexOf(s)===i);return{type:o.length>1?o:o[0],enum:r.reduce((s,i)=>s.includes(i._def.value)?s:[...s,i._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,o)=>[...n,...o._def.values.filter(s=>!n.includes(s))],[])};return em(t,e)}var em=(t,e)=>{let r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((n,o)=>D(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${o}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function rm(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:Wn[t.innerType._def.typeName],nullable:!0}:{type:[Wn[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=D(t.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let r=D(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function nm(t,e){let r={type:"number"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"int":r.type="integer",au(r,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?W(r,"minimum",n.value,n.message,e):W(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),W(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?W(r,"maximum",n.value,n.message,e):W(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),W(r,"maximum",n.value,n.message,e));break;case"multipleOf":W(r,"multipleOf",n.value,n.message,e);break}return r}function om(t,e){let r=e.target==="openAi",n={type:"object",properties:{}},o=[],s=t.shape();for(let a in s){let c=s[a];if(c===void 0||c._def===void 0)continue;let u=Z$(c);u&&r&&(c._def.typeName==="ZodOptional"&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),u=!1);let l=D(c._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});l!==void 0&&(n.properties[a]=l,u||o.push(a))}o.length&&(n.required=o);let i=A$(t,e);return i!==void 0&&(n.additionalProperties=i),n}function A$(t,e){if(t.catchall._def.typeName!=="ZodNever")return D(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function Z$(t){try{return t.isOptional()}catch{return!0}}var sm=(t,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return D(t.innerType._def,e);let r=D(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:me(e)},r]}:me(e)};var im=(t,e)=>{if(e.pipeStrategy==="input")return D(t.in._def,e);if(e.pipeStrategy==="output")return D(t.out._def,e);let r=D(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=D(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(o=>o!==void 0)}};function am(t,e){return D(t.type._def,e)}function cm(t,e){let n={type:"array",uniqueItems:!0,items:D(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&W(n,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&W(n,"maxItems",t.maxSize.value,t.maxSize.message,e),n}function um(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,n)=>D(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:D(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,n)=>D(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function lm(t){return{not:me(t)}}function dm(t){return me(t)}var pm=(t,e)=>D(t.innerType._def,e);var fm=(t,e,r)=>{switch(e){case w.ZodString:return Es(t,r);case w.ZodNumber:return nm(t,r);case w.ZodObject:return om(t,r);case w.ZodBigInt:return Lf(t,r);case w.ZodBoolean:return Uf();case w.ZodDate:return cu(t,r);case w.ZodUndefined:return lm(r);case w.ZodNull:return Qf(r);case w.ZodArray:return qf(t,r);case w.ZodUnion:case w.ZodDiscriminatedUnion:return tm(t,r);case w.ZodIntersection:return Bf(t,r);case w.ZodTuple:return um(t,r);case w.ZodRecord:return Is(t,r);case w.ZodLiteral:return Jf(t,r);case w.ZodEnum:return Hf(t);case w.ZodNativeEnum:return Xf(t);case w.ZodNullable:return rm(t,r);case w.ZodOptional:return sm(t,r);case w.ZodMap:return Wf(t,r);case w.ZodSet:return cm(t,r);case w.ZodLazy:return()=>t.getter()._def;case w.ZodPromise:return am(t,r);case w.ZodNaN:case w.ZodNever:return Yf(r);case w.ZodEffects:return Kf(t,r);case w.ZodAny:return me(r);case w.ZodUnknown:return dm(r);case w.ZodDefault:return Ff(t,r);case w.ZodBranded:return zs(t,r);case w.ZodReadonly:return pm(t,r);case w.ZodCatch:return Vf(t,r);case w.ZodPipeline:return im(t,r);case w.ZodFunction:case w.ZodVoid:case w.ZodSymbol:return;default:return(n=>{})(e)}};function D(t,e,r=!1){let n=e.seen.get(t);if(e.override){let a=e.override?.(t,e,n,r);if(a!==Zf)return a}if(n&&!r){let a=M$(n,e);if(a!==void 0)return a}let o={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,o);let s=fm(t,t.typeName,e),i=typeof s=="function"?D(s(),e):s;if(i&&D$(t,e,i),e.postProcess){let a=e.postProcess(i,t,e);return o.jsonSchema=i,a}return o.jsonSchema=i,i}var M$=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:Ps(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,n)=>e.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),me(e)):e.$refStrategy==="seen"?me(e):void 0}},D$=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r);var du=(t,e)=>{let r=Df(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((c,[u,l])=>({...c,[u]:D(l._def,{...r,currentPath:[...r.basePath,r.definitionPath,u]},!0)??me(r)}),{}):void 0,o=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,s=D(t._def,o===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,o]},!1)??me(r),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i),r.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[r.openAiAnyTypeName]||(n[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:r.$refStrategy==="relative"?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));let a=o===void 0?n?{...s,[r.definitionPath]:n}:s:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,o].join("/"),[r.definitionPath]:{...n,[o]:s}};return r.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function q$(t){return!t||t==="jsonSchema7"||t==="draft-7"?"draft-7":t==="jsonSchema2019-09"||t==="draft-2020-12"?"draft-2020-12":"draft-7"}function pu(t,e){return et(t)?Cc(t,{target:q$(e?.target),io:e?.pipeStrategy??"input"}):du(t,{strictUnions:e?.strictUnions??!0,pipeStrategy:e?.pipeStrategy??"input"})}function fu(t){let r=Bt(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=rs(r);if(typeof n!="string")throw new Error("Schema method literal must be a string");return n}function mu(t,e){let r=Ht(t,e);if(!r.success)throw r.error;return r.data}var L$=6e4,Rs=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(us,r=>{this._oncancel(r)}),this.setNotificationHandler(ds,r=>{this._onprogress(r)}),this.setRequestHandler(ls,r=>({})),this._taskStore=e?.taskStore,this._taskMessageQueue=e?.taskMessageQueue,this._taskStore&&(this.setRequestHandler(ps,async(r,n)=>{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new C(N.InvalidParams,"Failed to retrieve task: Task not found");return{...o}}),this.setRequestHandler(ms,async(r,n)=>{let o=async()=>{let s=r.params.taskId;if(this._taskMessageQueue){let a;for(;a=await this._taskMessageQueue.dequeue(s,n.sessionId);){if(a.type==="response"||a.type==="error"){let c=a.message,u=c.id,l=this._requestResolvers.get(u);if(l)if(this._requestResolvers.delete(u),a.type==="response")l(c);else{let d=c,m=new C(d.error.code,d.error.message,d.error.data);l(m)}else{let d=a.type==="response"?"Response":"Error";this._onerror(new Error(`${d} handler missing for request ${u}`))}continue}await this._transport?.send(a.message,{relatedRequestId:n.requestId})}}let i=await this._taskStore.getTask(s,n.sessionId);if(!i)throw new C(N.InvalidParams,`Task not found: ${s}`);if(!Gt(i.status))return await this._waitForTaskUpdate(s,n.signal),await o();if(Gt(i.status)){let a=await this._taskStore.getTaskResult(s,n.sessionId);return this._clearTaskQueue(s),{...a,_meta:{...a._meta,[Jt]:{taskId:s}}}}return await o()};return await o()}),this.setRequestHandler(hs,async(r,n)=>{try{let{tasks:o,nextCursor:s}=await this._taskStore.listTasks(r.params?.cursor,n.sessionId);return{tasks:o,nextCursor:s,_meta:{}}}catch(o){throw new C(N.InvalidParams,`Failed to list tasks: ${o instanceof Error?o.message:String(o)}`)}}),this.setRequestHandler(ys,async(r,n)=>{try{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new C(N.InvalidParams,`Task not found: ${r.params.taskId}`);if(Gt(o.status))throw new C(N.InvalidParams,`Cannot cancel task in terminal status: ${o.status}`);await this._taskStore.updateTaskStatus(r.params.taskId,"cancelled","Client cancelled task execution.",n.sessionId),this._clearTaskQueue(r.params.taskId);let s=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!s)throw new C(N.InvalidParams,`Task not found after cancellation: ${r.params.taskId}`);return{_meta:{},...s}}catch(o){throw o instanceof C?o:new C(N.InvalidRequest,`Failed to cancel task: ${o instanceof Error?o.message:String(o)}`)}}))}async _oncancel(e){if(!e.params.requestId)return;this._requestHandlerAbortControllers.get(e.params.requestId)?.abort(e.params.reason)}_setupTimeout(e,r,n,o,s=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(o,r),startTime:Date.now(),timeout:r,maxTotalTimeout:n,resetTimeoutOnProgress:s,onTimeout:o})}_resetTimeout(e){let r=this._timeoutInfo.get(e);if(!r)return!1;let n=Date.now()-r.startTime;if(r.maxTotalTimeout&&n>=r.maxTotalTimeout)throw this._timeoutInfo.delete(e),C.fromError(N.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:n});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(e){let r=this._timeoutInfo.get(e);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(e))}async connect(e){if(this._transport)throw new Error("Already connected to a transport. Call close() before connecting to a new transport, or use a separate Protocol instance per connection.");this._transport=e;let r=this.transport?.onclose;this._transport.onclose=()=>{r?.(),this._onclose()};let n=this.transport?.onerror;this._transport.onerror=s=>{n?.(s),this._onerror(s)};let o=this._transport?.onmessage;this._transport.onmessage=(s,i)=>{o?.(s,i),Un(s)||Sf(s)?this._onresponse(s):Hc(s)?this._onrequest(s,i):kf(s)?this._onnotification(s):this._onerror(new Error(`Unknown message type: ${JSON.stringify(s)}`))},await this._transport.start()}_onclose(){let e=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();for(let n of this._requestHandlerAbortControllers.values())n.abort();this._requestHandlerAbortControllers.clear();let r=C.fromError(N.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(let n of e.values())n(r)}_onerror(e){this.onerror?.(e)}_onnotification(e){let r=this._notificationHandlers.get(e.method)??this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(e)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(e,r){let n=this._requestHandlers.get(e.method)??this.fallbackRequestHandler,o=this._transport,s=e.params?._meta?.[Jt]?.taskId;if(n===void 0){let l={jsonrpc:"2.0",id:e.id,error:{code:N.MethodNotFound,message:"Method not found"}};s&&this._taskMessageQueue?this._enqueueTaskMessage(s,{type:"error",message:l,timestamp:Date.now()},o?.sessionId).catch(d=>this._onerror(new Error(`Failed to enqueue error response: ${d}`))):o?.send(l).catch(d=>this._onerror(new Error(`Failed to send an error response: ${d}`)));return}let i=new AbortController;this._requestHandlerAbortControllers.set(e.id,i);let a=bf(e.params)?e.params.task:void 0,c=this._taskStore?this.requestTaskStore(e,o?.sessionId):void 0,u={signal:i.signal,sessionId:o?.sessionId,_meta:e.params?._meta,sendNotification:async l=>{if(i.signal.aborted)return;let d={relatedRequestId:e.id};s&&(d.relatedTask={taskId:s}),await this.notification(l,d)},sendRequest:async(l,d,m)=>{if(i.signal.aborted)throw new C(N.ConnectionClosed,"Request was cancelled");let h={...m,relatedRequestId:e.id};s&&!h.relatedTask&&(h.relatedTask={taskId:s});let p=h.relatedTask?.taskId??s;return p&&c&&await c.updateTaskStatus(p,"input_required"),await this.request(l,d,h)},authInfo:r?.authInfo,requestId:e.id,requestInfo:r?.requestInfo,taskId:s,taskStore:c,taskRequestedTtl:a?.ttl,closeSSEStream:r?.closeSSEStream,closeStandaloneSSEStream:r?.closeStandaloneSSEStream};Promise.resolve().then(()=>{a&&this.assertTaskHandlerCapability(e.method)}).then(()=>n(e,u)).then(async l=>{if(i.signal.aborted)return;let d={result:l,jsonrpc:"2.0",id:e.id};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"response",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)},async l=>{if(i.signal.aborted)return;let d={jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(l.code)?l.code:N.InternalError,message:l.message??"Internal error",...l.data!==void 0&&{data:l.data}}};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"error",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)}).catch(l=>this._onerror(new Error(`Failed to send response: ${l}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progressToken:r,...n}=e.params,o=Number(r),s=this._progressHandlers.get(o);if(!s){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}let i=this._responseHandlers.get(o),a=this._timeoutInfo.get(o);if(a&&i&&a.resetTimeoutOnProgress)try{this._resetTimeout(o)}catch(c){this._responseHandlers.delete(o),this._progressHandlers.delete(o),this._cleanupTimeout(o),i(c);return}s(n)}_onresponse(e){let r=Number(e.id),n=this._requestResolvers.get(r);if(n){if(this._requestResolvers.delete(r),Un(e))n(e);else{let i=new C(e.error.code,e.error.message,e.error.data);n(i)}return}let o=this._responseHandlers.get(r);if(o===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}this._responseHandlers.delete(r),this._cleanupTimeout(r);let s=!1;if(Un(e)&&e.result&&typeof e.result=="object"){let i=e.result;if(i.task&&typeof i.task=="object"){let a=i.task;typeof a.taskId=="string"&&(s=!0,this._taskProgressTokens.set(a.taskId,r))}}if(s||this._progressHandlers.delete(r),Un(e))o(e);else{let i=C.fromError(e.error.code,e.error.message,e.error.data);o(i)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(e,r,n){let{task:o}=n??{};if(!o){try{yield{type:"result",result:await this.request(e,r,n)}}catch(i){yield{type:"error",error:i instanceof C?i:new C(N.InternalError,String(i))}}return}let s;try{let i=await this.request(e,en,n);if(i.task)s=i.task.taskId,yield{type:"taskCreated",task:i.task};else throw new C(N.InternalError,"Task creation did not return a task");for(;;){let a=await this.getTask({taskId:s},n);if(yield{type:"taskStatus",task:a},Gt(a.status)){a.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)}:a.status==="failed"?yield{type:"error",error:new C(N.InternalError,`Task ${s} failed`)}:a.status==="cancelled"&&(yield{type:"error",error:new C(N.InternalError,`Task ${s} was cancelled`)});return}if(a.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)};return}let c=a.pollInterval??this._options?.defaultTaskPollInterval??1e3;await new Promise(u=>setTimeout(u,c)),n?.signal?.throwIfAborted()}}catch(i){yield{type:"error",error:i instanceof C?i:new C(N.InternalError,String(i))}}}request(e,r,n){let{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i,task:a,relatedTask:c}=n??{};return new Promise((u,l)=>{let d=x=>{l(x)};if(!this._transport){d(new Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{this.assertCapabilityForMethod(e.method),a&&this.assertTaskCapability(e.method)}catch(x){d(x);return}n?.signal?.throwIfAborted();let m=this._requestMessageId++,h={...e,jsonrpc:"2.0",id:m};n?.onprogress&&(this._progressHandlers.set(m,n.onprogress),h.params={...e.params,_meta:{...e.params?._meta||{},progressToken:m}}),a&&(h.params={...h.params,task:a}),c&&(h.params={...h.params,_meta:{...h.params?._meta||{},[Jt]:c}});let p=x=>{this._responseHandlers.delete(m),this._progressHandlers.delete(m),this._cleanupTimeout(m),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:m,reason:String(x)}},{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i}).catch(k=>this._onerror(new Error(`Failed to send cancellation: ${k}`)));let $=x instanceof C?x:new C(N.RequestTimeout,String(x));l($)};this._responseHandlers.set(m,x=>{if(!n?.signal?.aborted){if(x instanceof Error)return l(x);try{let $=Ht(r,x.result);$.success?u($.data):l($.error)}catch($){l($)}}}),n?.signal?.addEventListener("abort",()=>{p(n?.signal?.reason)});let f=n?.timeout??L$,g=()=>p(C.fromError(N.RequestTimeout,"Request timed out",{timeout:f}));this._setupTimeout(m,f,n?.maxTotalTimeout,g,n?.resetTimeoutOnProgress??!1);let v=c?.taskId;if(v){let x=$=>{let k=this._responseHandlers.get(m);k?k($):this._onerror(new Error(`Response handler missing for side-channeled request ${m}`))};this._requestResolvers.set(m,x),this._enqueueTaskMessage(v,{type:"request",message:h,timestamp:Date.now()}).catch($=>{this._cleanupTimeout(m),l($)})}else this._transport.send(h,{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i}).catch(x=>{this._cleanupTimeout(m),l(x)})})}async getTask(e,r){return this.request({method:"tasks/get",params:e},fs,r)}async getTaskResult(e,r,n){return this.request({method:"tasks/result",params:e},r,n)}async listTasks(e,r){return this.request({method:"tasks/list",params:e},gs,r)}async cancelTask(e,r){return this.request({method:"tasks/cancel",params:e},zf,r)}async notification(e,r){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);let n=r?.relatedTask?.taskId;if(n){let a={...e,jsonrpc:"2.0",params:{...e.params,_meta:{...e.params?._meta||{},[Jt]:r.relatedTask}}};await this._enqueueTaskMessage(n,{type:"notification",message:a,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(e.method)&&!e.params&&!r?.relatedRequestId&&!r?.relatedTask){if(this._pendingDebouncedNotifications.has(e.method))return;this._pendingDebouncedNotifications.add(e.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(e.method),!this._transport)return;let a={...e,jsonrpc:"2.0"};r?.relatedTask&&(a={...a,params:{...a.params,_meta:{...a.params?._meta||{},[Jt]:r.relatedTask}}}),this._transport?.send(a,r).catch(c=>this._onerror(c))});return}let i={...e,jsonrpc:"2.0"};r?.relatedTask&&(i={...i,params:{...i.params,_meta:{...i.params?._meta||{},[Jt]:r.relatedTask}}}),await this._transport.send(i,r)}setRequestHandler(e,r){let n=fu(e);this.assertRequestHandlerCapability(n),this._requestHandlers.set(n,(o,s)=>{let i=mu(e,o);return Promise.resolve(r(i,s))})}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,r){let n=fu(e);this._notificationHandlers.set(n,o=>{let s=mu(e,o);return Promise.resolve(r(s))})}removeNotificationHandler(e){this._notificationHandlers.delete(e)}_cleanupTaskProgressHandler(e){let r=this._taskProgressTokens.get(e);r!==void 0&&(this._progressHandlers.delete(r),this._taskProgressTokens.delete(e))}async _enqueueTaskMessage(e,r,n){if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let o=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(e,r,n,o)}async _clearTaskQueue(e,r){if(this._taskMessageQueue){let n=await this._taskMessageQueue.dequeueAll(e,r);for(let o of n)if(o.type==="request"&&Hc(o.message)){let s=o.message.id,i=this._requestResolvers.get(s);i?(i(new C(N.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(s)):this._onerror(new Error(`Resolver missing for request ${s} during task ${e} cleanup`))}}}async _waitForTaskUpdate(e,r){let n=this._options?.defaultTaskPollInterval??1e3;try{let o=await this._taskStore?.getTask(e);o?.pollInterval&&(n=o.pollInterval)}catch{}return new Promise((o,s)=>{if(r.aborted){s(new C(N.InvalidRequest,"Request cancelled"));return}let i=setTimeout(o,n);r.addEventListener("abort",()=>{clearTimeout(i),s(new C(N.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(e,r){let n=this._taskStore;if(!n)throw new Error("No task store configured");return{createTask:async o=>{if(!e)throw new Error("No request provided");return await n.createTask(o,e.id,{method:e.method,params:e.params},r)},getTask:async o=>{let s=await n.getTask(o,r);if(!s)throw new C(N.InvalidParams,"Failed to retrieve task: Task not found");return s},storeTaskResult:async(o,s,i)=>{await n.storeTaskResult(o,s,i,r);let a=await n.getTask(o,r);if(a){let c=Bn.parse({method:"notifications/tasks/status",params:a});await this.notification(c),Gt(a.status)&&this._cleanupTaskProgressHandler(o)}},getTaskResult:o=>n.getTaskResult(o,r),updateTaskStatus:async(o,s,i)=>{let a=await n.getTask(o,r);if(!a)throw new C(N.InvalidParams,`Task "${o}" not found - it may have been cleaned up`);if(Gt(a.status))throw new C(N.InvalidParams,`Cannot update task "${o}" from terminal status "${a.status}" to "${s}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await n.updateTaskStatus(o,s,i,r);let c=await n.getTask(o,r);if(c){let u=Bn.parse({method:"notifications/tasks/status",params:c});await this.notification(u),Gt(c.status)&&this._cleanupTaskProgressHandler(o)}},listTasks:o=>n.listTasks(o,r)}}};function mm(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function hm(t,e){let r={...t};for(let n in e){let o=n,s=e[o];if(s===void 0)continue;let i=r[o];mm(i)&&mm(s)?r[o]={...i,...s}:r[o]=s}return r}var ty=Io(Ql(),1),ry=Io(ey(),1);function RP(){let t=new ty.default({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return(0,ry.default)(t),t}var mi=class{constructor(e){this._ajv=e??RP()}getValidator(e){let r="$id"in e&&typeof e.$id=="string"?this._ajv.getSchema(e.$id)??this._ajv.compile(e):this._ajv.compile(e);return n=>r(n)?{valid:!0,data:n,errorMessage:void 0}:{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(r.errors)}}};var hi=class{constructor(e){this._server=e}requestStream(e,r,n){return this._server.requestStream(e,r,n)}async getTask(e,r){return this._server.getTask({taskId:e},r)}async getTaskResult(e,r,n){return this._server.getTaskResult({taskId:e},r,n)}async listTasks(e,r){return this._server.listTasks(e?{cursor:e}:void 0,r)}async cancelTask(e,r){return this._server.cancelTask({taskId:e},r)}};function ny(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"tools/call":if(!t.tools?.call)throw new Error(`${r} does not support task creation for tools/call (required for ${e})`);break;default:break}}function oy(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"sampling/createMessage":if(!t.sampling?.createMessage)throw new Error(`${r} does not support task creation for sampling/createMessage (required for ${e})`);break;case"elicitation/create":if(!t.elicitation?.create)throw new Error(`${r} does not support task creation for elicitation/create (required for ${e})`);break;default:break}}var gi=class extends Rs{constructor(e,r){super(r),this._serverInfo=e,this._loggingLevels=new Map,this.LOG_LEVEL_SEVERITY=new Map(Gn.options.map((n,o)=>[n,o])),this.isMessageIgnored=(n,o)=>{let s=this._loggingLevels.get(o);return s?this.LOG_LEVEL_SEVERITY.get(n)<this.LOG_LEVEL_SEVERITY.get(s):!1},this._capabilities=r?.capabilities??{},this._instructions=r?.instructions,this._jsonSchemaValidator=r?.jsonSchemaValidator??new mi,this.setRequestHandler(Gc,n=>this._oninitialize(n)),this.setNotificationHandler(Wc,()=>this.oninitialized?.()),this._capabilities.logging&&this.setRequestHandler(nu,async(n,o)=>{let s=o.sessionId||o.requestInfo?.headers["mcp-session-id"]||void 0,{level:i}=n.params,a=Gn.safeParse(i);return a.success&&this._loggingLevels.set(s,a.data),{}})}get experimental(){return this._experimental||(this._experimental={tasks:new hi(this)}),this._experimental}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=hm(this._capabilities,e)}setRequestHandler(e,r){let o=Bt(e)?.method;if(!o)throw new Error("Schema is missing a method literal");let s;if(et(o)){let a=o;s=a._zod?.def?.value??a.value}else{let a=o;s=a._def?.value??a.value}if(typeof s!="string")throw new Error("Schema method literal must be a string");if(s==="tools/call"){let a=async(c,u)=>{let l=Ht(rn,c);if(!l.success){let p=l.error instanceof Error?l.error.message:String(l.error);throw new C(N.InvalidParams,`Invalid tools/call request: ${p}`)}let{params:d}=l.data,m=await Promise.resolve(r(c,u));if(d.task){let p=Ht(en,m);if(!p.success){let f=p.error instanceof Error?p.error.message:String(p.error);throw new C(N.InvalidParams,`Invalid task creation result: ${f}`)}return p.data}let h=Ht(ks,m);if(!h.success){let p=h.error instanceof Error?h.error.message:String(h.error);throw new C(N.InvalidParams,`Invalid tools/call result: ${p}`)}return h.data};return super.setRequestHandler(e,a)}return super.setRequestHandler(e,r)}assertCapabilityForMethod(e){switch(e){case"sampling/createMessage":if(!this._clientCapabilities?.sampling)throw new Error(`Client does not support sampling (required for ${e})`);break;case"elicitation/create":if(!this._clientCapabilities?.elicitation)throw new Error(`Client does not support elicitation (required for ${e})`);break;case"roots/list":if(!this._clientCapabilities?.roots)throw new Error(`Client does not support listing roots (required for ${e})`);break;case"ping":break}}assertNotificationCapability(e){switch(e){case"notifications/message":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw new Error(`Server does not support notifying about resources (required for ${e})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw new Error(`Server does not support notifying of tool list changes (required for ${e})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw new Error(`Server does not support notifying of prompt list changes (required for ${e})`);break;case"notifications/elicitation/complete":if(!this._clientCapabilities?.elicitation?.url)throw new Error(`Client does not support URL elicitation (required for ${e})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){if(this._capabilities)switch(e){case"completion/complete":if(!this._capabilities.completions)throw new Error(`Server does not support completions (required for ${e})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw new Error(`Server does not support resources (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw new Error(`Server does not support tasks capability (required for ${e})`);break;case"ping":case"initialize":break}}assertTaskCapability(e){oy(this._clientCapabilities?.tasks?.requests,e,"Client")}assertTaskHandlerCapability(e){this._capabilities&&ny(this._capabilities.tasks?.requests,e,"Server")}async _oninitialize(e){let r=e.params.protocolVersion;return this._clientCapabilities=e.params.capabilities,this._clientVersion=e.params.clientInfo,{protocolVersion:_f.includes(r)?r:Fc,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},cs)}async createMessage(e,r){if((e.tools||e.toolChoice)&&!this._clientCapabilities?.sampling?.tools)throw new Error("Client does not support sampling tools capability.");if(e.messages.length>0){let n=e.messages[e.messages.length-1],o=Array.isArray(n.content)?n.content:[n.content],s=o.some(u=>u.type==="tool_result"),i=e.messages.length>1?e.messages[e.messages.length-2]:void 0,a=i?Array.isArray(i.content)?i.content:[i.content]:[],c=a.some(u=>u.type==="tool_use");if(s){if(o.some(u=>u.type!=="tool_result"))throw new Error("The last message must contain only tool_result content if any is present");if(!c)throw new Error("tool_result blocks are not matching any tool_use from the previous message")}if(c){let u=new Set(a.filter(d=>d.type==="tool_use").map(d=>d.id)),l=new Set(o.filter(d=>d.type==="tool_result").map(d=>d.toolUseId));if(u.size!==l.size||![...u].every(d=>l.has(d)))throw new Error("ids of tool_result blocks and tool_use blocks from previous message do not match")}}return e.tools?this.request({method:"sampling/createMessage",params:e},su,r):this.request({method:"sampling/createMessage",params:e},ou,r)}async elicitInput(e,r){switch(e.mode??"form"){case"url":{if(!this._clientCapabilities?.elicitation?.url)throw new Error("Client does not support url elicitation.");let o=e;return this.request({method:"elicitation/create",params:o},Ss,r)}case"form":{if(!this._clientCapabilities?.elicitation?.form)throw new Error("Client does not support form elicitation.");let o=e.mode==="form"?e:{...e,mode:"form"},s=await this.request({method:"elicitation/create",params:o},Ss,r);if(s.action==="accept"&&s.content&&o.requestedSchema)try{let a=this._jsonSchemaValidator.getValidator(o.requestedSchema)(s.content);if(!a.valid)throw new C(N.InvalidParams,`Elicitation response content does not match requested schema: ${a.errorMessage}`)}catch(i){throw i instanceof C?i:new C(N.InternalError,`Error validating elicitation response: ${i instanceof Error?i.message:String(i)}`)}return s}}}createElicitationCompletionNotifier(e,r){if(!this._clientCapabilities?.elicitation?.url)throw new Error("Client does not support URL elicitation (required for notifications/elicitation/complete)");return()=>this.notification({method:"notifications/elicitation/complete",params:{elicitationId:e}},r)}async listRoots(e,r){return this.request({method:"roots/list",params:e},iu,r)}async sendLoggingMessage(e,r){if(this._capabilities.logging&&!this.isMessageIgnored(e.level,r))return this.notification({method:"notifications/message",params:e})}async sendResourceUpdated(e){return this.notification({method:"notifications/resources/updated",params:e})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}};var iy=Symbol.for("mcp.completable");function ad(t){return!!t&&typeof t=="object"&&iy in t}function ay(t){return t[iy]?.complete}var sy;(function(t){t.Completable="McpCompletable"})(sy||(sy={}));var CP=/^[A-Za-z0-9._-]{1,128}$/;function jP(t){let e=[];if(t.length===0)return{isValid:!1,warnings:["Tool name cannot be empty"]};if(t.length>128)return{isValid:!1,warnings:[`Tool name exceeds maximum length of 128 characters (current: ${t.length})`]};if(t.includes(" ")&&e.push("Tool name contains spaces, which may cause parsing issues"),t.includes(",")&&e.push("Tool name contains commas, which may cause parsing issues"),(t.startsWith("-")||t.endsWith("-"))&&e.push("Tool name starts or ends with a dash, which may cause parsing issues in some contexts"),(t.startsWith(".")||t.endsWith("."))&&e.push("Tool name starts or ends with a dot, which may cause parsing issues in some contexts"),!CP.test(t)){let r=t.split("").filter(n=>!/[A-Za-z0-9._-]/.test(n)).filter((n,o,s)=>s.indexOf(n)===o);return e.push(`Tool name contains invalid characters: ${r.map(n=>`"${n}"`).join(", ")}`,"Allowed characters are: A-Z, a-z, 0-9, underscore (_), dash (-), and dot (.)"),{isValid:!1,warnings:e}}return{isValid:!0,warnings:e}}function OP(t,e){if(e.length>0){console.warn(`Tool name validation warning for "${t}":`);for(let r of e)console.warn(`  - ${r}`);console.warn("Tool registration will proceed, but this may cause compatibility issues."),console.warn("Consider updating the tool name to conform to the MCP tool naming standard."),console.warn("See SEP: Specify Format for Tool Names (https://github.com/modelcontextprotocol/modelcontextprotocol/issues/986) for more details.")}}function cd(t){let e=jP(t);return OP(t,e.warnings),e.isValid}var yi=class{constructor(e){this._mcpServer=e}registerToolTask(e,r,n){let o={taskSupport:"required",...r.execution};if(o.taskSupport==="forbidden")throw new Error(`Cannot register task-based tool '${e}' with taskSupport 'forbidden'. Use registerTool() instead.`);return this._mcpServer._createRegisteredTool(e,r.title,r.description,r.inputSchema,r.outputSchema,r.annotations,o,r._meta,n)}};var _i=class{constructor(e,r){this._registeredResources={},this._registeredResourceTemplates={},this._registeredTools={},this._registeredPrompts={},this._toolHandlersInitialized=!1,this._completionHandlerInitialized=!1,this._resourceHandlersInitialized=!1,this._promptHandlersInitialized=!1,this.server=new gi(e,r)}get experimental(){return this._experimental||(this._experimental={tasks:new yi(this)}),this._experimental}async connect(e){return await this.server.connect(e)}async close(){await this.server.close()}setToolRequestHandlers(){this._toolHandlersInitialized||(this.server.assertCanSetRequestHandler(or(ws)),this.server.assertCanSetRequestHandler(or(rn)),this.server.registerCapabilities({tools:{listChanged:!0}}),this.server.setRequestHandler(ws,()=>({tools:Object.entries(this._registeredTools).filter(([,e])=>e.enabled).map(([e,r])=>{let n={name:e,title:r.title,description:r.description,inputSchema:(()=>{let o=Yr(r.inputSchema);return o?pu(o,{strictUnions:!0,pipeStrategy:"input"}):NP})(),annotations:r.annotations,execution:r.execution,_meta:r._meta};if(r.outputSchema){let o=Yr(r.outputSchema);o&&(n.outputSchema=pu(o,{strictUnions:!0,pipeStrategy:"output"}))}return n})})),this.server.setRequestHandler(rn,async(e,r)=>{try{let n=this._registeredTools[e.params.name];if(!n)throw new C(N.InvalidParams,`Tool ${e.params.name} not found`);if(!n.enabled)throw new C(N.InvalidParams,`Tool ${e.params.name} disabled`);let o=!!e.params.task,s=n.execution?.taskSupport,i="createTask"in n.handler;if((s==="required"||s==="optional")&&!i)throw new C(N.InternalError,`Tool ${e.params.name} has taskSupport '${s}' but was not registered with registerToolTask`);if(s==="required"&&!o)throw new C(N.MethodNotFound,`Tool ${e.params.name} requires task augmentation (taskSupport: 'required')`);if(s==="optional"&&!o&&i)return await this.handleAutomaticTaskPolling(n,e,r);let a=await this.validateToolInput(n,e.params.arguments,e.params.name),c=await this.executeToolHandler(n,a,r);return o||await this.validateToolOutput(n,c,e.params.name),c}catch(n){if(n instanceof C&&n.code===N.UrlElicitationRequired)throw n;return this.createToolError(n instanceof Error?n.message:String(n))}}),this._toolHandlersInitialized=!0)}createToolError(e){return{content:[{type:"text",text:e}],isError:!0}}async validateToolInput(e,r,n){if(!e.inputSchema)return;let s=Yr(e.inputSchema)??e.inputSchema,i=await es(s,r);if(!i.success){let a="error"in i?i.error:"Unknown error",c=ts(a);throw new C(N.InvalidParams,`Input validation error: Invalid arguments for tool ${n}: ${c}`)}return i.data}async validateToolOutput(e,r,n){if(!e.outputSchema||!("content"in r)||r.isError)return;if(!r.structuredContent)throw new C(N.InvalidParams,`Output validation error: Tool ${n} has an output schema but no structured content was provided`);let o=Yr(e.outputSchema),s=await es(o,r.structuredContent);if(!s.success){let i="error"in s?s.error:"Unknown error",a=ts(i);throw new C(N.InvalidParams,`Output validation error: Invalid structured content for tool ${n}: ${a}`)}}async executeToolHandler(e,r,n){let o=e.handler;if("createTask"in o){if(!n.taskStore)throw new Error("No task store provided.");let i={...n,taskStore:n.taskStore};if(e.inputSchema){let a=o;return await Promise.resolve(a.createTask(r,i))}else{let a=o;return await Promise.resolve(a.createTask(i))}}if(e.inputSchema){let i=o;return await Promise.resolve(i(r,n))}else{let i=o;return await Promise.resolve(i(n))}}async handleAutomaticTaskPolling(e,r,n){if(!n.taskStore)throw new Error("No task store provided for task-capable tool.");let o=await this.validateToolInput(e,r.params.arguments,r.params.name),s=e.handler,i={...n,taskStore:n.taskStore},a=o?await Promise.resolve(s.createTask(o,i)):await Promise.resolve(s.createTask(i)),c=a.task.taskId,u=a.task,l=u.pollInterval??5e3;for(;u.status!=="completed"&&u.status!=="failed"&&u.status!=="cancelled";){await new Promise(m=>setTimeout(m,l));let d=await n.taskStore.getTask(c);if(!d)throw new C(N.InternalError,`Task ${c} not found during polling`);u=d}return await n.taskStore.getTaskResult(c)}setCompletionRequestHandler(){this._completionHandlerInitialized||(this.server.assertCanSetRequestHandler(or(Ts)),this.server.registerCapabilities({completions:{}}),this.server.setRequestHandler(Ts,async e=>{switch(e.params.ref.type){case"ref/prompt":return Of(e),this.handlePromptCompletion(e,e.params.ref);case"ref/resource":return Nf(e),this.handleResourceCompletion(e,e.params.ref);default:throw new C(N.InvalidParams,`Invalid completion reference: ${e.params.ref}`)}}),this._completionHandlerInitialized=!0)}async handlePromptCompletion(e,r){let n=this._registeredPrompts[r.name];if(!n)throw new C(N.InvalidParams,`Prompt ${r.name} not found`);if(!n.enabled)throw new C(N.InvalidParams,`Prompt ${r.name} disabled`);if(!n.argsSchema)return Po;let s=Bt(n.argsSchema)?.[e.params.argument.name];if(!ad(s))return Po;let i=ay(s);if(!i)return Po;let a=await i(e.params.argument.value,e.params.context);return uy(a)}async handleResourceCompletion(e,r){let n=Object.values(this._registeredResourceTemplates).find(i=>i.resourceTemplate.uriTemplate.toString()===r.uri);if(!n){if(this._registeredResources[r.uri])return Po;throw new C(N.InvalidParams,`Resource template ${e.params.ref.uri} not found`)}let o=n.resourceTemplate.completeCallback(e.params.argument.name);if(!o)return Po;let s=await o(e.params.argument.value,e.params.context);return uy(s)}setResourceRequestHandlers(){this._resourceHandlersInitialized||(this.server.assertCanSetRequestHandler(or(_s)),this.server.assertCanSetRequestHandler(or(vs)),this.server.assertCanSetRequestHandler(or(xs)),this.server.registerCapabilities({resources:{listChanged:!0}}),this.server.setRequestHandler(_s,async(e,r)=>{let n=Object.entries(this._registeredResources).filter(([s,i])=>i.enabled).map(([s,i])=>({uri:s,name:i.name,...i.metadata})),o=[];for(let s of Object.values(this._registeredResourceTemplates)){if(!s.resourceTemplate.listCallback)continue;let i=await s.resourceTemplate.listCallback(r);for(let a of i.resources)o.push({...s.metadata,...a})}return{resources:[...n,...o]}}),this.server.setRequestHandler(vs,async()=>({resourceTemplates:Object.entries(this._registeredResourceTemplates).map(([r,n])=>({name:r,uriTemplate:n.resourceTemplate.uriTemplate.toString(),...n.metadata}))})),this.server.setRequestHandler(xs,async(e,r)=>{let n=new URL(e.params.uri),o=this._registeredResources[n.toString()];if(o){if(!o.enabled)throw new C(N.InvalidParams,`Resource ${n} disabled`);return o.readCallback(n,r)}for(let s of Object.values(this._registeredResourceTemplates)){let i=s.resourceTemplate.uriTemplate.match(n.toString());if(i)return s.readCallback(n,i,r)}throw new C(N.InvalidParams,`Resource ${n} not found`)}),this._resourceHandlersInitialized=!0)}setPromptRequestHandlers(){this._promptHandlersInitialized||(this.server.assertCanSetRequestHandler(or(bs)),this.server.assertCanSetRequestHandler(or($s)),this.server.registerCapabilities({prompts:{listChanged:!0}}),this.server.setRequestHandler(bs,()=>({prompts:Object.entries(this._registeredPrompts).filter(([,e])=>e.enabled).map(([e,r])=>({name:e,title:r.title,description:r.description,arguments:r.argsSchema?ZP(r.argsSchema):void 0}))})),this.server.setRequestHandler($s,async(e,r)=>{let n=this._registeredPrompts[e.params.name];if(!n)throw new C(N.InvalidParams,`Prompt ${e.params.name} not found`);if(!n.enabled)throw new C(N.InvalidParams,`Prompt ${e.params.name} disabled`);if(n.argsSchema){let o=Yr(n.argsSchema),s=await es(o,e.params.arguments);if(!s.success){let c="error"in s?s.error:"Unknown error",u=ts(c);throw new C(N.InvalidParams,`Invalid arguments for prompt ${e.params.name}: ${u}`)}let i=s.data,a=n.callback;return await Promise.resolve(a(i,r))}else{let o=n.callback;return await Promise.resolve(o(r))}}),this._promptHandlersInitialized=!0)}resource(e,r,...n){let o;typeof n[0]=="object"&&(o=n.shift());let s=n[0];if(typeof r=="string"){if(this._registeredResources[r])throw new Error(`Resource ${r} is already registered`);let i=this._createRegisteredResource(e,void 0,r,o,s);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),i}else{if(this._registeredResourceTemplates[e])throw new Error(`Resource template ${e} is already registered`);let i=this._createRegisteredResourceTemplate(e,void 0,r,o,s);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),i}}registerResource(e,r,n,o){if(typeof r=="string"){if(this._registeredResources[r])throw new Error(`Resource ${r} is already registered`);let s=this._createRegisteredResource(e,n.title,r,n,o);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),s}else{if(this._registeredResourceTemplates[e])throw new Error(`Resource template ${e} is already registered`);let s=this._createRegisteredResourceTemplate(e,n.title,r,n,o);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),s}}_createRegisteredResource(e,r,n,o,s){let i={name:e,title:r,metadata:o,readCallback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({uri:null}),update:a=>{typeof a.uri<"u"&&a.uri!==n&&(delete this._registeredResources[n],a.uri&&(this._registeredResources[a.uri]=i)),typeof a.name<"u"&&(i.name=a.name),typeof a.title<"u"&&(i.title=a.title),typeof a.metadata<"u"&&(i.metadata=a.metadata),typeof a.callback<"u"&&(i.readCallback=a.callback),typeof a.enabled<"u"&&(i.enabled=a.enabled),this.sendResourceListChanged()}};return this._registeredResources[n]=i,i}_createRegisteredResourceTemplate(e,r,n,o,s){let i={resourceTemplate:n,title:r,metadata:o,readCallback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({name:null}),update:u=>{typeof u.name<"u"&&u.name!==e&&(delete this._registeredResourceTemplates[e],u.name&&(this._registeredResourceTemplates[u.name]=i)),typeof u.title<"u"&&(i.title=u.title),typeof u.template<"u"&&(i.resourceTemplate=u.template),typeof u.metadata<"u"&&(i.metadata=u.metadata),typeof u.callback<"u"&&(i.readCallback=u.callback),typeof u.enabled<"u"&&(i.enabled=u.enabled),this.sendResourceListChanged()}};this._registeredResourceTemplates[e]=i;let a=n.uriTemplate.variableNames;return Array.isArray(a)&&a.some(u=>!!n.completeCallback(u))&&this.setCompletionRequestHandler(),i}_createRegisteredPrompt(e,r,n,o,s){let i={title:r,description:n,argsSchema:o===void 0?void 0:zr(o),callback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({name:null}),update:a=>{typeof a.name<"u"&&a.name!==e&&(delete this._registeredPrompts[e],a.name&&(this._registeredPrompts[a.name]=i)),typeof a.title<"u"&&(i.title=a.title),typeof a.description<"u"&&(i.description=a.description),typeof a.argsSchema<"u"&&(i.argsSchema=zr(a.argsSchema)),typeof a.callback<"u"&&(i.callback=a.callback),typeof a.enabled<"u"&&(i.enabled=a.enabled),this.sendPromptListChanged()}};return this._registeredPrompts[e]=i,o&&Object.values(o).some(c=>{let u=c instanceof Le?c._def?.innerType:c;return ad(u)})&&this.setCompletionRequestHandler(),i}_createRegisteredTool(e,r,n,o,s,i,a,c,u){cd(e);let l={title:r,description:n,inputSchema:cy(o),outputSchema:cy(s),annotations:i,execution:a,_meta:c,handler:u,enabled:!0,disable:()=>l.update({enabled:!1}),enable:()=>l.update({enabled:!0}),remove:()=>l.update({name:null}),update:d=>{typeof d.name<"u"&&d.name!==e&&(typeof d.name=="string"&&cd(d.name),delete this._registeredTools[e],d.name&&(this._registeredTools[d.name]=l)),typeof d.title<"u"&&(l.title=d.title),typeof d.description<"u"&&(l.description=d.description),typeof d.paramsSchema<"u"&&(l.inputSchema=zr(d.paramsSchema)),typeof d.outputSchema<"u"&&(l.outputSchema=zr(d.outputSchema)),typeof d.callback<"u"&&(l.handler=d.callback),typeof d.annotations<"u"&&(l.annotations=d.annotations),typeof d._meta<"u"&&(l._meta=d._meta),typeof d.enabled<"u"&&(l.enabled=d.enabled),this.sendToolListChanged()}};return this._registeredTools[e]=l,this.setToolRequestHandlers(),this.sendToolListChanged(),l}tool(e,...r){if(this._registeredTools[e])throw new Error(`Tool ${e} is already registered`);let n,o,s,i;if(typeof r[0]=="string"&&(n=r.shift()),r.length>1){let c=r[0];ud(c)?(o=r.shift(),r.length>1&&typeof r[0]=="object"&&r[0]!==null&&!ud(r[0])&&(i=r.shift())):typeof c=="object"&&c!==null&&(i=r.shift())}let a=r[0];return this._createRegisteredTool(e,void 0,n,o,s,i,{taskSupport:"forbidden"},void 0,a)}registerTool(e,r,n){if(this._registeredTools[e])throw new Error(`Tool ${e} is already registered`);let{title:o,description:s,inputSchema:i,outputSchema:a,annotations:c,_meta:u}=r;return this._createRegisteredTool(e,o,s,i,a,c,{taskSupport:"forbidden"},u,n)}prompt(e,...r){if(this._registeredPrompts[e])throw new Error(`Prompt ${e} is already registered`);let n;typeof r[0]=="string"&&(n=r.shift());let o;r.length>1&&(o=r.shift());let s=r[0],i=this._createRegisteredPrompt(e,void 0,n,o,s);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),i}registerPrompt(e,r,n){if(this._registeredPrompts[e])throw new Error(`Prompt ${e} is already registered`);let{title:o,description:s,argsSchema:i}=r,a=this._createRegisteredPrompt(e,o,s,i,n);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),a}isConnected(){return this.server.transport!==void 0}async sendLoggingMessage(e,r){return this.server.sendLoggingMessage(e,r)}sendResourceListChanged(){this.isConnected()&&this.server.sendResourceListChanged()}sendToolListChanged(){this.isConnected()&&this.server.sendToolListChanged()}sendPromptListChanged(){this.isConnected()&&this.server.sendPromptListChanged()}};var NP={type:"object",properties:{}};function ly(t){return t!==null&&typeof t=="object"&&"parse"in t&&typeof t.parse=="function"&&"safeParse"in t&&typeof t.safeParse=="function"}function AP(t){return"_def"in t||"_zod"in t||ly(t)}function ud(t){return typeof t!="object"||t===null||AP(t)?!1:Object.keys(t).length===0?!0:Object.values(t).some(ly)}function cy(t){if(t)return ud(t)?zr(t):t}function ZP(t){let e=Bt(t);return e?Object.entries(e).map(([r,n])=>{let o=Jp(n),s=Gp(n);return{name:r,description:o,required:!s}}):[]}function or(t){let r=Bt(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=rs(r);if(typeof n=="string")return n;throw new Error("Schema method literal must be a string")}function uy(t){return{completion:{values:t.slice(0,100),total:t.length,hasMore:t.length>100}}}var Po={completion:{values:[],hasMore:!1}};var ld=Io(require("node:process"),1);var vi=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;let e=this._buffer.indexOf(`
`);if(e===-1)return null;let r=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),MP(r)}clear(){this._buffer=void 0}};function MP(t){return Tf.parse(JSON.parse(t))}function dy(t){return JSON.stringify(t)+`
`}var xi=class{constructor(e=ld.default.stdin,r=ld.default.stdout){this._stdin=e,this._stdout=r,this._readBuffer=new vi,this._started=!1,this._ondata=n=>{this._readBuffer.append(n),this.processReadBuffer()},this._onerror=n=>{this.onerror?.(n)}}async start(){if(this._started)throw new Error("StdioServerTransport already started! If using Server class, note that connect() calls start() automatically.");this._started=!0,this._stdin.on("data",this._ondata),this._stdin.on("error",this._onerror)}processReadBuffer(){for(;;)try{let e=this._readBuffer.readMessage();if(e===null)break;this.onmessage?.(e)}catch(e){this.onerror?.(e)}}async close(){this._stdin.off("data",this._ondata),this._stdin.off("error",this._onerror),this._stdin.listenerCount("data")===0&&this._stdin.pause(),this._readBuffer.clear(),this.onclose?.()}send(e){return new Promise(r=>{let n=dy(e);this._stdout.write(n)?r():this._stdout.once("drain",r)})}};var zo=Io(require("node:crypto"),1);var fy="0123456789ABCDEFGHJKMNPQRSTVWXYZ",bi=32;var DP=16,my=10,py=0xffffffffffff;var Dr;(function(t){t.Base32IncorrectEncoding="B32_ENC_INVALID",t.DecodeTimeInvalidCharacter="DEC_TIME_CHAR",t.DecodeTimeValueMalformed="DEC_TIME_MALFORMED",t.EncodeTimeNegative="ENC_TIME_NEG",t.EncodeTimeSizeExceeded="ENC_TIME_SIZE_EXCEED",t.EncodeTimeValueMalformed="ENC_TIME_MALFORMED",t.PRNGDetectFailure="PRNG_DETECT",t.ULIDInvalid="ULID_INVALID",t.Unexpected="UNEXPECTED",t.UUIDInvalid="UUID_INVALID"})(Dr||(Dr={}));var qr=class extends Error{constructor(e,r){super(`${r} (${e})`),this.name="ULIDError",this.code=e}};function qP(t){let e=Math.floor(t()*bi)%bi;return fy.charAt(e)}function LP(t){let e=UP(),r=e&&(e.crypto||e.msCrypto)||(typeof zo.default<"u"?zo.default:null);if(typeof r?.getRandomValues=="function")return()=>{let n=new Uint8Array(1);return r.getRandomValues(n),n[0]/256};if(typeof r?.randomBytes=="function")return()=>r.randomBytes(1).readUInt8()/256;if(zo.default?.randomBytes)return()=>zo.default.randomBytes(1).readUInt8()/256;throw new qr(Dr.PRNGDetectFailure,"Failed to find a reliable PRNG")}function UP(){return KP()?self:typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:null}function VP(t,e){let r="";for(;t>0;t--)r=qP(e)+r;return r}function FP(t,e=my){if(isNaN(t))throw new qr(Dr.EncodeTimeValueMalformed,`Time must be a number: ${t}`);if(t>py)throw new qr(Dr.EncodeTimeSizeExceeded,`Cannot encode a time larger than ${py}: ${t}`);if(t<0)throw new qr(Dr.EncodeTimeNegative,`Time must be positive: ${t}`);if(Number.isInteger(t)===!1)throw new qr(Dr.EncodeTimeValueMalformed,`Time must be an integer: ${t}`);let r,n="";for(let o=e;o>0;o--)r=t%bi,n=fy.charAt(r)+n,t=(t-r)/bi;return n}function KP(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}function hy(t,e){let r=e||LP(),n=!t||isNaN(t)?Date.now():t;return FP(n,my)+VP(DP,r)}var $i=class{baseUrl;apiKey;teamId;projectId;brainETag=null;brainCache=null;brainParamsKey=null;constructor(e){if(this.apiKey=e?.apiKey??process.env.CONTOX_API_KEY??"",this.baseUrl=(e?.apiUrl??process.env.CONTOX_API_URL??"https://contox.dev").replace(/\/$/,""),this.teamId=e?.teamId??process.env.CONTOX_TEAM_ID??"",this.projectId=e?.projectId??process.env.CONTOX_PROJECT_ID??"",!this.apiKey)throw new Error("CONTOX_API_KEY is required. Set it as an environment variable.");if(!this.teamId)throw new Error("CONTOX_TEAM_ID is required. Set it as an environment variable.");if(!this.projectId)throw new Error("CONTOX_PROJECT_ID is required. Set it as an environment variable.")}async request(e,r={}){let n=`${this.baseUrl}/api${e}`,o=await fetch(n,{...r,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...r.headers}});if(!o.ok){let s=await o.json().catch(()=>({})),i=typeof s.error=="string"?s.error:o.statusText;throw new Error(`API error (${String(o.status)}): ${i}`)}return o.json()}async listContexts(e){let r=new URLSearchParams({teamId:this.teamId,projectId:this.projectId});return e?.schemaKey&&r.set("schemaKey",e.schemaKey),e?.tier!==void 0&&r.set("tier",String(e.tier)),e?.state&&r.set("state",e.state),e?.contextType&&r.set("contextType",e.contextType),e?.parentContextId&&r.set("parentContextId",e.parentContextId),this.request(`/contexts?${r.toString()}`)}async getContext(e){return this.request(`/contexts/${encodeURIComponent(e)}`)}async createContext(e){return this.request("/contexts",{method:"POST",body:JSON.stringify(e)})}async updateContext(e,r){return this.request(`/contexts/${encodeURIComponent(e)}`,{method:"PATCH",body:JSON.stringify(r)})}async deleteContext(e){await this.request(`/contexts/${encodeURIComponent(e)}`,{method:"DELETE"})}async findBySchemaKey(e){return(await this.listContexts({schemaKey:e}))[0]??null}async findContextByName(e){return(await this.listContexts()).find(n=>n.name===e)??null}async searchContexts(e){let r=await this.listContexts(),n=e.toLowerCase();return r.filter(o=>o.name.toLowerCase().includes(n)||(o.description?.toLowerCase().includes(n)??!1))}async searchContent(e){return this.request(`/contexts/search?q=${encodeURIComponent(e)}&projectId=${encodeURIComponent(this.projectId)}`)}async getBrain(e,r){let n=new URLSearchParams({teamId:this.teamId,projectId:this.projectId});if(r&&n.set("includeDrafts","true"),e){let u=Object.entries(e).map(([l,d])=>`${l}:${String(d)}`).join(",");n.set("entriesLimit",u)}let o=n.toString();o!==this.brainParamsKey&&(this.brainETag=null,this.brainCache=null,this.brainParamsKey=o);let s={};this.brainETag&&(s["If-None-Match"]=this.brainETag);let i=`${this.baseUrl}/api/contexts/brain?${o}`,a=await fetch(i,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...s}});if(a.status===304&&this.brainCache)return this.brainCache;if(!a.ok){let u=await a.json().catch(()=>({})),l=typeof u.error=="string"?u.error:a.statusText;throw new Error(`API error (${String(a.status)}): ${l}`)}let c=await a.json();return this.brainETag=a.headers.get("etag"),this.brainCache=c,c}async createEntry(e){return this.request("/context-entries",{method:"POST",body:JSON.stringify(e)})}async listEntries(e,r){let n=new URLSearchParams({contextId:e});return r?.limit&&n.set("limit",String(r.limit)),r?.cursorAfter&&n.set("cursorAfter",r.cursorAfter),r?.entryType&&n.set("entryType",r.entryType),this.request(`/context-entries?${n.toString()}`)}async optimisticUpdate(e,r,n,o){for(let i=0;i<3;i++){let a=await this.getContext(e),c=a.content??"",u=r(c);try{return await this.updateContext(e,{content:u,version:a.version,source:n,sourceRef:o})}catch(l){if((l instanceof Error?l.message:String(l)).includes("409")&&i<2)continue;throw l}}throw new Error("OCC: max retries exceeded")}async populate(e,r,n){return this.request("/contexts/populate",{method:"POST",body:JSON.stringify({teamId:this.teamId,projectId:this.projectId,nodes:e,dryRun:r,source:n})})}async approveContext(e){await this.request(`/contexts/${encodeURIComponent(e)}/approve?action=approve`,{method:"POST"})}async deprecateContext(e){await this.request(`/contexts/${encodeURIComponent(e)}/approve?action=deprecate`,{method:"POST"})}async getTree(){return this.request(`/contexts/tree?teamId=${encodeURIComponent(this.teamId)}&projectId=${encodeURIComponent(this.projectId)}`)}async createLink(e,r,n,o,s){await this.request("/context-links",{method:"POST",body:JSON.stringify({teamId:this.teamId,projectId:this.projectId,fromSchemaKey:e,toSchemaKey:r,linkType:n,reason:o,confidence:s,source:"mcp"})})}async getLinks(e,r){let n=new URLSearchParams({teamId:this.teamId,projectId:this.projectId,schemaKey:e});return r&&n.set("direction",r),this.request(`/context-links?${n.toString()}`)}async compactContext(e){return this.request(`/contexts/${encodeURIComponent(e)}/compact`,{method:"POST"})}static generateUlid(){return hy()}};var ki=require("node:crypto"),wi=class{baseUrl;apiKey;projectId;hmacSecret;brainETag=null;brainCache=null;constructor(e){this.apiKey=e.apiKey,this.baseUrl=(e.apiUrl??"https://contox.dev").replace(/\/$/,""),this.projectId=e.projectId,this.hmacSecret=e.hmacSecret??null}async getBrain(e){let r=new URLSearchParams({projectId:this.projectId});e?.minConfidence!==void 0&&r.set("minConfidence",String(e.minConfidence)),e?.limit!==void 0&&r.set("limit",String(e.limit));let n={};this.brainETag&&(n["If-None-Match"]=this.brainETag);let o=`${this.baseUrl}/api/v2/brain?${r.toString()}`,s=await fetch(o,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...n}});if(s.status===304&&this.brainCache)return this.brainCache;if(!s.ok){let a=await s.json().catch(()=>({})),c=typeof a.error=="string"?a.error:s.statusText;throw new Error(`V2 brain error (${String(s.status)}): ${c}`)}let i=await s.json();return this.brainETag=s.headers.get("etag"),this.brainCache=i,i}async search(e,r){let n=new URLSearchParams({projectId:this.projectId,q:e});return r?.limit!==void 0&&n.set("limit",String(r.limit)),r?.minSimilarity!==void 0&&n.set("minSimilarity",String(r.minSimilarity)),this.request(`/v2/search?${n.toString()}`)}async listItems(e){let r=new URLSearchParams({projectId:this.projectId});return e?.type&&r.set("type",e.type),e?.schemaKey&&r.set("schemaKey",e.schemaKey),e?.status&&r.set("status",e.status),e?.limit!==void 0&&r.set("limit",String(e.limit)),e?.offset!==void 0&&r.set("offset",String(e.offset)),this.request(`/v2/items?${r.toString()}`)}async getItem(e,r){let n=r?"?includeEmbedding=true":"";return this.request(`/v2/items/${encodeURIComponent(e)}${n}`)}async ingest(e){if(!this.hmacSecret)throw new Error("V2_HMAC_SECRET is required for V2 ingest");let r=JSON.stringify(e),n=new Date().toISOString(),o=(0,ki.randomUUID)(),s=(0,ki.createHmac)("sha256",this.hmacSecret).update(r).digest("hex");return this.request("/v2/ingest",{method:"POST",body:JSON.stringify({source:"mcp-server",timestamp:n,nonce:o,signature:s,projectId:this.projectId,event:e,skipEnrichment:!0})})}async analyzeHygiene(e){return this.request("/v2/hygiene",{method:"POST",body:JSON.stringify({action:"analyze",mode:e.mode,scope:{teamId:e.teamId,projectId:this.projectId},filters:e.schemaKeyPrefix?{schemaKeyPrefix:e.schemaKeyPrefix}:void 0})})}async applyHygiene(e){return this.request("/v2/hygiene",{method:"POST",body:JSON.stringify({action:"apply",scope:{teamId:e.teamId,projectId:this.projectId},plan:e.plan,selectedActionIds:e.selectedActionIds,dryRun:e.dryRun??!1})})}async request(e,r={}){let n=`${this.baseUrl}/api${e}`,o=await fetch(n,{...r,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...r.headers}});if(!o.ok){let s=await o.json().catch(()=>({})),i=typeof s.error=="string"?s.error:o.statusText;throw new Error(`V2 API error (${String(o.status)}): ${i}`)}return o.json()}};var gy=[{id:"architecture",name:"Architecture",description:"Tech stack, architecture decisions, design patterns, project structure, infrastructure",order:0},{id:"conventions",name:"Conventions & Rules",description:"Coding conventions, style rules, linter gotchas, naming patterns, team agreements",order:1},{id:"implementation",name:"Implementation Log",description:"Features built, components created, APIs implemented, integrations added",order:2},{id:"decisions",name:"Technical Decisions",description:"Key decisions with rationale: why X over Y, trade-offs considered, constraints",order:3},{id:"bugs",name:"Bugs & Fixes",description:"Bugs found and how they were fixed, edge cases discovered, workarounds applied",order:4},{id:"todo",name:"Todo & Next Steps",description:"Pending tasks, known issues, planned improvements, tech debt to address",order:5},{id:"sessions",name:"Session Log",description:"Chronological log of all AI sessions with date and summary",order:6}];async function yy(t,e={}){let r=e.since??new Date(Date.now()-864e5).toISOString(),n=[];n.push("# On-Call View"),n.push(""),n.push(`> Since: ${r}`),n.push("");try{let o=await t.findBySchemaKey("root/sessions");if(o){let s=await t.listEntries(o.id,{limit:5});if(n.push("## Recent Sessions"),n.push(""),s.entries.length===0)n.push("No recent sessions.");else for(let i of s.entries)n.push(`- **${i.title}** (${i.createdAt})`),i.tags&&i.tags.length>0&&n.push(`  Tags: ${i.tags.join(", ")}`);n.push("")}}catch{n.push("## Recent Sessions"),n.push(""),n.push("_Unable to fetch sessions._"),n.push("")}try{let o=await t.listContexts({state:"draft"}),s=new Date(Date.now()-10080*60*1e3).toISOString(),i=o.filter(a=>(a.createdAt??"")<s);if(n.push("## Stale Drafts (>7 days)"),n.push(""),i.length===0)n.push("No stale drafts.");else{n.push(`Found ${i.length} stale draft(s):`),n.push("");for(let a of i.slice(0,10))n.push(`- **${a.name}** (schemaKey: ${a.schemaKey??"none"}, created: ${a.createdAt??"unknown"})`);i.length>10&&n.push(`- ... and ${i.length-10} more`)}n.push("")}catch{n.push("## Stale Drafts"),n.push(""),n.push("_Unable to fetch drafts._"),n.push("")}try{let o=await t.findBySchemaKey("root/bugs");if(o){let s=await t.listEntries(o.id,{limit:5});if(n.push("## Recent Bugs"),n.push(""),s.entries.length===0)n.push("No recent bugs recorded.");else for(let i of s.entries)n.push(`- **${i.title}** (${i.createdAt})`);n.push("")}}catch{n.push("## Recent Bugs"),n.push(""),n.push("_Unable to fetch bugs._"),n.push("")}try{let s=(await t.getTree()).total,i=await t.listContexts(),a=i.filter(l=>l.state==="approved").length,c=i.filter(l=>l.state==="draft").length,u=i.filter(l=>l.state==="deprecated").length;n.push("## Brain Health"),n.push(""),n.push("| Metric | Value |"),n.push("|--------|-------|"),n.push(`| Total contexts | ${s} |`),n.push(`| Approved | ${a} |`),n.push(`| Draft | ${c} |`),n.push(`| Deprecated | ${u} |`),n.push("")}catch{n.push("## Brain Health"),n.push(""),n.push("_Unable to fetch brain stats._"),n.push("")}return n.join(`
`)}var HP=new Map,dd={schemaKey:"root",name:"Project Memory",contextType:"system",tier:1,order:0,description:"Root context \u2014 project overview and metadata",storageModel:"content",writePolicy:"mcp",children:[{schemaKey:"root/cortex",name:"Cortex",contextType:"system",tier:1,order:1,description:"Auto-generated project summary \u2014 current focus, recent sessions",storageModel:"content",writePolicy:"mcp"},{schemaKey:"root/stack",name:"Stack & Infrastructure",contextType:"reference",tier:1,order:2,description:"Tech stack, architecture decisions, design patterns, project structure",storageModel:"content",writePolicy:"both",children:[{schemaKey:"root/stack/database",name:"Database Schema",contextType:"reference",tier:2,order:0,description:"Database schema, collections, indexes, relationships",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/stack/environment",name:"Environment & Config",contextType:"reference",tier:2,order:1,description:"Environment variables, configuration files, deployment settings",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/stack/deployment",name:"Deployment & CI/CD",contextType:"reference",tier:2,order:2,description:"Deployment setup, CI/CD pipelines, hosting infrastructure",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/api",name:"API Surface",contextType:"reference",tier:1,order:3,description:"API endpoints, request/response schemas, authentication",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/backend/auth",linkType:"see-also"},{toSchemaKey:"root/stack/database",linkType:"depends-on"}],children:[{schemaKey:"root/api/auth",name:"Auth & User Endpoints",contextType:"reference",tier:2,order:0,description:"Authentication, registration, password reset, session management",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/api/core",name:"Core Resource Endpoints",contextType:"reference",tier:2,order:1,description:"CRUD endpoints for core business entities",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/api/integrations",name:"Integration Endpoints",contextType:"reference",tier:2,order:2,description:"Third-party integration endpoints (Slack, VS Code, etc.)",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/frontend",name:"Frontend Architecture",contextType:"reference",tier:1,order:4,description:"Frontend components, pages, hooks, design system",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/frontend/design",linkType:"depends-on"},{toSchemaKey:"root/api",linkType:"see-also"}],children:[{schemaKey:"root/frontend/ui",name:"UI Component Library",contextType:"reference",tier:2,order:0,description:"Reusable UI components, their props and usage patterns",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/frontend/pages",name:"Page Components & Routes",contextType:"reference",tier:2,order:1,description:"Page-level components and routing structure",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/frontend/hooks",name:"Hooks & State Management",contextType:"reference",tier:2,order:2,description:"Custom hooks, state management patterns, data fetching",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/frontend/design",name:"Design System Tokens",contextType:"reference",tier:2,order:3,description:"Colors, typography, spacing, design tokens and variables",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/backend",name:"Backend Architecture",contextType:"reference",tier:1,order:5,description:"Backend modules, business logic, external integrations",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/stack/database",linkType:"depends-on"},{toSchemaKey:"root/api",linkType:"see-also"}],children:[{schemaKey:"root/backend/auth",name:"Auth & Security",contextType:"reference",tier:2,order:0,description:"Authentication middleware, RBAC, security patterns",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/backend/logic",name:"Business Logic Modules",contextType:"reference",tier:2,order:1,description:"Core business logic, validation, data processing",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/backend/integrations",name:"External Integrations",contextType:"reference",tier:2,order:2,description:"Third-party service integrations (Stripe, Appwrite, etc.)",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/packages",name:"Packages & Extensions",contextType:"reference",tier:1,order:6,description:"MCP server, CLI, Claude plugin, VS Code extension",storageModel:"content",writePolicy:"scanner",children:[{schemaKey:"root/packages/mcp",name:"MCP Server Package",contextType:"reference",tier:2,order:0,description:"MCP server implementation, tools, API client",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/packages/cli",name:"CLI Package",contextType:"reference",tier:2,order:1,description:"CLI commands, options, configuration",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/packages/plugin",name:"Claude Plugin Package",contextType:"reference",tier:2,order:2,description:"Claude Code plugin configuration and marketplace metadata",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/packages/vscode",name:"VS Code Extension",contextType:"reference",tier:2,order:3,description:"VS Code extension functionality and configuration",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/conventions",name:"Conventions & Patterns",contextType:"memory",tier:1,order:7,description:"Coding conventions, style rules, naming patterns, team agreements",storageModel:"entries",writePolicy:"both"},{schemaKey:"root/decisions",name:"Architecture Decisions",contextType:"memory",tier:1,order:8,description:"Key decisions with rationale: why X over Y, trade-offs, constraints",storageModel:"entries",writePolicy:"both"},{schemaKey:"root/todo",name:"Active Todo & Roadmap",contextType:"memory",tier:1,order:9,description:"Pending tasks, known issues, planned improvements, tech debt",storageModel:"entries",writePolicy:"both"},{schemaKey:"root/bugs",name:"Bug Registry",contextType:"memory",tier:1,order:10,description:"Bugs found and how they were fixed, edge cases, workarounds",storageModel:"entries",writePolicy:"mcp"},{schemaKey:"root/journal",name:"Implementation Journal",contextType:"memory",tier:2,order:11,description:"Features built, components created, APIs implemented",storageModel:"entries",writePolicy:"mcp"},{schemaKey:"root/sessions",name:"Session Chronicle",contextType:"system",tier:2,order:12,description:"Chronological log of all AI sessions with date and summary",storageModel:"entries",writePolicy:"mcp"},{schemaKey:"root/contracts",name:"API Contracts",contextType:"reference",tier:1,order:13,description:"Contract documents per domain \u2014 identity, IO, invariants, failure modes, SLOs",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/api",linkType:"depends-on"}],children:[{schemaKey:"root/contracts/auth",name:"Auth Contract",contextType:"reference",tier:2,order:0,description:"Cookie/bearer auth, derivation, RBAC contract",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/backend/auth",linkType:"see-also"}]},{schemaKey:"root/contracts/brain-endpoint",name:"Brain Endpoint Contract",contextType:"reference",tier:2,order:1,description:"GET /brain contract \u2014 ETag, tier assembly, token budget",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/entries",name:"Entries Contract",contextType:"reference",tier:2,order:2,description:"Context entries CRUD \u2014 ULID ordering, idempotency, cursor pagination",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/populate",name:"Populate Contract",contextType:"reference",tier:2,order:3,description:"Batch upsert contract \u2014 diffStats, dryRun, contentHash dedup",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/search",name:"Search Contract",contextType:"reference",tier:2,order:4,description:"Unified search contract \u2014 proof objects, relevance, link boost",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/links",name:"Links Contract",contextType:"reference",tier:2,order:5,description:"Context links CRUD \u2014 bidirectional queries, confidence scoring",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/compaction",name:"Compaction Contract",contextType:"reference",tier:2,order:6,description:"Entries compaction contract \u2014 rolling summary, no deletion",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/runbooks",name:"Runbooks",contextType:"reference",tier:1,order:14,description:"Operational runbooks for incident response and diagnostics",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/ops",linkType:"see-also"}],children:[{schemaKey:"root/runbooks/brain-5xx",name:"Runbook: Brain 5xx",contextType:"reference",tier:2,order:0,description:"Brain endpoint returns 500 \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/populate-stuck",name:"Runbook: Populate Stuck",contextType:"reference",tier:2,order:1,description:"Populate run stuck or failing \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/search-low-recall",name:"Runbook: Search Low Recall",contextType:"reference",tier:2,order:2,description:"Search returns poor results \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/drafts-never-approved",name:"Runbook: Drafts Never Approved",contextType:"reference",tier:2,order:3,description:"Draft contexts accumulate without approval \u2014 diagnosis",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/audit-mismatch",name:"Runbook: Audit Mismatch",contextType:"reference",tier:2,order:4,description:"Mutation audit log inconsistent \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/appwrite-throttling",name:"Runbook: Appwrite Throttling",contextType:"reference",tier:2,order:5,description:"Appwrite rate limits hit \u2014 diagnosis and mitigation",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/ops",name:"Operations & SLOs",contextType:"reference",tier:1,order:15,description:"SLOs per CUJ, error budget policy, golden signals, observability",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/contracts",linkType:"depends-on"}]},{schemaKey:"root/security",name:"Security & Threat Model",contextType:"reference",tier:1,order:16,description:"STRIDE threat model, ASVS checklist, auth surface, mitigations",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/backend/auth",linkType:"see-also"}]},{schemaKey:"root/governance",name:"Data Governance",contextType:"reference",tier:1,order:17,description:"Lifecycle rules, immutable fields, integrity jobs, state machine",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/quality",name:"Quality Gates",contextType:"reference",tier:1,order:18,description:"Test suites, contract tests, retrieval eval, populate gates",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/performance",name:"Performance & Cost",contextType:"reference",tier:1,order:19,description:"Token budgets, degradation strategy, cheap retrieval, cost tracking",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/patterns",name:"Patterns Cookbook",contextType:"reference",tier:1,order:20,description:"Canonical code patterns with snippets \u2014 OCC, idempotency, ETag, pagination",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/conventions",linkType:"see-also"}]},{schemaKey:"root/flows",name:"Data Flows",contextType:"reference",tier:1,order:21,description:"Mermaid sequence diagrams for critical paths \u2014 auth, save, populate, search",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/api",linkType:"see-also"}]},{schemaKey:"root/schema",name:"DB Schema Docs",contextType:"reference",tier:1,order:22,description:"Appwrite collections, attributes, types, indexes with justifications",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/stack/database",linkType:"see-also"}]},{schemaKey:"root/adrs",name:"Architecture Decision Records",contextType:"memory",tier:1,order:23,description:"Formal ADRs \u2014 context, options, decision, tradeoffs, consequences",storageModel:"content",writePolicy:"both",links:[{toSchemaKey:"root/decisions",linkType:"see-also"}]}]};function _y(t){if(HP.set(t.schemaKey,t),t.children)for(let e of t.children)_y(e)}_y(dd);function vy(t,e){if(t.schemaKey===e)return t;if(t.children)for(let r of t.children){let n=vy(r,e);if(n)return n}return null}async function xy(t,e){let r=[];r.push(`# Explain: ${e}`),r.push("");let n=vy(dd,e);if(n){if(r.push("## Schema Metadata"),r.push(""),r.push("| Property | Value |"),r.push("|----------|-------|"),r.push(`| SchemaKey | \`${n.schemaKey}\` |`),r.push(`| Name | ${n.name} |`),n.tier!==void 0&&r.push(`| Tier | ${n.tier} |`),n.contextType&&r.push(`| Context Type | ${n.contextType} |`),n.writePolicy&&r.push(`| Write Policy | ${n.writePolicy} |`),n.storageModel&&r.push(`| Storage Model | ${n.storageModel} |`),n.description&&r.push(`| Description | ${n.description} |`),n.children&&r.push(`| Children | ${n.children.length} |`),r.push(""),n.links&&n.links.length>0){r.push("### Links (Schema-Declared)"),r.push("");for(let o of n.links)r.push(`- **${o.linkType}** \u2192 \`${o.toSchemaKey}\``);r.push("")}}else r.push("> SchemaKey not found in brain-schema.ts"),r.push("");try{let o=await t.findBySchemaKey(e);if(o){if(r.push("## Context"),r.push(""),r.push("| Property | Value |"),r.push("|----------|-------|"),r.push(`| ID | ${o.id} |`),r.push(`| State | ${o.state??"unknown"} |`),r.push(`| Version | ${o.version??0} |`),o.contentHash&&r.push(`| Content Hash | ${o.contentHash.slice(0,12)}... |`),o.lastEntryAt&&r.push(`| Last Entry | ${o.lastEntryAt} |`),r.push(""),o.content){let s=o.content.length>500?o.content.slice(0,500)+"...":o.content;r.push("### Content Preview"),r.push(""),r.push(s),r.push("")}try{let s=await t.getLinks(e);if(s.outgoing.length>0||s.incoming.length>0){if(r.push("## Links (Runtime)"),r.push(""),s.outgoing.length>0){r.push("**Outgoing:**");for(let i of s.outgoing)r.push(`- ${i.linkType} \u2192 \`${i.toSchemaKey}\``);r.push("")}if(s.incoming.length>0){r.push("**Incoming:**");for(let i of s.incoming)r.push(`- ${i.linkType} \u2190 \`${i.fromSchemaKey}\``);r.push("")}}}catch{}try{let s=await t.listEntries(o.id,{limit:5});if(s.entries.length>0){r.push("## Recent Entries"),r.push("");for(let i of s.entries){r.push(`### ${i.title}`),r.push(`> ${i.entryType??"entry"} | ${i.createdAt}`);let a=i.content.length>200?i.content.slice(0,200)+"...":i.content;r.push(a),r.push("")}}}catch{}}else r.push("## Context"),r.push(""),r.push("_No context found for this schemaKey in the current project._"),r.push("")}catch(o){r.push("## Context"),r.push(""),r.push(`_Error fetching context: ${String(o)}_`),r.push("")}if(e.startsWith("root/contracts/")){r.push("## Related Contract"),r.push("");let o=e.replace("root/contracts/","");r.push(`This is a contract domain. See generated contract: \`generated/contracts/${o}.md\``),r.push("")}else{let o=e.replace("root/","").split("/")[0];if(o)try{await t.findBySchemaKey(`root/contracts/${o}`)&&(r.push("## Related Contract"),r.push(""),r.push(`See: \`root/contracts/${o}\``),r.push(""))}catch{}}return r.join(`
`)}var Mt=require("node:fs"),De=require("node:path"),BP=new Set(["node_modules",".next",".git","dist","out","build",".cache",".turbo","coverage",".nyc_output",".storybook","storybook-static","__pycache__",".venv","vendor",".svn",".hg","test-results","playwright-report",".playwright"]),JP=new Set(["package-lock.json","pnpm-lock.yaml","yarn.lock","bun.lockb",".DS_Store","Thumbs.db","nul"]),GP=new Set([".png",".jpg",".jpeg",".gif",".svg",".ico",".webp",".avif",".woff",".woff2",".ttf",".eot",".otf",".mp3",".mp4",".wav",".ogg",".webm",".zip",".tar",".gz",".br",".7z",".rar",".pdf",".doc",".docx",".xls",".xlsx",".exe",".dll",".so",".dylib",".wasm",".map"]),WP=32*1024,XP=[{pattern:/^README\.md$/i,reason:"Project documentation"},{pattern:/^ARCHITECTURE\.md$/i,reason:"Architecture documentation"},{pattern:/^CLAUDE\.md$/i,reason:"AI assistant instructions"},{pattern:/^AGENTS\.md$/i,reason:"AI agent instructions"},{pattern:/^RULES\.md$/i,reason:"Project rules"},{pattern:/^CONTRIBUTING\.md$/i,reason:"Contribution guidelines"},{pattern:/^\.cursorrules$/i,reason:"AI assistant rules"},{pattern:/^\.clinerules$/i,reason:"AI assistant rules"},{pattern:/^Dockerfile$/i,reason:"Container configuration"},{pattern:/^docker-compose\.ya?ml$/i,reason:"Container orchestration"},{pattern:/^\.env\.example$/i,reason:"Environment template"},{pattern:/^schema\.prisma$/i,reason:"Database schema"},{pattern:/^drizzle\.config\.\w+$/i,reason:"Database configuration"}];function YP(t){return BP.has(t)||t.startsWith(".")}function QP(t){if(JP.has(t))return!0;let e=(0,De.extname)(t).toLowerCase();return!!GP.has(e)}function ez(t){for(let{pattern:e,reason:r}of XP)if(e.test(t))return{match:!0,reason:r};return{match:!1,reason:""}}function tz(t){let e=(0,De.extname)(t).toLowerCase();return{".ts":"TypeScript",".tsx":"TypeScript (JSX)",".js":"JavaScript",".jsx":"JavaScript (JSX)",".py":"Python",".rb":"Ruby",".go":"Go",".rs":"Rust",".java":"Java",".kt":"Kotlin",".swift":"Swift",".cs":"C#",".cpp":"C++",".c":"C",".php":"PHP",".vue":"Vue",".svelte":"Svelte",".astro":"Astro",".css":"CSS",".scss":"SCSS",".less":"LESS",".html":"HTML",".md":"Markdown",".json":"JSON",".yaml":"YAML",".yml":"YAML",".toml":"TOML",".xml":"XML",".sql":"SQL",".graphql":"GraphQL",".gql":"GraphQL",".sh":"Shell",".bash":"Shell",".zsh":"Shell",".dockerfile":"Dockerfile"}[e]??null}function rz(t,e,r){let n=[],o=[],s=[],i=/export\s+(?:const|function)\s+(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)\b/g,a;for(;(a=i.exec(t))!==null;)n.push(a[1]);let c=/export\s+const\s+(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)\s*=\s*(\w+)\(/g;for(;(a=c.exec(t))!==null;)n.includes(a[1])||n.push(a[1]),s.push(a[2]);let u=/(?:const|let)\s+(\w+Schema)\s*=\s*z\.\w+\(\{([^}]*(?:\{[^}]*\}[^}]*)*)\}\)/g;for(;(a=u.exec(t))!==null;){let d=a[1],h=a[2].replace(/\s+/g," ").trim();o.push(`${d}: { ${h.length>200?h.slice(0,200)+"...":h} }`)}let l=[...new Set(s)];return{path:e,methods:n,filePath:r,schemas:o,middleware:l}}function nz(t,e){let r=(0,De.basename)(e).replace(/\.(tsx|jsx)$/,""),n=null,o=null,s=t.match(/export\s+default\s+function\s+(\w+)/),i=t.match(/export\s+function\s+(\w+)/);s?r=s[1]:i&&(r=i[1]);let a=[/(?:export\s+)?interface\s+(\w*Props\w*)\s*\{([^}]*(?:\{[^}]*\}[^}]*)*)\}/,/(?:export\s+)?type\s+(\w*Props\w*)\s*=\s*\{([^}]*(?:\{[^}]*\}[^}]*)*)\}/];for(let u of a){let l=t.match(u);if(l){let m=l[2].trim().split(`
`).map(h=>h.trim()).filter(h=>h&&!h.startsWith("//")&&!h.startsWith("/*"));m.length>0&&(n=m.slice(0,15).join(`
`),m.length>15&&(n+=`
// ... ${String(m.length-15)} more props`));break}}let c=t.match(/\/\*\*\s*\n([^*]*(?:\*[^/][^*]*)*)\*\/\s*\n\s*(?:export\s+)?(?:default\s+)?function/);return c&&(o=c[1].replace(/^\s*\*\s?/gm,"").trim().split(`
`)[0]??null),{name:r,filePath:e,props:n,description:o}}function Si(t,e){let r=[],n=null,o=t.match(/^\/\*\*\s*\n([^*]*(?:\*[^/][^*]*)*)\*\/\s*\n/);o&&(n=o[1].replace(/^\s*\*\s?/gm,"").trim().split(`
`)[0]??null);let s=/export\s+(async\s+)?function\s+(\w+)\s*(<[^>]*>)?\s*\(([^)]*)\)\s*:\s*([^\n{]+)/g,i;for(;(i=s.exec(t))!==null;){let m=i[1]?"async ":"",h=i[2],p=i[3]??"",f=i[4].replace(/\s+/g," ").trim(),g=i[5].trim().replace(/\s*\{$/,"");r.push({name:h,signature:`${m}function ${h}${p}(${f}): ${g}`,kind:"function"})}let a=/export\s+const\s+(\w+)\s*(?::\s*[^=]+)?\s*=\s*(async\s+)?\(([^)]*)\)\s*(?::\s*([^\n=>]+))?\s*=>/g;for(;(i=a.exec(t))!==null;){let m=i[1],h=i[2]?"async ":"",p=i[3].replace(/\s+/g," ").trim(),f=i[4]?.trim()??"unknown";r.some(g=>g.name===m)||r.push({name:m,signature:`${h}const ${m} = (${p}): ${f}`,kind:"function"})}let c=/export\s+const\s+(\w+)\s*(?::\s*([^=\n]+))?\s*=/g;for(;(i=c.exec(t))!==null;){let m=i[1],h=i[2]?.trim();r.some(p=>p.name===m)||r.push({name:m,signature:h?`const ${m}: ${h}`:`const ${m}`,kind:"const"})}let u=/export\s+interface\s+(\w+)\s*(?:<[^>]*>)?\s*\{([^}]*(?:\{[^}]*\}[^}]*)*)\}/g;for(;(i=u.exec(t))!==null;){let m=i[1],p=i[2].trim().split(`
`).map(g=>g.trim()).filter(g=>g&&!g.startsWith("//")),f=p.slice(0,8).join("; ");r.push({name:m,signature:`interface ${m} { ${f}${p.length>8?"; ...":""} }`,kind:"interface"})}let l=/export\s+type\s+(\w+)\s*(?:<[^>]*>)?\s*=\s*([^\n;]+)/g;for(;(i=l.exec(t))!==null;){let m=i[1],h=i[2].trim();r.push({name:m,signature:`type ${m} = ${h.length>100?h.slice(0,100)+"...":h}`,kind:"type"})}let d=/export\s+(?:abstract\s+)?class\s+(\w+)(?:\s+extends\s+(\w+))?(?:\s+implements\s+(\w+))?/g;for(;(i=d.exec(t))!==null;){let m=i[1],h=i[2]?` extends ${i[2]}`:"",p=i[3]?` implements ${i[3]}`:"";r.push({name:m,signature:`class ${m}${h}${p}`,kind:"class"})}return{filePath:e,exports:r,description:n}}function $y(t){let e=[],r=[],n=[],o=[],s=[],i=[],a=[],c=[],u={},l=0,d=0;function m(g,v){if(v>8)return;let x;try{x=(0,Mt.readdirSync)(g)}catch{return}let $=x.sort((k,E)=>{let M=pd((0,De.join)(g,k)),ve=pd((0,De.join)(g,E));return M&&!ve?-1:!M&&ve?1:k.localeCompare(E)});for(let k of $){let E=(0,De.join)(g,k),M=(0,De.relative)(t,E).replace(/\\/g,"/");if(pd(E)){if(YP(k))continue;d++,e.push(M+"/"),m(E,v+1)}else{if(QP(k))continue;l++,e.push(M);let ve=tz(k);if(ve&&(u[ve]=(u[ve]??0)+1),M.startsWith("src/app/")&&(k==="page.tsx"||k==="route.ts")){let te=M.replace("src/app","").replace("/page.tsx","").replace("/route.ts","").replace(/\/\[([^\]]+)\]/g,"/:$1");if(k==="route.ts"){let Tt=Zt(E);Tt&&!Tt.startsWith("[File too large")?r.push(rz(Tt,te||"/",M)):r.push({path:te||"/",methods:[],filePath:M,schemas:[],middleware:[]})}else r.push({path:te||"/",methods:["PAGE"],filePath:M,schemas:[],middleware:[]})}if(M.match(/src\/components\/.*\.(tsx|jsx)$/)&&!M.includes(".test.")&&!M.includes(".stories.")){let te=Zt(E);te&&!te.startsWith("[File too large")?n.push(nz(te,M)):n.push({name:(0,De.basename)(M).replace(/\.(tsx|jsx)$/,""),filePath:M,props:null,description:null})}if(M.match(/src\/hooks\/.*\.(ts|js)$/)&&!M.includes(".test.")){let te=Zt(E);te&&!te.startsWith("[File too large")&&s.push(Si(te,M))}if(M.match(/src\/stores\/.*\.(ts|js)$/)&&!M.includes(".test.")){let te=Zt(E);te&&!te.startsWith("[File too large")&&i.push(Si(te,M))}if(M==="src/middleware.ts"||M==="middleware.ts"){let te=Zt(E);te&&!te.startsWith("[File too large")&&a.push(Si(te,M))}if(M.match(/src\/lib\/.*\.(ts|js)$/)&&!M.includes(".test.")){let te=Zt(E);te&&!te.startsWith("[File too large")?o.push(Si(te,M)):o.push({filePath:M,exports:[],description:null})}let Xe=ez(k);if(Xe.match){let te=Zt(E);te&&c.push({path:M,content:te,reason:Xe.reason})}}}}m(t,0);let h=by((0,De.join)(t,"package.json")),p=by((0,De.join)(t,"tsconfig.json")),f=Zt((0,De.join)(t,".env.example"));return{root:t,tree:e,packageJson:h,tsConfig:p,envExample:f,routes:r,components:n,libs:o,hooks:s,stores:i,middlewares:a,keyFiles:c,stats:{totalFiles:l,totalDirs:d,languages:u}}}function pd(t){try{return(0,Mt.statSync)(t).isDirectory()}catch{return!1}}function Zt(t){try{if(!(0,Mt.existsSync)(t))return null;let e=(0,Mt.statSync)(t);return e.size>WP?`[File too large: ${Math.round(e.size/1024)}KB]`:(0,Mt.readFileSync)(t,"utf-8")}catch{return null}}function by(t){let e=Zt(t);if(!e||e.startsWith("[File too large"))return null;try{return JSON.parse(e)}catch{return null}}var bn=require("node:path");function fd(t){return Math.ceil(t.length/4)}function Sy(t){let e=t.packageJson?String(t.packageJson.name??(0,bn.basename)(t.root)):(0,bn.basename)(t.root),r=[],n=new Date().toISOString(),o=iz(t),s=t.routes.filter(a=>!a.methods.includes("PAGE")),i=t.routes.filter(a=>a.methods.includes("PAGE"));{let a=[];a.push(`# ${e} \u2014 Project Overview
`),a.push(`> Scanned: ${n}
`),t.packageJson?.description&&a.push(`**Description**: ${String(t.packageJson.description)}
`),o.length>0&&a.push(`**Stack**: ${o.join(", ")}
`),a.push(`**Stats**: ${String(t.stats.totalFiles)} files, ${String(t.stats.totalDirs)} directories`),a.push(`**Routes**: ${String(s.length)} API endpoints, ${String(i.length)} pages`),a.push(`**Components**: ${String(t.components.length)} React components`),a.push(`**Libraries**: ${String(t.libs.length)} modules in src/lib/`),t.hooks.length>0&&a.push(`**Hooks**: ${String(t.hooks.length)} custom hooks`),t.stores.length>0&&a.push(`**Stores**: ${String(t.stores.length)} state stores`),a.push("");let c=Object.entries(t.stats.languages).sort(([,u],[,l])=>l-u).slice(0,8);c.length>0&&a.push("**Languages**: "+c.map(([u,l])=>`${u} (${String(l)})`).join(", ")+`
`),a.push(`## Project Structure
`),a.push("```"),a.push(az(t.tree)),a.push("```\n"),a.push(`## Architecture Notes
`),t.routes.some(u=>u.middleware.includes("withRateLimit"))&&a.push("- API routes use `withRateLimit` middleware for rate limiting"),t.routes.some(u=>u.schemas.length>0)&&a.push("- Request validation via Zod schemas"),t.middlewares.length>0&&a.push("- Next.js middleware active at `src/middleware.ts`"),t.stores.length>0&&a.push(`- Client state management: ${String(t.stores.length)} Zustand stores`),t.hooks.length>0&&a.push(`- ${String(t.hooks.length)} custom React hooks in src/hooks/`),a.push(""),r.push({name:"[Scan] Overview",description:`Project overview: ${o.slice(0,3).join(", ")}, ${String(t.stats.totalFiles)} files`,content:a.join(`
`),order:0,schemaKey:"root/scan",tier:1,contextType:"reference"})}if(i.length>0){let a=[];a.push(`## Pages
`),a.push("| Route | File |"),a.push("|-------|------|");for(let c of i.sort((u,l)=>u.path.localeCompare(l.path)))a.push(`| \`${c.path}\` | ${c.filePath} |`);a.push(""),r.push({name:"[Scan] Pages & Routes",description:`${String(i.length)} Next.js page routes`,content:a.join(`
`),order:1,schemaKey:"root/frontend/pages",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"})}if(s.length>0){let a=s.filter(h=>/^\/api\/(auth|user|team|orgs)/.test(h.path)),c=s.filter(h=>/^\/api\/(contexts|projects|context-entries|context-links)/.test(h.path)),u=s.filter(h=>/^\/api\/(billing|integrations|webhooks|keys|ai)/.test(h.path)),l=new Set([...a,...c,...u]),d=s.filter(h=>!l.has(h)),m=d.length>0?Ti("API: System & Admin",d):`## API Overview

${String(s.length)} API endpoints across ${String(a.length>0?1:0)+String(c.length>0?1:0)+String(u.length>0?1:0)} domains.`;r.push({name:"[Scan] API: System",description:`${String(s.length)} total API endpoints (${String(d.length)} system)`,content:m,order:2,schemaKey:"root/api",tier:2,contextType:"reference"}),a.length>0&&r.push({name:"[Scan] API: Auth & User",description:`${String(a.length)} endpoints: auth, user, team, orgs`,content:Ti("API: Auth & User Management",a),order:3,schemaKey:"root/api/auth",parentSchemaKey:"root/api",tier:2,contextType:"reference"}),c.length>0&&r.push({name:"[Scan] API: Core CRUD",description:`${String(c.length)} endpoints: contexts, projects, entries, links`,content:Ti("API: Core CRUD",c),order:4,schemaKey:"root/api/core",parentSchemaKey:"root/api",tier:2,contextType:"reference"}),u.length>0&&r.push({name:"[Scan] API: Integrations",description:`${String(u.length)} endpoints: billing, integrations, webhooks, keys, AI`,content:Ti("API: Integrations",u),order:5,schemaKey:"root/api/integrations",parentSchemaKey:"root/api",tier:2,contextType:"reference"})}if(t.components.length>0){let a=t.components.filter(m=>m.filePath.includes("/contox/")),c=t.components.filter(m=>m.filePath.includes("/ui/")),u=t.components.filter(m=>m.filePath.includes("/pages/")||m.filePath.includes("/landing/")||m.filePath.includes("/providers/")||m.filePath.includes("/skeletons/")||m.filePath.includes("/icons/")),l=new Set([...a,...c,...u]),d=t.components.filter(m=>!l.has(m));if(a.length>0&&r.push({name:"[Scan] Components: Domain",description:`${String(a.length)} domain components (brain, editor, entries, etc.)`,content:Pi(a),order:6,schemaKey:"root/frontend",tier:2,contextType:"reference"}),c.length>0&&r.push({name:"[Scan] Components: UI Library",description:`${String(c.length)} UI primitives (buttons, cards, dialogs, etc.)`,content:Pi(c),order:7,schemaKey:"root/frontend/ui",parentSchemaKey:"root/frontend",tier:3,contextType:"reference"}),u.length>0){let m=[...u,...d];r.push({name:"[Scan] Components: Pages & Layout",description:`${String(m.length)} page, landing, provider, and layout components`,content:Pi(m),order:8,schemaKey:"root/frontend/layout",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"})}else d.length>0&&r.push({name:"[Scan] Components: Other",description:`${String(d.length)} uncategorized components`,content:Pi(d),order:8,schemaKey:"root/frontend/layout",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"})}if(t.hooks.length>0&&r.push({name:"[Scan] Hooks",description:`${String(t.hooks.length)} custom React hooks`,content:xn("Custom Hooks (src/hooks/)",t.hooks),order:9,schemaKey:"root/frontend/hooks",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"}),t.stores.length>0&&r.push({name:"[Scan] State Stores",description:`${String(t.stores.length)} Zustand stores`,content:xn("State Stores (src/stores/)",t.stores),order:10,schemaKey:"root/frontend/stores",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"}),t.libs.length>0||t.middlewares.length>0){let a=t.libs.filter(f=>f.filePath.includes("/middleware/")),c=t.libs.filter(f=>/\/(stripe|email|openrouter|rate-limiter|quotas|webhook-dispatcher|activity-logger)/.test(f.filePath)),u=t.libs.filter(f=>f.filePath.includes("/validations/")),l=new Set([...a,...c,...u]),d=t.libs.filter(f=>!l.has(f)),m=t.libs.length+t.middlewares.length,h=[...t.libs,...t.middlewares].reduce((f,g)=>f+g.exports.length,0),p=[];if(p.push(`## Backend Overview
`),p.push(`**${String(m)} modules** \u2014 ${String(h)} exported functions/types
`),p.push("| Category | Count | Key Modules |"),p.push("|----------|-------|-------------|"),d.length>0){let f=d.slice(0,5).map(g=>`\`${(0,bn.basename)(g.filePath).replace(/\.(ts|js)$/,"")}\``).join(", ");p.push(`| Core | ${String(d.length)} | ${f} |`)}if(c.length>0){let f=c.map(g=>`\`${(0,bn.basename)(g.filePath).replace(/\.(ts|js)$/,"")}\``).join(", ");p.push(`| Services | ${String(c.length)} | ${f} |`)}if(u.length>0&&p.push(`| Validations | ${String(u.length)} | Zod schemas for API input |`),a.length>0||t.middlewares.length>0){let f=a.length+t.middlewares.length;p.push(`| Middleware | ${String(f)} | auth-derive, brain-invariants |`)}if(p.push(""),r.push({name:"[Scan] Backend Overview",description:`${String(m)} backend modules, ${String(h)} exports`,content:p.join(`
`),order:11,schemaKey:"root/backend",tier:2,contextType:"reference"}),d.length>0&&r.push({name:"[Scan] Libs: Core",description:`${String(d.length)} core libraries (appwrite, auth, utils, etc.)`,content:xn("Core Libraries",d),order:12,schemaKey:"root/backend/logic",parentSchemaKey:"root/backend",tier:2,contextType:"reference"}),c.length>0&&r.push({name:"[Scan] Libs: Services",description:`${String(c.length)} service integrations (stripe, email, AI, etc.)`,content:xn("Service Integrations",c),order:13,schemaKey:"root/backend/integrations",parentSchemaKey:"root/backend",tier:2,contextType:"reference"}),u.length>0&&r.push({name:"[Scan] Libs: Validations",description:`${String(u.length)} Zod validation schemas`,content:xn("Validation Schemas",u),order:14,schemaKey:"root/backend/validations",parentSchemaKey:"root/backend",tier:2,contextType:"reference"}),a.length>0||t.middlewares.length>0){let f=[...a,...t.middlewares];r.push({name:"[Scan] Auth & Middleware",description:`${String(f.length)} auth/middleware modules`,content:xn("Auth & Middleware",f),order:15,schemaKey:"root/backend/auth",parentSchemaKey:"root/backend",tier:2,contextType:"reference"})}}if(t.packageJson){let a=oz(t.packageJson);if(a){let c=t.packageJson.dependencies;r.push({name:"[Scan] Dependencies",description:`${String(Object.keys(c??{}).length)} runtime deps, npm scripts`,content:a,order:16,schemaKey:"root/stack",tier:2,contextType:"reference"})}}if((t.tsConfig||t.envExample)&&r.push({name:"[Scan] Configuration",description:"TypeScript config, environment variables",content:sz(t),order:17,schemaKey:"root/stack/environment",parentSchemaKey:"root/stack",tier:2,contextType:"reference"}),t.keyFiles.some(a=>a.path.startsWith("packages/"))){let a=t.keyFiles.filter(c=>c.path.startsWith("packages/"));r.push({name:"[Scan] Packages",description:`${String(a.length)} monorepo packages (CLI, MCP, plugins)`,content:wy(a),order:18,schemaKey:"root/packages",tier:2,contextType:"reference"})}{let a=t.keyFiles.filter(c=>!c.path.startsWith("packages/"));a.length>0&&r.push({name:"[Scan] Documentation",description:`Key docs: ${a.map(c=>c.path).join(", ")}`,content:wy(a),order:19,schemaKey:"root/scan/docs",parentSchemaKey:"root/scan",tier:3,contextType:"reference"})}return r}function Ti(t,e){let r=[];r.push(`## ${t}
`);for(let n of e.sort((o,s)=>o.path.localeCompare(s.path))){let o=n.methods.length>0?n.methods.join(", "):"UNKNOWN";if(r.push(`### \`${o}\` ${n.path}`),r.push(`> File: \`${n.filePath}\``),n.middleware.length>0&&r.push(`> Middleware: ${n.middleware.map(s=>`\`${s}\``).join(", ")}`),n.schemas.length>0){r.push(`
**Request schemas:**`),r.push("```typescript");for(let s of n.schemas)r.push(s);r.push("```")}r.push("")}return r.join(`
`)}function Pi(t){let e=[];e.push(`## Components
`);let r=cz(t.map(o=>o.filePath)),n=new Map(t.map(o=>[o.filePath,o]));for(let[o,s]of r){e.push(`### ${o}
`);for(let i of s){let a=n.get(i);if(!a)continue;let c=a.description?` \u2014 ${a.description}`:"";e.push(`#### \`${a.name}\`${c}`),e.push(`> File: \`${a.filePath}\``),a.props&&(e.push(`
**Props:**`),e.push("```typescript"),e.push(a.props),e.push("```")),e.push("")}}return e.join(`
`)}function xn(t,e){let r=[];r.push(`## ${t}
`);for(let n of e.sort((o,s)=>o.filePath.localeCompare(s.filePath))){let o=(0,bn.basename)(n.filePath).replace(/\.(ts|js)$/,""),s=n.description?` \u2014 ${n.description}`:"";if(r.push(`### \`${o}\`${s}`),r.push(`> File: \`${n.filePath}\``),n.exports.length>0){r.push(""),r.push("```typescript");for(let i of n.exports)r.push(`export ${i.signature}`);r.push("```")}else r.push(`
*No public exports detected*`);r.push("")}return r.join(`
`)}function oz(t){let e=[],r=t.dependencies,n=t.devDependencies;if(r&&Object.keys(r).length>0){e.push(`## Runtime Dependencies
`);let s=ky(r);for(let[i,a]of s)e.push(`**${i}**: ${a.map(([c,u])=>`${c} ${u}`).join(", ")}`);e.push("")}if(n&&Object.keys(n).length>0){e.push(`## Dev Dependencies
`);let s=ky(n);for(let[i,a]of s)e.push(`**${i}**: ${a.map(([c,u])=>`${c} ${u}`).join(", ")}`);e.push("")}let o=t.scripts;if(o&&Object.keys(o).length>0){e.push(`## NPM Scripts
`),e.push("```");for(let[s,i]of Object.entries(o))e.push(`${s}: ${i}`);e.push("```")}return e.length>0?e.join(`
`):null}function sz(t){let e=[];if(t.tsConfig){let r=t.tsConfig.compilerOptions;r&&(e.push(`## TypeScript Configuration
`),e.push("```json"),e.push(JSON.stringify({compilerOptions:r},null,2)),e.push("```\n"))}return t.envExample&&(e.push(`## Environment Variables
`),e.push("```env"),e.push(t.envExample.trim()),e.push("```")),e.join(`
`)}function wy(t){let e=[];e.push(`## Key Documentation
`);for(let r of t){e.push(`### ${r.path}`),e.push(`> ${r.reason}
`);let n=r.path.split(".").pop()??"",o=n==="md"?"markdown":n;e.push(`\`\`\`${o}`);let s=8e3;r.content.length>s?(e.push(r.content.slice(0,s)),e.push(`
... [truncated, ${String(Math.round(r.content.length/1024))}KB total]`)):e.push(r.content),e.push("```\n")}return e.join(`
`)}function iz(t){let e=[];if(!t.packageJson)return e;let r={...t.packageJson.dependencies??{},...t.packageJson.devDependencies??{}};return r.next?e.push(`Next.js ${r.next}`):r.nuxt?e.push(`Nuxt ${r.nuxt}`):r["@angular/core"]?e.push(`Angular ${r["@angular/core"]}`):r.svelte?e.push(`Svelte ${r.svelte}`):r.astro?e.push(`Astro ${r.astro}`):r.react?e.push(`React ${r.react}`):r.vue&&e.push(`Vue ${r.vue}`),r.typescript&&e.push("TypeScript"),r.tailwindcss?e.push("Tailwind CSS"):r["styled-components"]&&e.push("styled-components"),r.prisma||r["@prisma/client"]?e.push("Prisma"):r["drizzle-orm"]?e.push("Drizzle"):r.mongoose?e.push("MongoDB"):r.pg&&e.push("PostgreSQL"),r.appwrite||r["node-appwrite"]?e.push("Appwrite"):r.firebase||r["firebase-admin"]?e.push("Firebase"):r["@supabase/supabase-js"]&&e.push("Supabase"),r["next-auth"]?e.push("NextAuth"):r["@clerk/nextjs"]&&e.push("Clerk"),r.zustand?e.push("Zustand"):r["@reduxjs/toolkit"]?e.push("Redux"):r.jotai&&e.push("Jotai"),r.vitest?e.push("Vitest"):r.jest&&e.push("Jest"),r.stripe&&e.push("Stripe"),r.resend&&e.push("Resend"),r["@sentry/nextjs"]&&e.push("Sentry"),e}function az(t){let e=[],r=new Map;r.set("",{dirs:[],fileCount:0});for(let s of t){let i=s.endsWith("/"),a=s.replace(/\/$/,"").split("/");if(i&&a.length<=3){let c=a.slice(0,-1).join("/"),u=a[a.length-1]??"";r.has(c)||r.set(c,{dirs:[],fileCount:0}),r.get(c).dirs.push(u),r.has(s.replace(/\/$/,""))||r.set(s.replace(/\/$/,""),{dirs:[],fileCount:0})}else if(!i){let u=a.slice(0,-1).join("/");for(;u&&!r.has(u);)u=u.split("/").slice(0,-1).join("/");r.has(u)&&r.get(u).fileCount++}}function n(s,i){let a=r.get(s);if(a)for(let c of a.dirs.sort()){let u=s?`${s}/${c}`:c,l=r.get(u),d="  ".repeat(i),m=l?.fileCount?` (${String(l.fileCount)} files)`:"";e.push(`${d}${c}/${m}`),n(u,i+1)}}let o=r.get("");return o?.fileCount&&e.push(`(${String(o.fileCount)} root files)`),n("",0),e.join(`
`)}function cz(t){let e=new Map;for(let r of t){let o=r.split("/").slice(0,3).join("/");e.has(o)||e.set(o,[]),e.get(o).push(r)}return[...e.entries()].sort(([r],[n])=>r.localeCompare(n))}function ky(t){let e=new Map;for(let[n,o]of Object.entries(t)){let s="Other";n.match(/^(next|react|react-dom|vue|nuxt|svelte|astro|@angular)/)?s="Framework":n.match(/^(@dnd-kit|framer-motion|@radix|@headlessui|lucide|@heroicons)/)?s="UI":n.match(/^(tailwindcss|postcss|autoprefixer|sass|styled-)/)?s="Styling":n.match(/^(prisma|drizzle|mongoose|pg|@prisma|typeorm)/)?s="Database":n.match(/^(appwrite|node-appwrite|firebase|@supabase)/)?s="Backend/BaaS":n.match(/^(next-auth|@clerk|passport|bcrypt|jsonwebtoken)/)?s="Auth":n.match(/^(zustand|@reduxjs|jotai|recoil|mobx)/)?s="State":n.match(/^(vitest|jest|@testing|playwright|cypress|@playwright)/)?s="Testing":n.match(/^(typescript|@types\/|eslint|prettier|@eslint)/)?s="Tooling":n.match(/^(stripe|@stripe)/)?s="Payments":n.match(/^(resend|nodemailer|@sendgrid)/)?s="Email":n.match(/^(@sentry|sentry)/)?s="Monitoring":n.match(/^(zod|yup|joi|class-validator)/)?s="Validation":n.match(/^(next-intl|i18next|react-intl)/)?s="i18n":n.match(/^(@storybook|storybook|chromatic)/)&&(s="Storybook"),e.has(s)||e.set(s,[]),e.get(s).push([n,o])}let r=["Framework","Backend/BaaS","Auth","Database","State","UI","Styling","Validation","Payments","Email","i18n","Monitoring","Testing","Storybook","Tooling","Other"];return[...e.entries()].sort(([n],[o])=>{let s=r.indexOf(n),i=r.indexOf(o);return(s===-1?99:s)-(i===-1?99:i)})}var Py=require("node:child_process"),zy=require("node:path"),uz=1e4,lz=1024*1024,dz=2048,Ty=5120,pz=200,Ey="\u2039\u2039\u2039COMMIT_SEP\u203A\u203A\u203A",Eo="\u2039\u2039\u2039FIELD_SEP\u203A\u203A\u203A",fz=20;function Ie(t,e){try{return(0,Py.execSync)(`git ${t}`,{cwd:e,encoding:"utf-8",timeout:uz,maxBuffer:lz,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function md(t,e){return t.length<=e?t:`${t.slice(0,e)}
[...truncated at ${String(e)} chars]`}function mz(t){let e=0;for(let r of t.split(`
`)){let n=r.split("	"),o=parseInt(n[0]??"0",10),s=parseInt(n[1]??"0",10);isNaN(o)||(e+=o),isNaN(s)||(e+=s)}return e}async function hz(t,e){try{let r=await t.findBySchemaKey("root/sessions");if(!r)return null;let n=await t.listEntries(r.id,{limit:1});if(n.entries.length===0)return null;let o=n.entries[0]?.sourceRef;if(!o||!o.startsWith("git:"))return null;let s=o.slice(4);return Ie(`cat-file -t ${s}`,e)!=="commit"?null:s}catch{return null}}function gz(t){if(!t)return[];let e=t.split(Ey).filter(n=>n.trim().length>0),r=[];for(let n of e){let o=n.split(Eo);o.length<5||r.push({sha:(o[0]??"").trim(),shortSha:(o[1]??"").trim(),author:(o[2]??"").trim(),date:(o[3]??"").trim(),message:(o[4]??"").trim()})}return r}function yz(t,e){let n=Ie(`show ${t} --name-only --format=`,e).split(`
`).filter(c=>c.trim().length>0),o=Ie(`show ${t} --numstat --format=`,e),s=Ie(`show ${t} --stat --format=`,e),i=mz(o),a=null;if(i>0&&i<pz){let c=Ie(`show ${t} --patch --unified=0 --format=`,e);c&&(a=md(c,dz))}return{files:n,numstat:o,diffStat:s,patch:a}}function _z(t,e,r){if(!e&&r===0)return null;let n="",o="",s=[];if(e){let i=Ie("diff --cached --stat",t),a=Ie("diff --cached --unified=0",t);n=md([i,a].filter(Boolean).join(`

`),Ty);let c=Ie("diff --stat",t),u=Ie("diff --unified=0",t);o=md([c,u].filter(Boolean).join(`

`),Ty)}if(r>0){let i=Ie("ls-files --others --exclude-standard",t);s.push(...i.split(`
`).filter(a=>a.trim().length>0).slice(0,50))}return{staged:n,unstaged:o,untrackedFiles:s}}async function Iy(t,e={}){let r=e.directory?(0,zy.resolve)(e.directory):process.cwd(),n=e.limit??fz,o=e.mode??"first-parent",s=Ie("rev-parse --show-toplevel",r);if(!s)throw new Error(`Not a git repository: ${r}`);let i=Ie("rev-parse --abbrev-ref HEAD",r),a=Ie("rev-parse HEAD",r),u=Ie("status --porcelain",r).length>0,l=Ie("ls-files --others --exclude-standard",r),d=l?l.split(`
`).filter(Boolean).length:0,m=await hz(t,r),h,p,f=o==="first-parent"?" --first-parent":"";m?(h=`${m.slice(0,7)}..HEAD`,p=`log${f} ${m}..HEAD`):(h=`HEAD~${String(n)}..HEAD`,p=`log${f} -n ${String(n)}`);let g=Ie(`${p} --oneline`,r),v=g?g.split(`
`).filter(Boolean).length:0,x=[Ey,"%H",Eo,"%h",Eo,"%an",Eo,"%aI",Eo,"%B"].join(""),$=Ie(`${p} -n ${String(n)} --format=${x}`,r),k=gz($),E=v>n,M=[];for(let Xe of k){let te=yz(Xe.sha,r);M.push({...Xe,...te})}let ve=_z(r,u,d);return{repoRoot:s,currentBranch:i,headSha:a,isDirty:u,untrackedCount:d,baseSha:m,range:h,mode:o,commits:M,totalUnsaved:v,truncated:E,wip:ve}}function Ry(t){let e=[];e.push("# Git Digest"),e.push(""),e.push(`**Branch**: ${t.currentBranch}`),e.push(`**HEAD**: ${t.headSha.slice(0,7)}`),e.push(`**Range**: ${t.range} (${t.mode})`),e.push(`**Unsaved commits**: ${String(t.totalUnsaved)}${t.truncated?` (showing first ${String(t.commits.length)})`:""}`),e.push(`**Dirty**: ${t.isDirty?"yes":"no"}${t.untrackedCount>0?` (${String(t.untrackedCount)} untracked)`:""}`),e.push(""),t.commits.length===0&&e.push("_No unsaved commits._");for(let r of t.commits){if(e.push("---"),e.push(`## ${r.shortSha} \u2014 ${r.message.split(`
`)[0]??""}`),e.push(`**Author**: ${r.author} | **Date**: ${r.date}`),e.push(""),r.message.includes(`
`)){let n=r.message.split(`
`).slice(1).join(`
`).trim();n&&(e.push("**Body**:"),e.push(n),e.push(""))}e.push(`**Files** (${String(r.files.length)}):`);for(let n of r.files)e.push(`- ${n}`);e.push(""),r.diffStat&&(e.push(`**Stat**: ${r.diffStat.split(`
`).pop()??""}`),e.push("")),r.patch!==null&&(e.push("**Patch** (minimal):"),e.push("```diff"),e.push(r.patch),e.push("```"),e.push(""))}if(t.wip&&(e.push("---"),e.push("## WIP (non-committed)"),e.push(""),t.wip.staged&&(e.push("### Staged changes"),e.push("```"),e.push(t.wip.staged),e.push("```"),e.push("")),t.wip.unstaged&&(e.push("### Unstaged changes"),e.push("```"),e.push(t.wip.unstaged),e.push("```"),e.push("")),t.wip.untrackedFiles.length>0)){e.push("### Untracked files");for(let r of t.wip.untrackedFiles)e.push(`- ${r}`);e.push("")}return e.join(`
`)}var wn=require("node:fs"),jy=require("node:child_process"),$n=require("node:path"),Oy=".contox.json",vz=5e3;function xz(t=process.cwd()){let e=t;for(let r=0;r<20;r++){let n=(0,$n.join)(e,Oy);if((0,wn.existsSync)(n))try{let s=(0,wn.readFileSync)(n,"utf-8");return JSON.parse(s)}catch{return null}let o=(0,$n.join)(e,"..");if(o===e)break;e=o}return null}function hd(t){try{return(0,jy.execSync)("git rev-parse --show-toplevel",{cwd:t,encoding:"utf-8",timeout:vz,stdio:["pipe","pipe","pipe"]}).trim()}catch{return null}}function bz(t){let e=hd(t);return e?(0,$n.basename)(e):null}async function $z(t,e,r,n){let o=new URLSearchParams({teamId:r,name:n}),s=await fetch(`${e}/api/projects?${o.toString()}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});return s.ok?s.json():[]}async function wz(t,e,r,n){let o=await fetch(`${e}/api/projects`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({name:n,teamId:r})});if(!o.ok){let s=await o.json().catch(()=>({})),i=typeof s.error=="string"?s.error:o.statusText;throw new Error(`Failed to create project "${n}": ${i}`)}return o.json()}function Cy(t,e){try{let r=(0,$n.join)(t,Oy);(0,wn.writeFileSync)(r,JSON.stringify(e,null,2)+`
`,"utf-8")}catch{}}async function Ny(t){let e=t.apiKey??"",r=(t.apiUrl??"https://contox.dev").replace(/\/$/,""),n=t.teamId??"";if(!e)throw new Error("CONTOX_API_KEY is required. Set it as an environment variable.");if(!n)throw new Error("CONTOX_TEAM_ID is required. Set it as an environment variable.");let o=process.cwd(),s=xz(o);if(s?.projectId)return{apiKey:e,apiUrl:r,teamId:s.teamId||n,projectId:s.projectId};let i=bz(o);if(i)try{let a=await $z(e,r,n,i);if(a.length>0){let l=a[0],d=hd(o)??o;return Cy(d,{teamId:n,projectId:l.id,projectName:l.name}),{apiKey:e,apiUrl:r,teamId:n,projectId:l.id}}let c=await wz(e,r,n,i),u=hd(o)??o;return Cy(u,{teamId:n,projectId:c.id,projectName:c.name}),{apiKey:e,apiUrl:r,teamId:n,projectId:c.id}}catch{}if(t.projectId)return{apiKey:e,apiUrl:r,teamId:n,projectId:t.projectId};throw new Error(`Could not resolve project. Either:
  - Add a .contox.json file (run \`contox init\`)
  - Set CONTOX_PROJECT_ID environment variable
  - Run from a git repository directory`)}var Ei=require("node:fs/promises"),Zy=require("node:path"),Ay="<!-- contox:start -->",gd="<!-- contox:end -->";async function _d(t,e,r){try{let n=await Sz(e,r),o=(0,Zy.join)(t,"CLAUDE.md"),s="";try{s=await(0,Ei.readFile)(o,"utf-8")}catch{}let i=kz(s,n);return await(0,Ei.writeFile)(o,i,"utf-8"),!0}catch(n){let o=n instanceof Error?n.message:String(n);return console.error(`[contox] CLAUDE.md update failed: ${o}`),!1}}function kz(t,e){let r=`${Ay}
${e}
${gd}`;if(!t.trim())return r+`
`;let n=t.indexOf(Ay),o=t.indexOf(gd);if(n!==-1&&o!==-1){let i=t.slice(0,n),a=t.slice(o+gd.length);return i+r+a}let s=t.endsWith(`
`)?`
`:`

`;return t+s+r+`
`}async function Sz(t,e){let r=[];if(r.push("# Contox \u2014 Auto-generated Project Context"),r.push(""),r.push("> This section is auto-managed by Contox. Do not edit between the markers."),r.push("> Your own content outside the markers is preserved."),r.push(""),r.push("## Memory Protocol"),r.push(""),r.push("### Session Start"),r.push("- Call `contox_get_memory` to load project context from previous sessions"),r.push(""),r.push("### During Session"),r.push("- Use all Contox tools freely to read/write data (create contexts, update, search, scan, etc.)"),r.push("- This pushes information to the Contox platform in real-time"),r.push(""),r.push("### Saving \u2014 USER-INITIATED ONLY"),r.push("- **NEVER** call `contox_save_session` automatically or proactively"),r.push('- Only save when the user explicitly asks (e.g. "save", "save session", "contox save")'),r.push("- The user may be working on multiple tasks in parallel \u2014 auto-saving could mix contexts"),r.push(""),e)r.push(zi(e,2e3)),r.push("");else try{let n=await t.listContexts(),o=n.find(a=>a.schemaKey==="root/stack");if(o){let a=await yd(t,o);a&&(r.push("## Project Stack"),r.push(""),r.push(zi(a,500)),r.push(""))}let s=n.find(a=>a.schemaKey==="root/conventions");if(s){let a=await yd(t,s);a&&(r.push("## Conventions"),r.push(""),r.push(zi(a,500)),r.push(""))}let i=n.find(a=>a.schemaKey==="root/cortex");if(i){let a=await yd(t,i);a&&(r.push("## Current Focus"),r.push(""),r.push(zi(a,300)),r.push(""))}}catch{r.push("## Project Context"),r.push(""),r.push("_Run `contox_get_memory` at session start to load full project context._"),r.push("")}return r.join(`
`)}function zi(t,e){let r=t.trim();if(r.length<=e)return r;let n=r.slice(0,e),o=n.lastIndexOf(`
`);return o>e*.5?n.slice(0,o):n+"..."}async function yd(t,e){if(e.content!=null&&e.content.length>0)return e.content;try{return(await t.getContext(e.id)).content??""}catch{return""}}function Dt(t){return Math.ceil(t.length/4)}async function My(t,e){let{task:r,scope:n,tokenBudget:o}=e,s=[];s.push(`# Context Pack
`),s.push(`> Task: ${r}`),s.push(`> Scope: ${n} | Budget: ~${String(o)} tokens
`);let i=Dt(s.join(`
`)),a=o-i-50;if(n==="full"){let l=await t.getBrain(),d=l.document,m=a*4;return d.length<=m?s.push(d):(s.push(d.slice(0,m)),s.push(`

_[truncated to fit token budget]_`)),s.push(`
---
_${String(l.itemsLoaded)} items | ~${String(Dt(s.join(`
`)))} tokens_`),s.join(`
`)}if(n==="minimal"){let l=await t.listItems({limit:5});if(l.items.length===0)return s.push("_No memory items yet._"),s.join(`
`);for(let d of l.items){let m=Tz(d);if(Dt(s.join(`
`)+m)>o)break;s.push(m)}return s.push(`
---
_${String(l.items.length)} items (minimal) | ~${String(Dt(s.join(`
`)))} tokens_`),s.join(`
`)}let c=[];try{c=(await t.search(r,{limit:15,minSimilarity:.6})).results}catch{let l=await t.getBrain(),d=a*4;return s.push(l.document.slice(0,d)),s.push(`
---
_Fallback: full brain (search unavailable) | ~${String(Dt(s.join(`
`)))} tokens_`),s.join(`
`)}if(c.length===0){let l=await t.getBrain({limit:20}),d=a*4;return s.push(l.document.slice(0,d)),s.push(`
---
_No semantic matches \u2014 showing top items | ~${String(Dt(s.join(`
`)))} tokens_`),s.join(`
`)}let u=new Map;for(let l of c){let d=l.schemaKey.split("/").slice(0,2).join("/"),m=u.get(d)??[];m.push(l),u.set(d,m)}for(let[l,d]of u){let m=l.split("/").pop()??l,h=`## ${m.charAt(0).toUpperCase()}${m.slice(1)}
`;if(Dt(s.join(`
`)+h)>o)break;s.push(h);for(let p of d){let f=Pz(p);if(Dt(s.join(`
`)+f)>o)break;s.push(f)}}return s.push(`
---
_${String(c.length)} relevant items | ~${String(Dt(s.join(`
`)))} tokens_`),s.join(`
`)}function Tz(t){let e=[];return e.push(`### ${t.title}`),e.push(`> confidence: ${t.confidence.toFixed(2)} | ${t.schemaKey}`),t.files.length>0&&e.push(`> files: ${t.files.slice(0,5).join(", ")}`),e.push(""),e.push(t.facts),e.push(""),e.join(`
`)}function Pz(t){let e=[];return e.push(`### ${t.title}`),e.push(`> similarity: ${t.similarity.toFixed(3)} | confidence: ${t.confidence.toFixed(2)} | ${t.type}`),t.files.length>0&&e.push(`> files: ${t.files.slice(0,5).join(", ")}`),e.push(""),e.push(t.facts),e.push(""),e.join(`
`)}var _e=new _i({name:"contox",version:"3.5.0"}),ye,sr;_e.tool("contox_get_memory","Load the complete project memory. Call this at the START of every session to remember previous work. Returns a markdown document with: Architecture, Conventions, Implementation Log, Decisions, Bugs & Fixes, Todo, and Session Log.",{},async()=>{try{let t=await sr.getBrain();return{content:[{type:"text",text:`${t.document}
---
_${String(t.itemsLoaded)} items loaded (~${String(t.tokenEstimate)} tokens) | hash: ${t.brainHash}_
`}]}}catch(t){return{content:[{type:"text",text:`Error loading memory: ${String(t)}`}],isError:!0}}});var zz=gy.filter(t=>t.id!=="sessions").map(t=>`"${t.id}": ${t.description}`).join(`
`);_e.tool("contox_save_session",`Save this session's work into persistent project memory.

IMPORTANT: Only call this tool when the user EXPLICITLY asks to save (e.g. "save", "save session", "contox save"). NEVER call it automatically or proactively \u2014 the user may be working on multiple tasks in parallel and needs to control when sessions are saved.

Provide a summary and structured changes. Each change has a category, title, and content.

Available categories:
${zz}

The session log is updated automatically. Content is APPENDED to existing sub-contexts (never overwritten).`,{summary:I.string().describe("Brief session summary (1-3 sentences): what was accomplished"),changes:I.array(I.object({category:I.enum(["architecture","conventions","implementation","decisions","bugs","todo"]).describe("Category for this change"),title:I.string().describe('Brief title (e.g. "Added auth middleware", "Fixed CSS z-index bug")'),content:I.string().describe("Detailed content to save. Use markdown. Be specific and include file paths, patterns, key decisions.")})).describe("List of changes to save, organized by category"),headCommitSha:I.string().optional().describe("HEAD commit SHA at save time (from contox_git_digest). Tracks save position for incremental digests.")},async t=>{try{let e=await sr.ingest({type:"mcp_save",summary:t.summary,changes:t.changes,headCommitSha:t.headCommitSha});return sr.getBrain().then(r=>_d(process.cwd(),ye,r.document)).catch(()=>{_d(process.cwd(),ye).catch(()=>{})}),{content:[{type:"text",text:["Session saved via V2 pipeline.",`- Event ID: ${e.eventId}`,`- Session: ${e.sessionId}`,'Raw event stored. Enrichment deferred \u2014 user must click "Generate Memory" in the dashboard to trigger the pipeline.'].join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error saving session: ${String(e)}`}],isError:!0}}});_e.tool("contox_list_contexts","List all contexts for the current project (including sub-contexts)",{},async()=>{try{let e=(await ye.listContexts()).map(r=>({id:r.id,name:r.name,description:r.description,parentContextId:r.parentContextId,schemaKey:r.schemaKey,tier:r.tier,state:r.state,tokens:r.tokens,updatedAt:r.updatedAt}));return{content:[{type:"text",text:JSON.stringify(e,null,2)}]}}catch(t){return{content:[{type:"text",text:`Error: ${String(t)}`}],isError:!0}}});_e.tool("contox_get_context","Get a specific context by ID, including its full content",{id:I.string().describe("The context ID")},async t=>{try{let e=await ye.getContext(t.id);return{content:[{type:"text",text:JSON.stringify(e,null,2)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});_e.tool("contox_create_context","Create a new context manually.",{name:I.string().describe("Context name"),description:I.string().optional().describe("Optional description"),content:I.string().optional().describe("Optional initial content"),parentContextId:I.string().optional().describe("Optional parent context ID for hierarchy")},async t=>{try{let e=await ye.createContext({name:t.name,teamId:ye.teamId,projectId:ye.projectId,description:t.description,parentContextId:t.parentContextId});return t.content&&await ye.updateContext(e.id,{content:t.content}),{content:[{type:"text",text:`Context created: ${e.name} (${e.id})`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});_e.tool("contox_update_context","Update an existing context (name, description, or content). Content is replaced, not appended.",{id:I.string().describe("The context ID to update"),name:I.string().optional().describe("New name"),description:I.string().optional().describe("New description"),content:I.string().optional().describe("New content (replaces existing)")},async t=>{try{let e={};t.name!==void 0&&(e.name=t.name),t.description!==void 0&&(e.description=t.description),t.content!==void 0&&(e.content=t.content);let r=await ye.updateContext(t.id,e);return{content:[{type:"text",text:`Context updated: ${r.name} (${r.id})`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});_e.tool("contox_delete_context","Delete a context by ID. This is irreversible.",{id:I.string().describe("The context ID to delete")},async t=>{try{return await ye.deleteContext(t.id),{content:[{type:"text",text:`Context deleted: ${t.id}`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});_e.tool("contox_search",`Search contexts by name, description, AND content. Use this to find specific code patterns, function signatures, API endpoints, component props, or any information stored in the project memory. Returns matching snippets with surrounding context.

Examples: "useAuth", "stripe", "password reset", "Button props", "GET /api/contexts"`,{query:I.string().describe("Search query \u2014 searches across all context content, names, and descriptions")},async t=>{try{let e=await sr.search(t.query,{limit:10,minSimilarity:.65});if(e.results.length===0)return{content:[{type:"text",text:`No results found for "${t.query}" (semantic search, ${String(e.totalCandidates)} candidates)`}]};let r=[];r.push(`Found ${String(e.results.length)} result(s) for "${t.query}" (semantic, ${String(e.totalCandidates)} candidates):
`);for(let n of e.results)r.push(`## ${n.title}`),r.push(`> ${n.type} | similarity: ${n.similarity.toFixed(3)} | confidence: ${n.confidence.toFixed(2)} | ${n.schemaKey}`),n.files.length>0&&r.push(`> files: ${n.files.slice(0,5).join(", ")}`),r.push(""),r.push(n.facts),r.push("");return{content:[{type:"text",text:r.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});_e.tool("contox_populate","Populate the brain hierarchy with structured contexts. Used by scanners and CLI to batch-create/update contexts by schemaKey. Created contexts default to state 'draft'. Returns audit trail with runId and diff stats.",{nodes:I.array(I.object({schemaKey:I.string().describe('Unique schema key (e.g. "root/api/auth")'),name:I.string().describe("Display name for the context"),content:I.string().optional().describe("Markdown content"),description:I.string().optional().describe("Brief description"),contextType:I.enum(["system","reference","memory"]).optional().describe("Context type"),tier:I.number().optional().describe("Tier (1=always loaded, 2=on-demand, 3=archive)"),parentSchemaKey:I.string().optional().describe("Parent schema key for hierarchy")})).describe("List of nodes to populate"),dryRun:I.boolean().optional().describe("If true, only return diff stats without writing"),source:I.string().optional().describe('Source identifier (e.g. "cli-scan", "mcp-populate")')},async t=>{try{let e=await ye.populate(t.nodes,t.dryRun,t.source);return{content:[{type:"text",text:[`Populate ${t.dryRun?"(dry run) ":""}completed.`,`- Run ID: ${e.runId}`,`- Created: ${String(e.created)}`,`- Updated: ${String(e.updated)}`,`- Unchanged: ${String(e.unchanged)}`,`- Errors: ${String(e.errors)}`].join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});_e.tool("contox_add_entry","Add an entry to a journal-like context (bugs, implementation journal, sessions). Entries are INSERT-only (event-sourced) and idempotent via idempotencyKey. Uses client-generated ULID for monotone ordering.",{contextId:I.string().describe("Target context ID"),title:I.string().describe("Entry title (max 200 chars)"),content:I.string().describe("Entry content in markdown"),entryType:I.string().optional().describe('Entry type (e.g. "bug-fix", "feature", "session")'),tags:I.array(I.string()).optional().describe("Tags for categorization"),idempotencyKey:I.string().optional().describe("Idempotency key for retry safety"),source:I.string().optional().describe("Source identifier"),sourceRef:I.string().optional().describe("Source reference (commit SHA, session ID, etc.)")},async t=>{try{let e=await ye.createEntry({contextId:t.contextId,title:t.title,content:t.content,entryType:t.entryType,tags:t.tags,idempotencyKey:t.idempotencyKey,source:t.source,sourceRef:t.sourceRef});return{content:[{type:"text",text:`Entry added: ${e.title} (${e.id})`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});_e.tool("contox_get_tree","Get the hierarchical brain tree for the current project. Returns a nested tree of contexts with schemaKey, tier, state, contextType, and children. Useful for understanding the project knowledge structure at a glance.",{},async()=>{try{let t=await ye.getTree();return{content:[{type:"text",text:JSON.stringify(t.tree,null,2)}]}}catch(t){return{content:[{type:"text",text:`Error: ${String(t)}`}],isError:!0}}});_e.tool("contox_approve","Approve or deprecate a context (state machine). Approved contexts are included in the brain document. Deprecated contexts are hidden. Only works on contexts with a state (draft \u2192 approved \u2192 deprecated).",{id:I.string().describe("The context ID"),action:I.enum(["approve","deprecate"]).describe('"approve" to make visible in brain, "deprecate" to hide')},async t=>{try{return t.action==="approve"?await ye.approveContext(t.id):await ye.deprecateContext(t.id),{content:[{type:"text",text:`Context ${t.action==="approve"?"approved":"deprecated"}: ${t.id}`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});_e.tool("contox_get_links","Get links for a context by its schemaKey. Returns incoming and outgoing links with linkType, reason, and confidence. Links represent relationships between contexts (see-also, depends-on, child-of, related).",{schemaKey:I.string().describe('The schemaKey of the context (e.g. "root/api/auth")'),direction:I.enum(["both","outgoing","incoming"]).optional().describe("Filter direction (default: both)")},async t=>{try{let e=await ye.getLinks(t.schemaKey,t.direction),r=[];if(e.outgoing.length>0){r.push(`## Outgoing (${String(e.outgoing.length)})`);for(let n of e.outgoing)r.push(`- \u2192 ${n.toSchemaKey} [${n.linkType}]${n.reason?` \u2014 ${n.reason}`:""}${n.confidence!==null?` (conf: ${String(n.confidence)})`:""}`)}if(e.incoming.length>0){r.push(`## Incoming (${String(e.incoming.length)})`);for(let n of e.incoming)r.push(`- \u2190 ${n.fromSchemaKey} [${n.linkType}]${n.reason?` \u2014 ${n.reason}`:""}${n.confidence!==null?` (conf: ${String(n.confidence)})`:""}`)}return r.length===0&&r.push(`No links found for "${t.schemaKey}"`),{content:[{type:"text",text:r.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});_e.tool("contox_add_link",'Create a directed link between two contexts by their schemaKeys. Links form a knowledge graph \u2014 use them to express relationships like "depends-on", "see-also", "child-of", or "related".',{from:I.string().describe('Source schemaKey (e.g. "root/frontend/hooks")'),to:I.string().describe('Target schemaKey (e.g. "root/api/auth")'),linkType:I.enum(["see-also","depends-on","child-of","related"]).describe("Type of relationship"),reason:I.string().optional().describe("Why this link exists"),confidence:I.number().optional().describe("Confidence score 0-1 (e.g. 0.9 = very confident)")},async t=>{try{return await ye.createLink(t.from,t.to,t.linkType,t.reason,t.confidence),{content:[{type:"text",text:`Link created: ${t.from} \u2192 ${t.to} [${t.linkType}]`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});_e.tool("contox_compact","Compact entries for a journal-like context (bugs, journal, sessions). Summarizes all entries into a single content block, reducing token count while preserving key information. Use when a context has too many entries.",{id:I.string().describe("The context ID to compact")},async t=>{try{let e=await ye.compactContext(t.id);return{content:[{type:"text",text:[`Compaction completed for context ${t.id}:`,`- Entries processed: ${String(e.entriesCount)}`,`- Summary length: ${String(e.summaryLength)} chars`,`- ${e.message}`].join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});_e.tool("contox_oncall_view","View on-call operational summary for the current project. Shows recent sessions, stale drafts (>7 days), recent bugs, and brain health stats. Use this for a quick project health check.",{since:I.string().optional().describe("ISO date string \u2014 show data since this time (default: last 24h)")},async t=>{try{return{content:[{type:"text",text:await yy(ye,{since:t.since})}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});_e.tool("contox_explain_schemakey","Deep-dive into any brain schemaKey. Returns: schema metadata (tier, contextType, writePolicy), context content preview, runtime links (incoming/outgoing), recent entries, and related contracts. Use this to understand any part of the brain.",{schemaKey:I.string().describe('The schemaKey to explain (e.g. "root/contracts/auth", "root/bugs")')},async t=>{try{return{content:[{type:"text",text:await xy(ye,t.schemaKey)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});_e.tool("contox_scan",`Scan a local codebase directory and push ~15-20 hierarchical sub-contexts to the project brain. Walks the filesystem to extract routes, components, libraries, hooks, stores, dependencies, and key documentation files. Results are organized into granular sub-contexts mapped to brain schemaKeys and pushed via the populate API with content-hash dedup.

Use this to index a codebase so the AI can understand the project structure without reading source files. The scan respects .gitignore-like exclusions (node_modules, .next, dist, etc.) and reads files up to 32KB.`,{directory:I.string().optional().describe("Absolute path to the project root directory to scan. Defaults to the current working directory."),dryRun:I.boolean().optional().describe("If true, scan and build sub-contexts but do not push to the API. Returns what would be created/updated.")},async t=>{try{let e=t.directory??process.cwd(),r=$y(e),n=r.routes.filter(f=>!f.methods.includes("PAGE")),o=r.routes.filter(f=>f.methods.includes("PAGE")),s=[...r.libs,...r.hooks,...r.stores].reduce((f,g)=>f+g.exports.length,0),i=Sy(r),a=0;for(let f of i)a+=fd(f.content);let c=[`Scan completed for: ${e}`,`- Files: ${String(r.stats.totalFiles)}, Directories: ${String(r.stats.totalDirs)}`,`- API endpoints: ${String(n.length)}, Pages: ${String(o.length)}`,`- Components: ${String(r.components.length)}, Libraries: ${String(r.libs.length)}, Hooks: ${String(r.hooks.length)}, Stores: ${String(r.stores.length)}`,`- Exported functions/types: ${String(s)}`,`- Key documentation files: ${String(r.keyFiles.length)}`,`- Sub-contexts generated: ${String(i.length)} (~${String(a)} tokens)`];if(t.dryRun){c.push(""),c.push("Sub-contexts (dry run \u2014 not pushed):");for(let f of i){let g=fd(f.content);c.push(`  - ${f.name} [${f.schemaKey}] (~${String(g)} tokens)`)}return{content:[{type:"text",text:c.join(`
`)}]}}let u=i.sort((f,g)=>{let v=f.schemaKey.split("/").length,x=g.schemaKey.split("/").length;return v!==x?v-x:f.order-g.order}).map(f=>({schemaKey:f.schemaKey,name:f.name,content:f.content,description:f.description,contextType:f.contextType??"reference",tier:f.tier??2,parentSchemaKey:f.parentSchemaKey})),l=50,d=0,m=0,h=0,p=0;for(let f=0;f<u.length;f+=l){let g=u.slice(f,f+l),v=await ye.populate(g,!1,"mcp-scan");d+=v.created,m+=v.updated,h+=v.unchanged,p+=v.errors}return c.push(""),c.push("Populate results:"),c.push(`- Created: ${String(d)}`),c.push(`- Updated: ${String(m)}`),c.push(`- Unchanged: ${String(h)}`),p>0&&c.push(`- Errors: ${String(p)}`),{content:[{type:"text",text:c.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error scanning codebase: ${String(e)}`}],isError:!0}}});_e.tool("contox_git_digest",`Read git commits since last save. Returns structured commit data (SHA, message, files, diff stats, smart patches) + WIP evidence for Claude to analyze and enrich before saving.

Uses SHA-based range tracking (not dates) for reliable incremental digests. The base SHA is read from the last session entry's sourceRef field.`,{directory:I.string().optional().describe("Absolute path to the git repo root. Defaults to the current working directory."),limit:I.number().optional().describe("Max commits to return. Default 20."),mode:I.enum(["first-parent","all"]).optional().describe("first-parent (default): clean shipping journal. all: exhaustive including merge commits.")},async t=>{try{let e=await Iy(ye,{directory:t.directory,limit:t.limit,mode:t.mode});return{content:[{type:"text",text:Ry(e)}]}}catch(e){return{content:[{type:"text",text:`Error reading git digest: ${String(e)}`}],isError:!0}}});_e.tool("contox_context_pack",`Build a focused context pack for the current task. Uses V2 semantic search to find the most relevant memory items and assembles a token-budgeted markdown document.

Scopes:
- "relevant" (default): Semantic search for task-related items only
- "full": Complete brain document, truncated to budget
- "minimal": Top 5 highest-confidence items

Falls back to full brain if semantic search is unavailable.`,{task:I.string().describe("Current task description \u2014 used for semantic search"),scope:I.enum(["full","relevant","minimal"]).default("relevant").describe("How much context to include"),tokenBudget:I.number().default(4e3).describe("Approximate token budget for the pack")},async t=>{try{return{content:[{type:"text",text:await My(sr,{task:t.task,scope:t.scope,tokenBudget:t.tokenBudget})}]}}catch(e){return{content:[{type:"text",text:`Error building context pack: ${String(e)}`}],isError:!0}}});_e.tool("contox_hygiene",`Run the Memory Hygiene Agent to analyze and clean up memory items.

Modes:
- "quick": Analyze the 20 most recent items (fast, low cost)
- "weekly": Analyze all items updated in the last 7 days

The agent proposes safe, minimal edits: rename titles, retag, merge duplicates, deprecate superseded items, flag quality issues, redact secrets. It NEVER auto-applies changes.

Two-phase workflow:
1. Call without "apply" to get a HygienePlan (proposed actions)
2. Call with "apply" + selectedActionIds to execute chosen actions

Each action has a confidence score and requiresHumanApproval flag.`,{mode:I.enum(["quick","weekly"]).default("quick").describe('Analysis mode: "quick" (20 recent items) or "weekly" (last 7 days)'),schemaKeyPrefix:I.string().optional().describe('Filter items by schemaKey prefix (e.g. "root/bugs")'),apply:I.array(I.string()).optional().describe("Action IDs to apply from a previous plan. Omit to analyze only."),plan:I.string().optional().describe("JSON-stringified HygienePlan from a previous analyze call. Required when applying."),dryRun:I.boolean().optional().describe("If true, show what would be applied without executing.")},async t=>{try{let e=process.env.CONTOX_TEAM_ID??"";if(t.apply&&t.apply.length>0){if(!t.plan)return{content:[{type:"text",text:'Error: "plan" is required when applying actions.'}],isError:!0};let o;try{o=JSON.parse(t.plan)}catch{return{content:[{type:"text",text:'Error: "plan" must be valid JSON.'}],isError:!0}}let s=await sr.applyHygiene({teamId:e,plan:o,selectedActionIds:t.apply,dryRun:t.dryRun}),i=[`Hygiene Apply ${t.dryRun?"(DRY RUN) ":""}Result:`,`- Applied: ${String(s.appliedActionIds.length)}`,`- Skipped: ${String(s.skippedActionIds.length)}`,`- Errors: ${String(s.errors.length)}`];if(s.errors.length>0){i.push("","Errors:");for(let a of s.errors)i.push(`  - ${a.actionId}: ${a.message}`)}return{content:[{type:"text",text:i.join(`
`)}]}}let r=await sr.analyzeHygiene({mode:t.mode,teamId:e,schemaKeyPrefix:t.schemaKeyPrefix}),n=[`Memory Hygiene Report (${t.mode} mode)`,`${"\u2500".repeat(40)}`,`Items analyzed: ${String(r.metrics.totalMemories)}`,`Actions proposed: ${String(r.metrics.actionsCount)}`,`Tokens: ${String(r.usage.promptTokens)}+${String(r.usage.completionTokens)}`,"",r.summary];if(r.warnings.length>0){n.push("","Warnings:");for(let o of r.warnings)n.push(`  \u26A0 ${o}`)}if(r.actions.length>0){n.push("");let o=new Map;for(let s of r.actions){let i=o.get(s.type)??[];i.push(s),o.set(s.type,i)}for(let[s,i]of o){n.push(`${s} (${String(i.length)})`);for(let a of i){let c=a.requiresHumanApproval?" [NEEDS APPROVAL]":"";n.push(`  \u2022 ${a.reason} (confidence: ${String(a.confidence)})${c}`),n.push(`    id: ${a.actionId} | targets: ${a.targetMemoryIds.join(", ")}`)}n.push("")}n.push("To apply actions, call contox_hygiene with:","  apply: [actionId1, actionId2, ...]",`  plan: '${JSON.stringify(r)}'`)}return{content:[{type:"text",text:n.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});async function Ez(){let t=await Ny({apiKey:process.env.CONTOX_API_KEY,apiUrl:process.env.CONTOX_API_URL,teamId:process.env.CONTOX_TEAM_ID,projectId:process.env.CONTOX_PROJECT_ID});ye=new $i(t),sr=new wi({apiKey:t.apiKey??"",apiUrl:t.apiUrl,projectId:t.projectId??"",hmacSecret:process.env.CONTOX_HMAC_SECRET??process.env.V2_HMAC_SECRET_MCP??process.env.V2_HMAC_SECRET});let e=new xi;await _e.connect(e)}Ez().catch(t=>{console.error("Fatal error:",t),process.exit(1)});
