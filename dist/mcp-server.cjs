#!/usr/bin/env node
"use strict";var Wy=Object.create;var Zi=Object.defineProperty;var Xy=Object.getOwnPropertyDescriptor;var Yy=Object.getOwnPropertyNames;var Qy=Object.getPrototypeOf,e_=Object.prototype.hasOwnProperty;var P=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Di=(t,e)=>{for(var r in e)Zi(t,r,{get:e[r],enumerable:!0})},t_=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Yy(e))!e_.call(t,o)&&o!==r&&Zi(t,o,{get:()=>e[o],enumerable:!(n=Xy(e,o))||n.enumerable});return t};var Oo=(t,e,r)=>(r=t!=null?Wy(Qy(t)):{},t_(e||!t||!t.__esModule?Zi(r,"default",{value:t,enumerable:!0}):r,t));var ro=P(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.regexpCode=Q.getEsmExportName=Q.getProperty=Q.safeStringify=Q.stringify=Q.strConcat=Q.addCodeArg=Q.str=Q._=Q.nil=Q._Code=Q.Name=Q.IDENTIFIER=Q._CodeOrName=void 0;var eo=class{};Q._CodeOrName=eo;Q.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var Ir=class extends eo{constructor(e){if(super(),!Q.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};Q.Name=Ir;var ot=class extends eo{constructor(e){super(),this._items=typeof e=="string"?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let e=this._items[0];return e===""||e==='""'}get str(){var e;return(e=this._str)!==null&&e!==void 0?e:this._str=this._items.reduce((r,n)=>`${r}${n}`,"")}get names(){var e;return(e=this._names)!==null&&e!==void 0?e:this._names=this._items.reduce((r,n)=>(n instanceof Ir&&(r[n.str]=(r[n.str]||0)+1),r),{})}};Q._Code=ot;Q.nil=new ot("");function wm(t,...e){let r=[t[0]],n=0;for(;n<e.length;)wu(r,e[n]),r.push(t[++n]);return new ot(r)}Q._=wm;var $u=new ot("+");function km(t,...e){let r=[to(t[0])],n=0;for(;n<e.length;)r.push($u),wu(r,e[n]),r.push($u,to(t[++n]));return tw(r),new ot(r)}Q.str=km;function wu(t,e){e instanceof ot?t.push(...e._items):e instanceof Ir?t.push(e):t.push(ow(e))}Q.addCodeArg=wu;function tw(t){let e=1;for(;e<t.length-1;){if(t[e]===$u){let r=rw(t[e-1],t[e+1]);if(r!==void 0){t.splice(e-1,3,r);continue}t[e++]="+"}e++}}function rw(t,e){if(e==='""')return t;if(t==='""')return e;if(typeof t=="string")return e instanceof Ir||t[t.length-1]!=='"'?void 0:typeof e!="string"?`${t.slice(0,-1)}${e}"`:e[0]==='"'?t.slice(0,-1)+e.slice(1):void 0;if(typeof e=="string"&&e[0]==='"'&&!(t instanceof Ir))return`"${t}${e.slice(1)}`}function nw(t,e){return e.emptyStr()?t:t.emptyStr()?e:km`${t}${e}`}Q.strConcat=nw;function ow(t){return typeof t=="number"||typeof t=="boolean"||t===null?t:to(Array.isArray(t)?t.join(","):t)}function sw(t){return new ot(to(t))}Q.stringify=sw;function to(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}Q.safeStringify=to;function iw(t){return typeof t=="string"&&Q.IDENTIFIER.test(t)?new ot(`.${t}`):wm`[${t}]`}Q.getProperty=iw;function aw(t){if(typeof t=="string"&&Q.IDENTIFIER.test(t))return new ot(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)}Q.getEsmExportName=aw;function cw(t){return new ot(t.toString())}Q.regexpCode=cw});var Tu=P(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.ValueScope=He.ValueScopeName=He.Scope=He.varKinds=He.UsedValueState=void 0;var Ke=ro(),ku=class extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}},Ns;(function(t){t[t.Started=0]="Started",t[t.Completed=1]="Completed"})(Ns||(He.UsedValueState=Ns={}));He.varKinds={const:new Ke.Name("const"),let:new Ke.Name("let"),var:new Ke.Name("var")};var Ms=class{constructor({prefixes:e,parent:r}={}){this._names={},this._prefixes=e,this._parent=r}toName(e){return e instanceof Ke.Name?e:this.name(e)}name(e){return new Ke.Name(this._newName(e))}_newName(e){let r=this._names[e]||this._nameGroup(e);return`${e}${r.index++}`}_nameGroup(e){var r,n;if(!((n=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||n===void 0)&&n.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}};He.Scope=Ms;var Zs=class extends Ke.Name{constructor(e,r){super(r),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=(0,Ke._)`.${new Ke.Name(r)}[${n}]`}};He.ValueScopeName=Zs;var uw=(0,Ke._)`\n`,Su=class extends Ms{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?uw:Ke.nil}}get(){return this._scope}name(e){return new Zs(e,this._newName(e))}value(e,r){var n;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let o=this.toName(e),{prefix:s}=o,i=(n=r.key)!==null&&n!==void 0?n:r.ref,a=this._values[s];if(a){let l=a.get(i);if(l)return l}else a=this._values[s]=new Map;a.set(i,o);let c=this._scope[s]||(this._scope[s]=[]),u=c.length;return c[u]=r.ref,o.setValue(r,{property:s,itemIndex:u}),o}getValue(e,r){let n=this._values[e];if(n)return n.get(r)}scopeRefs(e,r=this._values){return this._reduceValues(r,n=>{if(n.scopePath===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return(0,Ke._)`${e}${n.scopePath}`})}scopeCode(e=this._values,r,n){return this._reduceValues(e,o=>{if(o.value===void 0)throw new Error(`CodeGen: name "${o}" has no value`);return o.value.code},r,n)}_reduceValues(e,r,n={},o){let s=Ke.nil;for(let i in e){let a=e[i];if(!a)continue;let c=n[i]=n[i]||new Map;a.forEach(u=>{if(c.has(u))return;c.set(u,Ns.Started);let l=r(u);if(l){let d=this.opts.es5?He.varKinds.var:He.varKinds.const;s=(0,Ke._)`${s}${d} ${u} = ${l};${this.opts._n}`}else if(l=o?.(u))s=(0,Ke._)`${s}${l}${this.opts._n}`;else throw new ku(u);c.set(u,Ns.Completed)})}return s}};He.ValueScope=Su});var V=P(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.or=K.and=K.not=K.CodeGen=K.operators=K.varKinds=K.ValueScopeName=K.ValueScope=K.Scope=K.Name=K.regexpCode=K.stringify=K.getProperty=K.nil=K.strConcat=K.str=K._=void 0;var X=ro(),ft=Tu(),Yt=ro();Object.defineProperty(K,"_",{enumerable:!0,get:function(){return Yt._}});Object.defineProperty(K,"str",{enumerable:!0,get:function(){return Yt.str}});Object.defineProperty(K,"strConcat",{enumerable:!0,get:function(){return Yt.strConcat}});Object.defineProperty(K,"nil",{enumerable:!0,get:function(){return Yt.nil}});Object.defineProperty(K,"getProperty",{enumerable:!0,get:function(){return Yt.getProperty}});Object.defineProperty(K,"stringify",{enumerable:!0,get:function(){return Yt.stringify}});Object.defineProperty(K,"regexpCode",{enumerable:!0,get:function(){return Yt.regexpCode}});Object.defineProperty(K,"Name",{enumerable:!0,get:function(){return Yt.Name}});var Us=Tu();Object.defineProperty(K,"Scope",{enumerable:!0,get:function(){return Us.Scope}});Object.defineProperty(K,"ValueScope",{enumerable:!0,get:function(){return Us.ValueScope}});Object.defineProperty(K,"ValueScopeName",{enumerable:!0,get:function(){return Us.ValueScopeName}});Object.defineProperty(K,"varKinds",{enumerable:!0,get:function(){return Us.varKinds}});K.operators={GT:new X._Code(">"),GTE:new X._Code(">="),LT:new X._Code("<"),LTE:new X._Code("<="),EQ:new X._Code("==="),NEQ:new X._Code("!=="),NOT:new X._Code("!"),OR:new X._Code("||"),AND:new X._Code("&&"),ADD:new X._Code("+")};var Ot=class{optimizeNodes(){return this}optimizeNames(e,r){return this}},Pu=class extends Ot{constructor(e,r,n){super(),this.varKind=e,this.name=r,this.rhs=n}render({es5:e,_n:r}){let n=e?ft.varKinds.var:this.varKind,o=this.rhs===void 0?"":` = ${this.rhs}`;return`${n} ${this.name}${o};`+r}optimizeNames(e,r){if(e[this.name.str])return this.rhs&&(this.rhs=sn(this.rhs,e,r)),this}get names(){return this.rhs instanceof X._CodeOrName?this.rhs.names:{}}},Ds=class extends Ot{constructor(e,r,n){super(),this.lhs=e,this.rhs=r,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof X.Name&&!e[this.lhs.str]&&!this.sideEffects))return this.rhs=sn(this.rhs,e,r),this}get names(){let e=this.lhs instanceof X.Name?{}:{...this.lhs.names};return Ls(e,this.rhs)}},zu=class extends Ds{constructor(e,r,n,o){super(e,n,o),this.op=r}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}},Eu=class extends Ot{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}},Iu=class extends Ot{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}},Ru=class extends Ot{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}},Cu=class extends Ot{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,r){return this.code=sn(this.code,e,r),this}get names(){return this.code instanceof X._CodeOrName?this.code.names:{}}},no=class extends Ot{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((r,n)=>r+n.render(e),"")}optimizeNodes(){let{nodes:e}=this,r=e.length;for(;r--;){let n=e[r].optimizeNodes();Array.isArray(n)?e.splice(r,1,...n):n?e[r]=n:e.splice(r,1)}return e.length>0?this:void 0}optimizeNames(e,r){let{nodes:n}=this,o=n.length;for(;o--;){let s=n[o];s.optimizeNames(e,r)||(lw(e,s.names),n.splice(o,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,r)=>jr(e,r.names),{})}},At=class extends no{render(e){return"{"+e._n+super.render(e)+"}"+e._n}},ju=class extends no{},on=class extends At{};on.kind="else";var Rr=class t extends At{constructor(e,r){super(r),this.condition=e}render(e){let r=`if(${this.condition})`+super.render(e);return this.else&&(r+="else "+this.else.render(e)),r}optimizeNodes(){super.optimizeNodes();let e=this.condition;if(e===!0)return this.nodes;let r=this.else;if(r){let n=r.optimizeNodes();r=this.else=Array.isArray(n)?new on(n):n}if(r)return e===!1?r instanceof t?r:r.nodes:this.nodes.length?this:new t(Sm(e),r instanceof t?[r]:r.nodes);if(!(e===!1||!this.nodes.length))return this}optimizeNames(e,r){var n;if(this.else=(n=this.else)===null||n===void 0?void 0:n.optimizeNames(e,r),!!(super.optimizeNames(e,r)||this.else))return this.condition=sn(this.condition,e,r),this}get names(){let e=super.names;return Ls(e,this.condition),this.else&&jr(e,this.else.names),e}};Rr.kind="if";var Cr=class extends At{};Cr.kind="for";var Ou=class extends Cr{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iteration=sn(this.iteration,e,r),this}get names(){return jr(super.names,this.iteration.names)}},Au=class extends Cr{constructor(e,r,n,o){super(),this.varKind=e,this.name=r,this.from=n,this.to=o}render(e){let r=e.es5?ft.varKinds.var:this.varKind,{name:n,from:o,to:s}=this;return`for(${r} ${n}=${o}; ${n}<${s}; ${n}++)`+super.render(e)}get names(){let e=Ls(super.names,this.from);return Ls(e,this.to)}},qs=class extends Cr{constructor(e,r,n,o){super(),this.loop=e,this.varKind=r,this.name=n,this.iterable=o}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iterable=sn(this.iterable,e,r),this}get names(){return jr(super.names,this.iterable.names)}},oo=class extends At{constructor(e,r,n){super(),this.name=e,this.args=r,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}};oo.kind="func";var so=class extends no{render(e){return"return "+super.render(e)}};so.kind="return";var Nu=class extends At{render(e){let r="try"+super.render(e);return this.catch&&(r+=this.catch.render(e)),this.finally&&(r+=this.finally.render(e)),r}optimizeNodes(){var e,r;return super.optimizeNodes(),(e=this.catch)===null||e===void 0||e.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(e,r){var n,o;return super.optimizeNames(e,r),(n=this.catch)===null||n===void 0||n.optimizeNames(e,r),(o=this.finally)===null||o===void 0||o.optimizeNames(e,r),this}get names(){let e=super.names;return this.catch&&jr(e,this.catch.names),this.finally&&jr(e,this.finally.names),e}},io=class extends At{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}};io.kind="catch";var ao=class extends At{render(e){return"finally"+super.render(e)}};ao.kind="finally";var Mu=class{constructor(e,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=e,this._scope=new ft.Scope({parent:e}),this._nodes=[new ju]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,r){let n=this._extScope.value(e,r);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,r){return this._extScope.getValue(e,r)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,r,n,o){let s=this._scope.toName(r);return n!==void 0&&o&&(this._constants[s.str]=n),this._leafNode(new Pu(e,s,n)),s}const(e,r,n){return this._def(ft.varKinds.const,e,r,n)}let(e,r,n){return this._def(ft.varKinds.let,e,r,n)}var(e,r,n){return this._def(ft.varKinds.var,e,r,n)}assign(e,r,n){return this._leafNode(new Ds(e,r,n))}add(e,r){return this._leafNode(new zu(e,K.operators.ADD,r))}code(e){return typeof e=="function"?e():e!==X.nil&&this._leafNode(new Cu(e)),this}object(...e){let r=["{"];for(let[n,o]of e)r.length>1&&r.push(","),r.push(n),(n!==o||this.opts.es5)&&(r.push(":"),(0,X.addCodeArg)(r,o));return r.push("}"),new X._Code(r)}if(e,r,n){if(this._blockNode(new Rr(e)),r&&n)this.code(r).else().code(n).endIf();else if(r)this.code(r).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new Rr(e))}else(){return this._elseNode(new on)}endIf(){return this._endBlockNode(Rr,on)}_for(e,r){return this._blockNode(e),r&&this.code(r).endFor(),this}for(e,r){return this._for(new Ou(e),r)}forRange(e,r,n,o,s=this.opts.es5?ft.varKinds.var:ft.varKinds.let){let i=this._scope.toName(e);return this._for(new Au(s,i,r,n),()=>o(i))}forOf(e,r,n,o=ft.varKinds.const){let s=this._scope.toName(e);if(this.opts.es5){let i=r instanceof X.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,X._)`${i}.length`,a=>{this.var(s,(0,X._)`${i}[${a}]`),n(s)})}return this._for(new qs("of",o,s,r),()=>n(s))}forIn(e,r,n,o=this.opts.es5?ft.varKinds.var:ft.varKinds.const){if(this.opts.ownProperties)return this.forOf(e,(0,X._)`Object.keys(${r})`,n);let s=this._scope.toName(e);return this._for(new qs("in",o,s,r),()=>n(s))}endFor(){return this._endBlockNode(Cr)}label(e){return this._leafNode(new Eu(e))}break(e){return this._leafNode(new Iu(e))}return(e){let r=new so;if(this._blockNode(r),this.code(e),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(so)}try(e,r,n){if(!r&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');let o=new Nu;if(this._blockNode(o),this.code(e),r){let s=this.name("e");this._currNode=o.catch=new io(s),r(s)}return n&&(this._currNode=o.finally=new ao,this.code(n)),this._endBlockNode(io,ao)}throw(e){return this._leafNode(new Ru(e))}block(e,r){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(r),this}endBlock(e){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let n=this._nodes.length-r;if(n<0||e!==void 0&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=r,this}func(e,r=X.nil,n,o){return this._blockNode(new oo(e,r,n)),o&&this.code(o).endFunc(),this}endFunc(){return this._endBlockNode(oo)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,r){let n=this._currNode;if(n instanceof e||r&&n instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${e.kind}/${r.kind}`:e.kind}"`)}_elseNode(e){let r=this._currNode;if(!(r instanceof Rr))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=e,this}get _root(){return this._nodes[0]}get _currNode(){let e=this._nodes;return e[e.length-1]}set _currNode(e){let r=this._nodes;r[r.length-1]=e}};K.CodeGen=Mu;function jr(t,e){for(let r in e)t[r]=(t[r]||0)+(e[r]||0);return t}function Ls(t,e){return e instanceof X._CodeOrName?jr(t,e.names):t}function sn(t,e,r){if(t instanceof X.Name)return n(t);if(!o(t))return t;return new X._Code(t._items.reduce((s,i)=>(i instanceof X.Name&&(i=n(i)),i instanceof X._Code?s.push(...i._items):s.push(i),s),[]));function n(s){let i=r[s.str];return i===void 0||e[s.str]!==1?s:(delete e[s.str],i)}function o(s){return s instanceof X._Code&&s._items.some(i=>i instanceof X.Name&&e[i.str]===1&&r[i.str]!==void 0)}}function lw(t,e){for(let r in e)t[r]=(t[r]||0)-(e[r]||0)}function Sm(t){return typeof t=="boolean"||typeof t=="number"||t===null?!t:(0,X._)`!${Zu(t)}`}K.not=Sm;var dw=Tm(K.operators.AND);function pw(...t){return t.reduce(dw)}K.and=pw;var fw=Tm(K.operators.OR);function mw(...t){return t.reduce(fw)}K.or=mw;function Tm(t){return(e,r)=>e===X.nil?r:r===X.nil?e:(0,X._)`${Zu(e)} ${t} ${Zu(r)}`}function Zu(t){return t instanceof X.Name?t:(0,X._)`(${t})`}});var ee=P(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.checkStrictMode=H.getErrorPath=H.Type=H.useFunc=H.setEvaluated=H.evaluatedPropsToName=H.mergeEvaluated=H.eachItem=H.unescapeJsonPointer=H.escapeJsonPointer=H.escapeFragment=H.unescapeFragment=H.schemaRefOrVal=H.schemaHasRulesButRef=H.schemaHasRules=H.checkUnknownRules=H.alwaysValidSchema=H.toHash=void 0;var ie=V(),hw=ro();function gw(t){let e={};for(let r of t)e[r]=!0;return e}H.toHash=gw;function yw(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:(Em(t,e),!Im(e,t.self.RULES.all))}H.alwaysValidSchema=yw;function Em(t,e=t.schema){let{opts:r,self:n}=t;if(!r.strictSchema||typeof e=="boolean")return;let o=n.RULES.keywords;for(let s in e)o[s]||jm(t,`unknown keyword: "${s}"`)}H.checkUnknownRules=Em;function Im(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(e[r])return!0;return!1}H.schemaHasRules=Im;function _w(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}H.schemaHasRulesButRef=_w;function vw({topSchemaRef:t,schemaPath:e},r,n,o){if(!o){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,ie._)`${r}`}return(0,ie._)`${t}${e}${(0,ie.getProperty)(n)}`}H.schemaRefOrVal=vw;function xw(t){return Rm(decodeURIComponent(t))}H.unescapeFragment=xw;function bw(t){return encodeURIComponent(qu(t))}H.escapeFragment=bw;function qu(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}H.escapeJsonPointer=qu;function Rm(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}H.unescapeJsonPointer=Rm;function $w(t,e){if(Array.isArray(t))for(let r of t)e(r);else e(t)}H.eachItem=$w;function Pm({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:n}){return(o,s,i,a)=>{let c=i===void 0?s:i instanceof ie.Name?(s instanceof ie.Name?t(o,s,i):e(o,s,i),i):s instanceof ie.Name?(e(o,i,s),s):r(s,i);return a===ie.Name&&!(c instanceof ie.Name)?n(o,c):c}}H.mergeEvaluated={props:Pm({mergeNames:(t,e,r)=>t.if((0,ie._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,ie._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,ie._)`${r} || {}`).code((0,ie._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,ie._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,ie._)`${r} || {}`),Lu(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:Cm}),items:Pm({mergeNames:(t,e,r)=>t.if((0,ie._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,ie._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,ie._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,ie._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function Cm(t,e){if(e===!0)return t.var("props",!0);let r=t.var("props",(0,ie._)`{}`);return e!==void 0&&Lu(t,r,e),r}H.evaluatedPropsToName=Cm;function Lu(t,e,r){Object.keys(r).forEach(n=>t.assign((0,ie._)`${e}${(0,ie.getProperty)(n)}`,!0))}H.setEvaluated=Lu;var zm={};function ww(t,e){return t.scopeValue("func",{ref:e,code:zm[e.code]||(zm[e.code]=new hw._Code(e.code))})}H.useFunc=ww;var Du;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(Du||(H.Type=Du={}));function kw(t,e,r){if(t instanceof ie.Name){let n=e===Du.Num;return r?n?(0,ie._)`"[" + ${t} + "]"`:(0,ie._)`"['" + ${t} + "']"`:n?(0,ie._)`"/" + ${t}`:(0,ie._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,ie.getProperty)(t).toString():"/"+qu(t)}H.getErrorPath=kw;function jm(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}H.checkStrictMode=jm});var Nt=P(Uu=>{"use strict";Object.defineProperty(Uu,"__esModule",{value:!0});var je=V(),Sw={data:new je.Name("data"),valCxt:new je.Name("valCxt"),instancePath:new je.Name("instancePath"),parentData:new je.Name("parentData"),parentDataProperty:new je.Name("parentDataProperty"),rootData:new je.Name("rootData"),dynamicAnchors:new je.Name("dynamicAnchors"),vErrors:new je.Name("vErrors"),errors:new je.Name("errors"),this:new je.Name("this"),self:new je.Name("self"),scope:new je.Name("scope"),json:new je.Name("json"),jsonPos:new je.Name("jsonPos"),jsonLen:new je.Name("jsonLen"),jsonPart:new je.Name("jsonPart")};Uu.default=Sw});var co=P(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.extendErrors=Oe.resetErrorsCount=Oe.reportExtraError=Oe.reportError=Oe.keyword$DataError=Oe.keywordError=void 0;var Y=V(),Fs=ee(),Ze=Nt();Oe.keywordError={message:({keyword:t})=>(0,Y.str)`must pass "${t}" keyword validation`};Oe.keyword$DataError={message:({keyword:t,schemaType:e})=>e?(0,Y.str)`"${t}" keyword must be ${e} ($data)`:(0,Y.str)`"${t}" keyword is invalid ($data)`};function Tw(t,e=Oe.keywordError,r,n){let{it:o}=t,{gen:s,compositeRule:i,allErrors:a}=o,c=Nm(t,e,r);n??(i||a)?Om(s,c):Am(o,(0,Y._)`[${c}]`)}Oe.reportError=Tw;function Pw(t,e=Oe.keywordError,r){let{it:n}=t,{gen:o,compositeRule:s,allErrors:i}=n,a=Nm(t,e,r);Om(o,a),s||i||Am(n,Ze.default.vErrors)}Oe.reportExtraError=Pw;function zw(t,e){t.assign(Ze.default.errors,e),t.if((0,Y._)`${Ze.default.vErrors} !== null`,()=>t.if(e,()=>t.assign((0,Y._)`${Ze.default.vErrors}.length`,e),()=>t.assign(Ze.default.vErrors,null)))}Oe.resetErrorsCount=zw;function Ew({gen:t,keyword:e,schemaValue:r,data:n,errsCount:o,it:s}){if(o===void 0)throw new Error("ajv implementation error");let i=t.name("err");t.forRange("i",o,Ze.default.errors,a=>{t.const(i,(0,Y._)`${Ze.default.vErrors}[${a}]`),t.if((0,Y._)`${i}.instancePath === undefined`,()=>t.assign((0,Y._)`${i}.instancePath`,(0,Y.strConcat)(Ze.default.instancePath,s.errorPath))),t.assign((0,Y._)`${i}.schemaPath`,(0,Y.str)`${s.errSchemaPath}/${e}`),s.opts.verbose&&(t.assign((0,Y._)`${i}.schema`,r),t.assign((0,Y._)`${i}.data`,n))})}Oe.extendErrors=Ew;function Om(t,e){let r=t.const("err",e);t.if((0,Y._)`${Ze.default.vErrors} === null`,()=>t.assign(Ze.default.vErrors,(0,Y._)`[${r}]`),(0,Y._)`${Ze.default.vErrors}.push(${r})`),t.code((0,Y._)`${Ze.default.errors}++`)}function Am(t,e){let{gen:r,validateName:n,schemaEnv:o}=t;o.$async?r.throw((0,Y._)`new ${t.ValidationError}(${e})`):(r.assign((0,Y._)`${n}.errors`,e),r.return(!1))}var Or={keyword:new Y.Name("keyword"),schemaPath:new Y.Name("schemaPath"),params:new Y.Name("params"),propertyName:new Y.Name("propertyName"),message:new Y.Name("message"),schema:new Y.Name("schema"),parentSchema:new Y.Name("parentSchema")};function Nm(t,e,r){let{createErrors:n}=t.it;return n===!1?(0,Y._)`{}`:Iw(t,e,r)}function Iw(t,e,r={}){let{gen:n,it:o}=t,s=[Rw(o,r),Cw(t,r)];return jw(t,e,s),n.object(...s)}function Rw({errorPath:t},{instancePath:e}){let r=e?(0,Y.str)`${t}${(0,Fs.getErrorPath)(e,Fs.Type.Str)}`:t;return[Ze.default.instancePath,(0,Y.strConcat)(Ze.default.instancePath,r)]}function Cw({keyword:t,it:{errSchemaPath:e}},{schemaPath:r,parentSchema:n}){let o=n?e:(0,Y.str)`${e}/${t}`;return r&&(o=(0,Y.str)`${o}${(0,Fs.getErrorPath)(r,Fs.Type.Str)}`),[Or.schemaPath,o]}function jw(t,{params:e,message:r},n){let{keyword:o,data:s,schemaValue:i,it:a}=t,{opts:c,propertyName:u,topSchemaRef:l,schemaPath:d}=a;n.push([Or.keyword,o],[Or.params,typeof e=="function"?e(t):e||(0,Y._)`{}`]),c.messages&&n.push([Or.message,typeof r=="function"?r(t):r]),c.verbose&&n.push([Or.schema,i],[Or.parentSchema,(0,Y._)`${l}${d}`],[Ze.default.data,s]),u&&n.push([Or.propertyName,u])}});var Zm=P(an=>{"use strict";Object.defineProperty(an,"__esModule",{value:!0});an.boolOrEmptySchema=an.topBoolOrEmptySchema=void 0;var Ow=co(),Aw=V(),Nw=Nt(),Mw={message:"boolean schema is false"};function Zw(t){let{gen:e,schema:r,validateName:n}=t;r===!1?Mm(t,!1):typeof r=="object"&&r.$async===!0?e.return(Nw.default.data):(e.assign((0,Aw._)`${n}.errors`,null),e.return(!0))}an.topBoolOrEmptySchema=Zw;function Dw(t,e){let{gen:r,schema:n}=t;n===!1?(r.var(e,!1),Mm(t)):r.var(e,!0)}an.boolOrEmptySchema=Dw;function Mm(t,e){let{gen:r,data:n}=t,o={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,Ow.reportError)(o,Mw,void 0,e)}});var Fu=P(cn=>{"use strict";Object.defineProperty(cn,"__esModule",{value:!0});cn.getRules=cn.isJSONType=void 0;var qw=["string","number","integer","boolean","null","object","array"],Lw=new Set(qw);function Uw(t){return typeof t=="string"&&Lw.has(t)}cn.isJSONType=Uw;function Fw(){let t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}cn.getRules=Fw});var Vu=P(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.shouldUseRule=Qt.shouldUseGroup=Qt.schemaHasRulesForType=void 0;function Vw({schema:t,self:e},r){let n=e.RULES.types[r];return n&&n!==!0&&Dm(t,n)}Qt.schemaHasRulesForType=Vw;function Dm(t,e){return e.rules.some(r=>qm(t,r))}Qt.shouldUseGroup=Dm;function qm(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(n=>t[n]!==void 0))}Qt.shouldUseRule=qm});var uo=P(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.reportTypeError=Ae.checkDataTypes=Ae.checkDataType=Ae.coerceAndCheckDataType=Ae.getJSONTypes=Ae.getSchemaTypes=Ae.DataType=void 0;var Kw=Fu(),Hw=Vu(),Bw=co(),U=V(),Lm=ee(),un;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(un||(Ae.DataType=un={}));function Gw(t){let e=Um(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}Ae.getSchemaTypes=Gw;function Um(t){let e=Array.isArray(t)?t:t?[t]:[];if(e.every(Kw.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}Ae.getJSONTypes=Um;function Jw(t,e){let{gen:r,data:n,opts:o}=t,s=Ww(e,o.coerceTypes),i=e.length>0&&!(s.length===0&&e.length===1&&(0,Hw.schemaHasRulesForType)(t,e[0]));if(i){let a=Hu(e,n,o.strictNumbers,un.Wrong);r.if(a,()=>{s.length?Xw(t,e,s):Bu(t)})}return i}Ae.coerceAndCheckDataType=Jw;var Fm=new Set(["string","number","integer","boolean","null"]);function Ww(t,e){return e?t.filter(r=>Fm.has(r)||e==="array"&&r==="array"):[]}function Xw(t,e,r){let{gen:n,data:o,opts:s}=t,i=n.let("dataType",(0,U._)`typeof ${o}`),a=n.let("coerced",(0,U._)`undefined`);s.coerceTypes==="array"&&n.if((0,U._)`${i} == 'object' && Array.isArray(${o}) && ${o}.length == 1`,()=>n.assign(o,(0,U._)`${o}[0]`).assign(i,(0,U._)`typeof ${o}`).if(Hu(e,o,s.strictNumbers),()=>n.assign(a,o))),n.if((0,U._)`${a} !== undefined`);for(let u of r)(Fm.has(u)||u==="array"&&s.coerceTypes==="array")&&c(u);n.else(),Bu(t),n.endIf(),n.if((0,U._)`${a} !== undefined`,()=>{n.assign(o,a),Yw(t,a)});function c(u){switch(u){case"string":n.elseIf((0,U._)`${i} == "number" || ${i} == "boolean"`).assign(a,(0,U._)`"" + ${o}`).elseIf((0,U._)`${o} === null`).assign(a,(0,U._)`""`);return;case"number":n.elseIf((0,U._)`${i} == "boolean" || ${o} === null
              || (${i} == "string" && ${o} && ${o} == +${o})`).assign(a,(0,U._)`+${o}`);return;case"integer":n.elseIf((0,U._)`${i} === "boolean" || ${o} === null
              || (${i} === "string" && ${o} && ${o} == +${o} && !(${o} % 1))`).assign(a,(0,U._)`+${o}`);return;case"boolean":n.elseIf((0,U._)`${o} === "false" || ${o} === 0 || ${o} === null`).assign(a,!1).elseIf((0,U._)`${o} === "true" || ${o} === 1`).assign(a,!0);return;case"null":n.elseIf((0,U._)`${o} === "" || ${o} === 0 || ${o} === false`),n.assign(a,null);return;case"array":n.elseIf((0,U._)`${i} === "string" || ${i} === "number"
              || ${i} === "boolean" || ${o} === null`).assign(a,(0,U._)`[${o}]`)}}}function Yw({gen:t,parentData:e,parentDataProperty:r},n){t.if((0,U._)`${e} !== undefined`,()=>t.assign((0,U._)`${e}[${r}]`,n))}function Ku(t,e,r,n=un.Correct){let o=n===un.Correct?U.operators.EQ:U.operators.NEQ,s;switch(t){case"null":return(0,U._)`${e} ${o} null`;case"array":s=(0,U._)`Array.isArray(${e})`;break;case"object":s=(0,U._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":s=i((0,U._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":s=i();break;default:return(0,U._)`typeof ${e} ${o} ${t}`}return n===un.Correct?s:(0,U.not)(s);function i(a=U.nil){return(0,U.and)((0,U._)`typeof ${e} == "number"`,a,r?(0,U._)`isFinite(${e})`:U.nil)}}Ae.checkDataType=Ku;function Hu(t,e,r,n){if(t.length===1)return Ku(t[0],e,r,n);let o,s=(0,Lm.toHash)(t);if(s.array&&s.object){let i=(0,U._)`typeof ${e} != "object"`;o=s.null?i:(0,U._)`!${e} || ${i}`,delete s.null,delete s.array,delete s.object}else o=U.nil;s.number&&delete s.integer;for(let i in s)o=(0,U.and)(o,Ku(i,e,r,n));return o}Ae.checkDataTypes=Hu;var Qw={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,U._)`{type: ${t}}`:(0,U._)`{type: ${e}}`};function Bu(t){let e=ek(t);(0,Bw.reportError)(e,Qw)}Ae.reportTypeError=Bu;function ek(t){let{gen:e,data:r,schema:n}=t,o=(0,Lm.schemaRefOrVal)(t,n,"type");return{gen:e,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:t}}});var Km=P(Vs=>{"use strict";Object.defineProperty(Vs,"__esModule",{value:!0});Vs.assignDefaults=void 0;var ln=V(),tk=ee();function rk(t,e){let{properties:r,items:n}=t.schema;if(e==="object"&&r)for(let o in r)Vm(t,o,r[o].default);else e==="array"&&Array.isArray(n)&&n.forEach((o,s)=>Vm(t,s,o.default))}Vs.assignDefaults=rk;function Vm(t,e,r){let{gen:n,compositeRule:o,data:s,opts:i}=t;if(r===void 0)return;let a=(0,ln._)`${s}${(0,ln.getProperty)(e)}`;if(o){(0,tk.checkStrictMode)(t,`default is ignored for: ${a}`);return}let c=(0,ln._)`${a} === undefined`;i.useDefaults==="empty"&&(c=(0,ln._)`${c} || ${a} === null || ${a} === ""`),n.if(c,(0,ln._)`${a} = ${(0,ln.stringify)(r)}`)}});var st=P(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.validateUnion=se.validateArray=se.usePattern=se.callValidateCode=se.schemaProperties=se.allSchemaProperties=se.noPropertyInData=se.propertyInData=se.isOwnProperty=se.hasPropFunc=se.reportMissingProp=se.checkMissingProp=se.checkReportMissingProp=void 0;var le=V(),Gu=ee(),er=Nt(),nk=ee();function ok(t,e){let{gen:r,data:n,it:o}=t;r.if(Wu(r,n,e,o.opts.ownProperties),()=>{t.setParams({missingProperty:(0,le._)`${e}`},!0),t.error()})}se.checkReportMissingProp=ok;function sk({gen:t,data:e,it:{opts:r}},n,o){return(0,le.or)(...n.map(s=>(0,le.and)(Wu(t,e,s,r.ownProperties),(0,le._)`${o} = ${s}`)))}se.checkMissingProp=sk;function ik(t,e){t.setParams({missingProperty:e},!0),t.error()}se.reportMissingProp=ik;function Hm(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,le._)`Object.prototype.hasOwnProperty`})}se.hasPropFunc=Hm;function Ju(t,e,r){return(0,le._)`${Hm(t)}.call(${e}, ${r})`}se.isOwnProperty=Ju;function ak(t,e,r,n){let o=(0,le._)`${e}${(0,le.getProperty)(r)} !== undefined`;return n?(0,le._)`${o} && ${Ju(t,e,r)}`:o}se.propertyInData=ak;function Wu(t,e,r,n){let o=(0,le._)`${e}${(0,le.getProperty)(r)} === undefined`;return n?(0,le.or)(o,(0,le.not)(Ju(t,e,r))):o}se.noPropertyInData=Wu;function Bm(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}se.allSchemaProperties=Bm;function ck(t,e){return Bm(e).filter(r=>!(0,Gu.alwaysValidSchema)(t,e[r]))}se.schemaProperties=ck;function uk({schemaCode:t,data:e,it:{gen:r,topSchemaRef:n,schemaPath:o,errorPath:s},it:i},a,c,u){let l=u?(0,le._)`${t}, ${e}, ${n}${o}`:e,d=[[er.default.instancePath,(0,le.strConcat)(er.default.instancePath,s)],[er.default.parentData,i.parentData],[er.default.parentDataProperty,i.parentDataProperty],[er.default.rootData,er.default.rootData]];i.opts.dynamicRef&&d.push([er.default.dynamicAnchors,er.default.dynamicAnchors]);let f=(0,le._)`${l}, ${r.object(...d)}`;return c!==le.nil?(0,le._)`${a}.call(${c}, ${f})`:(0,le._)`${a}(${f})`}se.callValidateCode=uk;var lk=(0,le._)`new RegExp`;function dk({gen:t,it:{opts:e}},r){let n=e.unicodeRegExp?"u":"",{regExp:o}=e.code,s=o(r,n);return t.scopeValue("pattern",{key:s.toString(),ref:s,code:(0,le._)`${o.code==="new RegExp"?lk:(0,nk.useFunc)(t,o)}(${r}, ${n})`})}se.usePattern=dk;function pk(t){let{gen:e,data:r,keyword:n,it:o}=t,s=e.name("valid");if(o.allErrors){let a=e.let("valid",!0);return i(()=>e.assign(a,!1)),a}return e.var(s,!0),i(()=>e.break()),s;function i(a){let c=e.const("len",(0,le._)`${r}.length`);e.forRange("i",0,c,u=>{t.subschema({keyword:n,dataProp:u,dataPropType:Gu.Type.Num},s),e.if((0,le.not)(s),a)})}}se.validateArray=pk;function fk(t){let{gen:e,schema:r,keyword:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(c=>(0,Gu.alwaysValidSchema)(o,c))&&!o.opts.unevaluated)return;let i=e.let("valid",!1),a=e.name("_valid");e.block(()=>r.forEach((c,u)=>{let l=t.subschema({keyword:n,schemaProp:u,compositeRule:!0},a);e.assign(i,(0,le._)`${i} || ${a}`),t.mergeValidEvaluated(l,a)||e.if((0,le.not)(i))})),t.result(i,()=>t.reset(),()=>t.error(!0))}se.validateUnion=fk});var Wm=P($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.validateKeywordUsage=$t.validSchemaType=$t.funcKeywordCode=$t.macroKeywordCode=void 0;var De=V(),Ar=Nt(),mk=st(),hk=co();function gk(t,e){let{gen:r,keyword:n,schema:o,parentSchema:s,it:i}=t,a=e.macro.call(i.self,o,s,i),c=Jm(r,n,a);i.opts.validateSchema!==!1&&i.self.validateSchema(a,!0);let u=r.name("valid");t.subschema({schema:a,schemaPath:De.nil,errSchemaPath:`${i.errSchemaPath}/${n}`,topSchemaRef:c,compositeRule:!0},u),t.pass(u,()=>t.error(!0))}$t.macroKeywordCode=gk;function yk(t,e){var r;let{gen:n,keyword:o,schema:s,parentSchema:i,$data:a,it:c}=t;vk(c,e);let u=!a&&e.compile?e.compile.call(c.self,s,i,c):e.validate,l=Jm(n,o,u),d=n.let("valid");t.block$data(d,f),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function f(){if(e.errors===!1)h(),e.modifying&&Gm(t),g(()=>t.error());else{let _=e.async?m():p();e.modifying&&Gm(t),g(()=>_k(t,_))}}function m(){let _=n.let("ruleErrs",null);return n.try(()=>h((0,De._)`await `),x=>n.assign(d,!1).if((0,De._)`${x} instanceof ${c.ValidationError}`,()=>n.assign(_,(0,De._)`${x}.errors`),()=>n.throw(x))),_}function p(){let _=(0,De._)`${l}.errors`;return n.assign(_,null),h(De.nil),_}function h(_=e.async?(0,De._)`await `:De.nil){let x=c.opts.passContext?Ar.default.this:Ar.default.self,b=!("compile"in e&&!a||e.schema===!1);n.assign(d,(0,De._)`${_}${(0,mk.callValidateCode)(t,l,x,b)}`,e.modifying)}function g(_){var x;n.if((0,De.not)((x=e.valid)!==null&&x!==void 0?x:d),_)}}$t.funcKeywordCode=yk;function Gm(t){let{gen:e,data:r,it:n}=t;e.if(n.parentData,()=>e.assign(r,(0,De._)`${n.parentData}[${n.parentDataProperty}]`))}function _k(t,e){let{gen:r}=t;r.if((0,De._)`Array.isArray(${e})`,()=>{r.assign(Ar.default.vErrors,(0,De._)`${Ar.default.vErrors} === null ? ${e} : ${Ar.default.vErrors}.concat(${e})`).assign(Ar.default.errors,(0,De._)`${Ar.default.vErrors}.length`),(0,hk.extendErrors)(t)},()=>t.error())}function vk({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function Jm(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,De.stringify)(r)})}function xk(t,e,r=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(t):n==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==n||r&&typeof t>"u")}$t.validSchemaType=xk;function bk({schema:t,opts:e,self:r,errSchemaPath:n},o,s){if(Array.isArray(o.keyword)?!o.keyword.includes(s):o.keyword!==s)throw new Error("ajv implementation error");let i=o.dependencies;if(i?.some(a=>!Object.prototype.hasOwnProperty.call(t,a)))throw new Error(`parent schema must have dependencies of ${s}: ${i.join(",")}`);if(o.validateSchema&&!o.validateSchema(t[s])){let c=`keyword "${s}" value is invalid at path "${n}": `+r.errorsText(o.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(c);else throw new Error(c)}}$t.validateKeywordUsage=bk});var Ym=P(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.extendSubschemaMode=tr.extendSubschemaData=tr.getSubschema=void 0;var wt=V(),Xm=ee();function $k(t,{keyword:e,schemaProp:r,schema:n,schemaPath:o,errSchemaPath:s,topSchemaRef:i}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){let a=t.schema[e];return r===void 0?{schema:a,schemaPath:(0,wt._)`${t.schemaPath}${(0,wt.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:a[r],schemaPath:(0,wt._)`${t.schemaPath}${(0,wt.getProperty)(e)}${(0,wt.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,Xm.escapeFragment)(r)}`}}if(n!==void 0){if(o===void 0||s===void 0||i===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:o,topSchemaRef:i,errSchemaPath:s}}throw new Error('either "keyword" or "schema" must be passed')}tr.getSubschema=$k;function wk(t,e,{dataProp:r,dataPropType:n,data:o,dataTypes:s,propertyName:i}){if(o!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=e;if(r!==void 0){let{errorPath:u,dataPathArr:l,opts:d}=e,f=a.let("data",(0,wt._)`${e.data}${(0,wt.getProperty)(r)}`,!0);c(f),t.errorPath=(0,wt.str)`${u}${(0,Xm.getErrorPath)(r,n,d.jsPropertySyntax)}`,t.parentDataProperty=(0,wt._)`${r}`,t.dataPathArr=[...l,t.parentDataProperty]}if(o!==void 0){let u=o instanceof wt.Name?o:a.let("data",o,!0);c(u),i!==void 0&&(t.propertyName=i)}s&&(t.dataTypes=s);function c(u){t.data=u,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,u]}}tr.extendSubschemaData=wk;function kk(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:n,createErrors:o,allErrors:s}){n!==void 0&&(t.compositeRule=n),o!==void 0&&(t.createErrors=o),s!==void 0&&(t.allErrors=s),t.jtdDiscriminator=e,t.jtdMetadata=r}tr.extendSubschemaMode=kk});var Xu=P((lO,Qm)=>{"use strict";Qm.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,o,s;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(o=n;o--!==0;)if(!t(e[o],r[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(r).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(r,s[o]))return!1;for(o=n;o--!==0;){var i=s[o];if(!t(e[i],r[i]))return!1}return!0}return e!==e&&r!==r}});var th=P((dO,eh)=>{"use strict";var rr=eh.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var n=typeof r=="function"?r:r.pre||function(){},o=r.post||function(){};Ks(e,n,o,t,"",t)};rr.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};rr.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};rr.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};rr.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function Ks(t,e,r,n,o,s,i,a,c,u){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,o,s,i,a,c,u);for(var l in n){var d=n[l];if(Array.isArray(d)){if(l in rr.arrayKeywords)for(var f=0;f<d.length;f++)Ks(t,e,r,d[f],o+"/"+l+"/"+f,s,o,l,n,f)}else if(l in rr.propsKeywords){if(d&&typeof d=="object")for(var m in d)Ks(t,e,r,d[m],o+"/"+l+"/"+Sk(m),s,o,l,n,m)}else(l in rr.keywords||t.allKeys&&!(l in rr.skipKeywords))&&Ks(t,e,r,d,o+"/"+l,s,o,l,n)}r(n,o,s,i,a,c,u)}}function Sk(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}});var lo=P(Be=>{"use strict";Object.defineProperty(Be,"__esModule",{value:!0});Be.getSchemaRefs=Be.resolveUrl=Be.normalizeId=Be._getFullPath=Be.getFullPath=Be.inlineRef=void 0;var Tk=ee(),Pk=Xu(),zk=th(),Ek=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function Ik(t,e=!0){return typeof t=="boolean"?!0:e===!0?!Yu(t):e?rh(t)<=e:!1}Be.inlineRef=Ik;var Rk=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function Yu(t){for(let e in t){if(Rk.has(e))return!0;let r=t[e];if(Array.isArray(r)&&r.some(Yu)||typeof r=="object"&&Yu(r))return!0}return!1}function rh(t){let e=0;for(let r in t){if(r==="$ref")return 1/0;if(e++,!Ek.has(r)&&(typeof t[r]=="object"&&(0,Tk.eachItem)(t[r],n=>e+=rh(n)),e===1/0))return 1/0}return e}function nh(t,e="",r){r!==!1&&(e=dn(e));let n=t.parse(e);return oh(t,n)}Be.getFullPath=nh;function oh(t,e){return t.serialize(e).split("#")[0]+"#"}Be._getFullPath=oh;var Ck=/#\/?$/;function dn(t){return t?t.replace(Ck,""):""}Be.normalizeId=dn;function jk(t,e,r){return r=dn(r),t.resolve(e,r)}Be.resolveUrl=jk;var Ok=/^[a-z_][-a-z0-9._]*$/i;function Ak(t,e){if(typeof t=="boolean")return{};let{schemaId:r,uriResolver:n}=this.opts,o=dn(t[r]||e),s={"":o},i=nh(n,o,!1),a={},c=new Set;return zk(t,{allKeys:!0},(d,f,m,p)=>{if(p===void 0)return;let h=i+f,g=s[p];typeof d[r]=="string"&&(g=_.call(this,d[r])),x.call(this,d.$anchor),x.call(this,d.$dynamicAnchor),s[f]=g;function _(b){let S=this.opts.uriResolver.resolve;if(b=dn(g?S(g,b):b),c.has(b))throw l(b);c.add(b);let I=this.refs[b];return typeof I=="string"&&(I=this.refs[I]),typeof I=="object"?u(d,I.schema,b):b!==dn(h)&&(b[0]==="#"?(u(d,a[b],b),a[b]=d):this.refs[b]=h),b}function x(b){if(typeof b=="string"){if(!Ok.test(b))throw new Error(`invalid anchor "${b}"`);_.call(this,`#${b}`)}}}),a;function u(d,f,m){if(f!==void 0&&!Pk(d,f))throw l(m)}function l(d){return new Error(`reference "${d}" resolves to more than one schema`)}}Be.getSchemaRefs=Ak});var mo=P(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});nr.getData=nr.KeywordCxt=nr.validateFunctionCode=void 0;var uh=Zm(),sh=uo(),el=Vu(),Hs=uo(),Nk=Km(),fo=Wm(),Qu=Ym(),O=V(),q=Nt(),Mk=lo(),Mt=ee(),po=co();function Zk(t){if(ph(t)&&(fh(t),dh(t))){Lk(t);return}lh(t,()=>(0,uh.topBoolOrEmptySchema)(t))}nr.validateFunctionCode=Zk;function lh({gen:t,validateName:e,schema:r,schemaEnv:n,opts:o},s){o.code.es5?t.func(e,(0,O._)`${q.default.data}, ${q.default.valCxt}`,n.$async,()=>{t.code((0,O._)`"use strict"; ${ih(r,o)}`),qk(t,o),t.code(s)}):t.func(e,(0,O._)`${q.default.data}, ${Dk(o)}`,n.$async,()=>t.code(ih(r,o)).code(s))}function Dk(t){return(0,O._)`{${q.default.instancePath}="", ${q.default.parentData}, ${q.default.parentDataProperty}, ${q.default.rootData}=${q.default.data}${t.dynamicRef?(0,O._)`, ${q.default.dynamicAnchors}={}`:O.nil}}={}`}function qk(t,e){t.if(q.default.valCxt,()=>{t.var(q.default.instancePath,(0,O._)`${q.default.valCxt}.${q.default.instancePath}`),t.var(q.default.parentData,(0,O._)`${q.default.valCxt}.${q.default.parentData}`),t.var(q.default.parentDataProperty,(0,O._)`${q.default.valCxt}.${q.default.parentDataProperty}`),t.var(q.default.rootData,(0,O._)`${q.default.valCxt}.${q.default.rootData}`),e.dynamicRef&&t.var(q.default.dynamicAnchors,(0,O._)`${q.default.valCxt}.${q.default.dynamicAnchors}`)},()=>{t.var(q.default.instancePath,(0,O._)`""`),t.var(q.default.parentData,(0,O._)`undefined`),t.var(q.default.parentDataProperty,(0,O._)`undefined`),t.var(q.default.rootData,q.default.data),e.dynamicRef&&t.var(q.default.dynamicAnchors,(0,O._)`{}`)})}function Lk(t){let{schema:e,opts:r,gen:n}=t;lh(t,()=>{r.$comment&&e.$comment&&hh(t),Hk(t),n.let(q.default.vErrors,null),n.let(q.default.errors,0),r.unevaluated&&Uk(t),mh(t),Jk(t)})}function Uk(t){let{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,O._)`${r}.evaluated`),e.if((0,O._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,O._)`${t.evaluated}.props`,(0,O._)`undefined`)),e.if((0,O._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,O._)`${t.evaluated}.items`,(0,O._)`undefined`))}function ih(t,e){let r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,O._)`/*# sourceURL=${r} */`:O.nil}function Fk(t,e){if(ph(t)&&(fh(t),dh(t))){Vk(t,e);return}(0,uh.boolOrEmptySchema)(t,e)}function dh({schema:t,self:e}){if(typeof t=="boolean")return!t;for(let r in t)if(e.RULES.all[r])return!0;return!1}function ph(t){return typeof t.schema!="boolean"}function Vk(t,e){let{schema:r,gen:n,opts:o}=t;o.$comment&&r.$comment&&hh(t),Bk(t),Gk(t);let s=n.const("_errs",q.default.errors);mh(t,s),n.var(e,(0,O._)`${s} === ${q.default.errors}`)}function fh(t){(0,Mt.checkUnknownRules)(t),Kk(t)}function mh(t,e){if(t.opts.jtd)return ah(t,[],!1,e);let r=(0,sh.getSchemaTypes)(t.schema),n=(0,sh.coerceAndCheckDataType)(t,r);ah(t,r,!n,e)}function Kk(t){let{schema:e,errSchemaPath:r,opts:n,self:o}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,Mt.schemaHasRulesButRef)(e,o.RULES)&&o.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function Hk(t){let{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,Mt.checkStrictMode)(t,"default is ignored in the schema root")}function Bk(t){let e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,Mk.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function Gk(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function hh({gen:t,schemaEnv:e,schema:r,errSchemaPath:n,opts:o}){let s=r.$comment;if(o.$comment===!0)t.code((0,O._)`${q.default.self}.logger.log(${s})`);else if(typeof o.$comment=="function"){let i=(0,O.str)`${n}/$comment`,a=t.scopeValue("root",{ref:e.root});t.code((0,O._)`${q.default.self}.opts.$comment(${s}, ${i}, ${a}.schema)`)}}function Jk(t){let{gen:e,schemaEnv:r,validateName:n,ValidationError:o,opts:s}=t;r.$async?e.if((0,O._)`${q.default.errors} === 0`,()=>e.return(q.default.data),()=>e.throw((0,O._)`new ${o}(${q.default.vErrors})`)):(e.assign((0,O._)`${n}.errors`,q.default.vErrors),s.unevaluated&&Wk(t),e.return((0,O._)`${q.default.errors} === 0`))}function Wk({gen:t,evaluated:e,props:r,items:n}){r instanceof O.Name&&t.assign((0,O._)`${e}.props`,r),n instanceof O.Name&&t.assign((0,O._)`${e}.items`,n)}function ah(t,e,r,n){let{gen:o,schema:s,data:i,allErrors:a,opts:c,self:u}=t,{RULES:l}=u;if(s.$ref&&(c.ignoreKeywordsWithRef||!(0,Mt.schemaHasRulesButRef)(s,l))){o.block(()=>yh(t,"$ref",l.all.$ref.definition));return}c.jtd||Xk(t,e),o.block(()=>{for(let f of l.rules)d(f);d(l.post)});function d(f){(0,el.shouldUseGroup)(s,f)&&(f.type?(o.if((0,Hs.checkDataType)(f.type,i,c.strictNumbers)),ch(t,f),e.length===1&&e[0]===f.type&&r&&(o.else(),(0,Hs.reportTypeError)(t)),o.endIf()):ch(t,f),a||o.if((0,O._)`${q.default.errors} === ${n||0}`))}}function ch(t,e){let{gen:r,schema:n,opts:{useDefaults:o}}=t;o&&(0,Nk.assignDefaults)(t,e.type),r.block(()=>{for(let s of e.rules)(0,el.shouldUseRule)(n,s)&&yh(t,s.keyword,s.definition,e.type)})}function Xk(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(Yk(t,e),t.opts.allowUnionTypes||Qk(t,e),e0(t,t.dataTypes))}function Yk(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{gh(t.dataTypes,r)||tl(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),r0(t,e)}}function Qk(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&tl(t,"use allowUnionTypes to allow union type keyword")}function e0(t,e){let r=t.self.RULES.all;for(let n in r){let o=r[n];if(typeof o=="object"&&(0,el.shouldUseRule)(t.schema,o)){let{type:s}=o.definition;s.length&&!s.some(i=>t0(e,i))&&tl(t,`missing type "${s.join(",")}" for keyword "${n}"`)}}}function t0(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function gh(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function r0(t,e){let r=[];for(let n of t.dataTypes)gh(e,n)?r.push(n):e.includes("integer")&&n==="number"&&r.push("integer");t.dataTypes=r}function tl(t,e){let r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,Mt.checkStrictMode)(t,e,t.opts.strictTypes)}var Bs=class{constructor(e,r,n){if((0,fo.validateKeywordUsage)(e,r,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Mt.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",_h(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,fo.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",q.default.errors))}result(e,r,n){this.failResult((0,O.not)(e),r,n)}failResult(e,r,n){this.gen.if(e),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,O.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:r}=this;this.fail((0,O._)`${r} !== undefined && (${(0,O.or)(this.invalid$data(),e)})`)}error(e,r,n){if(r){this.setParams(r),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,r){(e?po.reportExtraError:po.reportError)(this,this.def.error,r)}$dataError(){(0,po.reportError)(this,this.def.$dataError||po.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,po.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,n=O.nil){this.gen.block(()=>{this.check$data(e,n),r()})}check$data(e=O.nil,r=O.nil){if(!this.$data)return;let{gen:n,schemaCode:o,schemaType:s,def:i}=this;n.if((0,O.or)((0,O._)`${o} === undefined`,r)),e!==O.nil&&n.assign(e,!0),(s.length||i.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==O.nil&&n.assign(e,!1)),n.else()}invalid$data(){let{gen:e,schemaCode:r,schemaType:n,def:o,it:s}=this;return(0,O.or)(i(),a());function i(){if(n.length){if(!(r instanceof O.Name))throw new Error("ajv implementation error");let c=Array.isArray(n)?n:[n];return(0,O._)`${(0,Hs.checkDataTypes)(c,r,s.opts.strictNumbers,Hs.DataType.Wrong)}`}return O.nil}function a(){if(o.validateSchema){let c=e.scopeValue("validate$data",{ref:o.validateSchema});return(0,O._)`!${c}(${r})`}return O.nil}}subschema(e,r){let n=(0,Qu.getSubschema)(this.it,e);(0,Qu.extendSubschemaData)(n,this.it,e),(0,Qu.extendSubschemaMode)(n,e);let o={...this.it,...n,items:void 0,props:void 0};return Fk(o,r),o}mergeEvaluated(e,r){let{it:n,gen:o}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=Mt.mergeEvaluated.props(o,e.props,n.props,r)),n.items!==!0&&e.items!==void 0&&(n.items=Mt.mergeEvaluated.items(o,e.items,n.items,r)))}mergeValidEvaluated(e,r){let{it:n,gen:o}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return o.if(r,()=>this.mergeEvaluated(e,O.Name)),!0}};nr.KeywordCxt=Bs;function yh(t,e,r,n){let o=new Bs(t,r,e);"code"in r?r.code(o,n):o.$data&&r.validate?(0,fo.funcKeywordCode)(o,r):"macro"in r?(0,fo.macroKeywordCode)(o,r):(r.compile||r.validate)&&(0,fo.funcKeywordCode)(o,r)}var n0=/^\/(?:[^~]|~0|~1)*$/,o0=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function _h(t,{dataLevel:e,dataNames:r,dataPathArr:n}){let o,s;if(t==="")return q.default.rootData;if(t[0]==="/"){if(!n0.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);o=t,s=q.default.rootData}else{let u=o0.exec(t);if(!u)throw new Error(`Invalid JSON-pointer: ${t}`);let l=+u[1];if(o=u[2],o==="#"){if(l>=e)throw new Error(c("property/index",l));return n[e-l]}if(l>e)throw new Error(c("data",l));if(s=r[e-l],!o)return s}let i=s,a=o.split("/");for(let u of a)u&&(s=(0,O._)`${s}${(0,O.getProperty)((0,Mt.unescapeJsonPointer)(u))}`,i=(0,O._)`${i} && ${s}`);return i;function c(u,l){return`Cannot access ${u} ${l} levels up, current level is ${e}`}}nr.getData=_h});var Gs=P(nl=>{"use strict";Object.defineProperty(nl,"__esModule",{value:!0});var rl=class extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}};nl.default=rl});var ho=P(il=>{"use strict";Object.defineProperty(il,"__esModule",{value:!0});var ol=lo(),sl=class extends Error{constructor(e,r,n,o){super(o||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,ol.resolveUrl)(e,r,n),this.missingSchema=(0,ol.normalizeId)((0,ol.getFullPath)(e,this.missingRef))}};il.default=sl});var Ws=P(it=>{"use strict";Object.defineProperty(it,"__esModule",{value:!0});it.resolveSchema=it.getCompilingSchema=it.resolveRef=it.compileSchema=it.SchemaEnv=void 0;var mt=V(),s0=Gs(),Nr=Nt(),ht=lo(),vh=ee(),i0=mo(),pn=class{constructor(e){var r;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,ht.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}};it.SchemaEnv=pn;function cl(t){let e=xh.call(this,t);if(e)return e;let r=(0,ht.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:o}=this.opts.code,{ownProperties:s}=this.opts,i=new mt.CodeGen(this.scope,{es5:n,lines:o,ownProperties:s}),a;t.$async&&(a=i.scopeValue("Error",{ref:s0.default,code:(0,mt._)`require("ajv/dist/runtime/validation_error").default`}));let c=i.scopeName("validate");t.validateName=c;let u={gen:i,allErrors:this.opts.allErrors,data:Nr.default.data,parentData:Nr.default.parentData,parentDataProperty:Nr.default.parentDataProperty,dataNames:[Nr.default.data],dataPathArr:[mt.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:i.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,mt.stringify)(t.schema)}:{ref:t.schema}),validateName:c,ValidationError:a,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:mt.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,mt._)`""`,opts:this.opts,self:this},l;try{this._compilations.add(t),(0,i0.validateFunctionCode)(u),i.optimize(this.opts.code.optimize);let d=i.toString();l=`${i.scopeRefs(Nr.default.scope)}return ${d}`,this.opts.code.process&&(l=this.opts.code.process(l,t));let m=new Function(`${Nr.default.self}`,`${Nr.default.scope}`,l)(this,this.scope.get());if(this.scope.value(c,{ref:m}),m.errors=null,m.schema=t.schema,m.schemaEnv=t,t.$async&&(m.$async=!0),this.opts.code.source===!0&&(m.source={validateName:c,validateCode:d,scopeValues:i._values}),this.opts.unevaluated){let{props:p,items:h}=u;m.evaluated={props:p instanceof mt.Name?void 0:p,items:h instanceof mt.Name?void 0:h,dynamicProps:p instanceof mt.Name,dynamicItems:h instanceof mt.Name},m.source&&(m.source.evaluated=(0,mt.stringify)(m.evaluated))}return t.validate=m,t}catch(d){throw delete t.validate,delete t.validateName,l&&this.logger.error("Error compiling schema, function code:",l),d}finally{this._compilations.delete(t)}}it.compileSchema=cl;function a0(t,e,r){var n;r=(0,ht.resolveUrl)(this.opts.uriResolver,e,r);let o=t.refs[r];if(o)return o;let s=l0.call(this,t,r);if(s===void 0){let i=(n=t.localRefs)===null||n===void 0?void 0:n[r],{schemaId:a}=this.opts;i&&(s=new pn({schema:i,schemaId:a,root:t,baseId:e}))}if(s!==void 0)return t.refs[r]=c0.call(this,s)}it.resolveRef=a0;function c0(t){return(0,ht.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:cl.call(this,t)}function xh(t){for(let e of this._compilations)if(u0(e,t))return e}it.getCompilingSchema=xh;function u0(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function l0(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||Js.call(this,t,e)}function Js(t,e){let r=this.opts.uriResolver.parse(e),n=(0,ht._getFullPath)(this.opts.uriResolver,r),o=(0,ht.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===o)return al.call(this,r,t);let s=(0,ht.normalizeId)(n),i=this.refs[s]||this.schemas[s];if(typeof i=="string"){let a=Js.call(this,t,i);return typeof a?.schema!="object"?void 0:al.call(this,r,a)}if(typeof i?.schema=="object"){if(i.validate||cl.call(this,i),s===(0,ht.normalizeId)(e)){let{schema:a}=i,{schemaId:c}=this.opts,u=a[c];return u&&(o=(0,ht.resolveUrl)(this.opts.uriResolver,o,u)),new pn({schema:a,schemaId:c,root:t,baseId:o})}return al.call(this,r,i)}}it.resolveSchema=Js;var d0=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function al(t,{baseId:e,schema:r,root:n}){var o;if(((o=t.fragment)===null||o===void 0?void 0:o[0])!=="/")return;for(let a of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let c=r[(0,vh.unescapeFragment)(a)];if(c===void 0)return;r=c;let u=typeof r=="object"&&r[this.opts.schemaId];!d0.has(a)&&u&&(e=(0,ht.resolveUrl)(this.opts.uriResolver,e,u))}let s;if(typeof r!="boolean"&&r.$ref&&!(0,vh.schemaHasRulesButRef)(r,this.RULES)){let a=(0,ht.resolveUrl)(this.opts.uriResolver,e,r.$ref);s=Js.call(this,n,a)}let{schemaId:i}=this.opts;if(s=s||new pn({schema:r,schemaId:i,root:n,baseId:e}),s.schema!==s.root.schema)return s}});var bh=P((yO,p0)=>{p0.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var ll=P((_O,Sh)=>{"use strict";var f0=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),wh=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function ul(t){let e="",r=0,n=0;for(n=0;n<t.length;n++)if(r=t[n].charCodeAt(0),r!==48){if(!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n];break}for(n+=1;n<t.length;n++){if(r=t[n].charCodeAt(0),!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n]}return e}var m0=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function $h(t){return t.length=0,!0}function h0(t,e,r){if(t.length){let n=ul(t);if(n!=="")e.push(n);else return r.error=!0,!1;t.length=0}return!0}function g0(t){let e=0,r={error:!1,address:"",zone:""},n=[],o=[],s=!1,i=!1,a=h0;for(let c=0;c<t.length;c++){let u=t[c];if(!(u==="["||u==="]"))if(u===":"){if(s===!0&&(i=!0),!a(o,n,r))break;if(++e>7){r.error=!0;break}c>0&&t[c-1]===":"&&(s=!0),n.push(":");continue}else if(u==="%"){if(!a(o,n,r))break;a=$h}else{o.push(u);continue}}return o.length&&(a===$h?r.zone=o.join(""):i?n.push(o.join("")):n.push(ul(o))),r.address=n.join(""),r}function kh(t){if(y0(t,":")<2)return{host:t,isIPV6:!1};let e=g0(t);if(e.error)return{host:t,isIPV6:!1};{let r=e.address,n=e.address;return e.zone&&(r+="%"+e.zone,n+="%25"+e.zone),{host:r,isIPV6:!0,escapedHost:n}}}function y0(t,e){let r=0;for(let n=0;n<t.length;n++)t[n]===e&&r++;return r}function _0(t){let e=t,r=[],n=-1,o=0;for(;o=e.length;){if(o===1){if(e===".")break;if(e==="/"){r.push("/");break}else{r.push(e);break}}else if(o===2){if(e[0]==="."){if(e[1]===".")break;if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&(e[1]==="."||e[1]==="/")){r.push("/");break}}else if(o===3&&e==="/.."){r.length!==0&&r.pop(),r.push("/");break}if(e[0]==="."){if(e[1]==="."){if(e[2]==="/"){e=e.slice(3);continue}}else if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&e[1]==="."){if(e[2]==="/"){e=e.slice(2);continue}else if(e[2]==="."&&e[3]==="/"){e=e.slice(3),r.length!==0&&r.pop();continue}}if((n=e.indexOf("/",1))===-1){r.push(e);break}else r.push(e.slice(0,n)),e=e.slice(n)}return r.join("")}function v0(t,e){let r=e!==!0?escape:unescape;return t.scheme!==void 0&&(t.scheme=r(t.scheme)),t.userinfo!==void 0&&(t.userinfo=r(t.userinfo)),t.host!==void 0&&(t.host=r(t.host)),t.path!==void 0&&(t.path=r(t.path)),t.query!==void 0&&(t.query=r(t.query)),t.fragment!==void 0&&(t.fragment=r(t.fragment)),t}function x0(t){let e=[];if(t.userinfo!==void 0&&(e.push(t.userinfo),e.push("@")),t.host!==void 0){let r=unescape(t.host);if(!wh(r)){let n=kh(r);n.isIPV6===!0?r=`[${n.escapedHost}]`:r=t.host}e.push(r)}return(typeof t.port=="number"||typeof t.port=="string")&&(e.push(":"),e.push(String(t.port))),e.length?e.join(""):void 0}Sh.exports={nonSimpleDomain:m0,recomposeAuthority:x0,normalizeComponentEncoding:v0,removeDotSegments:_0,isIPv4:wh,isUUID:f0,normalizeIPv6:kh,stringArrayToHexStripped:ul}});var Ih=P((vO,Eh)=>{"use strict";var{isUUID:b0}=ll(),$0=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,w0=["http","https","ws","wss","urn","urn:uuid"];function k0(t){return w0.indexOf(t)!==-1}function dl(t){return t.secure===!0?!0:t.secure===!1?!1:t.scheme?t.scheme.length===3&&(t.scheme[0]==="w"||t.scheme[0]==="W")&&(t.scheme[1]==="s"||t.scheme[1]==="S")&&(t.scheme[2]==="s"||t.scheme[2]==="S"):!1}function Th(t){return t.host||(t.error=t.error||"HTTP URIs must have a host."),t}function Ph(t){let e=String(t.scheme).toLowerCase()==="https";return(t.port===(e?443:80)||t.port==="")&&(t.port=void 0),t.path||(t.path="/"),t}function S0(t){return t.secure=dl(t),t.resourceName=(t.path||"/")+(t.query?"?"+t.query:""),t.path=void 0,t.query=void 0,t}function T0(t){if((t.port===(dl(t)?443:80)||t.port==="")&&(t.port=void 0),typeof t.secure=="boolean"&&(t.scheme=t.secure?"wss":"ws",t.secure=void 0),t.resourceName){let[e,r]=t.resourceName.split("?");t.path=e&&e!=="/"?e:void 0,t.query=r,t.resourceName=void 0}return t.fragment=void 0,t}function P0(t,e){if(!t.path)return t.error="URN can not be parsed",t;let r=t.path.match($0);if(r){let n=e.scheme||t.scheme||"urn";t.nid=r[1].toLowerCase(),t.nss=r[2];let o=`${n}:${e.nid||t.nid}`,s=pl(o);t.path=void 0,s&&(t=s.parse(t,e))}else t.error=t.error||"URN can not be parsed.";return t}function z0(t,e){if(t.nid===void 0)throw new Error("URN without nid cannot be serialized");let r=e.scheme||t.scheme||"urn",n=t.nid.toLowerCase(),o=`${r}:${e.nid||n}`,s=pl(o);s&&(t=s.serialize(t,e));let i=t,a=t.nss;return i.path=`${n||e.nid}:${a}`,e.skipEscape=!0,i}function E0(t,e){let r=t;return r.uuid=r.nss,r.nss=void 0,!e.tolerant&&(!r.uuid||!b0(r.uuid))&&(r.error=r.error||"UUID is not valid."),r}function I0(t){let e=t;return e.nss=(t.uuid||"").toLowerCase(),e}var zh={scheme:"http",domainHost:!0,parse:Th,serialize:Ph},R0={scheme:"https",domainHost:zh.domainHost,parse:Th,serialize:Ph},Xs={scheme:"ws",domainHost:!0,parse:S0,serialize:T0},C0={scheme:"wss",domainHost:Xs.domainHost,parse:Xs.parse,serialize:Xs.serialize},j0={scheme:"urn",parse:P0,serialize:z0,skipNormalize:!0},O0={scheme:"urn:uuid",parse:E0,serialize:I0,skipNormalize:!0},Ys={http:zh,https:R0,ws:Xs,wss:C0,urn:j0,"urn:uuid":O0};Object.setPrototypeOf(Ys,null);function pl(t){return t&&(Ys[t]||Ys[t.toLowerCase()])||void 0}Eh.exports={wsIsSecure:dl,SCHEMES:Ys,isValidSchemeName:k0,getSchemeHandler:pl}});var jh=P((xO,ei)=>{"use strict";var{normalizeIPv6:A0,removeDotSegments:go,recomposeAuthority:N0,normalizeComponentEncoding:Qs,isIPv4:M0,nonSimpleDomain:Z0}=ll(),{SCHEMES:D0,getSchemeHandler:Rh}=Ih();function q0(t,e){return typeof t=="string"?t=kt(Zt(t,e),e):typeof t=="object"&&(t=Zt(kt(t,e),e)),t}function L0(t,e,r){let n=r?Object.assign({scheme:"null"},r):{scheme:"null"},o=Ch(Zt(t,n),Zt(e,n),n,!0);return n.skipEscape=!0,kt(o,n)}function Ch(t,e,r,n){let o={};return n||(t=Zt(kt(t,r),r),e=Zt(kt(e,r),r)),r=r||{},!r.tolerant&&e.scheme?(o.scheme=e.scheme,o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=go(e.path||""),o.query=e.query):(e.userinfo!==void 0||e.host!==void 0||e.port!==void 0?(o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=go(e.path||""),o.query=e.query):(e.path?(e.path[0]==="/"?o.path=go(e.path):((t.userinfo!==void 0||t.host!==void 0||t.port!==void 0)&&!t.path?o.path="/"+e.path:t.path?o.path=t.path.slice(0,t.path.lastIndexOf("/")+1)+e.path:o.path=e.path,o.path=go(o.path)),o.query=e.query):(o.path=t.path,e.query!==void 0?o.query=e.query:o.query=t.query),o.userinfo=t.userinfo,o.host=t.host,o.port=t.port),o.scheme=t.scheme),o.fragment=e.fragment,o}function U0(t,e,r){return typeof t=="string"?(t=unescape(t),t=kt(Qs(Zt(t,r),!0),{...r,skipEscape:!0})):typeof t=="object"&&(t=kt(Qs(t,!0),{...r,skipEscape:!0})),typeof e=="string"?(e=unescape(e),e=kt(Qs(Zt(e,r),!0),{...r,skipEscape:!0})):typeof e=="object"&&(e=kt(Qs(e,!0),{...r,skipEscape:!0})),t.toLowerCase()===e.toLowerCase()}function kt(t,e){let r={host:t.host,scheme:t.scheme,userinfo:t.userinfo,port:t.port,path:t.path,query:t.query,nid:t.nid,nss:t.nss,uuid:t.uuid,fragment:t.fragment,reference:t.reference,resourceName:t.resourceName,secure:t.secure,error:""},n=Object.assign({},e),o=[],s=Rh(n.scheme||r.scheme);s&&s.serialize&&s.serialize(r,n),r.path!==void 0&&(n.skipEscape?r.path=unescape(r.path):(r.path=escape(r.path),r.scheme!==void 0&&(r.path=r.path.split("%3A").join(":")))),n.reference!=="suffix"&&r.scheme&&o.push(r.scheme,":");let i=N0(r);if(i!==void 0&&(n.reference!=="suffix"&&o.push("//"),o.push(i),r.path&&r.path[0]!=="/"&&o.push("/")),r.path!==void 0){let a=r.path;!n.absolutePath&&(!s||!s.absolutePath)&&(a=go(a)),i===void 0&&a[0]==="/"&&a[1]==="/"&&(a="/%2F"+a.slice(2)),o.push(a)}return r.query!==void 0&&o.push("?",r.query),r.fragment!==void 0&&o.push("#",r.fragment),o.join("")}var F0=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function Zt(t,e){let r=Object.assign({},e),n={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},o=!1;r.reference==="suffix"&&(r.scheme?t=r.scheme+":"+t:t="//"+t);let s=t.match(F0);if(s){if(n.scheme=s[1],n.userinfo=s[3],n.host=s[4],n.port=parseInt(s[5],10),n.path=s[6]||"",n.query=s[7],n.fragment=s[8],isNaN(n.port)&&(n.port=s[5]),n.host)if(M0(n.host)===!1){let c=A0(n.host);n.host=c.host.toLowerCase(),o=c.isIPV6}else o=!0;n.scheme===void 0&&n.userinfo===void 0&&n.host===void 0&&n.port===void 0&&n.query===void 0&&!n.path?n.reference="same-document":n.scheme===void 0?n.reference="relative":n.fragment===void 0?n.reference="absolute":n.reference="uri",r.reference&&r.reference!=="suffix"&&r.reference!==n.reference&&(n.error=n.error||"URI is not a "+r.reference+" reference.");let i=Rh(r.scheme||n.scheme);if(!r.unicodeSupport&&(!i||!i.unicodeSupport)&&n.host&&(r.domainHost||i&&i.domainHost)&&o===!1&&Z0(n.host))try{n.host=URL.domainToASCII(n.host.toLowerCase())}catch(a){n.error=n.error||"Host's domain name can not be converted to ASCII: "+a}(!i||i&&!i.skipNormalize)&&(t.indexOf("%")!==-1&&(n.scheme!==void 0&&(n.scheme=unescape(n.scheme)),n.host!==void 0&&(n.host=unescape(n.host))),n.path&&(n.path=escape(unescape(n.path))),n.fragment&&(n.fragment=encodeURI(decodeURIComponent(n.fragment)))),i&&i.parse&&i.parse(n,r)}else n.error=n.error||"URI can not be parsed.";return n}var fl={SCHEMES:D0,normalize:q0,resolve:L0,resolveComponent:Ch,equal:U0,serialize:kt,parse:Zt};ei.exports=fl;ei.exports.default=fl;ei.exports.fastUri=fl});var Ah=P(ml=>{"use strict";Object.defineProperty(ml,"__esModule",{value:!0});var Oh=jh();Oh.code='require("ajv/dist/runtime/uri").default';ml.default=Oh});var Fh=P(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Ee.CodeGen=Ee.Name=Ee.nil=Ee.stringify=Ee.str=Ee._=Ee.KeywordCxt=void 0;var V0=mo();Object.defineProperty(Ee,"KeywordCxt",{enumerable:!0,get:function(){return V0.KeywordCxt}});var fn=V();Object.defineProperty(Ee,"_",{enumerable:!0,get:function(){return fn._}});Object.defineProperty(Ee,"str",{enumerable:!0,get:function(){return fn.str}});Object.defineProperty(Ee,"stringify",{enumerable:!0,get:function(){return fn.stringify}});Object.defineProperty(Ee,"nil",{enumerable:!0,get:function(){return fn.nil}});Object.defineProperty(Ee,"Name",{enumerable:!0,get:function(){return fn.Name}});Object.defineProperty(Ee,"CodeGen",{enumerable:!0,get:function(){return fn.CodeGen}});var K0=Gs(),qh=ho(),H0=Fu(),yo=Ws(),B0=V(),_o=lo(),ti=uo(),gl=ee(),Nh=bh(),G0=Ah(),Lh=(t,e)=>new RegExp(t,e);Lh.code="new RegExp";var J0=["removeAdditional","useDefaults","coerceTypes"],W0=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),X0={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},Y0={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},Mh=200;function Q0(t){var e,r,n,o,s,i,a,c,u,l,d,f,m,p,h,g,_,x,b,S,I,Z,ve,Ye,te;let zt=t.strict,Mi=(e=t.code)===null||e===void 0?void 0:e.optimize,Td=Mi===!0||Mi===void 0?1:Mi||0,Pd=(n=(r=t.code)===null||r===void 0?void 0:r.regExp)!==null&&n!==void 0?n:Lh,Jy=(o=t.uriResolver)!==null&&o!==void 0?o:G0.default;return{strictSchema:(i=(s=t.strictSchema)!==null&&s!==void 0?s:zt)!==null&&i!==void 0?i:!0,strictNumbers:(c=(a=t.strictNumbers)!==null&&a!==void 0?a:zt)!==null&&c!==void 0?c:!0,strictTypes:(l=(u=t.strictTypes)!==null&&u!==void 0?u:zt)!==null&&l!==void 0?l:"log",strictTuples:(f=(d=t.strictTuples)!==null&&d!==void 0?d:zt)!==null&&f!==void 0?f:"log",strictRequired:(p=(m=t.strictRequired)!==null&&m!==void 0?m:zt)!==null&&p!==void 0?p:!1,code:t.code?{...t.code,optimize:Td,regExp:Pd}:{optimize:Td,regExp:Pd},loopRequired:(h=t.loopRequired)!==null&&h!==void 0?h:Mh,loopEnum:(g=t.loopEnum)!==null&&g!==void 0?g:Mh,meta:(_=t.meta)!==null&&_!==void 0?_:!0,messages:(x=t.messages)!==null&&x!==void 0?x:!0,inlineRefs:(b=t.inlineRefs)!==null&&b!==void 0?b:!0,schemaId:(S=t.schemaId)!==null&&S!==void 0?S:"$id",addUsedSchema:(I=t.addUsedSchema)!==null&&I!==void 0?I:!0,validateSchema:(Z=t.validateSchema)!==null&&Z!==void 0?Z:!0,validateFormats:(ve=t.validateFormats)!==null&&ve!==void 0?ve:!0,unicodeRegExp:(Ye=t.unicodeRegExp)!==null&&Ye!==void 0?Ye:!0,int32range:(te=t.int32range)!==null&&te!==void 0?te:!0,uriResolver:Jy}}var vo=class{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...Q0(e)};let{es5:r,lines:n}=this.opts.code;this.scope=new B0.ValueScope({scope:{},prefixes:W0,es5:r,lines:n}),this.logger=sS(e.logger);let o=e.validateFormats;e.validateFormats=!1,this.RULES=(0,H0.getRules)(),Zh.call(this,X0,e,"NOT SUPPORTED"),Zh.call(this,Y0,e,"DEPRECATED","warn"),this._metaOpts=nS.call(this),e.formats&&tS.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&rS.call(this,e.keywords),typeof e.meta=="object"&&this.addMetaSchema(e.meta),eS.call(this),e.validateFormats=o}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:e,meta:r,schemaId:n}=this.opts,o=Nh;n==="id"&&(o={...Nh},o.id=o.$id,delete o.$id),r&&e&&this.addMetaSchema(o,o[n],!1)}defaultMeta(){let{meta:e,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof e=="object"?e[r]||e:void 0}validate(e,r){let n;if(typeof e=="string"){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);let o=n(r);return"$async"in n||(this.errors=n.errors),o}compile(e,r){let n=this._addSchema(e,r);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:n}=this.opts;return o.call(this,e,r);async function o(l,d){await s.call(this,l.$schema);let f=this._addSchema(l,d);return f.validate||i.call(this,f)}async function s(l){l&&!this.getSchema(l)&&await o.call(this,{$ref:l},!0)}async function i(l){try{return this._compileSchemaEnv(l)}catch(d){if(!(d instanceof qh.default))throw d;return a.call(this,d),await c.call(this,d.missingSchema),i.call(this,l)}}function a({missingSchema:l,missingRef:d}){if(this.refs[l])throw new Error(`AnySchema ${l} is loaded but ${d} cannot be resolved`)}async function c(l){let d=await u.call(this,l);this.refs[l]||await s.call(this,d.$schema),this.refs[l]||this.addSchema(d,l,r)}async function u(l){let d=this._loading[l];if(d)return d;try{return await(this._loading[l]=n(l))}finally{delete this._loading[l]}}}addSchema(e,r,n,o=this.opts.validateSchema){if(Array.isArray(e)){for(let i of e)this.addSchema(i,void 0,n,o);return this}let s;if(typeof e=="object"){let{schemaId:i}=this.opts;if(s=e[i],s!==void 0&&typeof s!="string")throw new Error(`schema ${i} must be string`)}return r=(0,_o.normalizeId)(r||s),this._checkUnique(r),this.schemas[r]=this._addSchema(e,n,r,o,!0),this}addMetaSchema(e,r,n=this.opts.validateSchema){return this.addSchema(e,r,!0,n),this}validateSchema(e,r){if(typeof e=="boolean")return!0;let n;if(n=e.$schema,n!==void 0&&typeof n!="string")throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let o=this.validate(n,e);if(!o&&r){let s="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(s);else throw new Error(s)}return o}getSchema(e){let r;for(;typeof(r=Dh.call(this,e))=="string";)e=r;if(r===void 0){let{schemaId:n}=this.opts,o=new yo.SchemaEnv({schema:{},schemaId:n});if(r=yo.resolveSchema.call(this,o,e),!r)return;this.refs[e]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=Dh.call(this,e);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{let r=e;this._cache.delete(r);let n=e[this.opts.schemaId];return n&&(n=(0,_o.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(let r of e)this.addKeyword(r);return this}addKeyword(e,r){let n;if(typeof e=="string")n=e,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=n);else if(typeof e=="object"&&r===void 0){if(r=e,n=r.keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(aS.call(this,n,r),!r)return(0,gl.eachItem)(n,s=>hl.call(this,s)),this;uS.call(this,r);let o={...r,type:(0,ti.getJSONTypes)(r.type),schemaType:(0,ti.getJSONTypes)(r.schemaType)};return(0,gl.eachItem)(n,o.type.length===0?s=>hl.call(this,s,o):s=>o.type.forEach(i=>hl.call(this,s,o,i))),this}getKeyword(e){let r=this.RULES.all[e];return typeof r=="object"?r.definition:!!r}removeKeyword(e){let{RULES:r}=this;delete r.keywords[e],delete r.all[e];for(let n of r.rules){let o=n.rules.findIndex(s=>s.keyword===e);o>=0&&n.rules.splice(o,1)}return this}addFormat(e,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[e]=r,this}errorsText(e=this.errors,{separator:r=", ",dataVar:n="data"}={}){return!e||e.length===0?"No errors":e.map(o=>`${n}${o.instancePath} ${o.message}`).reduce((o,s)=>o+r+s)}$dataMetaSchema(e,r){let n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(let o of r){let s=o.split("/").slice(1),i=e;for(let a of s)i=i[a];for(let a in n){let c=n[a];if(typeof c!="object")continue;let{$data:u}=c.definition,l=i[a];u&&l&&(i[a]=Uh(l))}}return e}_removeAllSchemas(e,r){for(let n in e){let o=e[n];(!r||r.test(n))&&(typeof o=="string"?delete e[n]:o&&!o.meta&&(this._cache.delete(o.schema),delete e[n]))}}_addSchema(e,r,n,o=this.opts.validateSchema,s=this.opts.addUsedSchema){let i,{schemaId:a}=this.opts;if(typeof e=="object")i=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof e!="boolean")throw new Error("schema must be object or boolean")}let c=this._cache.get(e);if(c!==void 0)return c;n=(0,_o.normalizeId)(i||n);let u=_o.getSchemaRefs.call(this,e,n);return c=new yo.SchemaEnv({schema:e,schemaId:a,meta:r,baseId:n,localRefs:u}),this._cache.set(c.schema,c),s&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=c),o&&this.validateSchema(e,!0),c}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):yo.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){let r=this.opts;this.opts=this._metaOpts;try{yo.compileSchema.call(this,e)}finally{this.opts=r}}};vo.ValidationError=K0.default;vo.MissingRefError=qh.default;Ee.default=vo;function Zh(t,e,r,n="error"){for(let o in t){let s=o;s in e&&this.logger[n](`${r}: option ${o}. ${t[s]}`)}}function Dh(t){return t=(0,_o.normalizeId)(t),this.schemas[t]||this.refs[t]}function eS(){let t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(let e in t)this.addSchema(t[e],e)}function tS(){for(let t in this.opts.formats){let e=this.opts.formats[t];e&&this.addFormat(t,e)}}function rS(t){if(Array.isArray(t)){this.addVocabulary(t);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let e in t){let r=t[e];r.keyword||(r.keyword=e),this.addKeyword(r)}}function nS(){let t={...this.opts};for(let e of J0)delete t[e];return t}var oS={log(){},warn(){},error(){}};function sS(t){if(t===!1)return oS;if(t===void 0)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}var iS=/^[a-z_$][a-z0-9_$:-]*$/i;function aS(t,e){let{RULES:r}=this;if((0,gl.eachItem)(t,n=>{if(r.keywords[n])throw new Error(`Keyword ${n} is already defined`);if(!iS.test(n))throw new Error(`Keyword ${n} has invalid name`)}),!!e&&e.$data&&!("code"in e||"validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function hl(t,e,r){var n;let o=e?.post;if(r&&o)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:s}=this,i=o?s.post:s.rules.find(({type:c})=>c===r);if(i||(i={type:r,rules:[]},s.rules.push(i)),s.keywords[t]=!0,!e)return;let a={keyword:t,definition:{...e,type:(0,ti.getJSONTypes)(e.type),schemaType:(0,ti.getJSONTypes)(e.schemaType)}};e.before?cS.call(this,i,a,e.before):i.rules.push(a),s.all[t]=a,(n=e.implements)===null||n===void 0||n.forEach(c=>this.addKeyword(c))}function cS(t,e,r){let n=t.rules.findIndex(o=>o.keyword===r);n>=0?t.rules.splice(n,0,e):(t.rules.push(e),this.logger.warn(`rule ${r} is not defined`))}function uS(t){let{metaSchema:e}=t;e!==void 0&&(t.$data&&this.opts.$data&&(e=Uh(e)),t.validateSchema=this.compile(e,!0))}var lS={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function Uh(t){return{anyOf:[t,lS]}}});var Vh=P(yl=>{"use strict";Object.defineProperty(yl,"__esModule",{value:!0});var dS={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};yl.default=dS});var Gh=P(Mr=>{"use strict";Object.defineProperty(Mr,"__esModule",{value:!0});Mr.callRef=Mr.getValidate=void 0;var pS=ho(),Kh=st(),Ge=V(),mn=Nt(),Hh=Ws(),ri=ee(),fS={keyword:"$ref",schemaType:"string",code(t){let{gen:e,schema:r,it:n}=t,{baseId:o,schemaEnv:s,validateName:i,opts:a,self:c}=n,{root:u}=s;if((r==="#"||r==="#/")&&o===u.baseId)return d();let l=Hh.resolveRef.call(c,u,o,r);if(l===void 0)throw new pS.default(n.opts.uriResolver,o,r);if(l instanceof Hh.SchemaEnv)return f(l);return m(l);function d(){if(s===u)return ni(t,i,s,s.$async);let p=e.scopeValue("root",{ref:u});return ni(t,(0,Ge._)`${p}.validate`,u,u.$async)}function f(p){let h=Bh(t,p);ni(t,h,p,p.$async)}function m(p){let h=e.scopeValue("schema",a.code.source===!0?{ref:p,code:(0,Ge.stringify)(p)}:{ref:p}),g=e.name("valid"),_=t.subschema({schema:p,dataTypes:[],schemaPath:Ge.nil,topSchemaRef:h,errSchemaPath:r},g);t.mergeEvaluated(_),t.ok(g)}}};function Bh(t,e){let{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,Ge._)`${r.scopeValue("wrapper",{ref:e})}.validate`}Mr.getValidate=Bh;function ni(t,e,r,n){let{gen:o,it:s}=t,{allErrors:i,schemaEnv:a,opts:c}=s,u=c.passContext?mn.default.this:Ge.nil;n?l():d();function l(){if(!a.$async)throw new Error("async schema referenced by sync schema");let p=o.let("valid");o.try(()=>{o.code((0,Ge._)`await ${(0,Kh.callValidateCode)(t,e,u)}`),m(e),i||o.assign(p,!0)},h=>{o.if((0,Ge._)`!(${h} instanceof ${s.ValidationError})`,()=>o.throw(h)),f(h),i||o.assign(p,!1)}),t.ok(p)}function d(){t.result((0,Kh.callValidateCode)(t,e,u),()=>m(e),()=>f(e))}function f(p){let h=(0,Ge._)`${p}.errors`;o.assign(mn.default.vErrors,(0,Ge._)`${mn.default.vErrors} === null ? ${h} : ${mn.default.vErrors}.concat(${h})`),o.assign(mn.default.errors,(0,Ge._)`${mn.default.vErrors}.length`)}function m(p){var h;if(!s.opts.unevaluated)return;let g=(h=r?.validate)===null||h===void 0?void 0:h.evaluated;if(s.props!==!0)if(g&&!g.dynamicProps)g.props!==void 0&&(s.props=ri.mergeEvaluated.props(o,g.props,s.props));else{let _=o.var("props",(0,Ge._)`${p}.evaluated.props`);s.props=ri.mergeEvaluated.props(o,_,s.props,Ge.Name)}if(s.items!==!0)if(g&&!g.dynamicItems)g.items!==void 0&&(s.items=ri.mergeEvaluated.items(o,g.items,s.items));else{let _=o.var("items",(0,Ge._)`${p}.evaluated.items`);s.items=ri.mergeEvaluated.items(o,_,s.items,Ge.Name)}}}Mr.callRef=ni;Mr.default=fS});var Jh=P(_l=>{"use strict";Object.defineProperty(_l,"__esModule",{value:!0});var mS=Vh(),hS=Gh(),gS=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",mS.default,hS.default];_l.default=gS});var Wh=P(vl=>{"use strict";Object.defineProperty(vl,"__esModule",{value:!0});var oi=V(),or=oi.operators,si={maximum:{okStr:"<=",ok:or.LTE,fail:or.GT},minimum:{okStr:">=",ok:or.GTE,fail:or.LT},exclusiveMaximum:{okStr:"<",ok:or.LT,fail:or.GTE},exclusiveMinimum:{okStr:">",ok:or.GT,fail:or.LTE}},yS={message:({keyword:t,schemaCode:e})=>(0,oi.str)`must be ${si[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,oi._)`{comparison: ${si[t].okStr}, limit: ${e}}`},_S={keyword:Object.keys(si),type:"number",schemaType:"number",$data:!0,error:yS,code(t){let{keyword:e,data:r,schemaCode:n}=t;t.fail$data((0,oi._)`${r} ${si[e].fail} ${n} || isNaN(${r})`)}};vl.default=_S});var Xh=P(xl=>{"use strict";Object.defineProperty(xl,"__esModule",{value:!0});var xo=V(),vS={message:({schemaCode:t})=>(0,xo.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,xo._)`{multipleOf: ${t}}`},xS={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:vS,code(t){let{gen:e,data:r,schemaCode:n,it:o}=t,s=o.opts.multipleOfPrecision,i=e.let("res"),a=s?(0,xo._)`Math.abs(Math.round(${i}) - ${i}) > 1e-${s}`:(0,xo._)`${i} !== parseInt(${i})`;t.fail$data((0,xo._)`(${n} === 0 || (${i} = ${r}/${n}, ${a}))`)}};xl.default=xS});var Qh=P(bl=>{"use strict";Object.defineProperty(bl,"__esModule",{value:!0});function Yh(t){let e=t.length,r=0,n=0,o;for(;n<e;)r++,o=t.charCodeAt(n++),o>=55296&&o<=56319&&n<e&&(o=t.charCodeAt(n),(o&64512)===56320&&n++);return r}bl.default=Yh;Yh.code='require("ajv/dist/runtime/ucs2length").default'});var eg=P($l=>{"use strict";Object.defineProperty($l,"__esModule",{value:!0});var Zr=V(),bS=ee(),$S=Qh(),wS={message({keyword:t,schemaCode:e}){let r=t==="maxLength"?"more":"fewer";return(0,Zr.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,Zr._)`{limit: ${t}}`},kS={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:wS,code(t){let{keyword:e,data:r,schemaCode:n,it:o}=t,s=e==="maxLength"?Zr.operators.GT:Zr.operators.LT,i=o.opts.unicode===!1?(0,Zr._)`${r}.length`:(0,Zr._)`${(0,bS.useFunc)(t.gen,$S.default)}(${r})`;t.fail$data((0,Zr._)`${i} ${s} ${n}`)}};$l.default=kS});var tg=P(wl=>{"use strict";Object.defineProperty(wl,"__esModule",{value:!0});var SS=st(),ii=V(),TS={message:({schemaCode:t})=>(0,ii.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,ii._)`{pattern: ${t}}`},PS={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:TS,code(t){let{data:e,$data:r,schema:n,schemaCode:o,it:s}=t,i=s.opts.unicodeRegExp?"u":"",a=r?(0,ii._)`(new RegExp(${o}, ${i}))`:(0,SS.usePattern)(t,n);t.fail$data((0,ii._)`!${a}.test(${e})`)}};wl.default=PS});var rg=P(kl=>{"use strict";Object.defineProperty(kl,"__esModule",{value:!0});var bo=V(),zS={message({keyword:t,schemaCode:e}){let r=t==="maxProperties"?"more":"fewer";return(0,bo.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,bo._)`{limit: ${t}}`},ES={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:zS,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxProperties"?bo.operators.GT:bo.operators.LT;t.fail$data((0,bo._)`Object.keys(${r}).length ${o} ${n}`)}};kl.default=ES});var ng=P(Sl=>{"use strict";Object.defineProperty(Sl,"__esModule",{value:!0});var $o=st(),wo=V(),IS=ee(),RS={message:({params:{missingProperty:t}})=>(0,wo.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,wo._)`{missingProperty: ${t}}`},CS={keyword:"required",type:"object",schemaType:"array",$data:!0,error:RS,code(t){let{gen:e,schema:r,schemaCode:n,data:o,$data:s,it:i}=t,{opts:a}=i;if(!s&&r.length===0)return;let c=r.length>=a.loopRequired;if(i.allErrors?u():l(),a.strictRequired){let m=t.parentSchema.properties,{definedProperties:p}=t.it;for(let h of r)if(m?.[h]===void 0&&!p.has(h)){let g=i.schemaEnv.baseId+i.errSchemaPath,_=`required property "${h}" is not defined at "${g}" (strictRequired)`;(0,IS.checkStrictMode)(i,_,i.opts.strictRequired)}}function u(){if(c||s)t.block$data(wo.nil,d);else for(let m of r)(0,$o.checkReportMissingProp)(t,m)}function l(){let m=e.let("missing");if(c||s){let p=e.let("valid",!0);t.block$data(p,()=>f(m,p)),t.ok(p)}else e.if((0,$o.checkMissingProp)(t,r,m)),(0,$o.reportMissingProp)(t,m),e.else()}function d(){e.forOf("prop",n,m=>{t.setParams({missingProperty:m}),e.if((0,$o.noPropertyInData)(e,o,m,a.ownProperties),()=>t.error())})}function f(m,p){t.setParams({missingProperty:m}),e.forOf(m,n,()=>{e.assign(p,(0,$o.propertyInData)(e,o,m,a.ownProperties)),e.if((0,wo.not)(p),()=>{t.error(),e.break()})},wo.nil)}}};Sl.default=CS});var og=P(Tl=>{"use strict";Object.defineProperty(Tl,"__esModule",{value:!0});var ko=V(),jS={message({keyword:t,schemaCode:e}){let r=t==="maxItems"?"more":"fewer";return(0,ko.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,ko._)`{limit: ${t}}`},OS={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:jS,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxItems"?ko.operators.GT:ko.operators.LT;t.fail$data((0,ko._)`${r}.length ${o} ${n}`)}};Tl.default=OS});var ai=P(Pl=>{"use strict";Object.defineProperty(Pl,"__esModule",{value:!0});var sg=Xu();sg.code='require("ajv/dist/runtime/equal").default';Pl.default=sg});var ig=P(El=>{"use strict";Object.defineProperty(El,"__esModule",{value:!0});var zl=uo(),Ie=V(),AS=ee(),NS=ai(),MS={message:({params:{i:t,j:e}})=>(0,Ie.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,Ie._)`{i: ${t}, j: ${e}}`},ZS={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:MS,code(t){let{gen:e,data:r,$data:n,schema:o,parentSchema:s,schemaCode:i,it:a}=t;if(!n&&!o)return;let c=e.let("valid"),u=s.items?(0,zl.getSchemaTypes)(s.items):[];t.block$data(c,l,(0,Ie._)`${i} === false`),t.ok(c);function l(){let p=e.let("i",(0,Ie._)`${r}.length`),h=e.let("j");t.setParams({i:p,j:h}),e.assign(c,!0),e.if((0,Ie._)`${p} > 1`,()=>(d()?f:m)(p,h))}function d(){return u.length>0&&!u.some(p=>p==="object"||p==="array")}function f(p,h){let g=e.name("item"),_=(0,zl.checkDataTypes)(u,g,a.opts.strictNumbers,zl.DataType.Wrong),x=e.const("indices",(0,Ie._)`{}`);e.for((0,Ie._)`;${p}--;`,()=>{e.let(g,(0,Ie._)`${r}[${p}]`),e.if(_,(0,Ie._)`continue`),u.length>1&&e.if((0,Ie._)`typeof ${g} == "string"`,(0,Ie._)`${g} += "_"`),e.if((0,Ie._)`typeof ${x}[${g}] == "number"`,()=>{e.assign(h,(0,Ie._)`${x}[${g}]`),t.error(),e.assign(c,!1).break()}).code((0,Ie._)`${x}[${g}] = ${p}`)})}function m(p,h){let g=(0,AS.useFunc)(e,NS.default),_=e.name("outer");e.label(_).for((0,Ie._)`;${p}--;`,()=>e.for((0,Ie._)`${h} = ${p}; ${h}--;`,()=>e.if((0,Ie._)`${g}(${r}[${p}], ${r}[${h}])`,()=>{t.error(),e.assign(c,!1).break(_)})))}}};El.default=ZS});var ag=P(Rl=>{"use strict";Object.defineProperty(Rl,"__esModule",{value:!0});var Il=V(),DS=ee(),qS=ai(),LS={message:"must be equal to constant",params:({schemaCode:t})=>(0,Il._)`{allowedValue: ${t}}`},US={keyword:"const",$data:!0,error:LS,code(t){let{gen:e,data:r,$data:n,schemaCode:o,schema:s}=t;n||s&&typeof s=="object"?t.fail$data((0,Il._)`!${(0,DS.useFunc)(e,qS.default)}(${r}, ${o})`):t.fail((0,Il._)`${s} !== ${r}`)}};Rl.default=US});var cg=P(Cl=>{"use strict";Object.defineProperty(Cl,"__esModule",{value:!0});var So=V(),FS=ee(),VS=ai(),KS={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,So._)`{allowedValues: ${t}}`},HS={keyword:"enum",schemaType:"array",$data:!0,error:KS,code(t){let{gen:e,data:r,$data:n,schema:o,schemaCode:s,it:i}=t;if(!n&&o.length===0)throw new Error("enum must have non-empty array");let a=o.length>=i.opts.loopEnum,c,u=()=>c??(c=(0,FS.useFunc)(e,VS.default)),l;if(a||n)l=e.let("valid"),t.block$data(l,d);else{if(!Array.isArray(o))throw new Error("ajv implementation error");let m=e.const("vSchema",s);l=(0,So.or)(...o.map((p,h)=>f(m,h)))}t.pass(l);function d(){e.assign(l,!1),e.forOf("v",s,m=>e.if((0,So._)`${u()}(${r}, ${m})`,()=>e.assign(l,!0).break()))}function f(m,p){let h=o[p];return typeof h=="object"&&h!==null?(0,So._)`${u()}(${r}, ${m}[${p}])`:(0,So._)`${r} === ${h}`}}};Cl.default=HS});var ug=P(jl=>{"use strict";Object.defineProperty(jl,"__esModule",{value:!0});var BS=Wh(),GS=Xh(),JS=eg(),WS=tg(),XS=rg(),YS=ng(),QS=og(),eT=ig(),tT=ag(),rT=cg(),nT=[BS.default,GS.default,JS.default,WS.default,XS.default,YS.default,QS.default,eT.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},tT.default,rT.default];jl.default=nT});var Al=P(To=>{"use strict";Object.defineProperty(To,"__esModule",{value:!0});To.validateAdditionalItems=void 0;var Dr=V(),Ol=ee(),oT={message:({params:{len:t}})=>(0,Dr.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,Dr._)`{limit: ${t}}`},sT={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:oT,code(t){let{parentSchema:e,it:r}=t,{items:n}=e;if(!Array.isArray(n)){(0,Ol.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}lg(t,n)}};function lg(t,e){let{gen:r,schema:n,data:o,keyword:s,it:i}=t;i.items=!0;let a=r.const("len",(0,Dr._)`${o}.length`);if(n===!1)t.setParams({len:e.length}),t.pass((0,Dr._)`${a} <= ${e.length}`);else if(typeof n=="object"&&!(0,Ol.alwaysValidSchema)(i,n)){let u=r.var("valid",(0,Dr._)`${a} <= ${e.length}`);r.if((0,Dr.not)(u),()=>c(u)),t.ok(u)}function c(u){r.forRange("i",e.length,a,l=>{t.subschema({keyword:s,dataProp:l,dataPropType:Ol.Type.Num},u),i.allErrors||r.if((0,Dr.not)(u),()=>r.break())})}}To.validateAdditionalItems=lg;To.default=sT});var Nl=P(Po=>{"use strict";Object.defineProperty(Po,"__esModule",{value:!0});Po.validateTuple=void 0;var dg=V(),ci=ee(),iT=st(),aT={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){let{schema:e,it:r}=t;if(Array.isArray(e))return pg(t,"additionalItems",e);r.items=!0,!(0,ci.alwaysValidSchema)(r,e)&&t.ok((0,iT.validateArray)(t))}};function pg(t,e,r=t.schema){let{gen:n,parentSchema:o,data:s,keyword:i,it:a}=t;l(o),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=ci.mergeEvaluated.items(n,r.length,a.items));let c=n.name("valid"),u=n.const("len",(0,dg._)`${s}.length`);r.forEach((d,f)=>{(0,ci.alwaysValidSchema)(a,d)||(n.if((0,dg._)`${u} > ${f}`,()=>t.subschema({keyword:i,schemaProp:f,dataProp:f},c)),t.ok(c))});function l(d){let{opts:f,errSchemaPath:m}=a,p=r.length,h=p===d.minItems&&(p===d.maxItems||d[e]===!1);if(f.strictTuples&&!h){let g=`"${i}" is ${p}-tuple, but minItems or maxItems/${e} are not specified or different at path "${m}"`;(0,ci.checkStrictMode)(a,g,f.strictTuples)}}}Po.validateTuple=pg;Po.default=aT});var fg=P(Ml=>{"use strict";Object.defineProperty(Ml,"__esModule",{value:!0});var cT=Nl(),uT={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,cT.validateTuple)(t,"items")};Ml.default=uT});var hg=P(Zl=>{"use strict";Object.defineProperty(Zl,"__esModule",{value:!0});var mg=V(),lT=ee(),dT=st(),pT=Al(),fT={message:({params:{len:t}})=>(0,mg.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,mg._)`{limit: ${t}}`},mT={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:fT,code(t){let{schema:e,parentSchema:r,it:n}=t,{prefixItems:o}=r;n.items=!0,!(0,lT.alwaysValidSchema)(n,e)&&(o?(0,pT.validateAdditionalItems)(t,o):t.ok((0,dT.validateArray)(t)))}};Zl.default=mT});var gg=P(Dl=>{"use strict";Object.defineProperty(Dl,"__esModule",{value:!0});var at=V(),ui=ee(),hT={message:({params:{min:t,max:e}})=>e===void 0?(0,at.str)`must contain at least ${t} valid item(s)`:(0,at.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,at._)`{minContains: ${t}}`:(0,at._)`{minContains: ${t}, maxContains: ${e}}`},gT={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:hT,code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:s}=t,i,a,{minContains:c,maxContains:u}=n;s.opts.next?(i=c===void 0?1:c,a=u):i=1;let l=e.const("len",(0,at._)`${o}.length`);if(t.setParams({min:i,max:a}),a===void 0&&i===0){(0,ui.checkStrictMode)(s,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&i>a){(0,ui.checkStrictMode)(s,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,ui.alwaysValidSchema)(s,r)){let h=(0,at._)`${l} >= ${i}`;a!==void 0&&(h=(0,at._)`${h} && ${l} <= ${a}`),t.pass(h);return}s.items=!0;let d=e.name("valid");a===void 0&&i===1?m(d,()=>e.if(d,()=>e.break())):i===0?(e.let(d,!0),a!==void 0&&e.if((0,at._)`${o}.length > 0`,f)):(e.let(d,!1),f()),t.result(d,()=>t.reset());function f(){let h=e.name("_valid"),g=e.let("count",0);m(h,()=>e.if(h,()=>p(g)))}function m(h,g){e.forRange("i",0,l,_=>{t.subschema({keyword:"contains",dataProp:_,dataPropType:ui.Type.Num,compositeRule:!0},h),g()})}function p(h){e.code((0,at._)`${h}++`),a===void 0?e.if((0,at._)`${h} >= ${i}`,()=>e.assign(d,!0).break()):(e.if((0,at._)`${h} > ${a}`,()=>e.assign(d,!1).break()),i===1?e.assign(d,!0):e.if((0,at._)`${h} >= ${i}`,()=>e.assign(d,!0)))}}};Dl.default=gT});var vg=P(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.validateSchemaDeps=St.validatePropertyDeps=St.error=void 0;var ql=V(),yT=ee(),zo=st();St.error={message:({params:{property:t,depsCount:e,deps:r}})=>{let n=e===1?"property":"properties";return(0,ql.str)`must have ${n} ${r} when property ${t} is present`},params:({params:{property:t,depsCount:e,deps:r,missingProperty:n}})=>(0,ql._)`{property: ${t},
    missingProperty: ${n},
    depsCount: ${e},
    deps: ${r}}`};var _T={keyword:"dependencies",type:"object",schemaType:"object",error:St.error,code(t){let[e,r]=vT(t);yg(t,e),_g(t,r)}};function vT({schema:t}){let e={},r={};for(let n in t){if(n==="__proto__")continue;let o=Array.isArray(t[n])?e:r;o[n]=t[n]}return[e,r]}function yg(t,e=t.schema){let{gen:r,data:n,it:o}=t;if(Object.keys(e).length===0)return;let s=r.let("missing");for(let i in e){let a=e[i];if(a.length===0)continue;let c=(0,zo.propertyInData)(r,n,i,o.opts.ownProperties);t.setParams({property:i,depsCount:a.length,deps:a.join(", ")}),o.allErrors?r.if(c,()=>{for(let u of a)(0,zo.checkReportMissingProp)(t,u)}):(r.if((0,ql._)`${c} && (${(0,zo.checkMissingProp)(t,a,s)})`),(0,zo.reportMissingProp)(t,s),r.else())}}St.validatePropertyDeps=yg;function _g(t,e=t.schema){let{gen:r,data:n,keyword:o,it:s}=t,i=r.name("valid");for(let a in e)(0,yT.alwaysValidSchema)(s,e[a])||(r.if((0,zo.propertyInData)(r,n,a,s.opts.ownProperties),()=>{let c=t.subschema({keyword:o,schemaProp:a},i);t.mergeValidEvaluated(c,i)},()=>r.var(i,!0)),t.ok(i))}St.validateSchemaDeps=_g;St.default=_T});var bg=P(Ll=>{"use strict";Object.defineProperty(Ll,"__esModule",{value:!0});var xg=V(),xT=ee(),bT={message:"property name must be valid",params:({params:t})=>(0,xg._)`{propertyName: ${t.propertyName}}`},$T={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:bT,code(t){let{gen:e,schema:r,data:n,it:o}=t;if((0,xT.alwaysValidSchema)(o,r))return;let s=e.name("valid");e.forIn("key",n,i=>{t.setParams({propertyName:i}),t.subschema({keyword:"propertyNames",data:i,dataTypes:["string"],propertyName:i,compositeRule:!0},s),e.if((0,xg.not)(s),()=>{t.error(!0),o.allErrors||e.break()})}),t.ok(s)}};Ll.default=$T});var Fl=P(Ul=>{"use strict";Object.defineProperty(Ul,"__esModule",{value:!0});var li=st(),gt=V(),wT=Nt(),di=ee(),kT={message:"must NOT have additional properties",params:({params:t})=>(0,gt._)`{additionalProperty: ${t.additionalProperty}}`},ST={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:kT,code(t){let{gen:e,schema:r,parentSchema:n,data:o,errsCount:s,it:i}=t;if(!s)throw new Error("ajv implementation error");let{allErrors:a,opts:c}=i;if(i.props=!0,c.removeAdditional!=="all"&&(0,di.alwaysValidSchema)(i,r))return;let u=(0,li.allSchemaProperties)(n.properties),l=(0,li.allSchemaProperties)(n.patternProperties);d(),t.ok((0,gt._)`${s} === ${wT.default.errors}`);function d(){e.forIn("key",o,g=>{!u.length&&!l.length?p(g):e.if(f(g),()=>p(g))})}function f(g){let _;if(u.length>8){let x=(0,di.schemaRefOrVal)(i,n.properties,"properties");_=(0,li.isOwnProperty)(e,x,g)}else u.length?_=(0,gt.or)(...u.map(x=>(0,gt._)`${g} === ${x}`)):_=gt.nil;return l.length&&(_=(0,gt.or)(_,...l.map(x=>(0,gt._)`${(0,li.usePattern)(t,x)}.test(${g})`))),(0,gt.not)(_)}function m(g){e.code((0,gt._)`delete ${o}[${g}]`)}function p(g){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){m(g);return}if(r===!1){t.setParams({additionalProperty:g}),t.error(),a||e.break();return}if(typeof r=="object"&&!(0,di.alwaysValidSchema)(i,r)){let _=e.name("valid");c.removeAdditional==="failing"?(h(g,_,!1),e.if((0,gt.not)(_),()=>{t.reset(),m(g)})):(h(g,_),a||e.if((0,gt.not)(_),()=>e.break()))}}function h(g,_,x){let b={keyword:"additionalProperties",dataProp:g,dataPropType:di.Type.Str};x===!1&&Object.assign(b,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(b,_)}}};Ul.default=ST});var kg=P(Kl=>{"use strict";Object.defineProperty(Kl,"__esModule",{value:!0});var TT=mo(),$g=st(),Vl=ee(),wg=Fl(),PT={keyword:"properties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:s}=t;s.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&wg.default.code(new TT.KeywordCxt(s,wg.default,"additionalProperties"));let i=(0,$g.allSchemaProperties)(r);for(let d of i)s.definedProperties.add(d);s.opts.unevaluated&&i.length&&s.props!==!0&&(s.props=Vl.mergeEvaluated.props(e,(0,Vl.toHash)(i),s.props));let a=i.filter(d=>!(0,Vl.alwaysValidSchema)(s,r[d]));if(a.length===0)return;let c=e.name("valid");for(let d of a)u(d)?l(d):(e.if((0,$g.propertyInData)(e,o,d,s.opts.ownProperties)),l(d),s.allErrors||e.else().var(c,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(c);function u(d){return s.opts.useDefaults&&!s.compositeRule&&r[d].default!==void 0}function l(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},c)}}};Kl.default=PT});var zg=P(Hl=>{"use strict";Object.defineProperty(Hl,"__esModule",{value:!0});var Sg=st(),pi=V(),Tg=ee(),Pg=ee(),zT={keyword:"patternProperties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,data:n,parentSchema:o,it:s}=t,{opts:i}=s,a=(0,Sg.allSchemaProperties)(r),c=a.filter(h=>(0,Tg.alwaysValidSchema)(s,r[h]));if(a.length===0||c.length===a.length&&(!s.opts.unevaluated||s.props===!0))return;let u=i.strictSchema&&!i.allowMatchingProperties&&o.properties,l=e.name("valid");s.props!==!0&&!(s.props instanceof pi.Name)&&(s.props=(0,Pg.evaluatedPropsToName)(e,s.props));let{props:d}=s;f();function f(){for(let h of a)u&&m(h),s.allErrors?p(h):(e.var(l,!0),p(h),e.if(l))}function m(h){for(let g in u)new RegExp(h).test(g)&&(0,Tg.checkStrictMode)(s,`property ${g} matches pattern ${h} (use allowMatchingProperties)`)}function p(h){e.forIn("key",n,g=>{e.if((0,pi._)`${(0,Sg.usePattern)(t,h)}.test(${g})`,()=>{let _=c.includes(h);_||t.subschema({keyword:"patternProperties",schemaProp:h,dataProp:g,dataPropType:Pg.Type.Str},l),s.opts.unevaluated&&d!==!0?e.assign((0,pi._)`${d}[${g}]`,!0):!_&&!s.allErrors&&e.if((0,pi.not)(l),()=>e.break())})})}}};Hl.default=zT});var Eg=P(Bl=>{"use strict";Object.defineProperty(Bl,"__esModule",{value:!0});var ET=ee(),IT={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){let{gen:e,schema:r,it:n}=t;if((0,ET.alwaysValidSchema)(n,r)){t.fail();return}let o=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),t.failResult(o,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};Bl.default=IT});var Ig=P(Gl=>{"use strict";Object.defineProperty(Gl,"__esModule",{value:!0});var RT=st(),CT={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:RT.validateUnion,error:{message:"must match a schema in anyOf"}};Gl.default=CT});var Rg=P(Jl=>{"use strict";Object.defineProperty(Jl,"__esModule",{value:!0});var fi=V(),jT=ee(),OT={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,fi._)`{passingSchemas: ${t.passing}}`},AT={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:OT,code(t){let{gen:e,schema:r,parentSchema:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(o.opts.discriminator&&n.discriminator)return;let s=r,i=e.let("valid",!1),a=e.let("passing",null),c=e.name("_valid");t.setParams({passing:a}),e.block(u),t.result(i,()=>t.reset(),()=>t.error(!0));function u(){s.forEach((l,d)=>{let f;(0,jT.alwaysValidSchema)(o,l)?e.var(c,!0):f=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},c),d>0&&e.if((0,fi._)`${c} && ${i}`).assign(i,!1).assign(a,(0,fi._)`[${a}, ${d}]`).else(),e.if(c,()=>{e.assign(i,!0),e.assign(a,d),f&&t.mergeEvaluated(f,fi.Name)})})}}};Jl.default=AT});var Cg=P(Wl=>{"use strict";Object.defineProperty(Wl,"__esModule",{value:!0});var NT=ee(),MT={keyword:"allOf",schemaType:"array",code(t){let{gen:e,schema:r,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");let o=e.name("valid");r.forEach((s,i)=>{if((0,NT.alwaysValidSchema)(n,s))return;let a=t.subschema({keyword:"allOf",schemaProp:i},o);t.ok(o),t.mergeEvaluated(a)})}};Wl.default=MT});var Ag=P(Xl=>{"use strict";Object.defineProperty(Xl,"__esModule",{value:!0});var mi=V(),Og=ee(),ZT={message:({params:t})=>(0,mi.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,mi._)`{failingKeyword: ${t.ifClause}}`},DT={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:ZT,code(t){let{gen:e,parentSchema:r,it:n}=t;r.then===void 0&&r.else===void 0&&(0,Og.checkStrictMode)(n,'"if" without "then" and "else" is ignored');let o=jg(n,"then"),s=jg(n,"else");if(!o&&!s)return;let i=e.let("valid",!0),a=e.name("_valid");if(c(),t.reset(),o&&s){let l=e.let("ifClause");t.setParams({ifClause:l}),e.if(a,u("then",l),u("else",l))}else o?e.if(a,u("then")):e.if((0,mi.not)(a),u("else"));t.pass(i,()=>t.error(!0));function c(){let l=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);t.mergeEvaluated(l)}function u(l,d){return()=>{let f=t.subschema({keyword:l},a);e.assign(i,a),t.mergeValidEvaluated(f,i),d?e.assign(d,(0,mi._)`${l}`):t.setParams({ifClause:l})}}}};function jg(t,e){let r=t.schema[e];return r!==void 0&&!(0,Og.alwaysValidSchema)(t,r)}Xl.default=DT});var Ng=P(Yl=>{"use strict";Object.defineProperty(Yl,"__esModule",{value:!0});var qT=ee(),LT={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,qT.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};Yl.default=LT});var Mg=P(Ql=>{"use strict";Object.defineProperty(Ql,"__esModule",{value:!0});var UT=Al(),FT=fg(),VT=Nl(),KT=hg(),HT=gg(),BT=vg(),GT=bg(),JT=Fl(),WT=kg(),XT=zg(),YT=Eg(),QT=Ig(),eP=Rg(),tP=Cg(),rP=Ag(),nP=Ng();function oP(t=!1){let e=[YT.default,QT.default,eP.default,tP.default,rP.default,nP.default,GT.default,JT.default,BT.default,WT.default,XT.default];return t?e.push(FT.default,KT.default):e.push(UT.default,VT.default),e.push(HT.default),e}Ql.default=oP});var Zg=P(ed=>{"use strict";Object.defineProperty(ed,"__esModule",{value:!0});var xe=V(),sP={message:({schemaCode:t})=>(0,xe.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,xe._)`{format: ${t}}`},iP={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:sP,code(t,e){let{gen:r,data:n,$data:o,schema:s,schemaCode:i,it:a}=t,{opts:c,errSchemaPath:u,schemaEnv:l,self:d}=a;if(!c.validateFormats)return;o?f():m();function f(){let p=r.scopeValue("formats",{ref:d.formats,code:c.code.formats}),h=r.const("fDef",(0,xe._)`${p}[${i}]`),g=r.let("fType"),_=r.let("format");r.if((0,xe._)`typeof ${h} == "object" && !(${h} instanceof RegExp)`,()=>r.assign(g,(0,xe._)`${h}.type || "string"`).assign(_,(0,xe._)`${h}.validate`),()=>r.assign(g,(0,xe._)`"string"`).assign(_,h)),t.fail$data((0,xe.or)(x(),b()));function x(){return c.strictSchema===!1?xe.nil:(0,xe._)`${i} && !${_}`}function b(){let S=l.$async?(0,xe._)`(${h}.async ? await ${_}(${n}) : ${_}(${n}))`:(0,xe._)`${_}(${n})`,I=(0,xe._)`(typeof ${_} == "function" ? ${S} : ${_}.test(${n}))`;return(0,xe._)`${_} && ${_} !== true && ${g} === ${e} && !${I}`}}function m(){let p=d.formats[s];if(!p){x();return}if(p===!0)return;let[h,g,_]=b(p);h===e&&t.pass(S());function x(){if(c.strictSchema===!1){d.logger.warn(I());return}throw new Error(I());function I(){return`unknown format "${s}" ignored in schema at path "${u}"`}}function b(I){let Z=I instanceof RegExp?(0,xe.regexpCode)(I):c.code.formats?(0,xe._)`${c.code.formats}${(0,xe.getProperty)(s)}`:void 0,ve=r.scopeValue("formats",{key:s,ref:I,code:Z});return typeof I=="object"&&!(I instanceof RegExp)?[I.type||"string",I.validate,(0,xe._)`${ve}.validate`]:["string",I,ve]}function S(){if(typeof p=="object"&&!(p instanceof RegExp)&&p.async){if(!l.$async)throw new Error("async format in sync schema");return(0,xe._)`await ${_}(${n})`}return typeof g=="function"?(0,xe._)`${_}(${n})`:(0,xe._)`${_}.test(${n})`}}}};ed.default=iP});var Dg=P(td=>{"use strict";Object.defineProperty(td,"__esModule",{value:!0});var aP=Zg(),cP=[aP.default];td.default=cP});var qg=P(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.contentVocabulary=hn.metadataVocabulary=void 0;hn.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];hn.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var Ug=P(rd=>{"use strict";Object.defineProperty(rd,"__esModule",{value:!0});var uP=Jh(),lP=ug(),dP=Mg(),pP=Dg(),Lg=qg(),fP=[uP.default,lP.default,(0,dP.default)(),pP.default,Lg.metadataVocabulary,Lg.contentVocabulary];rd.default=fP});var Vg=P(hi=>{"use strict";Object.defineProperty(hi,"__esModule",{value:!0});hi.DiscrError=void 0;var Fg;(function(t){t.Tag="tag",t.Mapping="mapping"})(Fg||(hi.DiscrError=Fg={}))});var Hg=P(od=>{"use strict";Object.defineProperty(od,"__esModule",{value:!0});var gn=V(),nd=Vg(),Kg=Ws(),mP=ho(),hP=ee(),gP={message:({params:{discrError:t,tagName:e}})=>t===nd.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,gn._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},yP={keyword:"discriminator",type:"object",schemaType:"object",error:gP,code(t){let{gen:e,data:r,schema:n,parentSchema:o,it:s}=t,{oneOf:i}=o;if(!s.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!i)throw new Error("discriminator: requires oneOf keyword");let c=e.let("valid",!1),u=e.const("tag",(0,gn._)`${r}${(0,gn.getProperty)(a)}`);e.if((0,gn._)`typeof ${u} == "string"`,()=>l(),()=>t.error(!1,{discrError:nd.DiscrError.Tag,tag:u,tagName:a})),t.ok(c);function l(){let m=f();e.if(!1);for(let p in m)e.elseIf((0,gn._)`${u} === ${p}`),e.assign(c,d(m[p]));e.else(),t.error(!1,{discrError:nd.DiscrError.Mapping,tag:u,tagName:a}),e.endIf()}function d(m){let p=e.name("valid"),h=t.subschema({keyword:"oneOf",schemaProp:m},p);return t.mergeEvaluated(h,gn.Name),p}function f(){var m;let p={},h=_(o),g=!0;for(let S=0;S<i.length;S++){let I=i[S];if(I?.$ref&&!(0,hP.schemaHasRulesButRef)(I,s.self.RULES)){let ve=I.$ref;if(I=Kg.resolveRef.call(s.self,s.schemaEnv.root,s.baseId,ve),I instanceof Kg.SchemaEnv&&(I=I.schema),I===void 0)throw new mP.default(s.opts.uriResolver,s.baseId,ve)}let Z=(m=I?.properties)===null||m===void 0?void 0:m[a];if(typeof Z!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);g=g&&(h||_(I)),x(Z,S)}if(!g)throw new Error(`discriminator: "${a}" must be required`);return p;function _({required:S}){return Array.isArray(S)&&S.includes(a)}function x(S,I){if(S.const)b(S.const,I);else if(S.enum)for(let Z of S.enum)b(Z,I);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function b(S,I){if(typeof S!="string"||S in p)throw new Error(`discriminator: "${a}" values must be unique strings`);p[S]=I}}}};od.default=yP});var Bg=P((cA,_P)=>{_P.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var id=P((de,sd)=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.MissingRefError=de.ValidationError=de.CodeGen=de.Name=de.nil=de.stringify=de.str=de._=de.KeywordCxt=de.Ajv=void 0;var vP=Fh(),xP=Ug(),bP=Hg(),Gg=Bg(),$P=["/properties"],gi="http://json-schema.org/draft-07/schema",yn=class extends vP.default{_addVocabularies(){super._addVocabularies(),xP.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(bP.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let e=this.opts.$data?this.$dataMetaSchema(Gg,$P):Gg;this.addMetaSchema(e,gi,!1),this.refs["http://json-schema.org/schema"]=gi}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(gi)?gi:void 0)}};de.Ajv=yn;sd.exports=de=yn;sd.exports.Ajv=yn;Object.defineProperty(de,"__esModule",{value:!0});de.default=yn;var wP=mo();Object.defineProperty(de,"KeywordCxt",{enumerable:!0,get:function(){return wP.KeywordCxt}});var _n=V();Object.defineProperty(de,"_",{enumerable:!0,get:function(){return _n._}});Object.defineProperty(de,"str",{enumerable:!0,get:function(){return _n.str}});Object.defineProperty(de,"stringify",{enumerable:!0,get:function(){return _n.stringify}});Object.defineProperty(de,"nil",{enumerable:!0,get:function(){return _n.nil}});Object.defineProperty(de,"Name",{enumerable:!0,get:function(){return _n.Name}});Object.defineProperty(de,"CodeGen",{enumerable:!0,get:function(){return _n.CodeGen}});var kP=Gs();Object.defineProperty(de,"ValidationError",{enumerable:!0,get:function(){return kP.default}});var SP=ho();Object.defineProperty(de,"MissingRefError",{enumerable:!0,get:function(){return SP.default}})});var ry=P(Pt=>{"use strict";Object.defineProperty(Pt,"__esModule",{value:!0});Pt.formatNames=Pt.fastFormats=Pt.fullFormats=void 0;function Tt(t,e){return{validate:t,compare:e}}Pt.fullFormats={date:Tt(Yg,ld),time:Tt(cd(!0),dd),"date-time":Tt(Jg(!0),ey),"iso-time":Tt(cd(),Qg),"iso-date-time":Tt(Jg(),ty),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:RP,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:ZP,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:CP,int32:{type:"number",validate:AP},int64:{type:"number",validate:NP},float:{type:"number",validate:Xg},double:{type:"number",validate:Xg},password:!0,binary:!0};Pt.fastFormats={...Pt.fullFormats,date:Tt(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,ld),time:Tt(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,dd),"date-time":Tt(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,ey),"iso-time":Tt(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,Qg),"iso-date-time":Tt(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,ty),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};Pt.formatNames=Object.keys(Pt.fullFormats);function TP(t){return t%4===0&&(t%100!==0||t%400===0)}var PP=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,zP=[0,31,28,31,30,31,30,31,31,30,31,30,31];function Yg(t){let e=PP.exec(t);if(!e)return!1;let r=+e[1],n=+e[2],o=+e[3];return n>=1&&n<=12&&o>=1&&o<=(n===2&&TP(r)?29:zP[n])}function ld(t,e){if(t&&e)return t>e?1:t<e?-1:0}var ad=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function cd(t){return function(r){let n=ad.exec(r);if(!n)return!1;let o=+n[1],s=+n[2],i=+n[3],a=n[4],c=n[5]==="-"?-1:1,u=+(n[6]||0),l=+(n[7]||0);if(u>23||l>59||t&&!a)return!1;if(o<=23&&s<=59&&i<60)return!0;let d=s-l*c,f=o-u*c-(d<0?1:0);return(f===23||f===-1)&&(d===59||d===-1)&&i<61}}function dd(t,e){if(!(t&&e))return;let r=new Date("2020-01-01T"+t).valueOf(),n=new Date("2020-01-01T"+e).valueOf();if(r&&n)return r-n}function Qg(t,e){if(!(t&&e))return;let r=ad.exec(t),n=ad.exec(e);if(r&&n)return t=r[1]+r[2]+r[3],e=n[1]+n[2]+n[3],t>e?1:t<e?-1:0}var ud=/t|\s/i;function Jg(t){let e=cd(t);return function(n){let o=n.split(ud);return o.length===2&&Yg(o[0])&&e(o[1])}}function ey(t,e){if(!(t&&e))return;let r=new Date(t).valueOf(),n=new Date(e).valueOf();if(r&&n)return r-n}function ty(t,e){if(!(t&&e))return;let[r,n]=t.split(ud),[o,s]=e.split(ud),i=ld(r,o);if(i!==void 0)return i||dd(n,s)}var EP=/\/|:/,IP=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function RP(t){return EP.test(t)&&IP.test(t)}var Wg=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function CP(t){return Wg.lastIndex=0,Wg.test(t)}var jP=-(2**31),OP=2**31-1;function AP(t){return Number.isInteger(t)&&t<=OP&&t>=jP}function NP(t){return Number.isInteger(t)}function Xg(){return!0}var MP=/[^\\]\\Z/;function ZP(t){if(MP.test(t))return!1;try{return new RegExp(t),!0}catch{return!1}}});var ny=P(vn=>{"use strict";Object.defineProperty(vn,"__esModule",{value:!0});vn.formatLimitDefinition=void 0;var DP=id(),yt=V(),sr=yt.operators,yi={formatMaximum:{okStr:"<=",ok:sr.LTE,fail:sr.GT},formatMinimum:{okStr:">=",ok:sr.GTE,fail:sr.LT},formatExclusiveMaximum:{okStr:"<",ok:sr.LT,fail:sr.GTE},formatExclusiveMinimum:{okStr:">",ok:sr.GT,fail:sr.LTE}},qP={message:({keyword:t,schemaCode:e})=>(0,yt.str)`should be ${yi[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,yt._)`{comparison: ${yi[t].okStr}, limit: ${e}}`};vn.formatLimitDefinition={keyword:Object.keys(yi),type:"string",schemaType:"string",$data:!0,error:qP,code(t){let{gen:e,data:r,schemaCode:n,keyword:o,it:s}=t,{opts:i,self:a}=s;if(!i.validateFormats)return;let c=new DP.KeywordCxt(s,a.RULES.all.format.definition,"format");c.$data?u():l();function u(){let f=e.scopeValue("formats",{ref:a.formats,code:i.code.formats}),m=e.const("fmt",(0,yt._)`${f}[${c.schemaCode}]`);t.fail$data((0,yt.or)((0,yt._)`typeof ${m} != "object"`,(0,yt._)`${m} instanceof RegExp`,(0,yt._)`typeof ${m}.compare != "function"`,d(m)))}function l(){let f=c.schema,m=a.formats[f];if(!m||m===!0)return;if(typeof m!="object"||m instanceof RegExp||typeof m.compare!="function")throw new Error(`"${o}": format "${f}" does not define "compare" function`);let p=e.scopeValue("formats",{key:f,ref:m,code:i.code.formats?(0,yt._)`${i.code.formats}${(0,yt.getProperty)(f)}`:void 0});t.fail$data(d(p))}function d(f){return(0,yt._)`${f}.compare(${r}, ${n}) ${yi[o].fail} 0`}},dependencies:["format"]};var LP=t=>(t.addKeyword(vn.formatLimitDefinition),t);vn.default=LP});var ay=P((Eo,iy)=>{"use strict";Object.defineProperty(Eo,"__esModule",{value:!0});var xn=ry(),UP=ny(),pd=V(),oy=new pd.Name("fullFormats"),FP=new pd.Name("fastFormats"),fd=(t,e={keywords:!0})=>{if(Array.isArray(e))return sy(t,e,xn.fullFormats,oy),t;let[r,n]=e.mode==="fast"?[xn.fastFormats,FP]:[xn.fullFormats,oy],o=e.formats||xn.formatNames;return sy(t,o,r,n),e.keywords&&(0,UP.default)(t),t};fd.get=(t,e="full")=>{let n=(e==="fast"?xn.fastFormats:xn.fullFormats)[t];if(!n)throw new Error(`Unknown format "${t}"`);return n};function sy(t,e,r,n){var o,s;(o=(s=t.opts.code).formats)!==null&&o!==void 0||(s.formats=(0,pd._)`require("ajv-formats/dist/formats").${n}`);for(let i of e)t.addFormat(i,r[i])}iy.exports=Eo=fd;Object.defineProperty(Eo,"__esModule",{value:!0});Eo.default=fd});var k={};Di(k,{BRAND:()=>P_,DIRTY:()=>ar,EMPTY_PATH:()=>s_,INVALID:()=>N,NEVER:()=>lv,OK:()=>Ce,ParseStatus:()=>ke,Schema:()=>F,ZodAny:()=>Vt,ZodArray:()=>Ct,ZodBigInt:()=>ur,ZodBoolean:()=>lr,ZodBranded:()=>zn,ZodCatch:()=>br,ZodDate:()=>dr,ZodDefault:()=>xr,ZodDiscriminatedUnion:()=>Mo,ZodEffects:()=>et,ZodEnum:()=>_r,ZodError:()=>Le,ZodFirstPartyTypeKind:()=>w,ZodFunction:()=>Do,ZodIntersection:()=>hr,ZodIssueCode:()=>$,ZodLazy:()=>gr,ZodLiteral:()=>yr,ZodMap:()=>Br,ZodNaN:()=>Jr,ZodNativeEnum:()=>vr,ZodNever:()=>ut,ZodNull:()=>fr,ZodNullable:()=>xt,ZodNumber:()=>cr,ZodObject:()=>Fe,ZodOptional:()=>Ue,ZodParsedType:()=>z,ZodPipeline:()=>En,ZodPromise:()=>Kt,ZodReadonly:()=>$r,ZodRecord:()=>Zo,ZodSchema:()=>F,ZodSet:()=>Gr,ZodString:()=>Ft,ZodSymbol:()=>Kr,ZodTransformer:()=>et,ZodTuple:()=>vt,ZodType:()=>F,ZodUndefined:()=>pr,ZodUnion:()=>mr,ZodUnknown:()=>Rt,ZodVoid:()=>Hr,addIssueToContext:()=>T,any:()=>N_,array:()=>q_,bigint:()=>R_,boolean:()=>Zd,coerce:()=>uv,custom:()=>Ad,date:()=>C_,datetimeRegex:()=>jd,defaultErrorMap:()=>Et,discriminatedUnion:()=>F_,effect:()=>tv,enum:()=>Y_,function:()=>J_,getErrorMap:()=>Ur,getParsedType:()=>_t,instanceof:()=>E_,intersection:()=>V_,isAborted:()=>Ao,isAsync:()=>Fr,isDirty:()=>No,isValid:()=>Ut,late:()=>z_,lazy:()=>W_,literal:()=>X_,makeIssue:()=>Pn,map:()=>B_,nan:()=>I_,nativeEnum:()=>Q_,never:()=>Z_,null:()=>A_,nullable:()=>nv,number:()=>Md,object:()=>Fi,objectUtil:()=>qi,oboolean:()=>cv,onumber:()=>av,optional:()=>rv,ostring:()=>iv,pipeline:()=>sv,preprocess:()=>ov,promise:()=>ev,quotelessJson:()=>r_,record:()=>H_,set:()=>G_,setErrorMap:()=>o_,strictObject:()=>L_,string:()=>Nd,symbol:()=>j_,transformer:()=>tv,tuple:()=>K_,undefined:()=>O_,union:()=>U_,unknown:()=>M_,util:()=>B,void:()=>D_});var B;(function(t){t.assertEqual=o=>{};function e(o){}t.assertIs=e;function r(o){throw new Error}t.assertNever=r,t.arrayToEnum=o=>{let s={};for(let i of o)s[i]=i;return s},t.getValidEnumValues=o=>{let s=t.objectKeys(o).filter(a=>typeof o[o[a]]!="number"),i={};for(let a of s)i[a]=o[a];return t.objectValues(i)},t.objectValues=o=>t.objectKeys(o).map(function(s){return o[s]}),t.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{let s=[];for(let i in o)Object.prototype.hasOwnProperty.call(o,i)&&s.push(i);return s},t.find=(o,s)=>{for(let i of o)if(s(i))return i},t.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function n(o,s=" | "){return o.map(i=>typeof i=="string"?`'${i}'`:i).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(o,s)=>typeof s=="bigint"?s.toString():s})(B||(B={}));var qi;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(qi||(qi={}));var z=B.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),_t=t=>{switch(typeof t){case"undefined":return z.undefined;case"string":return z.string;case"number":return Number.isNaN(t)?z.nan:z.number;case"boolean":return z.boolean;case"function":return z.function;case"bigint":return z.bigint;case"symbol":return z.symbol;case"object":return Array.isArray(t)?z.array:t===null?z.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?z.promise:typeof Map<"u"&&t instanceof Map?z.map:typeof Set<"u"&&t instanceof Set?z.set:typeof Date<"u"&&t instanceof Date?z.date:z.object;default:return z.unknown}};var $=B.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),r_=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Le=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},o=s=>{for(let i of s.issues)if(i.code==="invalid_union")i.unionErrors.map(o);else if(i.code==="invalid_return_type")o(i.returnTypeError);else if(i.code==="invalid_arguments")o(i.argumentsError);else if(i.path.length===0)n._errors.push(r(i));else{let a=n,c=0;for(;c<i.path.length;){let u=i.path[c];c===i.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(i))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return o(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,B.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let o of this.issues)if(o.path.length>0){let s=o.path[0];r[s]=r[s]||[],r[s].push(e(o))}else n.push(e(o));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Le.create=t=>new Le(t);var n_=(t,e)=>{let r;switch(t.code){case $.invalid_type:t.received===z.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case $.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,B.jsonStringifyReplacer)}`;break;case $.unrecognized_keys:r=`Unrecognized key(s) in object: ${B.joinValues(t.keys,", ")}`;break;case $.invalid_union:r="Invalid input";break;case $.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${B.joinValues(t.options)}`;break;case $.invalid_enum_value:r=`Invalid enum value. Expected ${B.joinValues(t.options)}, received '${t.received}'`;break;case $.invalid_arguments:r="Invalid function arguments";break;case $.invalid_return_type:r="Invalid function return type";break;case $.invalid_date:r="Invalid date";break;case $.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:B.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case $.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case $.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case $.custom:r="Invalid input";break;case $.invalid_intersection_types:r="Intersection results could not be merged";break;case $.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case $.not_finite:r="Number must be finite";break;default:r=e.defaultError,B.assertNever(t)}return{message:r}},Et=n_;var zd=Et;function o_(t){zd=t}function Ur(){return zd}var Pn=t=>{let{data:e,path:r,errorMaps:n,issueData:o}=t,s=[...r,...o.path||[]],i={...o,path:s};if(o.message!==void 0)return{...o,path:s,message:o.message};let a="",c=n.filter(u=>!!u).slice().reverse();for(let u of c)a=u(i,{data:e,defaultError:a}).message;return{...o,path:s,message:a}},s_=[];function T(t,e){let r=Ur(),n=Pn({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Et?void 0:Et].filter(o=>!!o)});t.common.issues.push(n)}var ke=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let o of r){if(o.status==="aborted")return N;o.status==="dirty"&&e.dirty(),n.push(o.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let o of r){let s=await o.key,i=await o.value;n.push({key:s,value:i})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let o of r){let{key:s,value:i}=o;if(s.status==="aborted"||i.status==="aborted")return N;s.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof i.value<"u"||o.alwaysSet)&&(n[s.value]=i.value)}return{status:e.value,value:n}}},N=Object.freeze({status:"aborted"}),ar=t=>({status:"dirty",value:t}),Ce=t=>({status:"valid",value:t}),Ao=t=>t.status==="aborted",No=t=>t.status==="dirty",Ut=t=>t.status==="valid",Fr=t=>typeof Promise<"u"&&t instanceof Promise;var R;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(R||(R={}));var Qe=class{constructor(e,r,n,o){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Ed=(t,e)=>{if(Ut(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Le(t.common.issues);return this._error=r,this._error}}};function L(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:o}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:o}:{errorMap:(i,a)=>{let{message:c}=t;return i.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??n??a.defaultError}:i.code!=="invalid_type"?{message:a.defaultError}:{message:c??r??a.defaultError}},description:o}}var F=class{get description(){return this._def.description}_getType(e){return _t(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:_t(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ke,ctx:{common:e.parent.common,data:e.data,parsedType:_t(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(Fr(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){let n={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_t(e)},o=this._parseSync({data:e,path:n.path,parent:n});return Ed(n,o)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_t(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:r});return Ut(n)?{value:n.value}:{issues:r.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(n=>Ut(n)?{value:n.value}:{issues:r.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_t(e)},o=this._parse({data:e,path:n.path,parent:n}),s=await(Fr(o)?o:Promise.resolve(o));return Ed(n,s)}refine(e,r){let n=o=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(o):r;return this._refinement((o,s)=>{let i=e(o),a=()=>s.addIssue({code:$.custom,...n(o)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(a(),!1)):i?!0:(a(),!1)})}refinement(e,r){return this._refinement((n,o)=>e(n)?!0:(o.addIssue(typeof r=="function"?r(n,o):r),!1))}_refinement(e){return new et({schema:this,typeName:w.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Ue.create(this,this._def)}nullable(){return xt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ct.create(this)}promise(){return Kt.create(this,this._def)}or(e){return mr.create([this,e],this._def)}and(e){return hr.create(this,e,this._def)}transform(e){return new et({...L(this._def),schema:this,typeName:w.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new xr({...L(this._def),innerType:this,defaultValue:r,typeName:w.ZodDefault})}brand(){return new zn({typeName:w.ZodBranded,type:this,...L(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new br({...L(this._def),innerType:this,catchValue:r,typeName:w.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return En.create(this,e)}readonly(){return $r.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},i_=/^c[^\s-]{8,}$/i,a_=/^[0-9a-z]+$/,c_=/^[0-9A-HJKMNP-TV-Z]{26}$/i,u_=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,l_=/^[a-z0-9_-]{21}$/i,d_=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,p_=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,f_=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,m_="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Li,h_=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,g_=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,y_=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,__=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,v_=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,x_=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Rd="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",b_=new RegExp(`^${Rd}$`);function Cd(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function $_(t){return new RegExp(`^${Cd(t)}$`)}function jd(t){let e=`${Rd}T${Cd(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function w_(t,e){return!!((e==="v4"||!e)&&h_.test(t)||(e==="v6"||!e)&&y_.test(t))}function k_(t,e){if(!d_.test(t))return!1;try{let[r]=t.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),o=JSON.parse(atob(n));return!(typeof o!="object"||o===null||"typ"in o&&o?.typ!=="JWT"||!o.alg||e&&o.alg!==e)}catch{return!1}}function S_(t,e){return!!((e==="v4"||!e)&&g_.test(t)||(e==="v6"||!e)&&__.test(t))}var Ft=class t extends F{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==z.string){let s=this._getOrReturnCtx(e);return T(s,{code:$.invalid_type,expected:z.string,received:s.parsedType}),N}let n=new ke,o;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(o=this._getOrReturnCtx(e,o),T(o,{code:$.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(o=this._getOrReturnCtx(e,o),T(o,{code:$.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let i=e.data.length>s.value,a=e.data.length<s.value;(i||a)&&(o=this._getOrReturnCtx(e,o),i?T(o,{code:$.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&T(o,{code:$.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")f_.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"email",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")Li||(Li=new RegExp(m_,"u")),Li.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"emoji",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")u_.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"uuid",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")l_.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"nanoid",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")i_.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"cuid",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")a_.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"cuid2",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")c_.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"ulid",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{o=this._getOrReturnCtx(e,o),T(o,{validation:"url",code:$.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"regex",code:$.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(o=this._getOrReturnCtx(e,o),T(o,{code:$.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(o=this._getOrReturnCtx(e,o),T(o,{code:$.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(o=this._getOrReturnCtx(e,o),T(o,{code:$.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?jd(s).test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{code:$.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?b_.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{code:$.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?$_(s).test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{code:$.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?p_.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"duration",code:$.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?w_(e.data,s.version)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"ip",code:$.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?k_(e.data,s.alg)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"jwt",code:$.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?S_(e.data,s.version)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"cidr",code:$.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?v_.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"base64",code:$.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?x_.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"base64url",code:$.invalid_string,message:s.message}),n.dirty()):B.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(o=>e.test(o),{validation:r,code:$.invalid_string,...R.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...R.errToObj(e)})}url(e){return this._addCheck({kind:"url",...R.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...R.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...R.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...R.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...R.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...R.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...R.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...R.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...R.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...R.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...R.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...R.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...R.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...R.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...R.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...R.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...R.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...R.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...R.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...R.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...R.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...R.errToObj(r)})}nonempty(e){return this.min(1,R.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Ft.create=t=>new Ft({checks:[],typeName:w.ZodString,coerce:t?.coerce??!1,...L(t)});function T_(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,s=Number.parseInt(t.toFixed(o).replace(".","")),i=Number.parseInt(e.toFixed(o).replace(".",""));return s%i/10**o}var cr=class t extends F{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==z.number){let s=this._getOrReturnCtx(e);return T(s,{code:$.invalid_type,expected:z.number,received:s.parsedType}),N}let n,o=new ke;for(let s of this._def.checks)s.kind==="int"?B.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),T(n,{code:$.invalid_type,expected:"integer",received:"float",message:s.message}),o.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),T(n,{code:$.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),T(n,{code:$.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="multipleOf"?T_(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),T(n,{code:$.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),T(n,{code:$.not_finite,message:s.message}),o.dirty()):B.assertNever(s);return{status:o.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,R.toString(r))}gt(e,r){return this.setLimit("min",e,!1,R.toString(r))}lte(e,r){return this.setLimit("max",e,!0,R.toString(r))}lt(e,r){return this.setLimit("max",e,!1,R.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:R.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:R.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:R.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:R.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:R.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:R.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&B.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};cr.create=t=>new cr({checks:[],typeName:w.ZodNumber,coerce:t?.coerce||!1,...L(t)});var ur=class t extends F{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==z.bigint)return this._getInvalidInput(e);let n,o=new ke;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),T(n,{code:$.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),T(n,{code:$.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),T(n,{code:$.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):B.assertNever(s);return{status:o.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return T(r,{code:$.invalid_type,expected:z.bigint,received:r.parsedType}),N}gte(e,r){return this.setLimit("min",e,!0,R.toString(r))}gt(e,r){return this.setLimit("min",e,!1,R.toString(r))}lte(e,r){return this.setLimit("max",e,!0,R.toString(r))}lt(e,r){return this.setLimit("max",e,!1,R.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:R.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:R.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};ur.create=t=>new ur({checks:[],typeName:w.ZodBigInt,coerce:t?.coerce??!1,...L(t)});var lr=class extends F{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==z.boolean){let n=this._getOrReturnCtx(e);return T(n,{code:$.invalid_type,expected:z.boolean,received:n.parsedType}),N}return Ce(e.data)}};lr.create=t=>new lr({typeName:w.ZodBoolean,coerce:t?.coerce||!1,...L(t)});var dr=class t extends F{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==z.date){let s=this._getOrReturnCtx(e);return T(s,{code:$.invalid_type,expected:z.date,received:s.parsedType}),N}if(Number.isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return T(s,{code:$.invalid_date}),N}let n=new ke,o;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(o=this._getOrReturnCtx(e,o),T(o,{code:$.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(o=this._getOrReturnCtx(e,o),T(o,{code:$.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):B.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:R.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:R.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};dr.create=t=>new dr({checks:[],coerce:t?.coerce||!1,typeName:w.ZodDate,...L(t)});var Kr=class extends F{_parse(e){if(this._getType(e)!==z.symbol){let n=this._getOrReturnCtx(e);return T(n,{code:$.invalid_type,expected:z.symbol,received:n.parsedType}),N}return Ce(e.data)}};Kr.create=t=>new Kr({typeName:w.ZodSymbol,...L(t)});var pr=class extends F{_parse(e){if(this._getType(e)!==z.undefined){let n=this._getOrReturnCtx(e);return T(n,{code:$.invalid_type,expected:z.undefined,received:n.parsedType}),N}return Ce(e.data)}};pr.create=t=>new pr({typeName:w.ZodUndefined,...L(t)});var fr=class extends F{_parse(e){if(this._getType(e)!==z.null){let n=this._getOrReturnCtx(e);return T(n,{code:$.invalid_type,expected:z.null,received:n.parsedType}),N}return Ce(e.data)}};fr.create=t=>new fr({typeName:w.ZodNull,...L(t)});var Vt=class extends F{constructor(){super(...arguments),this._any=!0}_parse(e){return Ce(e.data)}};Vt.create=t=>new Vt({typeName:w.ZodAny,...L(t)});var Rt=class extends F{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ce(e.data)}};Rt.create=t=>new Rt({typeName:w.ZodUnknown,...L(t)});var ut=class extends F{_parse(e){let r=this._getOrReturnCtx(e);return T(r,{code:$.invalid_type,expected:z.never,received:r.parsedType}),N}};ut.create=t=>new ut({typeName:w.ZodNever,...L(t)});var Hr=class extends F{_parse(e){if(this._getType(e)!==z.undefined){let n=this._getOrReturnCtx(e);return T(n,{code:$.invalid_type,expected:z.void,received:n.parsedType}),N}return Ce(e.data)}};Hr.create=t=>new Hr({typeName:w.ZodVoid,...L(t)});var Ct=class t extends F{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),o=this._def;if(r.parsedType!==z.array)return T(r,{code:$.invalid_type,expected:z.array,received:r.parsedType}),N;if(o.exactLength!==null){let i=r.data.length>o.exactLength.value,a=r.data.length<o.exactLength.value;(i||a)&&(T(r,{code:i?$.too_big:$.too_small,minimum:a?o.exactLength.value:void 0,maximum:i?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),n.dirty())}if(o.minLength!==null&&r.data.length<o.minLength.value&&(T(r,{code:$.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),n.dirty()),o.maxLength!==null&&r.data.length>o.maxLength.value&&(T(r,{code:$.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((i,a)=>o.type._parseAsync(new Qe(r,i,r.path,a)))).then(i=>ke.mergeArray(n,i));let s=[...r.data].map((i,a)=>o.type._parseSync(new Qe(r,i,r.path,a)));return ke.mergeArray(n,s)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:R.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:R.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:R.toString(r)}})}nonempty(e){return this.min(1,e)}};Ct.create=(t,e)=>new Ct({type:t,minLength:null,maxLength:null,exactLength:null,typeName:w.ZodArray,...L(e)});function Vr(t){if(t instanceof Fe){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=Ue.create(Vr(n))}return new Fe({...t._def,shape:()=>e})}else return t instanceof Ct?new Ct({...t._def,type:Vr(t.element)}):t instanceof Ue?Ue.create(Vr(t.unwrap())):t instanceof xt?xt.create(Vr(t.unwrap())):t instanceof vt?vt.create(t.items.map(e=>Vr(e))):t}var Fe=class t extends F{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=B.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==z.object){let u=this._getOrReturnCtx(e);return T(u,{code:$.invalid_type,expected:z.object,received:u.parsedType}),N}let{status:n,ctx:o}=this._processInputParams(e),{shape:s,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof ut&&this._def.unknownKeys==="strip"))for(let u in o.data)i.includes(u)||a.push(u);let c=[];for(let u of i){let l=s[u],d=o.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Qe(o,d,o.path,u)),alwaysSet:u in o.data})}if(this._def.catchall instanceof ut){let u=this._def.unknownKeys;if(u==="passthrough")for(let l of a)c.push({key:{status:"valid",value:l},value:{status:"valid",value:o.data[l]}});else if(u==="strict")a.length>0&&(T(o,{code:$.unrecognized_keys,keys:a}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let l of a){let d=o.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Qe(o,d,o.path,l)),alwaysSet:l in o.data})}}return o.common.async?Promise.resolve().then(async()=>{let u=[];for(let l of c){let d=await l.key,f=await l.value;u.push({key:d,value:f,alwaysSet:l.alwaysSet})}return u}).then(u=>ke.mergeObjectSync(n,u)):ke.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return R.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{let o=this._def.errorMap?.(r,n).message??n.defaultError;return r.code==="unrecognized_keys"?{message:R.errToObj(e).message??o}:{message:o}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:w.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};for(let n of B.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}omit(e){let r={};for(let n of B.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}deepPartial(){return Vr(this)}partial(e){let r={};for(let n of B.objectKeys(this.shape)){let o=this.shape[n];e&&!e[n]?r[n]=o:r[n]=o.optional()}return new t({...this._def,shape:()=>r})}required(e){let r={};for(let n of B.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof Ue;)s=s._def.innerType;r[n]=s}return new t({...this._def,shape:()=>r})}keyof(){return Od(B.objectKeys(this.shape))}};Fe.create=(t,e)=>new Fe({shape:()=>t,unknownKeys:"strip",catchall:ut.create(),typeName:w.ZodObject,...L(e)});Fe.strictCreate=(t,e)=>new Fe({shape:()=>t,unknownKeys:"strict",catchall:ut.create(),typeName:w.ZodObject,...L(e)});Fe.lazycreate=(t,e)=>new Fe({shape:t,unknownKeys:"strip",catchall:ut.create(),typeName:w.ZodObject,...L(e)});var mr=class extends F{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function o(s){for(let a of s)if(a.result.status==="valid")return a.result;for(let a of s)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;let i=s.map(a=>new Le(a.ctx.common.issues));return T(r,{code:$.invalid_union,unionErrors:i}),N}if(r.common.async)return Promise.all(n.map(async s=>{let i={...r,common:{...r.common,issues:[]},parent:null};return{result:await s._parseAsync({data:r.data,path:r.path,parent:i}),ctx:i}})).then(o);{let s,i=[];for(let c of n){let u={...r,common:{...r.common,issues:[]},parent:null},l=c._parseSync({data:r.data,path:r.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!s&&(s={result:l,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(s)return r.common.issues.push(...s.ctx.common.issues),s.result;let a=i.map(c=>new Le(c));return T(r,{code:$.invalid_union,unionErrors:a}),N}}get options(){return this._def.options}};mr.create=(t,e)=>new mr({options:t,typeName:w.ZodUnion,...L(e)});var It=t=>t instanceof gr?It(t.schema):t instanceof et?It(t.innerType()):t instanceof yr?[t.value]:t instanceof _r?t.options:t instanceof vr?B.objectValues(t.enum):t instanceof xr?It(t._def.innerType):t instanceof pr?[void 0]:t instanceof fr?[null]:t instanceof Ue?[void 0,...It(t.unwrap())]:t instanceof xt?[null,...It(t.unwrap())]:t instanceof zn||t instanceof $r?It(t.unwrap()):t instanceof br?It(t._def.innerType):[],Mo=class t extends F{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==z.object)return T(r,{code:$.invalid_type,expected:z.object,received:r.parsedType}),N;let n=this.discriminator,o=r.data[n],s=this.optionsMap.get(o);return s?r.common.async?s._parseAsync({data:r.data,path:r.path,parent:r}):s._parseSync({data:r.data,path:r.path,parent:r}):(T(r,{code:$.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),N)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let o=new Map;for(let s of r){let i=It(s.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of i){if(o.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);o.set(a,s)}}return new t({typeName:w.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:o,...L(n)})}};function Ui(t,e){let r=_t(t),n=_t(e);if(t===e)return{valid:!0,data:t};if(r===z.object&&n===z.object){let o=B.objectKeys(e),s=B.objectKeys(t).filter(a=>o.indexOf(a)!==-1),i={...t,...e};for(let a of s){let c=Ui(t[a],e[a]);if(!c.valid)return{valid:!1};i[a]=c.data}return{valid:!0,data:i}}else if(r===z.array&&n===z.array){if(t.length!==e.length)return{valid:!1};let o=[];for(let s=0;s<t.length;s++){let i=t[s],a=e[s],c=Ui(i,a);if(!c.valid)return{valid:!1};o.push(c.data)}return{valid:!0,data:o}}else return r===z.date&&n===z.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var hr=class extends F{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=(s,i)=>{if(Ao(s)||Ao(i))return N;let a=Ui(s.value,i.value);return a.valid?((No(s)||No(i))&&r.dirty(),{status:r.value,value:a.data}):(T(n,{code:$.invalid_intersection_types}),N)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,i])=>o(s,i)):o(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};hr.create=(t,e,r)=>new hr({left:t,right:e,typeName:w.ZodIntersection,...L(r)});var vt=class t extends F{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==z.array)return T(n,{code:$.invalid_type,expected:z.array,received:n.parsedType}),N;if(n.data.length<this._def.items.length)return T(n,{code:$.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),N;!this._def.rest&&n.data.length>this._def.items.length&&(T(n,{code:$.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let s=[...n.data].map((i,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new Qe(n,i,n.path,a)):null}).filter(i=>!!i);return n.common.async?Promise.all(s).then(i=>ke.mergeArray(r,i)):ke.mergeArray(r,s)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};vt.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new vt({items:t,typeName:w.ZodTuple,rest:null,...L(e)})};var Zo=class t extends F{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==z.object)return T(n,{code:$.invalid_type,expected:z.object,received:n.parsedType}),N;let o=[],s=this._def.keyType,i=this._def.valueType;for(let a in n.data)o.push({key:s._parse(new Qe(n,a,n.path,a)),value:i._parse(new Qe(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?ke.mergeObjectAsync(r,o):ke.mergeObjectSync(r,o)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof F?new t({keyType:e,valueType:r,typeName:w.ZodRecord,...L(n)}):new t({keyType:Ft.create(),valueType:e,typeName:w.ZodRecord,...L(r)})}},Br=class extends F{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==z.map)return T(n,{code:$.invalid_type,expected:z.map,received:n.parsedType}),N;let o=this._def.keyType,s=this._def.valueType,i=[...n.data.entries()].map(([a,c],u)=>({key:o._parse(new Qe(n,a,n.path,[u,"key"])),value:s._parse(new Qe(n,c,n.path,[u,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of i){let u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return N;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}})}else{let a=new Map;for(let c of i){let u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return N;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}}}};Br.create=(t,e,r)=>new Br({valueType:e,keyType:t,typeName:w.ZodMap,...L(r)});var Gr=class t extends F{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==z.set)return T(n,{code:$.invalid_type,expected:z.set,received:n.parsedType}),N;let o=this._def;o.minSize!==null&&n.data.size<o.minSize.value&&(T(n,{code:$.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),r.dirty()),o.maxSize!==null&&n.data.size>o.maxSize.value&&(T(n,{code:$.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),r.dirty());let s=this._def.valueType;function i(c){let u=new Set;for(let l of c){if(l.status==="aborted")return N;l.status==="dirty"&&r.dirty(),u.add(l.value)}return{status:r.value,value:u}}let a=[...n.data.values()].map((c,u)=>s._parse(new Qe(n,c,n.path,u)));return n.common.async?Promise.all(a).then(c=>i(c)):i(a)}min(e,r){return new t({...this._def,minSize:{value:e,message:R.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:R.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};Gr.create=(t,e)=>new Gr({valueType:t,minSize:null,maxSize:null,typeName:w.ZodSet,...L(e)});var Do=class t extends F{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==z.function)return T(r,{code:$.invalid_type,expected:z.function,received:r.parsedType}),N;function n(a,c){return Pn({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Ur(),Et].filter(u=>!!u),issueData:{code:$.invalid_arguments,argumentsError:c}})}function o(a,c){return Pn({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Ur(),Et].filter(u=>!!u),issueData:{code:$.invalid_return_type,returnTypeError:c}})}let s={errorMap:r.common.contextualErrorMap},i=r.data;if(this._def.returns instanceof Kt){let a=this;return Ce(async function(...c){let u=new Le([]),l=await a._def.args.parseAsync(c,s).catch(m=>{throw u.addIssue(n(c,m)),u}),d=await Reflect.apply(i,this,l);return await a._def.returns._def.type.parseAsync(d,s).catch(m=>{throw u.addIssue(o(d,m)),u})})}else{let a=this;return Ce(function(...c){let u=a._def.args.safeParse(c,s);if(!u.success)throw new Le([n(c,u.error)]);let l=Reflect.apply(i,this,u.data),d=a._def.returns.safeParse(l,s);if(!d.success)throw new Le([o(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:vt.create(e).rest(Rt.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||vt.create([]).rest(Rt.create()),returns:r||Rt.create(),typeName:w.ZodFunction,...L(n)})}},gr=class extends F{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};gr.create=(t,e)=>new gr({getter:t,typeName:w.ZodLazy,...L(e)});var yr=class extends F{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return T(r,{received:r.data,code:$.invalid_literal,expected:this._def.value}),N}return{status:"valid",value:e.data}}get value(){return this._def.value}};yr.create=(t,e)=>new yr({value:t,typeName:w.ZodLiteral,...L(e)});function Od(t,e){return new _r({values:t,typeName:w.ZodEnum,...L(e)})}var _r=class t extends F{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return T(r,{expected:B.joinValues(n),received:r.parsedType,code:$.invalid_type}),N}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return T(r,{received:r.data,code:$.invalid_enum_value,options:n}),N}return Ce(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};_r.create=Od;var vr=class extends F{_parse(e){let r=B.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==z.string&&n.parsedType!==z.number){let o=B.objectValues(r);return T(n,{expected:B.joinValues(o),received:n.parsedType,code:$.invalid_type}),N}if(this._cache||(this._cache=new Set(B.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let o=B.objectValues(r);return T(n,{received:n.data,code:$.invalid_enum_value,options:o}),N}return Ce(e.data)}get enum(){return this._def.values}};vr.create=(t,e)=>new vr({values:t,typeName:w.ZodNativeEnum,...L(e)});var Kt=class extends F{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==z.promise&&r.common.async===!1)return T(r,{code:$.invalid_type,expected:z.promise,received:r.parsedType}),N;let n=r.parsedType===z.promise?r.data:Promise.resolve(r.data);return Ce(n.then(o=>this._def.type.parseAsync(o,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Kt.create=(t,e)=>new Kt({type:t,typeName:w.ZodPromise,...L(e)});var et=class extends F{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===w.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=this._def.effect||null,s={addIssue:i=>{T(n,i),i.fatal?r.abort():r.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),o.type==="preprocess"){let i=o.transform(n.data,s);if(n.common.async)return Promise.resolve(i).then(async a=>{if(r.value==="aborted")return N;let c=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return c.status==="aborted"?N:c.status==="dirty"?ar(c.value):r.value==="dirty"?ar(c.value):c});{if(r.value==="aborted")return N;let a=this._def.schema._parseSync({data:i,path:n.path,parent:n});return a.status==="aborted"?N:a.status==="dirty"?ar(a.value):r.value==="dirty"?ar(a.value):a}}if(o.type==="refinement"){let i=a=>{let c=o.refinement(a,s);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?N:(a.status==="dirty"&&r.dirty(),i(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?N:(a.status==="dirty"&&r.dirty(),i(a.value).then(()=>({status:r.value,value:a.value}))))}if(o.type==="transform")if(n.common.async===!1){let i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Ut(i))return N;let a=o.transform(i.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>Ut(i)?Promise.resolve(o.transform(i.value,s)).then(a=>({status:r.value,value:a})):N);B.assertNever(o)}};et.create=(t,e,r)=>new et({schema:t,typeName:w.ZodEffects,effect:e,...L(r)});et.createWithPreprocess=(t,e,r)=>new et({schema:e,effect:{type:"preprocess",transform:t},typeName:w.ZodEffects,...L(r)});var Ue=class extends F{_parse(e){return this._getType(e)===z.undefined?Ce(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ue.create=(t,e)=>new Ue({innerType:t,typeName:w.ZodOptional,...L(e)});var xt=class extends F{_parse(e){return this._getType(e)===z.null?Ce(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};xt.create=(t,e)=>new xt({innerType:t,typeName:w.ZodNullable,...L(e)});var xr=class extends F{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===z.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};xr.create=(t,e)=>new xr({innerType:t,typeName:w.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...L(e)});var br=class extends F{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},o=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Fr(o)?o.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Le(n.common.issues)},input:n.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Le(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};br.create=(t,e)=>new br({innerType:t,typeName:w.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...L(e)});var Jr=class extends F{_parse(e){if(this._getType(e)!==z.nan){let n=this._getOrReturnCtx(e);return T(n,{code:$.invalid_type,expected:z.nan,received:n.parsedType}),N}return{status:"valid",value:e.data}}};Jr.create=t=>new Jr({typeName:w.ZodNaN,...L(t)});var P_=Symbol("zod_brand"),zn=class extends F{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},En=class t extends F{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?N:s.status==="dirty"?(r.dirty(),ar(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{let o=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?N:o.status==="dirty"?(r.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:w.ZodPipeline})}},$r=class extends F{_parse(e){let r=this._def.innerType._parse(e),n=o=>(Ut(o)&&(o.value=Object.freeze(o.value)),o);return Fr(r)?r.then(o=>n(o)):n(r)}unwrap(){return this._def.innerType}};$r.create=(t,e)=>new $r({innerType:t,typeName:w.ZodReadonly,...L(e)});function Id(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function Ad(t,e={},r){return t?Vt.create().superRefine((n,o)=>{let s=t(n);if(s instanceof Promise)return s.then(i=>{if(!i){let a=Id(e,n),c=a.fatal??r??!0;o.addIssue({code:"custom",...a,fatal:c})}});if(!s){let i=Id(e,n),a=i.fatal??r??!0;o.addIssue({code:"custom",...i,fatal:a})}}):Vt.create()}var z_={object:Fe.lazycreate},w;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(w||(w={}));var E_=(t,e={message:`Input not instance of ${t.name}`})=>Ad(r=>r instanceof t,e),Nd=Ft.create,Md=cr.create,I_=Jr.create,R_=ur.create,Zd=lr.create,C_=dr.create,j_=Kr.create,O_=pr.create,A_=fr.create,N_=Vt.create,M_=Rt.create,Z_=ut.create,D_=Hr.create,q_=Ct.create,Fi=Fe.create,L_=Fe.strictCreate,U_=mr.create,F_=Mo.create,V_=hr.create,K_=vt.create,H_=Zo.create,B_=Br.create,G_=Gr.create,J_=Do.create,W_=gr.create,X_=yr.create,Y_=_r.create,Q_=vr.create,ev=Kt.create,tv=et.create,rv=Ue.create,nv=xt.create,ov=et.createWithPreprocess,sv=En.create,iv=()=>Nd().optional(),av=()=>Md().optional(),cv=()=>Zd().optional(),uv={string:t=>Ft.create({...t,coerce:!0}),number:t=>cr.create({...t,coerce:!0}),boolean:t=>lr.create({...t,coerce:!0}),bigint:t=>ur.create({...t,coerce:!0}),date:t=>dr.create({...t,coerce:!0})};var lv=N;var dv=Object.freeze({status:"aborted"});function v(t,e,r){function n(a,c){var u;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(u=a._zod).traits??(u.traits=new Set),a._zod.traits.add(t),e(a,c);for(let l in i.prototype)l in a||Object.defineProperty(a,l,{value:i.prototype[l].bind(a)});a._zod.constr=i,a._zod.def=c}let o=r?.Parent??Object;class s extends o{}Object.defineProperty(s,"name",{value:t});function i(a){var c;let u=r?.Parent?new s:this;n(u,a),(c=u._zod).deferred??(c.deferred=[]);for(let l of u._zod.deferred)l();return u}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(t)}),Object.defineProperty(i,"name",{value:t}),i}var pv=Symbol("zod_brand"),jt=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},qo={};function Je(t){return t&&Object.assign(qo,t),qo}var G={};Di(G,{BIGINT_FORMAT_RANGES:()=>qd,Class:()=>Ki,NUMBER_FORMAT_RANGES:()=>Yi,aborted:()=>kr,allowsEval:()=>Ji,assert:()=>yv,assertEqual:()=>fv,assertIs:()=>hv,assertNever:()=>gv,assertNotEqual:()=>mv,assignProp:()=>Gi,cached:()=>Cn,captureStackTrace:()=>Uo,cleanEnum:()=>Iv,cleanRegex:()=>On,clone:()=>We,createTransparentProxy:()=>wv,defineLazy:()=>ae,esc:()=>wr,escapeRegex:()=>Ht,extend:()=>Tv,finalizeIssue:()=>lt,floatSafeRemainder:()=>Bi,getElementAtPath:()=>_v,getEnumValues:()=>Rn,getLengthableOrigin:()=>An,getParsedType:()=>$v,getSizableOrigin:()=>Ld,isObject:()=>Wr,isPlainObject:()=>Xr,issue:()=>Qi,joinValues:()=>Lo,jsonStringifyReplacer:()=>Hi,merge:()=>Pv,normalizeParams:()=>M,nullish:()=>jn,numKeys:()=>bv,omit:()=>Sv,optionalKeys:()=>Xi,partial:()=>zv,pick:()=>kv,prefixIssues:()=>bt,primitiveTypes:()=>Dd,promiseAllObject:()=>vv,propertyKeyTypes:()=>Wi,randomString:()=>xv,required:()=>Ev,stringifyPrimitive:()=>Fo,unwrapMessage:()=>In});function fv(t){return t}function mv(t){return t}function hv(t){}function gv(t){throw new Error}function yv(t){}function Rn(t){let e=Object.values(t).filter(n=>typeof n=="number");return Object.entries(t).filter(([n,o])=>e.indexOf(+n)===-1).map(([n,o])=>o)}function Lo(t,e="|"){return t.map(r=>Fo(r)).join(e)}function Hi(t,e){return typeof e=="bigint"?e.toString():e}function Cn(t){return{get value(){{let r=t();return Object.defineProperty(this,"value",{value:r}),r}throw new Error("cached value already set")}}}function jn(t){return t==null}function On(t){let e=t.startsWith("^")?1:0,r=t.endsWith("$")?t.length-1:t.length;return t.slice(e,r)}function Bi(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,s=Number.parseInt(t.toFixed(o).replace(".","")),i=Number.parseInt(e.toFixed(o).replace(".",""));return s%i/10**o}function ae(t,e,r){Object.defineProperty(t,e,{get(){{let o=r();return t[e]=o,o}throw new Error("cached value already set")},set(o){Object.defineProperty(t,e,{value:o})},configurable:!0})}function Gi(t,e,r){Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}function _v(t,e){return e?e.reduce((r,n)=>r?.[n],t):t}function vv(t){let e=Object.keys(t),r=e.map(n=>t[n]);return Promise.all(r).then(n=>{let o={};for(let s=0;s<e.length;s++)o[e[s]]=n[s];return o})}function xv(t=10){let e="abcdefghijklmnopqrstuvwxyz",r="";for(let n=0;n<t;n++)r+=e[Math.floor(Math.random()*e.length)];return r}function wr(t){return JSON.stringify(t)}var Uo=Error.captureStackTrace?Error.captureStackTrace:(...t)=>{};function Wr(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}var Ji=Cn(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let t=Function;return new t(""),!0}catch{return!1}});function Xr(t){if(Wr(t)===!1)return!1;let e=t.constructor;if(e===void 0)return!0;let r=e.prototype;return!(Wr(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function bv(t){let e=0;for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}var $v=t=>{let e=typeof t;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(t)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(t)?"array":t===null?"null":t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?"promise":typeof Map<"u"&&t instanceof Map?"map":typeof Set<"u"&&t instanceof Set?"set":typeof Date<"u"&&t instanceof Date?"date":typeof File<"u"&&t instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},Wi=new Set(["string","number","symbol"]),Dd=new Set(["string","number","bigint","boolean","symbol","undefined"]);function Ht(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function We(t,e,r){let n=new t._zod.constr(e??t._zod.def);return(!e||r?.parent)&&(n._zod.parent=t),n}function M(t){let e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function wv(t){let e;return new Proxy({},{get(r,n,o){return e??(e=t()),Reflect.get(e,n,o)},set(r,n,o,s){return e??(e=t()),Reflect.set(e,n,o,s)},has(r,n){return e??(e=t()),Reflect.has(e,n)},deleteProperty(r,n){return e??(e=t()),Reflect.deleteProperty(e,n)},ownKeys(r){return e??(e=t()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(r,n){return e??(e=t()),Reflect.getOwnPropertyDescriptor(e,n)},defineProperty(r,n,o){return e??(e=t()),Reflect.defineProperty(e,n,o)}})}function Fo(t){return typeof t=="bigint"?t.toString()+"n":typeof t=="string"?`"${t}"`:`${t}`}function Xi(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}var Yi={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},qd={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function kv(t,e){let r={},n=t._zod.def;for(let o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&(r[o]=n.shape[o])}return We(t,{...t._zod.def,shape:r,checks:[]})}function Sv(t,e){let r={...t._zod.def.shape},n=t._zod.def;for(let o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&delete r[o]}return We(t,{...t._zod.def,shape:r,checks:[]})}function Tv(t,e){if(!Xr(e))throw new Error("Invalid input to extend: expected a plain object");let r={...t._zod.def,get shape(){let n={...t._zod.def.shape,...e};return Gi(this,"shape",n),n},checks:[]};return We(t,r)}function Pv(t,e){return We(t,{...t._zod.def,get shape(){let r={...t._zod.def.shape,...e._zod.def.shape};return Gi(this,"shape",r),r},catchall:e._zod.def.catchall,checks:[]})}function zv(t,e,r){let n=e._zod.def.shape,o={...n};if(r)for(let s in r){if(!(s in n))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=t?new t({type:"optional",innerType:n[s]}):n[s])}else for(let s in n)o[s]=t?new t({type:"optional",innerType:n[s]}):n[s];return We(e,{...e._zod.def,shape:o,checks:[]})}function Ev(t,e,r){let n=e._zod.def.shape,o={...n};if(r)for(let s in r){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=new t({type:"nonoptional",innerType:n[s]}))}else for(let s in n)o[s]=new t({type:"nonoptional",innerType:n[s]});return We(e,{...e._zod.def,shape:o,checks:[]})}function kr(t,e=0){for(let r=e;r<t.issues.length;r++)if(t.issues[r]?.continue!==!0)return!0;return!1}function bt(t,e){return e.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(t),r})}function In(t){return typeof t=="string"?t:t?.message}function lt(t,e,r){let n={...t,path:t.path??[]};if(!t.message){let o=In(t.inst?._zod.def?.error?.(t))??In(e?.error?.(t))??In(r.customError?.(t))??In(r.localeError?.(t))??"Invalid input";n.message=o}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}function Ld(t){return t instanceof Set?"set":t instanceof Map?"map":t instanceof File?"file":"unknown"}function An(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function Qi(...t){let[e,r,n]=t;return typeof e=="string"?{message:e,code:"custom",input:r,inst:n}:{...e}}function Iv(t){return Object.entries(t).filter(([e,r])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}var Ki=class{constructor(...e){}};var Ud=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),Object.defineProperty(t,"message",{get(){return JSON.stringify(e,Hi,2)},enumerable:!0}),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},Vo=v("$ZodError",Ud),Nn=v("$ZodError",Ud,{Parent:Error});function ea(t,e=r=>r.message){let r={},n=[];for(let o of t.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(e(o))):n.push(e(o));return{formErrors:n,fieldErrors:r}}function ta(t,e){let r=e||function(s){return s.message},n={_errors:[]},o=s=>{for(let i of s.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(a=>o({issues:a}));else if(i.code==="invalid_key")o({issues:i.issues});else if(i.code==="invalid_element")o({issues:i.issues});else if(i.path.length===0)n._errors.push(r(i));else{let a=n,c=0;for(;c<i.path.length;){let u=i.path[c];c===i.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(i))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return o(t),n}var ra=t=>(e,r,n,o)=>{let s=n?Object.assign(n,{async:!1}):{async:!1},i=e._zod.run({value:r,issues:[]},s);if(i instanceof Promise)throw new jt;if(i.issues.length){let a=new(o?.Err??t)(i.issues.map(c=>lt(c,s,Je())));throw Uo(a,o?.callee),a}return i.value},na=ra(Nn),oa=t=>async(e,r,n,o)=>{let s=n?Object.assign(n,{async:!0}):{async:!0},i=e._zod.run({value:r,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){let a=new(o?.Err??t)(i.issues.map(c=>lt(c,s,Je())));throw Uo(a,o?.callee),a}return i.value},sa=oa(Nn),ia=t=>(e,r,n)=>{let o=n?{...n,async:!1}:{async:!1},s=e._zod.run({value:r,issues:[]},o);if(s instanceof Promise)throw new jt;return s.issues.length?{success:!1,error:new(t??Vo)(s.issues.map(i=>lt(i,o,Je())))}:{success:!0,data:s.value}},Sr=ia(Nn),aa=t=>async(e,r,n)=>{let o=n?Object.assign(n,{async:!0}):{async:!0},s=e._zod.run({value:r,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new t(s.issues.map(i=>lt(i,o,Je())))}:{success:!0,data:s.value}},Tr=aa(Nn);var Fd=/^[cC][^\s-]{8,}$/,Vd=/^[0-9a-z]+$/,Kd=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Hd=/^[0-9a-vA-V]{20}$/,Bd=/^[A-Za-z0-9]{27}$/,Gd=/^[a-zA-Z0-9_-]{21}$/,Jd=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/;var Wd=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,ca=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/;var Xd=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;var Cv="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Yd(){return new RegExp(Cv,"u")}var Qd=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ep=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,tp=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,rp=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,np=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,ua=/^[A-Za-z0-9_-]*$/,op=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/;var sp=/^\+(?:[0-9]){6,14}[0-9]$/,ip="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",ap=new RegExp(`^${ip}$`);function cp(t){let e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function up(t){return new RegExp(`^${cp(t)}$`)}function lp(t){let e=cp({precision:t.precision}),r=["Z"];t.local&&r.push(""),t.offset&&r.push("([+-]\\d{2}:\\d{2})");let n=`${e}(?:${r.join("|")})`;return new RegExp(`^${ip}T(?:${n})$`)}var dp=t=>{let e=t?`[\\s\\S]{${t?.minimum??0},${t?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)};var pp=/^\d+$/,fp=/^-?\d+(?:\.\d+)?/i,mp=/true|false/i,hp=/null/i;var gp=/^[^A-Z]*$/,yp=/^[^a-z]*$/;var Se=v("$ZodCheck",(t,e)=>{var r;t._zod??(t._zod={}),t._zod.def=e,(r=t._zod).onattach??(r.onattach=[])}),_p={number:"number",bigint:"bigint",object:"date"},la=v("$ZodCheckLessThan",(t,e)=>{Se.init(t,e);let r=_p[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,s=(e.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<s&&(e.inclusive?o.maximum=e.value:o.exclusiveMaximum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value<=e.value:n.value<e.value)||n.issues.push({origin:r,code:"too_big",maximum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),da=v("$ZodCheckGreaterThan",(t,e)=>{Se.init(t,e);let r=_p[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,s=(e.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>s&&(e.inclusive?o.minimum=e.value:o.exclusiveMinimum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value>=e.value:n.value>e.value)||n.issues.push({origin:r,code:"too_small",minimum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),vp=v("$ZodCheckMultipleOf",(t,e)=>{Se.init(t,e),t._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=e.value)}),t._zod.check=r=>{if(typeof r.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%e.value===BigInt(0):Bi(r.value,e.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:e.value,input:r.value,inst:t,continue:!e.abort})}}),xp=v("$ZodCheckNumberFormat",(t,e)=>{Se.init(t,e),e.format=e.format||"float64";let r=e.format?.includes("int"),n=r?"int":"number",[o,s]=Yi[e.format];t._zod.onattach.push(i=>{let a=i._zod.bag;a.format=e.format,a.minimum=o,a.maximum=s,r&&(a.pattern=pp)}),t._zod.check=i=>{let a=i.value;if(r){if(!Number.isInteger(a)){i.issues.push({expected:n,format:e.format,code:"invalid_type",input:a,inst:t});return}if(!Number.isSafeInteger(a)){a>0?i.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort}):i.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort});return}}a<o&&i.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:t,continue:!e.abort}),a>s&&i.issues.push({origin:"number",input:a,code:"too_big",maximum:s,inst:t})}});var bp=v("$ZodCheckMaxLength",(t,e)=>{var r;Se.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!jn(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let o=n.value;if(o.length<=e.maximum)return;let i=An(o);n.issues.push({origin:i,code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),$p=v("$ZodCheckMinLength",(t,e)=>{var r;Se.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!jn(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let o=n.value;if(o.length>=e.minimum)return;let i=An(o);n.issues.push({origin:i,code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),wp=v("$ZodCheckLengthEquals",(t,e)=>{var r;Se.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!jn(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag;o.minimum=e.length,o.maximum=e.length,o.length=e.length}),t._zod.check=n=>{let o=n.value,s=o.length;if(s===e.length)return;let i=An(o),a=s>e.length;n.issues.push({origin:i,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),Mn=v("$ZodCheckStringFormat",(t,e)=>{var r,n;Se.init(t,e),t._zod.onattach.push(o=>{let s=o._zod.bag;s.format=e.format,e.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(e.pattern))}),e.pattern?(r=t._zod).check??(r.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:e.format,input:o.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(n=t._zod).check??(n.check=()=>{})}),kp=v("$ZodCheckRegex",(t,e)=>{Mn.init(t,e),t._zod.check=r=>{e.pattern.lastIndex=0,!e.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),Sp=v("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=gp),Mn.init(t,e)}),Tp=v("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=yp),Mn.init(t,e)}),Pp=v("$ZodCheckIncludes",(t,e)=>{Se.init(t,e);let r=Ht(e.includes),n=new RegExp(typeof e.position=="number"?`^.{${e.position}}${r}`:r);e.pattern=n,t._zod.onattach.push(o=>{let s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),t._zod.check=o=>{o.value.includes(e.includes,e.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:o.value,inst:t,continue:!e.abort})}}),zp=v("$ZodCheckStartsWith",(t,e)=>{Se.init(t,e);let r=new RegExp(`^${Ht(e.prefix)}.*`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.startsWith(e.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:n.value,inst:t,continue:!e.abort})}}),Ep=v("$ZodCheckEndsWith",(t,e)=>{Se.init(t,e);let r=new RegExp(`.*${Ht(e.suffix)}$`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.endsWith(e.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:n.value,inst:t,continue:!e.abort})}});var Ip=v("$ZodCheckOverwrite",(t,e)=>{Se.init(t,e),t._zod.check=r=>{r.value=e.tx(r.value)}});var Ho=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let n=e.split(`
`).filter(i=>i),o=Math.min(...n.map(i=>i.length-i.trimStart().length)),s=n.map(i=>i.slice(o)).map(i=>" ".repeat(this.indent*2)+i);for(let i of s)this.content.push(i)}compile(){let e=Function,r=this?.args,o=[...(this?.content??[""]).map(s=>`  ${s}`)];return new e(...r,o.join(`
`))}};var Cp={major:4,minor:0,patch:0};var oe=v("$ZodType",(t,e)=>{var r;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=Cp;let n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(let o of n)for(let s of o._zod.onattach)s(t);if(n.length===0)(r=t._zod).deferred??(r.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{let o=(s,i,a)=>{let c=kr(s),u;for(let l of i){if(l._zod.def.when){if(!l._zod.def.when(s))continue}else if(c)continue;let d=s.issues.length,f=l._zod.check(s);if(f instanceof Promise&&a?.async===!1)throw new jt;if(u||f instanceof Promise)u=(u??Promise.resolve()).then(async()=>{await f,s.issues.length!==d&&(c||(c=kr(s,d)))});else{if(s.issues.length===d)continue;c||(c=kr(s,d))}}return u?u.then(()=>s):s};t._zod.run=(s,i)=>{let a=t._zod.parse(s,i);if(a instanceof Promise){if(i.async===!1)throw new jt;return a.then(c=>o(c,n,i))}return o(a,n,i)}}t["~standard"]={validate:o=>{try{let s=Sr(t,o);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return Tr(t,o).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}}),Zn=v("$ZodString",(t,e)=>{oe.init(t,e),t._zod.pattern=[...t?._zod.bag?.patterns??[]].pop()??dp(t._zod.bag),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),ce=v("$ZodStringFormat",(t,e)=>{Mn.init(t,e),Zn.init(t,e)}),fa=v("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=Wd),ce.init(t,e)}),ma=v("$ZodUUID",(t,e)=>{if(e.version){let n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(n===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=ca(n))}else e.pattern??(e.pattern=ca());ce.init(t,e)}),ha=v("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=Xd),ce.init(t,e)}),ga=v("$ZodURL",(t,e)=>{ce.init(t,e),t._zod.check=r=>{try{let n=r.value,o=new URL(n),s=o.href;e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(o.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:op.source,input:r.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:r.value,inst:t,continue:!e.abort})),!n.endsWith("/")&&s.endsWith("/")?r.value=s.slice(0,-1):r.value=s;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:t,continue:!e.abort})}}}),ya=v("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=Yd()),ce.init(t,e)}),_a=v("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=Gd),ce.init(t,e)}),va=v("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=Fd),ce.init(t,e)}),xa=v("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=Vd),ce.init(t,e)}),ba=v("$ZodULID",(t,e)=>{e.pattern??(e.pattern=Kd),ce.init(t,e)}),$a=v("$ZodXID",(t,e)=>{e.pattern??(e.pattern=Hd),ce.init(t,e)}),wa=v("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=Bd),ce.init(t,e)}),Up=v("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=lp(e)),ce.init(t,e)}),Fp=v("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=ap),ce.init(t,e)}),Vp=v("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=up(e)),ce.init(t,e)}),Kp=v("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=Jd),ce.init(t,e)}),ka=v("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=Qd),ce.init(t,e),t._zod.onattach.push(r=>{let n=r._zod.bag;n.format="ipv4"})}),Sa=v("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=ep),ce.init(t,e),t._zod.onattach.push(r=>{let n=r._zod.bag;n.format="ipv6"}),t._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:t,continue:!e.abort})}}}),Ta=v("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=tp),ce.init(t,e)}),Pa=v("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=rp),ce.init(t,e),t._zod.check=r=>{let[n,o]=r.value.split("/");try{if(!o)throw new Error;let s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${n}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:t,continue:!e.abort})}}});function Hp(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}var za=v("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=np),ce.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),t._zod.check=r=>{Hp(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:t,continue:!e.abort})}});function jv(t){if(!ua.test(t))return!1;let e=t.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=e.padEnd(Math.ceil(e.length/4)*4,"=");return Hp(r)}var Ea=v("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=ua),ce.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),t._zod.check=r=>{jv(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:t,continue:!e.abort})}}),Ia=v("$ZodE164",(t,e)=>{e.pattern??(e.pattern=sp),ce.init(t,e)});function Ov(t,e=null){try{let r=t.split(".");if(r.length!==3)return!1;let[n]=r;if(!n)return!1;let o=JSON.parse(atob(n));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||e&&(!("alg"in o)||o.alg!==e))}catch{return!1}}var Ra=v("$ZodJWT",(t,e)=>{ce.init(t,e),t._zod.check=r=>{Ov(r.value,e.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:t,continue:!e.abort})}});var Go=v("$ZodNumber",(t,e)=>{oe.init(t,e),t._zod.pattern=t._zod.bag.pattern??fp,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=Number(r.value)}catch{}let o=r.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return r;let s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:o,inst:t,...s?{received:s}:{}}),r}}),Ca=v("$ZodNumber",(t,e)=>{xp.init(t,e),Go.init(t,e)}),ja=v("$ZodBoolean",(t,e)=>{oe.init(t,e),t._zod.pattern=mp,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=!!r.value}catch{}let o=r.value;return typeof o=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:t}),r}});var Oa=v("$ZodNull",(t,e)=>{oe.init(t,e),t._zod.pattern=hp,t._zod.values=new Set([null]),t._zod.parse=(r,n)=>{let o=r.value;return o===null||r.issues.push({expected:"null",code:"invalid_type",input:o,inst:t}),r}});var Aa=v("$ZodUnknown",(t,e)=>{oe.init(t,e),t._zod.parse=r=>r}),Na=v("$ZodNever",(t,e)=>{oe.init(t,e),t._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)});function jp(t,e,r){t.issues.length&&e.issues.push(...bt(r,t.issues)),e.value[r]=t.value}var Ma=v("$ZodArray",(t,e)=>{oe.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Array.isArray(o))return r.issues.push({expected:"array",code:"invalid_type",input:o,inst:t}),r;r.value=Array(o.length);let s=[];for(let i=0;i<o.length;i++){let a=o[i],c=e.element._zod.run({value:a,issues:[]},n);c instanceof Promise?s.push(c.then(u=>jp(u,r,i))):jp(c,r,i)}return s.length?Promise.all(s).then(()=>r):r}});function Bo(t,e,r){t.issues.length&&e.issues.push(...bt(r,t.issues)),e.value[r]=t.value}function Op(t,e,r,n){t.issues.length?n[r]===void 0?r in n?e.value[r]=void 0:e.value[r]=t.value:e.issues.push(...bt(r,t.issues)):t.value===void 0?r in n&&(e.value[r]=void 0):e.value[r]=t.value}var Jo=v("$ZodObject",(t,e)=>{oe.init(t,e);let r=Cn(()=>{let d=Object.keys(e.shape);for(let m of d)if(!(e.shape[m]instanceof oe))throw new Error(`Invalid element at key "${m}": expected a Zod schema`);let f=Xi(e.shape);return{shape:e.shape,keys:d,keySet:new Set(d),numKeys:d.length,optionalKeys:new Set(f)}});ae(t._zod,"propValues",()=>{let d=e.shape,f={};for(let m in d){let p=d[m]._zod;if(p.values){f[m]??(f[m]=new Set);for(let h of p.values)f[m].add(h)}}return f});let n=d=>{let f=new Ho(["shape","payload","ctx"]),m=r.value,p=x=>{let b=wr(x);return`shape[${b}]._zod.run({ value: input[${b}], issues: [] }, ctx)`};f.write("const input = payload.value;");let h=Object.create(null),g=0;for(let x of m.keys)h[x]=`key_${g++}`;f.write("const newResult = {}");for(let x of m.keys)if(m.optionalKeys.has(x)){let b=h[x];f.write(`const ${b} = ${p(x)};`);let S=wr(x);f.write(`
        if (${b}.issues.length) {
          if (input[${S}] === undefined) {
            if (${S} in input) {
              newResult[${S}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${b}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${S}, ...iss.path] : [${S}],
              }))
            );
          }
        } else if (${b}.value === undefined) {
          if (${S} in input) newResult[${S}] = undefined;
        } else {
          newResult[${S}] = ${b}.value;
        }
        `)}else{let b=h[x];f.write(`const ${b} = ${p(x)};`),f.write(`
          if (${b}.issues.length) payload.issues = payload.issues.concat(${b}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${wr(x)}, ...iss.path] : [${wr(x)}]
          })));`),f.write(`newResult[${wr(x)}] = ${b}.value`)}f.write("payload.value = newResult;"),f.write("return payload;");let _=f.compile();return(x,b)=>_(d,x,b)},o,s=Wr,i=!qo.jitless,c=i&&Ji.value,u=e.catchall,l;t._zod.parse=(d,f)=>{l??(l=r.value);let m=d.value;if(!s(m))return d.issues.push({expected:"object",code:"invalid_type",input:m,inst:t}),d;let p=[];if(i&&c&&f?.async===!1&&f.jitless!==!0)o||(o=n(e.shape)),d=o(d,f);else{d.value={};let b=l.shape;for(let S of l.keys){let I=b[S],Z=I._zod.run({value:m[S],issues:[]},f),ve=I._zod.optin==="optional"&&I._zod.optout==="optional";Z instanceof Promise?p.push(Z.then(Ye=>ve?Op(Ye,d,S,m):Bo(Ye,d,S))):ve?Op(Z,d,S,m):Bo(Z,d,S)}}if(!u)return p.length?Promise.all(p).then(()=>d):d;let h=[],g=l.keySet,_=u._zod,x=_.def.type;for(let b of Object.keys(m)){if(g.has(b))continue;if(x==="never"){h.push(b);continue}let S=_.run({value:m[b],issues:[]},f);S instanceof Promise?p.push(S.then(I=>Bo(I,d,b))):Bo(S,d,b)}return h.length&&d.issues.push({code:"unrecognized_keys",keys:h,input:m,inst:t}),p.length?Promise.all(p).then(()=>d):d}});function Ap(t,e,r,n){for(let o of t)if(o.issues.length===0)return e.value=o.value,e;return e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(o=>o.issues.map(s=>lt(s,n,Je())))}),e}var Wo=v("$ZodUnion",(t,e)=>{oe.init(t,e),ae(t._zod,"optin",()=>e.options.some(r=>r._zod.optin==="optional")?"optional":void 0),ae(t._zod,"optout",()=>e.options.some(r=>r._zod.optout==="optional")?"optional":void 0),ae(t._zod,"values",()=>{if(e.options.every(r=>r._zod.values))return new Set(e.options.flatMap(r=>Array.from(r._zod.values)))}),ae(t._zod,"pattern",()=>{if(e.options.every(r=>r._zod.pattern)){let r=e.options.map(n=>n._zod.pattern);return new RegExp(`^(${r.map(n=>On(n.source)).join("|")})$`)}}),t._zod.parse=(r,n)=>{let o=!1,s=[];for(let i of e.options){let a=i._zod.run({value:r.value,issues:[]},n);if(a instanceof Promise)s.push(a),o=!0;else{if(a.issues.length===0)return a;s.push(a)}}return o?Promise.all(s).then(i=>Ap(i,r,t,n)):Ap(s,r,t,n)}}),Za=v("$ZodDiscriminatedUnion",(t,e)=>{Wo.init(t,e);let r=t._zod.parse;ae(t._zod,"propValues",()=>{let o={};for(let s of e.options){let i=s._zod.propValues;if(!i||Object.keys(i).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(let[a,c]of Object.entries(i)){o[a]||(o[a]=new Set);for(let u of c)o[a].add(u)}}return o});let n=Cn(()=>{let o=e.options,s=new Map;for(let i of o){let a=i._zod.propValues[e.discriminator];if(!a||a.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(i)}"`);for(let c of a){if(s.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);s.set(c,i)}}return s});t._zod.parse=(o,s)=>{let i=o.value;if(!Wr(i))return o.issues.push({code:"invalid_type",expected:"object",input:i,inst:t}),o;let a=n.value.get(i?.[e.discriminator]);return a?a._zod.run(o,s):e.unionFallback?r(o,s):(o.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:i,path:[e.discriminator],inst:t}),o)}}),Da=v("$ZodIntersection",(t,e)=>{oe.init(t,e),t._zod.parse=(r,n)=>{let o=r.value,s=e.left._zod.run({value:o,issues:[]},n),i=e.right._zod.run({value:o,issues:[]},n);return s instanceof Promise||i instanceof Promise?Promise.all([s,i]).then(([c,u])=>Np(r,c,u)):Np(r,s,i)}});function pa(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(Xr(t)&&Xr(e)){let r=Object.keys(e),n=Object.keys(t).filter(s=>r.indexOf(s)!==-1),o={...t,...e};for(let s of n){let i=pa(t[s],e[s]);if(!i.valid)return{valid:!1,mergeErrorPath:[s,...i.mergeErrorPath]};o[s]=i.data}return{valid:!0,data:o}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};let r=[];for(let n=0;n<t.length;n++){let o=t[n],s=e[n],i=pa(o,s);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};r.push(i.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function Np(t,e,r){if(e.issues.length&&t.issues.push(...e.issues),r.issues.length&&t.issues.push(...r.issues),kr(t))return t;let n=pa(e.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return t.value=n.data,t}var qa=v("$ZodRecord",(t,e)=>{oe.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Xr(o))return r.issues.push({expected:"record",code:"invalid_type",input:o,inst:t}),r;let s=[];if(e.keyType._zod.values){let i=e.keyType._zod.values;r.value={};for(let c of i)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){let u=e.valueType._zod.run({value:o[c],issues:[]},n);u instanceof Promise?s.push(u.then(l=>{l.issues.length&&r.issues.push(...bt(c,l.issues)),r.value[c]=l.value})):(u.issues.length&&r.issues.push(...bt(c,u.issues)),r.value[c]=u.value)}let a;for(let c in o)i.has(c)||(a=a??[],a.push(c));a&&a.length>0&&r.issues.push({code:"unrecognized_keys",input:o,inst:t,keys:a})}else{r.value={};for(let i of Reflect.ownKeys(o)){if(i==="__proto__")continue;let a=e.keyType._zod.run({value:i,issues:[]},n);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){r.issues.push({origin:"record",code:"invalid_key",issues:a.issues.map(u=>lt(u,n,Je())),input:i,path:[i],inst:t}),r.value[a.value]=a.value;continue}let c=e.valueType._zod.run({value:o[i],issues:[]},n);c instanceof Promise?s.push(c.then(u=>{u.issues.length&&r.issues.push(...bt(i,u.issues)),r.value[a.value]=u.value})):(c.issues.length&&r.issues.push(...bt(i,c.issues)),r.value[a.value]=c.value)}}return s.length?Promise.all(s).then(()=>r):r}});var La=v("$ZodEnum",(t,e)=>{oe.init(t,e);let r=Rn(e.entries);t._zod.values=new Set(r),t._zod.pattern=new RegExp(`^(${r.filter(n=>Wi.has(typeof n)).map(n=>typeof n=="string"?Ht(n):n.toString()).join("|")})$`),t._zod.parse=(n,o)=>{let s=n.value;return t._zod.values.has(s)||n.issues.push({code:"invalid_value",values:r,input:s,inst:t}),n}}),Ua=v("$ZodLiteral",(t,e)=>{oe.init(t,e),t._zod.values=new Set(e.values),t._zod.pattern=new RegExp(`^(${e.values.map(r=>typeof r=="string"?Ht(r):r?r.toString():String(r)).join("|")})$`),t._zod.parse=(r,n)=>{let o=r.value;return t._zod.values.has(o)||r.issues.push({code:"invalid_value",values:e.values,input:o,inst:t}),r}});var Fa=v("$ZodTransform",(t,e)=>{oe.init(t,e),t._zod.parse=(r,n)=>{let o=e.transform(r.value,r);if(n.async)return(o instanceof Promise?o:Promise.resolve(o)).then(i=>(r.value=i,r));if(o instanceof Promise)throw new jt;return r.value=o,r}}),Va=v("$ZodOptional",(t,e)=>{oe.init(t,e),t._zod.optin="optional",t._zod.optout="optional",ae(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),ae(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${On(r.source)})?$`):void 0}),t._zod.parse=(r,n)=>e.innerType._zod.optin==="optional"?e.innerType._zod.run(r,n):r.value===void 0?r:e.innerType._zod.run(r,n)}),Ka=v("$ZodNullable",(t,e)=>{oe.init(t,e),ae(t._zod,"optin",()=>e.innerType._zod.optin),ae(t._zod,"optout",()=>e.innerType._zod.optout),ae(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${On(r.source)}|null)$`):void 0}),ae(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(r,n)=>r.value===null?r:e.innerType._zod.run(r,n)}),Ha=v("$ZodDefault",(t,e)=>{oe.init(t,e),t._zod.optin="optional",ae(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(r.value===void 0)return r.value=e.defaultValue,r;let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>Mp(s,e)):Mp(o,e)}});function Mp(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}var Ba=v("$ZodPrefault",(t,e)=>{oe.init(t,e),t._zod.optin="optional",ae(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>(r.value===void 0&&(r.value=e.defaultValue),e.innerType._zod.run(r,n))}),Ga=v("$ZodNonOptional",(t,e)=>{oe.init(t,e),ae(t._zod,"values",()=>{let r=e.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>Zp(s,t)):Zp(o,t)}});function Zp(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}var Ja=v("$ZodCatch",(t,e)=>{oe.init(t,e),t._zod.optin="optional",ae(t._zod,"optout",()=>e.innerType._zod.optout),ae(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>(r.value=s.value,s.issues.length&&(r.value=e.catchValue({...r,error:{issues:s.issues.map(i=>lt(i,n,Je()))},input:r.value}),r.issues=[]),r)):(r.value=o.value,o.issues.length&&(r.value=e.catchValue({...r,error:{issues:o.issues.map(s=>lt(s,n,Je()))},input:r.value}),r.issues=[]),r)}});var Wa=v("$ZodPipe",(t,e)=>{oe.init(t,e),ae(t._zod,"values",()=>e.in._zod.values),ae(t._zod,"optin",()=>e.in._zod.optin),ae(t._zod,"optout",()=>e.out._zod.optout),t._zod.parse=(r,n)=>{let o=e.in._zod.run(r,n);return o instanceof Promise?o.then(s=>Dp(s,e,n)):Dp(o,e,n)}});function Dp(t,e,r){return kr(t)?t:e.out._zod.run({value:t.value,issues:t.issues},r)}var Xa=v("$ZodReadonly",(t,e)=>{oe.init(t,e),ae(t._zod,"propValues",()=>e.innerType._zod.propValues),ae(t._zod,"values",()=>e.innerType._zod.values),ae(t._zod,"optin",()=>e.innerType._zod.optin),ae(t._zod,"optout",()=>e.innerType._zod.optout),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(qp):qp(o)}});function qp(t){return t.value=Object.freeze(t.value),t}var Ya=v("$ZodCustom",(t,e)=>{Se.init(t,e),oe.init(t,e),t._zod.parse=(r,n)=>r,t._zod.check=r=>{let n=r.value,o=e.fn(n);if(o instanceof Promise)return o.then(s=>Lp(s,r,n,t));Lp(o,r,n,t)}});function Lp(t,e,r,n){if(!t){let o={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(o.params=n._zod.def.params),e.issues.push(Qi(o))}}var Av=t=>{let e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return e},Nv=()=>{let t={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function e(n){return t[n]??null}let r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return n=>{switch(n.code){case"invalid_type":return`Invalid input: expected ${n.expected}, received ${Av(n.input)}`;case"invalid_value":return n.values.length===1?`Invalid input: expected ${Fo(n.values[0])}`:`Invalid option: expected one of ${Lo(n.values,"|")}`;case"too_big":{let o=n.inclusive?"<=":"<",s=e(n.origin);return s?`Too big: expected ${n.origin??"value"} to have ${o}${n.maximum.toString()} ${s.unit??"elements"}`:`Too big: expected ${n.origin??"value"} to be ${o}${n.maximum.toString()}`}case"too_small":{let o=n.inclusive?">=":">",s=e(n.origin);return s?`Too small: expected ${n.origin} to have ${o}${n.minimum.toString()} ${s.unit}`:`Too small: expected ${n.origin} to be ${o}${n.minimum.toString()}`}case"invalid_format":{let o=n;return o.format==="starts_with"?`Invalid string: must start with "${o.prefix}"`:o.format==="ends_with"?`Invalid string: must end with "${o.suffix}"`:o.format==="includes"?`Invalid string: must include "${o.includes}"`:o.format==="regex"?`Invalid string: must match pattern ${o.pattern}`:`Invalid ${r[o.format]??n.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${n.divisor}`;case"unrecognized_keys":return`Unrecognized key${n.keys.length>1?"s":""}: ${Lo(n.keys,", ")}`;case"invalid_key":return`Invalid key in ${n.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${n.origin}`;default:return"Invalid input"}}};function Bp(){return{localeError:Nv()}}var Mv=Symbol("ZodOutput"),Zv=Symbol("ZodInput"),Dn=class{constructor(){this._map=new Map,this._idmap=new Map}add(e,...r){let n=r[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let r=this._map.get(e);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(e),this}get(e){let r=e._zod.parent;if(r){let n={...this.get(r)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}};function Gp(){return new Dn}var Bt=Gp();function Qa(t,e){return new t({type:"string",...M(e)})}function ec(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...M(e)})}function Xo(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...M(e)})}function tc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...M(e)})}function rc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...M(e)})}function nc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...M(e)})}function oc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...M(e)})}function sc(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...M(e)})}function ic(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...M(e)})}function ac(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...M(e)})}function cc(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...M(e)})}function uc(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...M(e)})}function lc(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...M(e)})}function dc(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...M(e)})}function pc(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...M(e)})}function fc(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...M(e)})}function mc(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...M(e)})}function hc(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...M(e)})}function gc(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...M(e)})}function yc(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...M(e)})}function _c(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...M(e)})}function vc(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...M(e)})}function xc(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...M(e)})}function Jp(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...M(e)})}function Wp(t,e){return new t({type:"string",format:"date",check:"string_format",...M(e)})}function Xp(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...M(e)})}function Yp(t,e){return new t({type:"string",format:"duration",check:"string_format",...M(e)})}function bc(t,e){return new t({type:"number",checks:[],...M(e)})}function $c(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...M(e)})}function wc(t,e){return new t({type:"boolean",...M(e)})}function kc(t,e){return new t({type:"null",...M(e)})}function Sc(t){return new t({type:"unknown"})}function Tc(t,e){return new t({type:"never",...M(e)})}function Yo(t,e){return new la({check:"less_than",...M(e),value:t,inclusive:!1})}function qn(t,e){return new la({check:"less_than",...M(e),value:t,inclusive:!0})}function Qo(t,e){return new da({check:"greater_than",...M(e),value:t,inclusive:!1})}function Ln(t,e){return new da({check:"greater_than",...M(e),value:t,inclusive:!0})}function es(t,e){return new vp({check:"multiple_of",...M(e),value:t})}function ts(t,e){return new bp({check:"max_length",...M(e),maximum:t})}function Yr(t,e){return new $p({check:"min_length",...M(e),minimum:t})}function rs(t,e){return new wp({check:"length_equals",...M(e),length:t})}function Pc(t,e){return new kp({check:"string_format",format:"regex",...M(e),pattern:t})}function zc(t){return new Sp({check:"string_format",format:"lowercase",...M(t)})}function Ec(t){return new Tp({check:"string_format",format:"uppercase",...M(t)})}function Ic(t,e){return new Pp({check:"string_format",format:"includes",...M(e),includes:t})}function Rc(t,e){return new zp({check:"string_format",format:"starts_with",...M(e),prefix:t})}function Cc(t,e){return new Ep({check:"string_format",format:"ends_with",...M(e),suffix:t})}function Pr(t){return new Ip({check:"overwrite",tx:t})}function jc(t){return Pr(e=>e.normalize(t))}function Oc(){return Pr(t=>t.trim())}function Ac(){return Pr(t=>t.toLowerCase())}function Nc(){return Pr(t=>t.toUpperCase())}function Qp(t,e,r){return new t({type:"array",element:e,...M(r)})}function Mc(t,e,r){let n=M(r);return n.abort??(n.abort=!0),new t({type:"custom",check:"custom",fn:e,...n})}function Zc(t,e,r){return new t({type:"custom",check:"custom",fn:e,...M(r)})}var ns=class{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??Bt,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,r={path:[],schemaPath:[]}){var n;let o=e._zod.def,s={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},i=this.seen.get(e);if(i)return i.count++,r.schemaPath.includes(e)&&(i.cycle=r.path),i.schema;let a={schema:{},count:1,cycle:void 0,path:r.path};this.seen.set(e,a);let c=e._zod.toJSONSchema?.();if(c)a.schema=c;else{let d={...r,schemaPath:[...r.schemaPath,e],path:r.path},f=e._zod.parent;if(f)a.ref=f,this.process(f,d),this.seen.get(f).isParent=!0;else{let m=a.schema;switch(o.type){case"string":{let p=m;p.type="string";let{minimum:h,maximum:g,format:_,patterns:x,contentEncoding:b}=e._zod.bag;if(typeof h=="number"&&(p.minLength=h),typeof g=="number"&&(p.maxLength=g),_&&(p.format=s[_]??_,p.format===""&&delete p.format),b&&(p.contentEncoding=b),x&&x.size>0){let S=[...x];S.length===1?p.pattern=S[0].source:S.length>1&&(a.schema.allOf=[...S.map(I=>({...this.target==="draft-7"?{type:"string"}:{},pattern:I.source}))])}break}case"number":{let p=m,{minimum:h,maximum:g,format:_,multipleOf:x,exclusiveMaximum:b,exclusiveMinimum:S}=e._zod.bag;typeof _=="string"&&_.includes("int")?p.type="integer":p.type="number",typeof S=="number"&&(p.exclusiveMinimum=S),typeof h=="number"&&(p.minimum=h,typeof S=="number"&&(S>=h?delete p.minimum:delete p.exclusiveMinimum)),typeof b=="number"&&(p.exclusiveMaximum=b),typeof g=="number"&&(p.maximum=g,typeof b=="number"&&(b<=g?delete p.maximum:delete p.exclusiveMaximum)),typeof x=="number"&&(p.multipleOf=x);break}case"boolean":{let p=m;p.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{m.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{m.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{let p=m,{minimum:h,maximum:g}=e._zod.bag;typeof h=="number"&&(p.minItems=h),typeof g=="number"&&(p.maxItems=g),p.type="array",p.items=this.process(o.element,{...d,path:[...d.path,"items"]});break}case"object":{let p=m;p.type="object",p.properties={};let h=o.shape;for(let x in h)p.properties[x]=this.process(h[x],{...d,path:[...d.path,"properties",x]});let g=new Set(Object.keys(h)),_=new Set([...g].filter(x=>{let b=o.shape[x]._zod;return this.io==="input"?b.optin===void 0:b.optout===void 0}));_.size>0&&(p.required=Array.from(_)),o.catchall?._zod.def.type==="never"?p.additionalProperties=!1:o.catchall?o.catchall&&(p.additionalProperties=this.process(o.catchall,{...d,path:[...d.path,"additionalProperties"]})):this.io==="output"&&(p.additionalProperties=!1);break}case"union":{let p=m;p.anyOf=o.options.map((h,g)=>this.process(h,{...d,path:[...d.path,"anyOf",g]}));break}case"intersection":{let p=m,h=this.process(o.left,{...d,path:[...d.path,"allOf",0]}),g=this.process(o.right,{...d,path:[...d.path,"allOf",1]}),_=b=>"allOf"in b&&Object.keys(b).length===1,x=[..._(h)?h.allOf:[h],..._(g)?g.allOf:[g]];p.allOf=x;break}case"tuple":{let p=m;p.type="array";let h=o.items.map((x,b)=>this.process(x,{...d,path:[...d.path,"prefixItems",b]}));if(this.target==="draft-2020-12"?p.prefixItems=h:p.items=h,o.rest){let x=this.process(o.rest,{...d,path:[...d.path,"items"]});this.target==="draft-2020-12"?p.items=x:p.additionalItems=x}o.rest&&(p.items=this.process(o.rest,{...d,path:[...d.path,"items"]}));let{minimum:g,maximum:_}=e._zod.bag;typeof g=="number"&&(p.minItems=g),typeof _=="number"&&(p.maxItems=_);break}case"record":{let p=m;p.type="object",p.propertyNames=this.process(o.keyType,{...d,path:[...d.path,"propertyNames"]}),p.additionalProperties=this.process(o.valueType,{...d,path:[...d.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{let p=m,h=Rn(o.entries);h.every(g=>typeof g=="number")&&(p.type="number"),h.every(g=>typeof g=="string")&&(p.type="string"),p.enum=h;break}case"literal":{let p=m,h=[];for(let g of o.values)if(g===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof g=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");h.push(Number(g))}else h.push(g);if(h.length!==0)if(h.length===1){let g=h[0];p.type=g===null?"null":typeof g,p.const=g}else h.every(g=>typeof g=="number")&&(p.type="number"),h.every(g=>typeof g=="string")&&(p.type="string"),h.every(g=>typeof g=="boolean")&&(p.type="string"),h.every(g=>g===null)&&(p.type="null"),p.enum=h;break}case"file":{let p=m,h={type:"string",format:"binary",contentEncoding:"binary"},{minimum:g,maximum:_,mime:x}=e._zod.bag;g!==void 0&&(h.minLength=g),_!==void 0&&(h.maxLength=_),x?x.length===1?(h.contentMediaType=x[0],Object.assign(p,h)):p.anyOf=x.map(b=>({...h,contentMediaType:b})):Object.assign(p,h);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{let p=this.process(o.innerType,d);m.anyOf=[p,{type:"null"}];break}case"nonoptional":{this.process(o.innerType,d),a.ref=o.innerType;break}case"success":{let p=m;p.type="boolean";break}case"default":{this.process(o.innerType,d),a.ref=o.innerType,m.default=JSON.parse(JSON.stringify(o.defaultValue));break}case"prefault":{this.process(o.innerType,d),a.ref=o.innerType,this.io==="input"&&(m._prefault=JSON.parse(JSON.stringify(o.defaultValue)));break}case"catch":{this.process(o.innerType,d),a.ref=o.innerType;let p;try{p=o.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}m.default=p;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{let p=m,h=e._zod.pattern;if(!h)throw new Error("Pattern not found in template literal");p.type="string",p.pattern=h.source;break}case"pipe":{let p=this.io==="input"?o.in._zod.def.type==="transform"?o.out:o.in:o.out;this.process(p,d),a.ref=p;break}case"readonly":{this.process(o.innerType,d),a.ref=o.innerType,m.readOnly=!0;break}case"promise":{this.process(o.innerType,d),a.ref=o.innerType;break}case"optional":{this.process(o.innerType,d),a.ref=o.innerType;break}case"lazy":{let p=e._zod.innerType;this.process(p,d),a.ref=p;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}default:}}}let u=this.metadataRegistry.get(e);return u&&Object.assign(a.schema,u),this.io==="input"&&$e(e)&&(delete a.schema.examples,delete a.schema.default),this.io==="input"&&a.schema._prefault&&((n=a.schema).default??(n.default=a.schema._prefault)),delete a.schema._prefault,this.seen.get(e).schema}emit(e,r){let n={cycles:r?.cycles??"ref",reused:r?.reused??"inline",external:r?.external??void 0},o=this.seen.get(e);if(!o)throw new Error("Unprocessed schema. This is a bug in Zod.");let s=l=>{let d=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){let h=n.external.registry.get(l[0])?.id,g=n.external.uri??(x=>x);if(h)return{ref:g(h)};let _=l[1].defId??l[1].schema.id??`schema${this.counter++}`;return l[1].defId=_,{defId:_,ref:`${g("__shared")}#/${d}/${_}`}}if(l[1]===o)return{ref:"#"};let m=`#/${d}/`,p=l[1].schema.id??`__schema${this.counter++}`;return{defId:p,ref:m+p}},i=l=>{if(l[1].schema.$ref)return;let d=l[1],{ref:f,defId:m}=s(l);d.def={...d.schema},m&&(d.defId=m);let p=d.schema;for(let h in p)delete p[h];p.$ref=f};if(n.cycles==="throw")for(let l of this.seen.entries()){let d=l[1];if(d.cycle)throw new Error(`Cycle detected: #/${d.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let l of this.seen.entries()){let d=l[1];if(e===l[0]){i(l);continue}if(n.external){let m=n.external.registry.get(l[0])?.id;if(e!==l[0]&&m){i(l);continue}}if(this.metadataRegistry.get(l[0])?.id){i(l);continue}if(d.cycle){i(l);continue}if(d.count>1&&n.reused==="ref"){i(l);continue}}let a=(l,d)=>{let f=this.seen.get(l),m=f.def??f.schema,p={...m};if(f.ref===null)return;let h=f.ref;if(f.ref=null,h){a(h,d);let g=this.seen.get(h).schema;g.$ref&&d.target==="draft-7"?(m.allOf=m.allOf??[],m.allOf.push(g)):(Object.assign(m,g),Object.assign(m,p))}f.isParent||this.override({zodSchema:l,jsonSchema:m,path:f.path??[]})};for(let l of[...this.seen.entries()].reverse())a(l[0],{target:this.target});let c={};if(this.target==="draft-2020-12"?c.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?c.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),n.external?.uri){let l=n.external.registry.get(e)?.id;if(!l)throw new Error("Schema is missing an `id` property");c.$id=n.external.uri(l)}Object.assign(c,o.def);let u=n.external?.defs??{};for(let l of this.seen.entries()){let d=l[1];d.def&&d.defId&&(u[d.defId]=d.def)}n.external||Object.keys(u).length>0&&(this.target==="draft-2020-12"?c.$defs=u:c.definitions=u);try{return JSON.parse(JSON.stringify(c))}catch{throw new Error("Error converting schema to JSON.")}}};function Dc(t,e){if(t instanceof Dn){let n=new ns(e),o={};for(let a of t._idmap.entries()){let[c,u]=a;n.process(u)}let s={},i={registry:t,uri:e?.uri,defs:o};for(let a of t._idmap.entries()){let[c,u]=a;s[c]=n.emit(u,{...e,external:i})}if(Object.keys(o).length>0){let a=n.target==="draft-2020-12"?"$defs":"definitions";s.__shared={[a]:o}}return{schemas:s}}let r=new ns(e);return r.process(t),r.emit(t,e)}function $e(t,e){let r=e??{seen:new Set};if(r.seen.has(t))return!1;r.seen.add(t);let o=t._zod.def;switch(o.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return $e(o.element,r);case"object":{for(let s in o.shape)if($e(o.shape[s],r))return!0;return!1}case"union":{for(let s of o.options)if($e(s,r))return!0;return!1}case"intersection":return $e(o.left,r)||$e(o.right,r);case"tuple":{for(let s of o.items)if($e(s,r))return!0;return!!(o.rest&&$e(o.rest,r))}case"record":return $e(o.keyType,r)||$e(o.valueType,r);case"map":return $e(o.keyType,r)||$e(o.valueType,r);case"set":return $e(o.valueType,r);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return $e(o.innerType,r);case"lazy":return $e(o.getter(),r);case"default":return $e(o.innerType,r);case"prefault":return $e(o.innerType,r);case"custom":return!1;case"transform":return!0;case"pipe":return $e(o.in,r)||$e(o.out,r);case"success":return!1;case"catch":return!1;default:}throw new Error(`Unknown schema type: ${o.type}`)}var vx=v("ZodMiniType",(t,e)=>{if(!t._zod)throw new Error("Uninitialized schema in ZodMiniType.");oe.init(t,e),t.def=e,t.parse=(r,n)=>na(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>Sr(t,r,n),t.parseAsync=async(r,n)=>sa(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>Tr(t,r,n),t.check=(...r)=>t.clone({...e,checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),t.clone=(r,n)=>We(t,r,n),t.brand=()=>t,t.register=(r,n)=>(r.add(t,n),t)});var xx=v("ZodMiniObject",(t,e)=>{Jo.init(t,e),vx.init(t,e),G.defineLazy(t,"shape",()=>e.shape)});function qc(t,e){let r={type:"object",get shape(){return G.assignProp(this,"shape",{...t}),this.shape},...G.normalizeParams(e)};return new xx(r)}function tt(t){return!!t._zod}function Er(t){let e=Object.values(t);if(e.length===0)return qc({});let r=e.every(tt),n=e.every(o=>!tt(o));if(r)return qc(t);if(n)return Fi(t);throw new Error("Mixed Zod versions detected in object shape.")}function Gt(t,e){return tt(t)?Sr(t,e):t.safeParse(e)}async function os(t,e){return tt(t)?await Tr(t,e):await t.safeParseAsync(e)}function Jt(t){if(!t)return;let e;if(tt(t)?e=t._zod?.def?.shape:e=t.shape,!!e){if(typeof e=="function")try{return e()}catch{return}return e}}function Qr(t){if(t){if(typeof t=="object"){let e=t,r=t;if(!e._def&&!r._zod){let n=Object.values(t);if(n.length>0&&n.every(o=>typeof o=="object"&&o!==null&&(o._def!==void 0||o._zod!==void 0||typeof o.parse=="function")))return Er(t)}}if(tt(t)){let r=t._zod?.def;if(r&&(r.type==="object"||r.shape!==void 0))return t}else if(t.shape!==void 0)return t}}function ss(t){if(t&&typeof t=="object"){if("message"in t&&typeof t.message=="string")return t.message;if("issues"in t&&Array.isArray(t.issues)&&t.issues.length>0){let e=t.issues[0];if(e&&typeof e=="object"&&"message"in e)return String(e.message)}try{return JSON.stringify(t)}catch{return String(t)}}return String(t)}function tf(t){return t.description}function rf(t){if(tt(t))return t._zod?.def?.type==="optional";let e=t;return typeof t.isOptional=="function"?t.isOptional():e._def?.typeName==="ZodOptional"}function is(t){if(tt(t)){let s=t._zod?.def;if(s){if(s.value!==void 0)return s.value;if(Array.isArray(s.values)&&s.values.length>0)return s.values[0]}}let r=t._def;if(r){if(r.value!==void 0)return r.value;if(Array.isArray(r.values)&&r.values.length>0)return r.values[0]}let n=t.value;if(n!==void 0)return n}var Un={};Di(Un,{ZodISODate:()=>of,ZodISODateTime:()=>nf,ZodISODuration:()=>af,ZodISOTime:()=>sf,date:()=>Uc,datetime:()=>Lc,duration:()=>Vc,time:()=>Fc});var nf=v("ZodISODateTime",(t,e)=>{Up.init(t,e),pe.init(t,e)});function Lc(t){return Jp(nf,t)}var of=v("ZodISODate",(t,e)=>{Fp.init(t,e),pe.init(t,e)});function Uc(t){return Wp(of,t)}var sf=v("ZodISOTime",(t,e)=>{Vp.init(t,e),pe.init(t,e)});function Fc(t){return Xp(sf,t)}var af=v("ZodISODuration",(t,e)=>{Kp.init(t,e),pe.init(t,e)});function Vc(t){return Yp(af,t)}var cf=(t,e)=>{Vo.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:r=>ta(t,r)},flatten:{value:r=>ea(t,r)},addIssue:{value:r=>t.issues.push(r)},addIssues:{value:r=>t.issues.push(...r)},isEmpty:{get(){return t.issues.length===0}}})},kI=v("ZodError",cf),Fn=v("ZodError",cf,{Parent:Error});var uf=ra(Fn),lf=oa(Fn),df=ia(Fn),pf=aa(Fn);var _e=v("ZodType",(t,e)=>(oe.init(t,e),t.def=e,Object.defineProperty(t,"_def",{value:e}),t.check=(...r)=>t.clone({...e,checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),t.clone=(r,n)=>We(t,r,n),t.brand=()=>t,t.register=(r,n)=>(r.add(t,n),t),t.parse=(r,n)=>uf(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>df(t,r,n),t.parseAsync=async(r,n)=>lf(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>pf(t,r,n),t.spa=t.safeParseAsync,t.refine=(r,n)=>t.check(yb(r,n)),t.superRefine=r=>t.check(_b(r)),t.overwrite=r=>t.check(Pr(r)),t.optional=()=>ye(t),t.nullable=()=>hf(t),t.nullish=()=>ye(hf(t)),t.nonoptional=r=>lb(t,r),t.array=()=>J(t),t.or=r=>ue([t,r]),t.and=r=>cs(t,r),t.transform=r=>Hc(t,xf(r)),t.default=r=>ab(t,r),t.prefault=r=>ub(t,r),t.catch=r=>pb(t,r),t.pipe=r=>Hc(t,r),t.readonly=()=>hb(t),t.describe=r=>{let n=t.clone();return Bt.add(n,{description:r}),n},Object.defineProperty(t,"description",{get(){return Bt.get(t)?.description},configurable:!0}),t.meta=(...r)=>{if(r.length===0)return Bt.get(t);let n=t.clone();return Bt.add(n,r[0]),n},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),gf=v("_ZodString",(t,e)=>{Zn.init(t,e),_e.init(t,e);let r=t._zod.bag;t.format=r.format??null,t.minLength=r.minimum??null,t.maxLength=r.maximum??null,t.regex=(...n)=>t.check(Pc(...n)),t.includes=(...n)=>t.check(Ic(...n)),t.startsWith=(...n)=>t.check(Rc(...n)),t.endsWith=(...n)=>t.check(Cc(...n)),t.min=(...n)=>t.check(Yr(...n)),t.max=(...n)=>t.check(ts(...n)),t.length=(...n)=>t.check(rs(...n)),t.nonempty=(...n)=>t.check(Yr(1,...n)),t.lowercase=n=>t.check(zc(n)),t.uppercase=n=>t.check(Ec(n)),t.trim=()=>t.check(Oc()),t.normalize=(...n)=>t.check(jc(...n)),t.toLowerCase=()=>t.check(Ac()),t.toUpperCase=()=>t.check(Nc())}),Ex=v("ZodString",(t,e)=>{Zn.init(t,e),gf.init(t,e),t.email=r=>t.check(ec(Ix,r)),t.url=r=>t.check(sc(Rx,r)),t.jwt=r=>t.check(xc(Hx,r)),t.emoji=r=>t.check(ic(Cx,r)),t.guid=r=>t.check(Xo(ff,r)),t.uuid=r=>t.check(tc(as,r)),t.uuidv4=r=>t.check(rc(as,r)),t.uuidv6=r=>t.check(nc(as,r)),t.uuidv7=r=>t.check(oc(as,r)),t.nanoid=r=>t.check(ac(jx,r)),t.guid=r=>t.check(Xo(ff,r)),t.cuid=r=>t.check(cc(Ox,r)),t.cuid2=r=>t.check(uc(Ax,r)),t.ulid=r=>t.check(lc(Nx,r)),t.base64=r=>t.check(yc(Fx,r)),t.base64url=r=>t.check(_c(Vx,r)),t.xid=r=>t.check(dc(Mx,r)),t.ksuid=r=>t.check(pc(Zx,r)),t.ipv4=r=>t.check(fc(Dx,r)),t.ipv6=r=>t.check(mc(qx,r)),t.cidrv4=r=>t.check(hc(Lx,r)),t.cidrv6=r=>t.check(gc(Ux,r)),t.e164=r=>t.check(vc(Kx,r)),t.datetime=r=>t.check(Lc(r)),t.date=r=>t.check(Uc(r)),t.time=r=>t.check(Fc(r)),t.duration=r=>t.check(Vc(r))});function y(t){return Qa(Ex,t)}var pe=v("ZodStringFormat",(t,e)=>{ce.init(t,e),gf.init(t,e)}),Ix=v("ZodEmail",(t,e)=>{ha.init(t,e),pe.init(t,e)});var ff=v("ZodGUID",(t,e)=>{fa.init(t,e),pe.init(t,e)});var as=v("ZodUUID",(t,e)=>{ma.init(t,e),pe.init(t,e)});var Rx=v("ZodURL",(t,e)=>{ga.init(t,e),pe.init(t,e)});var Cx=v("ZodEmoji",(t,e)=>{ya.init(t,e),pe.init(t,e)});var jx=v("ZodNanoID",(t,e)=>{_a.init(t,e),pe.init(t,e)});var Ox=v("ZodCUID",(t,e)=>{va.init(t,e),pe.init(t,e)});var Ax=v("ZodCUID2",(t,e)=>{xa.init(t,e),pe.init(t,e)});var Nx=v("ZodULID",(t,e)=>{ba.init(t,e),pe.init(t,e)});var Mx=v("ZodXID",(t,e)=>{$a.init(t,e),pe.init(t,e)});var Zx=v("ZodKSUID",(t,e)=>{wa.init(t,e),pe.init(t,e)});var Dx=v("ZodIPv4",(t,e)=>{ka.init(t,e),pe.init(t,e)});var qx=v("ZodIPv6",(t,e)=>{Sa.init(t,e),pe.init(t,e)});var Lx=v("ZodCIDRv4",(t,e)=>{Ta.init(t,e),pe.init(t,e)});var Ux=v("ZodCIDRv6",(t,e)=>{Pa.init(t,e),pe.init(t,e)});var Fx=v("ZodBase64",(t,e)=>{za.init(t,e),pe.init(t,e)});var Vx=v("ZodBase64URL",(t,e)=>{Ea.init(t,e),pe.init(t,e)});var Kx=v("ZodE164",(t,e)=>{Ia.init(t,e),pe.init(t,e)});var Hx=v("ZodJWT",(t,e)=>{Ra.init(t,e),pe.init(t,e)});var yf=v("ZodNumber",(t,e)=>{Go.init(t,e),_e.init(t,e),t.gt=(n,o)=>t.check(Qo(n,o)),t.gte=(n,o)=>t.check(Ln(n,o)),t.min=(n,o)=>t.check(Ln(n,o)),t.lt=(n,o)=>t.check(Yo(n,o)),t.lte=(n,o)=>t.check(qn(n,o)),t.max=(n,o)=>t.check(qn(n,o)),t.int=n=>t.check(mf(n)),t.safe=n=>t.check(mf(n)),t.positive=n=>t.check(Qo(0,n)),t.nonnegative=n=>t.check(Ln(0,n)),t.negative=n=>t.check(Yo(0,n)),t.nonpositive=n=>t.check(qn(0,n)),t.multipleOf=(n,o)=>t.check(es(n,o)),t.step=(n,o)=>t.check(es(n,o)),t.finite=()=>t;let r=t._zod.bag;t.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),t.isFinite=!0,t.format=r.format??null});function re(t){return bc(yf,t)}var Bx=v("ZodNumberFormat",(t,e)=>{Ca.init(t,e),yf.init(t,e)});function mf(t){return $c(Bx,t)}var Gx=v("ZodBoolean",(t,e)=>{ja.init(t,e),_e.init(t,e)});function we(t){return wc(Gx,t)}var Jx=v("ZodNull",(t,e)=>{Oa.init(t,e),_e.init(t,e)});function Bc(t){return kc(Jx,t)}var Wx=v("ZodUnknown",(t,e)=>{Aa.init(t,e),_e.init(t,e)});function fe(){return Sc(Wx)}var Xx=v("ZodNever",(t,e)=>{Na.init(t,e),_e.init(t,e)});function Yx(t){return Tc(Xx,t)}var Qx=v("ZodArray",(t,e)=>{Ma.init(t,e),_e.init(t,e),t.element=e.element,t.min=(r,n)=>t.check(Yr(r,n)),t.nonempty=r=>t.check(Yr(1,r)),t.max=(r,n)=>t.check(ts(r,n)),t.length=(r,n)=>t.check(rs(r,n)),t.unwrap=()=>t.element});function J(t,e){return Qp(Qx,t,e)}var _f=v("ZodObject",(t,e)=>{Jo.init(t,e),_e.init(t,e),G.defineLazy(t,"shape",()=>e.shape),t.keyof=()=>Ve(Object.keys(t._zod.def.shape)),t.catchall=r=>t.clone({...t._zod.def,catchall:r}),t.passthrough=()=>t.clone({...t._zod.def,catchall:fe()}),t.loose=()=>t.clone({...t._zod.def,catchall:fe()}),t.strict=()=>t.clone({...t._zod.def,catchall:Yx()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=r=>G.extend(t,r),t.merge=r=>G.merge(t,r),t.pick=r=>G.pick(t,r),t.omit=r=>G.omit(t,r),t.partial=(...r)=>G.partial(bf,t,r[0]),t.required=(...r)=>G.required($f,t,r[0])});function E(t,e){let r={type:"object",get shape(){return G.assignProp(this,"shape",{...t}),this.shape},...G.normalizeParams(e)};return new _f(r)}function Ne(t,e){return new _f({type:"object",get shape(){return G.assignProp(this,"shape",{...t}),this.shape},catchall:fe(),...G.normalizeParams(e)})}var vf=v("ZodUnion",(t,e)=>{Wo.init(t,e),_e.init(t,e),t.options=e.options});function ue(t,e){return new vf({type:"union",options:t,...G.normalizeParams(e)})}var eb=v("ZodDiscriminatedUnion",(t,e)=>{vf.init(t,e),Za.init(t,e)});function Gc(t,e,r){return new eb({type:"union",options:e,discriminator:t,...G.normalizeParams(r)})}var tb=v("ZodIntersection",(t,e)=>{Da.init(t,e),_e.init(t,e)});function cs(t,e){return new tb({type:"intersection",left:t,right:e})}var rb=v("ZodRecord",(t,e)=>{qa.init(t,e),_e.init(t,e),t.keyType=e.keyType,t.valueType=e.valueType});function me(t,e,r){return new rb({type:"record",keyType:t,valueType:e,...G.normalizeParams(r)})}var Kc=v("ZodEnum",(t,e)=>{La.init(t,e),_e.init(t,e),t.enum=e.entries,t.options=Object.values(e.entries);let r=new Set(Object.keys(e.entries));t.extract=(n,o)=>{let s={};for(let i of n)if(r.has(i))s[i]=e.entries[i];else throw new Error(`Key ${i} not found in enum`);return new Kc({...e,checks:[],...G.normalizeParams(o),entries:s})},t.exclude=(n,o)=>{let s={...e.entries};for(let i of n)if(r.has(i))delete s[i];else throw new Error(`Key ${i} not found in enum`);return new Kc({...e,checks:[],...G.normalizeParams(o),entries:s})}});function Ve(t,e){let r=Array.isArray(t)?Object.fromEntries(t.map(n=>[n,n])):t;return new Kc({type:"enum",entries:r,...G.normalizeParams(e)})}var nb=v("ZodLiteral",(t,e)=>{Ua.init(t,e),_e.init(t,e),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function j(t,e){return new nb({type:"literal",values:Array.isArray(t)?t:[t],...G.normalizeParams(e)})}var ob=v("ZodTransform",(t,e)=>{Fa.init(t,e),_e.init(t,e),t._zod.parse=(r,n)=>{r.addIssue=s=>{if(typeof s=="string")r.issues.push(G.issue(s,r.value,e));else{let i=s;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=t),i.continue??(i.continue=!0),r.issues.push(G.issue(i))}};let o=e.transform(r.value,r);return o instanceof Promise?o.then(s=>(r.value=s,r)):(r.value=o,r)}});function xf(t){return new ob({type:"transform",transform:t})}var bf=v("ZodOptional",(t,e)=>{Va.init(t,e),_e.init(t,e),t.unwrap=()=>t._zod.def.innerType});function ye(t){return new bf({type:"optional",innerType:t})}var sb=v("ZodNullable",(t,e)=>{Ka.init(t,e),_e.init(t,e),t.unwrap=()=>t._zod.def.innerType});function hf(t){return new sb({type:"nullable",innerType:t})}var ib=v("ZodDefault",(t,e)=>{Ha.init(t,e),_e.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function ab(t,e){return new ib({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}var cb=v("ZodPrefault",(t,e)=>{Ba.init(t,e),_e.init(t,e),t.unwrap=()=>t._zod.def.innerType});function ub(t,e){return new cb({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}var $f=v("ZodNonOptional",(t,e)=>{Ga.init(t,e),_e.init(t,e),t.unwrap=()=>t._zod.def.innerType});function lb(t,e){return new $f({type:"nonoptional",innerType:t,...G.normalizeParams(e)})}var db=v("ZodCatch",(t,e)=>{Ja.init(t,e),_e.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function pb(t,e){return new db({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}var fb=v("ZodPipe",(t,e)=>{Wa.init(t,e),_e.init(t,e),t.in=e.in,t.out=e.out});function Hc(t,e){return new fb({type:"pipe",in:t,out:e})}var mb=v("ZodReadonly",(t,e)=>{Xa.init(t,e),_e.init(t,e)});function hb(t){return new mb({type:"readonly",innerType:t})}var wf=v("ZodCustom",(t,e)=>{Ya.init(t,e),_e.init(t,e)});function gb(t){let e=new Se({check:"custom"});return e._zod.check=t,e}function kf(t,e){return Mc(wf,t??(()=>!0),e)}function yb(t,e={}){return Zc(wf,t,e)}function _b(t){let e=gb(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(G.issue(n,r.value,e._zod.def));else{let o=n;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=e),o.continue??(o.continue=!e._zod.def.abort),r.issues.push(G.issue(o))}},t(r.value,r)));return e}function Jc(t,e){return Hc(xf(t),e)}Je(Bp());var Xc="2025-11-25";var Sf=[Xc,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],Wt="io.modelcontextprotocol/related-task",ls="2.0",Te=kf(t=>t!==null&&(typeof t=="object"||typeof t=="function")),Tf=ue([y(),re().int()]),Pf=y(),ZI=Ne({ttl:ue([re(),Bc()]).optional(),pollInterval:re().optional()}),vb=E({ttl:re().optional()}),xb=E({taskId:y()}),Yc=Ne({progressToken:Tf.optional(),[Wt]:xb.optional()}),Xe=E({_meta:Yc.optional()}),Vn=Xe.extend({task:vb.optional()}),zf=t=>Vn.safeParse(t).success,Pe=E({method:y(),params:Xe.loose().optional()}),rt=E({_meta:Yc.optional()}),nt=E({method:y(),params:rt.loose().optional()}),ze=Ne({_meta:Yc.optional()}),ds=ue([y(),re().int()]),Ef=E({jsonrpc:j(ls),id:ds,...Pe.shape}).strict(),Qc=t=>Ef.safeParse(t).success,If=E({jsonrpc:j(ls),...nt.shape}).strict(),Rf=t=>If.safeParse(t).success,eu=E({jsonrpc:j(ls),id:ds,result:ze}).strict(),Kn=t=>eu.safeParse(t).success;var A;(function(t){t[t.ConnectionClosed=-32e3]="ConnectionClosed",t[t.RequestTimeout=-32001]="RequestTimeout",t[t.ParseError=-32700]="ParseError",t[t.InvalidRequest=-32600]="InvalidRequest",t[t.MethodNotFound=-32601]="MethodNotFound",t[t.InvalidParams=-32602]="InvalidParams",t[t.InternalError=-32603]="InternalError",t[t.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(A||(A={}));var tu=E({jsonrpc:j(ls),id:ds.optional(),error:E({code:re().int(),message:y(),data:fe().optional()})}).strict();var Cf=t=>tu.safeParse(t).success;var jf=ue([Ef,If,eu,tu]),DI=ue([eu,tu]),ps=ze.strict(),bb=rt.extend({requestId:ds.optional(),reason:y().optional()}),fs=nt.extend({method:j("notifications/cancelled"),params:bb}),$b=E({src:y(),mimeType:y().optional(),sizes:J(y()).optional(),theme:Ve(["light","dark"]).optional()}),Hn=E({icons:J($b).optional()}),en=E({name:y(),title:y().optional()}),Of=en.extend({...en.shape,...Hn.shape,version:y(),websiteUrl:y().optional(),description:y().optional()}),wb=cs(E({applyDefaults:we().optional()}),me(y(),fe())),kb=Jc(t=>t&&typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).length===0?{form:{}}:t,cs(E({form:wb.optional(),url:Te.optional()}),me(y(),fe()).optional())),Sb=Ne({list:Te.optional(),cancel:Te.optional(),requests:Ne({sampling:Ne({createMessage:Te.optional()}).optional(),elicitation:Ne({create:Te.optional()}).optional()}).optional()}),Tb=Ne({list:Te.optional(),cancel:Te.optional(),requests:Ne({tools:Ne({call:Te.optional()}).optional()}).optional()}),Pb=E({experimental:me(y(),Te).optional(),sampling:E({context:Te.optional(),tools:Te.optional()}).optional(),elicitation:kb.optional(),roots:E({listChanged:we().optional()}).optional(),tasks:Sb.optional()}),zb=Xe.extend({protocolVersion:y(),capabilities:Pb,clientInfo:Of}),ru=Pe.extend({method:j("initialize"),params:zb});var Eb=E({experimental:me(y(),Te).optional(),logging:Te.optional(),completions:Te.optional(),prompts:E({listChanged:we().optional()}).optional(),resources:E({subscribe:we().optional(),listChanged:we().optional()}).optional(),tools:E({listChanged:we().optional()}).optional(),tasks:Tb.optional()}),Ib=ze.extend({protocolVersion:y(),capabilities:Eb,serverInfo:Of,instructions:y().optional()}),nu=nt.extend({method:j("notifications/initialized"),params:rt.optional()});var ms=Pe.extend({method:j("ping"),params:Xe.optional()}),Rb=E({progress:re(),total:ye(re()),message:ye(y())}),Cb=E({...rt.shape,...Rb.shape,progressToken:Tf}),hs=nt.extend({method:j("notifications/progress"),params:Cb}),jb=Xe.extend({cursor:Pf.optional()}),Bn=Pe.extend({params:jb.optional()}),Gn=ze.extend({nextCursor:Pf.optional()}),Ob=Ve(["working","input_required","completed","failed","cancelled"]),Jn=E({taskId:y(),status:Ob,ttl:ue([re(),Bc()]),createdAt:y(),lastUpdatedAt:y(),pollInterval:ye(re()),statusMessage:ye(y())}),tn=ze.extend({task:Jn}),Ab=rt.merge(Jn),Wn=nt.extend({method:j("notifications/tasks/status"),params:Ab}),gs=Pe.extend({method:j("tasks/get"),params:Xe.extend({taskId:y()})}),ys=ze.merge(Jn),_s=Pe.extend({method:j("tasks/result"),params:Xe.extend({taskId:y()})}),qI=ze.loose(),vs=Bn.extend({method:j("tasks/list")}),xs=Gn.extend({tasks:J(Jn)}),bs=Pe.extend({method:j("tasks/cancel"),params:Xe.extend({taskId:y()})}),Af=ze.merge(Jn),Nf=E({uri:y(),mimeType:ye(y()),_meta:me(y(),fe()).optional()}),Mf=Nf.extend({text:y()}),ou=y().refine(t=>{try{return atob(t),!0}catch{return!1}},{message:"Invalid Base64 string"}),Zf=Nf.extend({blob:ou}),Xn=Ve(["user","assistant"]),rn=E({audience:J(Xn).optional(),priority:re().min(0).max(1).optional(),lastModified:Un.datetime({offset:!0}).optional()}),Df=E({...en.shape,...Hn.shape,uri:y(),description:ye(y()),mimeType:ye(y()),annotations:rn.optional(),_meta:ye(Ne({}))}),Nb=E({...en.shape,...Hn.shape,uriTemplate:y(),description:ye(y()),mimeType:ye(y()),annotations:rn.optional(),_meta:ye(Ne({}))}),$s=Bn.extend({method:j("resources/list")}),Mb=Gn.extend({resources:J(Df)}),ws=Bn.extend({method:j("resources/templates/list")}),Zb=Gn.extend({resourceTemplates:J(Nb)}),su=Xe.extend({uri:y()}),Db=su,ks=Pe.extend({method:j("resources/read"),params:Db}),qb=ze.extend({contents:J(ue([Mf,Zf]))}),Lb=nt.extend({method:j("notifications/resources/list_changed"),params:rt.optional()}),Ub=su,Fb=Pe.extend({method:j("resources/subscribe"),params:Ub}),Vb=su,Kb=Pe.extend({method:j("resources/unsubscribe"),params:Vb}),Hb=rt.extend({uri:y()}),Bb=nt.extend({method:j("notifications/resources/updated"),params:Hb}),Gb=E({name:y(),description:ye(y()),required:ye(we())}),Jb=E({...en.shape,...Hn.shape,description:ye(y()),arguments:ye(J(Gb)),_meta:ye(Ne({}))}),Ss=Bn.extend({method:j("prompts/list")}),Wb=Gn.extend({prompts:J(Jb)}),Xb=Xe.extend({name:y(),arguments:me(y(),y()).optional()}),Ts=Pe.extend({method:j("prompts/get"),params:Xb}),iu=E({type:j("text"),text:y(),annotations:rn.optional(),_meta:me(y(),fe()).optional()}),au=E({type:j("image"),data:ou,mimeType:y(),annotations:rn.optional(),_meta:me(y(),fe()).optional()}),cu=E({type:j("audio"),data:ou,mimeType:y(),annotations:rn.optional(),_meta:me(y(),fe()).optional()}),Yb=E({type:j("tool_use"),name:y(),id:y(),input:me(y(),fe()),_meta:me(y(),fe()).optional()}),Qb=E({type:j("resource"),resource:ue([Mf,Zf]),annotations:rn.optional(),_meta:me(y(),fe()).optional()}),e$=Df.extend({type:j("resource_link")}),uu=ue([iu,au,cu,e$,Qb]),t$=E({role:Xn,content:uu}),r$=ze.extend({description:y().optional(),messages:J(t$)}),n$=nt.extend({method:j("notifications/prompts/list_changed"),params:rt.optional()}),o$=E({title:y().optional(),readOnlyHint:we().optional(),destructiveHint:we().optional(),idempotentHint:we().optional(),openWorldHint:we().optional()}),s$=E({taskSupport:Ve(["required","optional","forbidden"]).optional()}),qf=E({...en.shape,...Hn.shape,description:y().optional(),inputSchema:E({type:j("object"),properties:me(y(),Te).optional(),required:J(y()).optional()}).catchall(fe()),outputSchema:E({type:j("object"),properties:me(y(),Te).optional(),required:J(y()).optional()}).catchall(fe()).optional(),annotations:o$.optional(),execution:s$.optional(),_meta:me(y(),fe()).optional()}),Ps=Bn.extend({method:j("tools/list")}),i$=Gn.extend({tools:J(qf)}),zs=ze.extend({content:J(uu).default([]),structuredContent:me(y(),fe()).optional(),isError:we().optional()}),LI=zs.or(ze.extend({toolResult:fe()})),a$=Vn.extend({name:y(),arguments:me(y(),fe()).optional()}),nn=Pe.extend({method:j("tools/call"),params:a$}),c$=nt.extend({method:j("notifications/tools/list_changed"),params:rt.optional()}),UI=E({autoRefresh:we().default(!0),debounceMs:re().int().nonnegative().default(300)}),Yn=Ve(["debug","info","notice","warning","error","critical","alert","emergency"]),u$=Xe.extend({level:Yn}),lu=Pe.extend({method:j("logging/setLevel"),params:u$}),l$=rt.extend({level:Yn,logger:y().optional(),data:fe()}),d$=nt.extend({method:j("notifications/message"),params:l$}),p$=E({name:y().optional()}),f$=E({hints:J(p$).optional(),costPriority:re().min(0).max(1).optional(),speedPriority:re().min(0).max(1).optional(),intelligencePriority:re().min(0).max(1).optional()}),m$=E({mode:Ve(["auto","required","none"]).optional()}),h$=E({type:j("tool_result"),toolUseId:y().describe("The unique identifier for the corresponding tool call."),content:J(uu).default([]),structuredContent:E({}).loose().optional(),isError:we().optional(),_meta:me(y(),fe()).optional()}),g$=Gc("type",[iu,au,cu]),us=Gc("type",[iu,au,cu,Yb,h$]),y$=E({role:Xn,content:ue([us,J(us)]),_meta:me(y(),fe()).optional()}),_$=Vn.extend({messages:J(y$),modelPreferences:f$.optional(),systemPrompt:y().optional(),includeContext:Ve(["none","thisServer","allServers"]).optional(),temperature:re().optional(),maxTokens:re().int(),stopSequences:J(y()).optional(),metadata:Te.optional(),tools:J(qf).optional(),toolChoice:m$.optional()}),v$=Pe.extend({method:j("sampling/createMessage"),params:_$}),du=ze.extend({model:y(),stopReason:ye(Ve(["endTurn","stopSequence","maxTokens"]).or(y())),role:Xn,content:g$}),pu=ze.extend({model:y(),stopReason:ye(Ve(["endTurn","stopSequence","maxTokens","toolUse"]).or(y())),role:Xn,content:ue([us,J(us)])}),x$=E({type:j("boolean"),title:y().optional(),description:y().optional(),default:we().optional()}),b$=E({type:j("string"),title:y().optional(),description:y().optional(),minLength:re().optional(),maxLength:re().optional(),format:Ve(["email","uri","date","date-time"]).optional(),default:y().optional()}),$$=E({type:Ve(["number","integer"]),title:y().optional(),description:y().optional(),minimum:re().optional(),maximum:re().optional(),default:re().optional()}),w$=E({type:j("string"),title:y().optional(),description:y().optional(),enum:J(y()),default:y().optional()}),k$=E({type:j("string"),title:y().optional(),description:y().optional(),oneOf:J(E({const:y(),title:y()})),default:y().optional()}),S$=E({type:j("string"),title:y().optional(),description:y().optional(),enum:J(y()),enumNames:J(y()).optional(),default:y().optional()}),T$=ue([w$,k$]),P$=E({type:j("array"),title:y().optional(),description:y().optional(),minItems:re().optional(),maxItems:re().optional(),items:E({type:j("string"),enum:J(y())}),default:J(y()).optional()}),z$=E({type:j("array"),title:y().optional(),description:y().optional(),minItems:re().optional(),maxItems:re().optional(),items:E({anyOf:J(E({const:y(),title:y()}))}),default:J(y()).optional()}),E$=ue([P$,z$]),I$=ue([S$,T$,E$]),R$=ue([I$,x$,b$,$$]),C$=Vn.extend({mode:j("form").optional(),message:y(),requestedSchema:E({type:j("object"),properties:me(y(),R$),required:J(y()).optional()})}),j$=Vn.extend({mode:j("url"),message:y(),elicitationId:y(),url:y().url()}),O$=ue([C$,j$]),A$=Pe.extend({method:j("elicitation/create"),params:O$}),N$=rt.extend({elicitationId:y()}),M$=nt.extend({method:j("notifications/elicitation/complete"),params:N$}),Es=ze.extend({action:Ve(["accept","decline","cancel"]),content:Jc(t=>t===null?void 0:t,me(y(),ue([y(),re(),we(),J(y())])).optional())}),Z$=E({type:j("ref/resource"),uri:y()});var D$=E({type:j("ref/prompt"),name:y()}),q$=Xe.extend({ref:ue([D$,Z$]),argument:E({name:y(),value:y()}),context:E({arguments:me(y(),y()).optional()}).optional()}),Is=Pe.extend({method:j("completion/complete"),params:q$});function Lf(t){if(t.params.ref.type!=="ref/prompt")throw new TypeError(`Expected CompleteRequestPrompt, but got ${t.params.ref.type}`)}function Uf(t){if(t.params.ref.type!=="ref/resource")throw new TypeError(`Expected CompleteRequestResourceTemplate, but got ${t.params.ref.type}`)}var L$=ze.extend({completion:Ne({values:J(y()).max(100),total:ye(re().int()),hasMore:ye(we())})}),U$=E({uri:y().startsWith("file://"),name:y().optional(),_meta:me(y(),fe()).optional()}),F$=Pe.extend({method:j("roots/list"),params:Xe.optional()}),fu=ze.extend({roots:J(U$)}),V$=nt.extend({method:j("notifications/roots/list_changed"),params:rt.optional()}),FI=ue([ms,ru,Is,lu,Ts,Ss,$s,ws,ks,Fb,Kb,nn,Ps,gs,_s,vs,bs]),VI=ue([fs,hs,nu,V$,Wn]),KI=ue([ps,du,pu,Es,fu,ys,xs,tn]),HI=ue([ms,v$,A$,F$,gs,_s,vs,bs]),BI=ue([fs,hs,d$,Bb,Lb,c$,n$,Wn,M$]),GI=ue([ps,Ib,L$,r$,Wb,Mb,Zb,qb,zs,i$,ys,xs,tn]),C=class t extends Error{constructor(e,r,n){super(`MCP error ${e}: ${r}`),this.code=e,this.data=n,this.name="McpError"}static fromError(e,r,n){if(e===A.UrlElicitationRequired&&n){let o=n;if(o.elicitations)return new Wc(o.elicitations,r)}return new t(e,r,n)}},Wc=class extends C{constructor(e,r=`URL elicitation${e.length>1?"s":""} required`){super(A.UrlElicitationRequired,r,{elicitations:e})}get elicitations(){return this.data?.elicitations??[]}};function Xt(t){return t==="completed"||t==="failed"||t==="cancelled"}var Vf=Symbol("Let zodToJsonSchema decide on which parser to use");var Ff={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Kf=t=>typeof t=="string"?{...Ff,name:t}:{...Ff,...t};var Hf=t=>{let e=Kf(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,o])=>[o._def,{def:o._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function mu(t,e,r,n){n?.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function W(t,e,r,n,o){t[e]=r,mu(t,e,n,o)}var Rs=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")};function he(t){if(t.target!=="openAi")return{};let e=[...t.basePath,t.definitionPath,t.openAiAnyTypeName];return t.flags.hasReferencedOpenAiAnyType=!0,{$ref:t.$refStrategy==="relative"?Rs(e,t.currentPath):e.join("/")}}function Bf(t,e){let r={type:"array"};return t.type?._def&&t.type?._def?.typeName!==w.ZodAny&&(r.items=D(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&W(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&W(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(W(r,"minItems",t.exactLength.value,t.exactLength.message,e),W(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function Gf(t,e){let r={type:"integer",format:"int64"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?W(r,"minimum",n.value,n.message,e):W(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),W(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?W(r,"maximum",n.value,n.message,e):W(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),W(r,"maximum",n.value,n.message,e));break;case"multipleOf":W(r,"multipleOf",n.value,n.message,e);break}return r}function Jf(){return{type:"boolean"}}function Cs(t,e){return D(t.type._def,e)}var Wf=(t,e)=>D(t.innerType._def,e);function hu(t,e,r){let n=r??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((o,s)=>hu(t,e,o))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return K$(t,e)}}var K$=(t,e)=>{let r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(let n of t.checks)switch(n.kind){case"min":W(r,"minimum",n.value,n.message,e);break;case"max":W(r,"maximum",n.value,n.message,e);break}return r};function Xf(t,e){return{...D(t.innerType._def,e),default:t.defaultValue()}}function Yf(t,e){return e.effectStrategy==="input"?D(t.schema._def,e):he(e)}function Qf(t){return{type:"string",enum:Array.from(t.values)}}var H$=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function em(t,e){let r=[D(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),D(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,o=[];return r.forEach(s=>{if(H$(s))o.push(...s.allOf),s.unevaluatedProperties===void 0&&(n=void 0);else{let i=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:a,...c}=s;i=c}else n=void 0;o.push(i)}}),o.length?{allOf:o,...n}:void 0}function tm(t,e){let r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}var gu,dt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(gu===void 0&&(gu=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),gu),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function js(t,e){let r={type:"string"};if(t.checks)for(let n of t.checks)switch(n.kind){case"min":W(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e);break;case"max":W(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":pt(r,"email",n.message,e);break;case"format:idn-email":pt(r,"idn-email",n.message,e);break;case"pattern:zod":Me(r,dt.email,n.message,e);break}break;case"url":pt(r,"uri",n.message,e);break;case"uuid":pt(r,"uuid",n.message,e);break;case"regex":Me(r,n.regex,n.message,e);break;case"cuid":Me(r,dt.cuid,n.message,e);break;case"cuid2":Me(r,dt.cuid2,n.message,e);break;case"startsWith":Me(r,RegExp(`^${yu(n.value,e)}`),n.message,e);break;case"endsWith":Me(r,RegExp(`${yu(n.value,e)}$`),n.message,e);break;case"datetime":pt(r,"date-time",n.message,e);break;case"date":pt(r,"date",n.message,e);break;case"time":pt(r,"time",n.message,e);break;case"duration":pt(r,"duration",n.message,e);break;case"length":W(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e),W(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"includes":{Me(r,RegExp(yu(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&pt(r,"ipv4",n.message,e),n.version!=="v4"&&pt(r,"ipv6",n.message,e);break}case"base64url":Me(r,dt.base64url,n.message,e);break;case"jwt":Me(r,dt.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&Me(r,dt.ipv4Cidr,n.message,e),n.version!=="v4"&&Me(r,dt.ipv6Cidr,n.message,e);break}case"emoji":Me(r,dt.emoji(),n.message,e);break;case"ulid":{Me(r,dt.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{pt(r,"binary",n.message,e);break}case"contentEncoding:base64":{W(r,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{Me(r,dt.base64,n.message,e);break}}break}case"nanoid":Me(r,dt.nanoid,n.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}function yu(t,e){return e.patternStrategy==="escape"?G$(t):t}var B$=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function G$(t){let e="";for(let r=0;r<t.length;r++)B$.has(t[r])||(e+="\\"),e+=t[r];return e}function pt(t,e,r,n){t.format||t.anyOf?.some(o=>o.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&n.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&n.errorMessages&&{errorMessage:{format:r}}})):W(t,"format",e,r,n)}function Me(t,e,r,n){t.pattern||t.allOf?.some(o=>o.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&n.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:rm(e,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):W(t,"pattern",rm(e,n),r,n)}function rm(t,e){if(!e.applyRegexFlags||!t.flags)return t.source;let r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},n=r.i?t.source.toLowerCase():t.source,o="",s=!1,i=!1,a=!1;for(let c=0;c<n.length;c++){if(s){o+=n[c],s=!1;continue}if(r.i){if(i){if(n[c].match(/[a-z]/)){a?(o+=n[c],o+=`${n[c-2]}-${n[c]}`.toUpperCase(),a=!1):n[c+1]==="-"&&n[c+2]?.match(/[a-z]/)?(o+=n[c],a=!0):o+=`${n[c]}${n[c].toUpperCase()}`;continue}}else if(n[c].match(/[a-z]/)){o+=`[${n[c]}${n[c].toUpperCase()}]`;continue}}if(r.m){if(n[c]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(n[c]==="$"){o+=`($|(?=[\r
]))`;continue}}if(r.s&&n[c]==="."){o+=i?`${n[c]}\r
`:`[${n[c]}\r
]`;continue}o+=n[c],n[c]==="\\"?s=!0:i&&n[c]==="]"?i=!1:!i&&n[c]==="["&&(i=!0)}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return o}function Os(t,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&t.keyType?._def.typeName===w.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((n,o)=>({...n,[o]:D(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",o]})??he(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let r={type:"object",additionalProperties:D(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return r;if(t.keyType?._def.typeName===w.ZodString&&t.keyType._def.checks?.length){let{type:n,...o}=js(t.keyType._def,e);return{...r,propertyNames:o}}else{if(t.keyType?._def.typeName===w.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};if(t.keyType?._def.typeName===w.ZodBranded&&t.keyType._def.type._def.typeName===w.ZodString&&t.keyType._def.type._def.checks?.length){let{type:n,...o}=Cs(t.keyType._def,e);return{...r,propertyNames:o}}}return r}function nm(t,e){if(e.mapStrategy==="record")return Os(t,e);let r=D(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||he(e),n=D(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||he(e);return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function om(t){let e=t.values,n=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),o=Array.from(new Set(n.map(s=>typeof s)));return{type:o.length===1?o[0]==="string"?"string":"number":["string","number"],enum:n}}function sm(t){return t.target==="openAi"?void 0:{not:he({...t,currentPath:[...t.currentPath,"not"]})}}function im(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var Qn={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function cm(t,e){if(e.target==="openApi3")return am(t,e);let r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(n=>n._def.typeName in Qn&&(!n._def.checks||!n._def.checks.length))){let n=r.reduce((o,s)=>{let i=Qn[s._def.typeName];return i&&!o.includes(i)?[...o,i]:o},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=r.reduce((o,s)=>{let i=typeof s._def.value;switch(i){case"string":case"number":case"boolean":return[...o,i];case"bigint":return[...o,"integer"];case"object":if(s._def.value===null)return[...o,"null"];case"symbol":case"undefined":case"function":default:return o}},[]);if(n.length===r.length){let o=n.filter((s,i,a)=>a.indexOf(s)===i);return{type:o.length>1?o:o[0],enum:r.reduce((s,i)=>s.includes(i._def.value)?s:[...s,i._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,o)=>[...n,...o._def.values.filter(s=>!n.includes(s))],[])};return am(t,e)}var am=(t,e)=>{let r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((n,o)=>D(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${o}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function um(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:Qn[t.innerType._def.typeName],nullable:!0}:{type:[Qn[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=D(t.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let r=D(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function lm(t,e){let r={type:"number"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"int":r.type="integer",mu(r,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?W(r,"minimum",n.value,n.message,e):W(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),W(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?W(r,"maximum",n.value,n.message,e):W(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),W(r,"maximum",n.value,n.message,e));break;case"multipleOf":W(r,"multipleOf",n.value,n.message,e);break}return r}function dm(t,e){let r=e.target==="openAi",n={type:"object",properties:{}},o=[],s=t.shape();for(let a in s){let c=s[a];if(c===void 0||c._def===void 0)continue;let u=W$(c);u&&r&&(c._def.typeName==="ZodOptional"&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),u=!1);let l=D(c._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});l!==void 0&&(n.properties[a]=l,u||o.push(a))}o.length&&(n.required=o);let i=J$(t,e);return i!==void 0&&(n.additionalProperties=i),n}function J$(t,e){if(t.catchall._def.typeName!=="ZodNever")return D(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function W$(t){try{return t.isOptional()}catch{return!0}}var pm=(t,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return D(t.innerType._def,e);let r=D(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:he(e)},r]}:he(e)};var fm=(t,e)=>{if(e.pipeStrategy==="input")return D(t.in._def,e);if(e.pipeStrategy==="output")return D(t.out._def,e);let r=D(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=D(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(o=>o!==void 0)}};function mm(t,e){return D(t.type._def,e)}function hm(t,e){let n={type:"array",uniqueItems:!0,items:D(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&W(n,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&W(n,"maxItems",t.maxSize.value,t.maxSize.message,e),n}function gm(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,n)=>D(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:D(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,n)=>D(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function ym(t){return{not:he(t)}}function _m(t){return he(t)}var vm=(t,e)=>D(t.innerType._def,e);var xm=(t,e,r)=>{switch(e){case w.ZodString:return js(t,r);case w.ZodNumber:return lm(t,r);case w.ZodObject:return dm(t,r);case w.ZodBigInt:return Gf(t,r);case w.ZodBoolean:return Jf();case w.ZodDate:return hu(t,r);case w.ZodUndefined:return ym(r);case w.ZodNull:return im(r);case w.ZodArray:return Bf(t,r);case w.ZodUnion:case w.ZodDiscriminatedUnion:return cm(t,r);case w.ZodIntersection:return em(t,r);case w.ZodTuple:return gm(t,r);case w.ZodRecord:return Os(t,r);case w.ZodLiteral:return tm(t,r);case w.ZodEnum:return Qf(t);case w.ZodNativeEnum:return om(t);case w.ZodNullable:return um(t,r);case w.ZodOptional:return pm(t,r);case w.ZodMap:return nm(t,r);case w.ZodSet:return hm(t,r);case w.ZodLazy:return()=>t.getter()._def;case w.ZodPromise:return mm(t,r);case w.ZodNaN:case w.ZodNever:return sm(r);case w.ZodEffects:return Yf(t,r);case w.ZodAny:return he(r);case w.ZodUnknown:return _m(r);case w.ZodDefault:return Xf(t,r);case w.ZodBranded:return Cs(t,r);case w.ZodReadonly:return vm(t,r);case w.ZodCatch:return Wf(t,r);case w.ZodPipeline:return fm(t,r);case w.ZodFunction:case w.ZodVoid:case w.ZodSymbol:return;default:return(n=>{})(e)}};function D(t,e,r=!1){let n=e.seen.get(t);if(e.override){let a=e.override?.(t,e,n,r);if(a!==Vf)return a}if(n&&!r){let a=X$(n,e);if(a!==void 0)return a}let o={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,o);let s=xm(t,t.typeName,e),i=typeof s=="function"?D(s(),e):s;if(i&&Y$(t,e,i),e.postProcess){let a=e.postProcess(i,t,e);return o.jsonSchema=i,a}return o.jsonSchema=i,i}var X$=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:Rs(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,n)=>e.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),he(e)):e.$refStrategy==="seen"?he(e):void 0}},Y$=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r);var _u=(t,e)=>{let r=Hf(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((c,[u,l])=>({...c,[u]:D(l._def,{...r,currentPath:[...r.basePath,r.definitionPath,u]},!0)??he(r)}),{}):void 0,o=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,s=D(t._def,o===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,o]},!1)??he(r),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i),r.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[r.openAiAnyTypeName]||(n[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:r.$refStrategy==="relative"?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));let a=o===void 0?n?{...s,[r.definitionPath]:n}:s:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,o].join("/"),[r.definitionPath]:{...n,[o]:s}};return r.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function Q$(t){return!t||t==="jsonSchema7"||t==="draft-7"?"draft-7":t==="jsonSchema2019-09"||t==="draft-2020-12"?"draft-2020-12":"draft-7"}function vu(t,e){return tt(t)?Dc(t,{target:Q$(e?.target),io:e?.pipeStrategy??"input"}):_u(t,{strictUnions:e?.strictUnions??!0,pipeStrategy:e?.pipeStrategy??"input"})}function xu(t){let r=Jt(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=is(r);if(typeof n!="string")throw new Error("Schema method literal must be a string");return n}function bu(t,e){let r=Gt(t,e);if(!r.success)throw r.error;return r.data}var ew=6e4,As=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(fs,r=>{this._oncancel(r)}),this.setNotificationHandler(hs,r=>{this._onprogress(r)}),this.setRequestHandler(ms,r=>({})),this._taskStore=e?.taskStore,this._taskMessageQueue=e?.taskMessageQueue,this._taskStore&&(this.setRequestHandler(gs,async(r,n)=>{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new C(A.InvalidParams,"Failed to retrieve task: Task not found");return{...o}}),this.setRequestHandler(_s,async(r,n)=>{let o=async()=>{let s=r.params.taskId;if(this._taskMessageQueue){let a;for(;a=await this._taskMessageQueue.dequeue(s,n.sessionId);){if(a.type==="response"||a.type==="error"){let c=a.message,u=c.id,l=this._requestResolvers.get(u);if(l)if(this._requestResolvers.delete(u),a.type==="response")l(c);else{let d=c,f=new C(d.error.code,d.error.message,d.error.data);l(f)}else{let d=a.type==="response"?"Response":"Error";this._onerror(new Error(`${d} handler missing for request ${u}`))}continue}await this._transport?.send(a.message,{relatedRequestId:n.requestId})}}let i=await this._taskStore.getTask(s,n.sessionId);if(!i)throw new C(A.InvalidParams,`Task not found: ${s}`);if(!Xt(i.status))return await this._waitForTaskUpdate(s,n.signal),await o();if(Xt(i.status)){let a=await this._taskStore.getTaskResult(s,n.sessionId);return this._clearTaskQueue(s),{...a,_meta:{...a._meta,[Wt]:{taskId:s}}}}return await o()};return await o()}),this.setRequestHandler(vs,async(r,n)=>{try{let{tasks:o,nextCursor:s}=await this._taskStore.listTasks(r.params?.cursor,n.sessionId);return{tasks:o,nextCursor:s,_meta:{}}}catch(o){throw new C(A.InvalidParams,`Failed to list tasks: ${o instanceof Error?o.message:String(o)}`)}}),this.setRequestHandler(bs,async(r,n)=>{try{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new C(A.InvalidParams,`Task not found: ${r.params.taskId}`);if(Xt(o.status))throw new C(A.InvalidParams,`Cannot cancel task in terminal status: ${o.status}`);await this._taskStore.updateTaskStatus(r.params.taskId,"cancelled","Client cancelled task execution.",n.sessionId),this._clearTaskQueue(r.params.taskId);let s=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!s)throw new C(A.InvalidParams,`Task not found after cancellation: ${r.params.taskId}`);return{_meta:{},...s}}catch(o){throw o instanceof C?o:new C(A.InvalidRequest,`Failed to cancel task: ${o instanceof Error?o.message:String(o)}`)}}))}async _oncancel(e){if(!e.params.requestId)return;this._requestHandlerAbortControllers.get(e.params.requestId)?.abort(e.params.reason)}_setupTimeout(e,r,n,o,s=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(o,r),startTime:Date.now(),timeout:r,maxTotalTimeout:n,resetTimeoutOnProgress:s,onTimeout:o})}_resetTimeout(e){let r=this._timeoutInfo.get(e);if(!r)return!1;let n=Date.now()-r.startTime;if(r.maxTotalTimeout&&n>=r.maxTotalTimeout)throw this._timeoutInfo.delete(e),C.fromError(A.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:n});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(e){let r=this._timeoutInfo.get(e);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(e))}async connect(e){if(this._transport)throw new Error("Already connected to a transport. Call close() before connecting to a new transport, or use a separate Protocol instance per connection.");this._transport=e;let r=this.transport?.onclose;this._transport.onclose=()=>{r?.(),this._onclose()};let n=this.transport?.onerror;this._transport.onerror=s=>{n?.(s),this._onerror(s)};let o=this._transport?.onmessage;this._transport.onmessage=(s,i)=>{o?.(s,i),Kn(s)||Cf(s)?this._onresponse(s):Qc(s)?this._onrequest(s,i):Rf(s)?this._onnotification(s):this._onerror(new Error(`Unknown message type: ${JSON.stringify(s)}`))},await this._transport.start()}_onclose(){let e=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();for(let n of this._requestHandlerAbortControllers.values())n.abort();this._requestHandlerAbortControllers.clear();let r=C.fromError(A.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(let n of e.values())n(r)}_onerror(e){this.onerror?.(e)}_onnotification(e){let r=this._notificationHandlers.get(e.method)??this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(e)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(e,r){let n=this._requestHandlers.get(e.method)??this.fallbackRequestHandler,o=this._transport,s=e.params?._meta?.[Wt]?.taskId;if(n===void 0){let l={jsonrpc:"2.0",id:e.id,error:{code:A.MethodNotFound,message:"Method not found"}};s&&this._taskMessageQueue?this._enqueueTaskMessage(s,{type:"error",message:l,timestamp:Date.now()},o?.sessionId).catch(d=>this._onerror(new Error(`Failed to enqueue error response: ${d}`))):o?.send(l).catch(d=>this._onerror(new Error(`Failed to send an error response: ${d}`)));return}let i=new AbortController;this._requestHandlerAbortControllers.set(e.id,i);let a=zf(e.params)?e.params.task:void 0,c=this._taskStore?this.requestTaskStore(e,o?.sessionId):void 0,u={signal:i.signal,sessionId:o?.sessionId,_meta:e.params?._meta,sendNotification:async l=>{if(i.signal.aborted)return;let d={relatedRequestId:e.id};s&&(d.relatedTask={taskId:s}),await this.notification(l,d)},sendRequest:async(l,d,f)=>{if(i.signal.aborted)throw new C(A.ConnectionClosed,"Request was cancelled");let m={...f,relatedRequestId:e.id};s&&!m.relatedTask&&(m.relatedTask={taskId:s});let p=m.relatedTask?.taskId??s;return p&&c&&await c.updateTaskStatus(p,"input_required"),await this.request(l,d,m)},authInfo:r?.authInfo,requestId:e.id,requestInfo:r?.requestInfo,taskId:s,taskStore:c,taskRequestedTtl:a?.ttl,closeSSEStream:r?.closeSSEStream,closeStandaloneSSEStream:r?.closeStandaloneSSEStream};Promise.resolve().then(()=>{a&&this.assertTaskHandlerCapability(e.method)}).then(()=>n(e,u)).then(async l=>{if(i.signal.aborted)return;let d={result:l,jsonrpc:"2.0",id:e.id};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"response",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)},async l=>{if(i.signal.aborted)return;let d={jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(l.code)?l.code:A.InternalError,message:l.message??"Internal error",...l.data!==void 0&&{data:l.data}}};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"error",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)}).catch(l=>this._onerror(new Error(`Failed to send response: ${l}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progressToken:r,...n}=e.params,o=Number(r),s=this._progressHandlers.get(o);if(!s){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}let i=this._responseHandlers.get(o),a=this._timeoutInfo.get(o);if(a&&i&&a.resetTimeoutOnProgress)try{this._resetTimeout(o)}catch(c){this._responseHandlers.delete(o),this._progressHandlers.delete(o),this._cleanupTimeout(o),i(c);return}s(n)}_onresponse(e){let r=Number(e.id),n=this._requestResolvers.get(r);if(n){if(this._requestResolvers.delete(r),Kn(e))n(e);else{let i=new C(e.error.code,e.error.message,e.error.data);n(i)}return}let o=this._responseHandlers.get(r);if(o===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}this._responseHandlers.delete(r),this._cleanupTimeout(r);let s=!1;if(Kn(e)&&e.result&&typeof e.result=="object"){let i=e.result;if(i.task&&typeof i.task=="object"){let a=i.task;typeof a.taskId=="string"&&(s=!0,this._taskProgressTokens.set(a.taskId,r))}}if(s||this._progressHandlers.delete(r),Kn(e))o(e);else{let i=C.fromError(e.error.code,e.error.message,e.error.data);o(i)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(e,r,n){let{task:o}=n??{};if(!o){try{yield{type:"result",result:await this.request(e,r,n)}}catch(i){yield{type:"error",error:i instanceof C?i:new C(A.InternalError,String(i))}}return}let s;try{let i=await this.request(e,tn,n);if(i.task)s=i.task.taskId,yield{type:"taskCreated",task:i.task};else throw new C(A.InternalError,"Task creation did not return a task");for(;;){let a=await this.getTask({taskId:s},n);if(yield{type:"taskStatus",task:a},Xt(a.status)){a.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)}:a.status==="failed"?yield{type:"error",error:new C(A.InternalError,`Task ${s} failed`)}:a.status==="cancelled"&&(yield{type:"error",error:new C(A.InternalError,`Task ${s} was cancelled`)});return}if(a.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)};return}let c=a.pollInterval??this._options?.defaultTaskPollInterval??1e3;await new Promise(u=>setTimeout(u,c)),n?.signal?.throwIfAborted()}}catch(i){yield{type:"error",error:i instanceof C?i:new C(A.InternalError,String(i))}}}request(e,r,n){let{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i,task:a,relatedTask:c}=n??{};return new Promise((u,l)=>{let d=x=>{l(x)};if(!this._transport){d(new Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{this.assertCapabilityForMethod(e.method),a&&this.assertTaskCapability(e.method)}catch(x){d(x);return}n?.signal?.throwIfAborted();let f=this._requestMessageId++,m={...e,jsonrpc:"2.0",id:f};n?.onprogress&&(this._progressHandlers.set(f,n.onprogress),m.params={...e.params,_meta:{...e.params?._meta||{},progressToken:f}}),a&&(m.params={...m.params,task:a}),c&&(m.params={...m.params,_meta:{...m.params?._meta||{},[Wt]:c}});let p=x=>{this._responseHandlers.delete(f),this._progressHandlers.delete(f),this._cleanupTimeout(f),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:f,reason:String(x)}},{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i}).catch(S=>this._onerror(new Error(`Failed to send cancellation: ${S}`)));let b=x instanceof C?x:new C(A.RequestTimeout,String(x));l(b)};this._responseHandlers.set(f,x=>{if(!n?.signal?.aborted){if(x instanceof Error)return l(x);try{let b=Gt(r,x.result);b.success?u(b.data):l(b.error)}catch(b){l(b)}}}),n?.signal?.addEventListener("abort",()=>{p(n?.signal?.reason)});let h=n?.timeout??ew,g=()=>p(C.fromError(A.RequestTimeout,"Request timed out",{timeout:h}));this._setupTimeout(f,h,n?.maxTotalTimeout,g,n?.resetTimeoutOnProgress??!1);let _=c?.taskId;if(_){let x=b=>{let S=this._responseHandlers.get(f);S?S(b):this._onerror(new Error(`Response handler missing for side-channeled request ${f}`))};this._requestResolvers.set(f,x),this._enqueueTaskMessage(_,{type:"request",message:m,timestamp:Date.now()}).catch(b=>{this._cleanupTimeout(f),l(b)})}else this._transport.send(m,{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i}).catch(x=>{this._cleanupTimeout(f),l(x)})})}async getTask(e,r){return this.request({method:"tasks/get",params:e},ys,r)}async getTaskResult(e,r,n){return this.request({method:"tasks/result",params:e},r,n)}async listTasks(e,r){return this.request({method:"tasks/list",params:e},xs,r)}async cancelTask(e,r){return this.request({method:"tasks/cancel",params:e},Af,r)}async notification(e,r){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);let n=r?.relatedTask?.taskId;if(n){let a={...e,jsonrpc:"2.0",params:{...e.params,_meta:{...e.params?._meta||{},[Wt]:r.relatedTask}}};await this._enqueueTaskMessage(n,{type:"notification",message:a,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(e.method)&&!e.params&&!r?.relatedRequestId&&!r?.relatedTask){if(this._pendingDebouncedNotifications.has(e.method))return;this._pendingDebouncedNotifications.add(e.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(e.method),!this._transport)return;let a={...e,jsonrpc:"2.0"};r?.relatedTask&&(a={...a,params:{...a.params,_meta:{...a.params?._meta||{},[Wt]:r.relatedTask}}}),this._transport?.send(a,r).catch(c=>this._onerror(c))});return}let i={...e,jsonrpc:"2.0"};r?.relatedTask&&(i={...i,params:{...i.params,_meta:{...i.params?._meta||{},[Wt]:r.relatedTask}}}),await this._transport.send(i,r)}setRequestHandler(e,r){let n=xu(e);this.assertRequestHandlerCapability(n),this._requestHandlers.set(n,(o,s)=>{let i=bu(e,o);return Promise.resolve(r(i,s))})}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,r){let n=xu(e);this._notificationHandlers.set(n,o=>{let s=bu(e,o);return Promise.resolve(r(s))})}removeNotificationHandler(e){this._notificationHandlers.delete(e)}_cleanupTaskProgressHandler(e){let r=this._taskProgressTokens.get(e);r!==void 0&&(this._progressHandlers.delete(r),this._taskProgressTokens.delete(e))}async _enqueueTaskMessage(e,r,n){if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let o=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(e,r,n,o)}async _clearTaskQueue(e,r){if(this._taskMessageQueue){let n=await this._taskMessageQueue.dequeueAll(e,r);for(let o of n)if(o.type==="request"&&Qc(o.message)){let s=o.message.id,i=this._requestResolvers.get(s);i?(i(new C(A.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(s)):this._onerror(new Error(`Resolver missing for request ${s} during task ${e} cleanup`))}}}async _waitForTaskUpdate(e,r){let n=this._options?.defaultTaskPollInterval??1e3;try{let o=await this._taskStore?.getTask(e);o?.pollInterval&&(n=o.pollInterval)}catch{}return new Promise((o,s)=>{if(r.aborted){s(new C(A.InvalidRequest,"Request cancelled"));return}let i=setTimeout(o,n);r.addEventListener("abort",()=>{clearTimeout(i),s(new C(A.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(e,r){let n=this._taskStore;if(!n)throw new Error("No task store configured");return{createTask:async o=>{if(!e)throw new Error("No request provided");return await n.createTask(o,e.id,{method:e.method,params:e.params},r)},getTask:async o=>{let s=await n.getTask(o,r);if(!s)throw new C(A.InvalidParams,"Failed to retrieve task: Task not found");return s},storeTaskResult:async(o,s,i)=>{await n.storeTaskResult(o,s,i,r);let a=await n.getTask(o,r);if(a){let c=Wn.parse({method:"notifications/tasks/status",params:a});await this.notification(c),Xt(a.status)&&this._cleanupTaskProgressHandler(o)}},getTaskResult:o=>n.getTaskResult(o,r),updateTaskStatus:async(o,s,i)=>{let a=await n.getTask(o,r);if(!a)throw new C(A.InvalidParams,`Task "${o}" not found - it may have been cleaned up`);if(Xt(a.status))throw new C(A.InvalidParams,`Cannot update task "${o}" from terminal status "${a.status}" to "${s}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await n.updateTaskStatus(o,s,i,r);let c=await n.getTask(o,r);if(c){let u=Wn.parse({method:"notifications/tasks/status",params:c});await this.notification(u),Xt(c.status)&&this._cleanupTaskProgressHandler(o)}},listTasks:o=>n.listTasks(o,r)}}};function bm(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function $m(t,e){let r={...t};for(let n in e){let o=n,s=e[o];if(s===void 0)continue;let i=r[o];bm(i)&&bm(s)?r[o]={...i,...s}:r[o]=s}return r}var cy=Oo(id(),1),uy=Oo(ay(),1);function VP(){let t=new cy.default({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return(0,uy.default)(t),t}var _i=class{constructor(e){this._ajv=e??VP()}getValidator(e){let r="$id"in e&&typeof e.$id=="string"?this._ajv.getSchema(e.$id)??this._ajv.compile(e):this._ajv.compile(e);return n=>r(n)?{valid:!0,data:n,errorMessage:void 0}:{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(r.errors)}}};var vi=class{constructor(e){this._server=e}requestStream(e,r,n){return this._server.requestStream(e,r,n)}async getTask(e,r){return this._server.getTask({taskId:e},r)}async getTaskResult(e,r,n){return this._server.getTaskResult({taskId:e},r,n)}async listTasks(e,r){return this._server.listTasks(e?{cursor:e}:void 0,r)}async cancelTask(e,r){return this._server.cancelTask({taskId:e},r)}};function ly(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"tools/call":if(!t.tools?.call)throw new Error(`${r} does not support task creation for tools/call (required for ${e})`);break;default:break}}function dy(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"sampling/createMessage":if(!t.sampling?.createMessage)throw new Error(`${r} does not support task creation for sampling/createMessage (required for ${e})`);break;case"elicitation/create":if(!t.elicitation?.create)throw new Error(`${r} does not support task creation for elicitation/create (required for ${e})`);break;default:break}}var xi=class extends As{constructor(e,r){super(r),this._serverInfo=e,this._loggingLevels=new Map,this.LOG_LEVEL_SEVERITY=new Map(Yn.options.map((n,o)=>[n,o])),this.isMessageIgnored=(n,o)=>{let s=this._loggingLevels.get(o);return s?this.LOG_LEVEL_SEVERITY.get(n)<this.LOG_LEVEL_SEVERITY.get(s):!1},this._capabilities=r?.capabilities??{},this._instructions=r?.instructions,this._jsonSchemaValidator=r?.jsonSchemaValidator??new _i,this.setRequestHandler(ru,n=>this._oninitialize(n)),this.setNotificationHandler(nu,()=>this.oninitialized?.()),this._capabilities.logging&&this.setRequestHandler(lu,async(n,o)=>{let s=o.sessionId||o.requestInfo?.headers["mcp-session-id"]||void 0,{level:i}=n.params,a=Yn.safeParse(i);return a.success&&this._loggingLevels.set(s,a.data),{}})}get experimental(){return this._experimental||(this._experimental={tasks:new vi(this)}),this._experimental}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=$m(this._capabilities,e)}setRequestHandler(e,r){let o=Jt(e)?.method;if(!o)throw new Error("Schema is missing a method literal");let s;if(tt(o)){let a=o;s=a._zod?.def?.value??a.value}else{let a=o;s=a._def?.value??a.value}if(typeof s!="string")throw new Error("Schema method literal must be a string");if(s==="tools/call"){let a=async(c,u)=>{let l=Gt(nn,c);if(!l.success){let p=l.error instanceof Error?l.error.message:String(l.error);throw new C(A.InvalidParams,`Invalid tools/call request: ${p}`)}let{params:d}=l.data,f=await Promise.resolve(r(c,u));if(d.task){let p=Gt(tn,f);if(!p.success){let h=p.error instanceof Error?p.error.message:String(p.error);throw new C(A.InvalidParams,`Invalid task creation result: ${h}`)}return p.data}let m=Gt(zs,f);if(!m.success){let p=m.error instanceof Error?m.error.message:String(m.error);throw new C(A.InvalidParams,`Invalid tools/call result: ${p}`)}return m.data};return super.setRequestHandler(e,a)}return super.setRequestHandler(e,r)}assertCapabilityForMethod(e){switch(e){case"sampling/createMessage":if(!this._clientCapabilities?.sampling)throw new Error(`Client does not support sampling (required for ${e})`);break;case"elicitation/create":if(!this._clientCapabilities?.elicitation)throw new Error(`Client does not support elicitation (required for ${e})`);break;case"roots/list":if(!this._clientCapabilities?.roots)throw new Error(`Client does not support listing roots (required for ${e})`);break;case"ping":break}}assertNotificationCapability(e){switch(e){case"notifications/message":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw new Error(`Server does not support notifying about resources (required for ${e})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw new Error(`Server does not support notifying of tool list changes (required for ${e})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw new Error(`Server does not support notifying of prompt list changes (required for ${e})`);break;case"notifications/elicitation/complete":if(!this._clientCapabilities?.elicitation?.url)throw new Error(`Client does not support URL elicitation (required for ${e})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){if(this._capabilities)switch(e){case"completion/complete":if(!this._capabilities.completions)throw new Error(`Server does not support completions (required for ${e})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw new Error(`Server does not support resources (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw new Error(`Server does not support tasks capability (required for ${e})`);break;case"ping":case"initialize":break}}assertTaskCapability(e){dy(this._clientCapabilities?.tasks?.requests,e,"Client")}assertTaskHandlerCapability(e){this._capabilities&&ly(this._capabilities.tasks?.requests,e,"Server")}async _oninitialize(e){let r=e.params.protocolVersion;return this._clientCapabilities=e.params.capabilities,this._clientVersion=e.params.clientInfo,{protocolVersion:Sf.includes(r)?r:Xc,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},ps)}async createMessage(e,r){if((e.tools||e.toolChoice)&&!this._clientCapabilities?.sampling?.tools)throw new Error("Client does not support sampling tools capability.");if(e.messages.length>0){let n=e.messages[e.messages.length-1],o=Array.isArray(n.content)?n.content:[n.content],s=o.some(u=>u.type==="tool_result"),i=e.messages.length>1?e.messages[e.messages.length-2]:void 0,a=i?Array.isArray(i.content)?i.content:[i.content]:[],c=a.some(u=>u.type==="tool_use");if(s){if(o.some(u=>u.type!=="tool_result"))throw new Error("The last message must contain only tool_result content if any is present");if(!c)throw new Error("tool_result blocks are not matching any tool_use from the previous message")}if(c){let u=new Set(a.filter(d=>d.type==="tool_use").map(d=>d.id)),l=new Set(o.filter(d=>d.type==="tool_result").map(d=>d.toolUseId));if(u.size!==l.size||![...u].every(d=>l.has(d)))throw new Error("ids of tool_result blocks and tool_use blocks from previous message do not match")}}return e.tools?this.request({method:"sampling/createMessage",params:e},pu,r):this.request({method:"sampling/createMessage",params:e},du,r)}async elicitInput(e,r){switch(e.mode??"form"){case"url":{if(!this._clientCapabilities?.elicitation?.url)throw new Error("Client does not support url elicitation.");let o=e;return this.request({method:"elicitation/create",params:o},Es,r)}case"form":{if(!this._clientCapabilities?.elicitation?.form)throw new Error("Client does not support form elicitation.");let o=e.mode==="form"?e:{...e,mode:"form"},s=await this.request({method:"elicitation/create",params:o},Es,r);if(s.action==="accept"&&s.content&&o.requestedSchema)try{let a=this._jsonSchemaValidator.getValidator(o.requestedSchema)(s.content);if(!a.valid)throw new C(A.InvalidParams,`Elicitation response content does not match requested schema: ${a.errorMessage}`)}catch(i){throw i instanceof C?i:new C(A.InternalError,`Error validating elicitation response: ${i instanceof Error?i.message:String(i)}`)}return s}}}createElicitationCompletionNotifier(e,r){if(!this._clientCapabilities?.elicitation?.url)throw new Error("Client does not support URL elicitation (required for notifications/elicitation/complete)");return()=>this.notification({method:"notifications/elicitation/complete",params:{elicitationId:e}},r)}async listRoots(e,r){return this.request({method:"roots/list",params:e},fu,r)}async sendLoggingMessage(e,r){if(this._capabilities.logging&&!this.isMessageIgnored(e.level,r))return this.notification({method:"notifications/message",params:e})}async sendResourceUpdated(e){return this.notification({method:"notifications/resources/updated",params:e})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}};var fy=Symbol.for("mcp.completable");function md(t){return!!t&&typeof t=="object"&&fy in t}function my(t){return t[fy]?.complete}var py;(function(t){t.Completable="McpCompletable"})(py||(py={}));var KP=/^[A-Za-z0-9._-]{1,128}$/;function HP(t){let e=[];if(t.length===0)return{isValid:!1,warnings:["Tool name cannot be empty"]};if(t.length>128)return{isValid:!1,warnings:[`Tool name exceeds maximum length of 128 characters (current: ${t.length})`]};if(t.includes(" ")&&e.push("Tool name contains spaces, which may cause parsing issues"),t.includes(",")&&e.push("Tool name contains commas, which may cause parsing issues"),(t.startsWith("-")||t.endsWith("-"))&&e.push("Tool name starts or ends with a dash, which may cause parsing issues in some contexts"),(t.startsWith(".")||t.endsWith("."))&&e.push("Tool name starts or ends with a dot, which may cause parsing issues in some contexts"),!KP.test(t)){let r=t.split("").filter(n=>!/[A-Za-z0-9._-]/.test(n)).filter((n,o,s)=>s.indexOf(n)===o);return e.push(`Tool name contains invalid characters: ${r.map(n=>`"${n}"`).join(", ")}`,"Allowed characters are: A-Z, a-z, 0-9, underscore (_), dash (-), and dot (.)"),{isValid:!1,warnings:e}}return{isValid:!0,warnings:e}}function BP(t,e){if(e.length>0){console.warn(`Tool name validation warning for "${t}":`);for(let r of e)console.warn(`  - ${r}`);console.warn("Tool registration will proceed, but this may cause compatibility issues."),console.warn("Consider updating the tool name to conform to the MCP tool naming standard."),console.warn("See SEP: Specify Format for Tool Names (https://github.com/modelcontextprotocol/modelcontextprotocol/issues/986) for more details.")}}function hd(t){let e=HP(t);return BP(t,e.warnings),e.isValid}var bi=class{constructor(e){this._mcpServer=e}registerToolTask(e,r,n){let o={taskSupport:"required",...r.execution};if(o.taskSupport==="forbidden")throw new Error(`Cannot register task-based tool '${e}' with taskSupport 'forbidden'. Use registerTool() instead.`);return this._mcpServer._createRegisteredTool(e,r.title,r.description,r.inputSchema,r.outputSchema,r.annotations,o,r._meta,n)}};var $i=class{constructor(e,r){this._registeredResources={},this._registeredResourceTemplates={},this._registeredTools={},this._registeredPrompts={},this._toolHandlersInitialized=!1,this._completionHandlerInitialized=!1,this._resourceHandlersInitialized=!1,this._promptHandlersInitialized=!1,this.server=new xi(e,r)}get experimental(){return this._experimental||(this._experimental={tasks:new bi(this)}),this._experimental}async connect(e){return await this.server.connect(e)}async close(){await this.server.close()}setToolRequestHandlers(){this._toolHandlersInitialized||(this.server.assertCanSetRequestHandler(ir(Ps)),this.server.assertCanSetRequestHandler(ir(nn)),this.server.registerCapabilities({tools:{listChanged:!0}}),this.server.setRequestHandler(Ps,()=>({tools:Object.entries(this._registeredTools).filter(([,e])=>e.enabled).map(([e,r])=>{let n={name:e,title:r.title,description:r.description,inputSchema:(()=>{let o=Qr(r.inputSchema);return o?vu(o,{strictUnions:!0,pipeStrategy:"input"}):GP})(),annotations:r.annotations,execution:r.execution,_meta:r._meta};if(r.outputSchema){let o=Qr(r.outputSchema);o&&(n.outputSchema=vu(o,{strictUnions:!0,pipeStrategy:"output"}))}return n})})),this.server.setRequestHandler(nn,async(e,r)=>{try{let n=this._registeredTools[e.params.name];if(!n)throw new C(A.InvalidParams,`Tool ${e.params.name} not found`);if(!n.enabled)throw new C(A.InvalidParams,`Tool ${e.params.name} disabled`);let o=!!e.params.task,s=n.execution?.taskSupport,i="createTask"in n.handler;if((s==="required"||s==="optional")&&!i)throw new C(A.InternalError,`Tool ${e.params.name} has taskSupport '${s}' but was not registered with registerToolTask`);if(s==="required"&&!o)throw new C(A.MethodNotFound,`Tool ${e.params.name} requires task augmentation (taskSupport: 'required')`);if(s==="optional"&&!o&&i)return await this.handleAutomaticTaskPolling(n,e,r);let a=await this.validateToolInput(n,e.params.arguments,e.params.name),c=await this.executeToolHandler(n,a,r);return o||await this.validateToolOutput(n,c,e.params.name),c}catch(n){if(n instanceof C&&n.code===A.UrlElicitationRequired)throw n;return this.createToolError(n instanceof Error?n.message:String(n))}}),this._toolHandlersInitialized=!0)}createToolError(e){return{content:[{type:"text",text:e}],isError:!0}}async validateToolInput(e,r,n){if(!e.inputSchema)return;let s=Qr(e.inputSchema)??e.inputSchema,i=await os(s,r);if(!i.success){let a="error"in i?i.error:"Unknown error",c=ss(a);throw new C(A.InvalidParams,`Input validation error: Invalid arguments for tool ${n}: ${c}`)}return i.data}async validateToolOutput(e,r,n){if(!e.outputSchema||!("content"in r)||r.isError)return;if(!r.structuredContent)throw new C(A.InvalidParams,`Output validation error: Tool ${n} has an output schema but no structured content was provided`);let o=Qr(e.outputSchema),s=await os(o,r.structuredContent);if(!s.success){let i="error"in s?s.error:"Unknown error",a=ss(i);throw new C(A.InvalidParams,`Output validation error: Invalid structured content for tool ${n}: ${a}`)}}async executeToolHandler(e,r,n){let o=e.handler;if("createTask"in o){if(!n.taskStore)throw new Error("No task store provided.");let i={...n,taskStore:n.taskStore};if(e.inputSchema){let a=o;return await Promise.resolve(a.createTask(r,i))}else{let a=o;return await Promise.resolve(a.createTask(i))}}if(e.inputSchema){let i=o;return await Promise.resolve(i(r,n))}else{let i=o;return await Promise.resolve(i(n))}}async handleAutomaticTaskPolling(e,r,n){if(!n.taskStore)throw new Error("No task store provided for task-capable tool.");let o=await this.validateToolInput(e,r.params.arguments,r.params.name),s=e.handler,i={...n,taskStore:n.taskStore},a=o?await Promise.resolve(s.createTask(o,i)):await Promise.resolve(s.createTask(i)),c=a.task.taskId,u=a.task,l=u.pollInterval??5e3;for(;u.status!=="completed"&&u.status!=="failed"&&u.status!=="cancelled";){await new Promise(f=>setTimeout(f,l));let d=await n.taskStore.getTask(c);if(!d)throw new C(A.InternalError,`Task ${c} not found during polling`);u=d}return await n.taskStore.getTaskResult(c)}setCompletionRequestHandler(){this._completionHandlerInitialized||(this.server.assertCanSetRequestHandler(ir(Is)),this.server.registerCapabilities({completions:{}}),this.server.setRequestHandler(Is,async e=>{switch(e.params.ref.type){case"ref/prompt":return Lf(e),this.handlePromptCompletion(e,e.params.ref);case"ref/resource":return Uf(e),this.handleResourceCompletion(e,e.params.ref);default:throw new C(A.InvalidParams,`Invalid completion reference: ${e.params.ref}`)}}),this._completionHandlerInitialized=!0)}async handlePromptCompletion(e,r){let n=this._registeredPrompts[r.name];if(!n)throw new C(A.InvalidParams,`Prompt ${r.name} not found`);if(!n.enabled)throw new C(A.InvalidParams,`Prompt ${r.name} disabled`);if(!n.argsSchema)return Io;let s=Jt(n.argsSchema)?.[e.params.argument.name];if(!md(s))return Io;let i=my(s);if(!i)return Io;let a=await i(e.params.argument.value,e.params.context);return gy(a)}async handleResourceCompletion(e,r){let n=Object.values(this._registeredResourceTemplates).find(i=>i.resourceTemplate.uriTemplate.toString()===r.uri);if(!n){if(this._registeredResources[r.uri])return Io;throw new C(A.InvalidParams,`Resource template ${e.params.ref.uri} not found`)}let o=n.resourceTemplate.completeCallback(e.params.argument.name);if(!o)return Io;let s=await o(e.params.argument.value,e.params.context);return gy(s)}setResourceRequestHandlers(){this._resourceHandlersInitialized||(this.server.assertCanSetRequestHandler(ir($s)),this.server.assertCanSetRequestHandler(ir(ws)),this.server.assertCanSetRequestHandler(ir(ks)),this.server.registerCapabilities({resources:{listChanged:!0}}),this.server.setRequestHandler($s,async(e,r)=>{let n=Object.entries(this._registeredResources).filter(([s,i])=>i.enabled).map(([s,i])=>({uri:s,name:i.name,...i.metadata})),o=[];for(let s of Object.values(this._registeredResourceTemplates)){if(!s.resourceTemplate.listCallback)continue;let i=await s.resourceTemplate.listCallback(r);for(let a of i.resources)o.push({...s.metadata,...a})}return{resources:[...n,...o]}}),this.server.setRequestHandler(ws,async()=>({resourceTemplates:Object.entries(this._registeredResourceTemplates).map(([r,n])=>({name:r,uriTemplate:n.resourceTemplate.uriTemplate.toString(),...n.metadata}))})),this.server.setRequestHandler(ks,async(e,r)=>{let n=new URL(e.params.uri),o=this._registeredResources[n.toString()];if(o){if(!o.enabled)throw new C(A.InvalidParams,`Resource ${n} disabled`);return o.readCallback(n,r)}for(let s of Object.values(this._registeredResourceTemplates)){let i=s.resourceTemplate.uriTemplate.match(n.toString());if(i)return s.readCallback(n,i,r)}throw new C(A.InvalidParams,`Resource ${n} not found`)}),this._resourceHandlersInitialized=!0)}setPromptRequestHandlers(){this._promptHandlersInitialized||(this.server.assertCanSetRequestHandler(ir(Ss)),this.server.assertCanSetRequestHandler(ir(Ts)),this.server.registerCapabilities({prompts:{listChanged:!0}}),this.server.setRequestHandler(Ss,()=>({prompts:Object.entries(this._registeredPrompts).filter(([,e])=>e.enabled).map(([e,r])=>({name:e,title:r.title,description:r.description,arguments:r.argsSchema?WP(r.argsSchema):void 0}))})),this.server.setRequestHandler(Ts,async(e,r)=>{let n=this._registeredPrompts[e.params.name];if(!n)throw new C(A.InvalidParams,`Prompt ${e.params.name} not found`);if(!n.enabled)throw new C(A.InvalidParams,`Prompt ${e.params.name} disabled`);if(n.argsSchema){let o=Qr(n.argsSchema),s=await os(o,e.params.arguments);if(!s.success){let c="error"in s?s.error:"Unknown error",u=ss(c);throw new C(A.InvalidParams,`Invalid arguments for prompt ${e.params.name}: ${u}`)}let i=s.data,a=n.callback;return await Promise.resolve(a(i,r))}else{let o=n.callback;return await Promise.resolve(o(r))}}),this._promptHandlersInitialized=!0)}resource(e,r,...n){let o;typeof n[0]=="object"&&(o=n.shift());let s=n[0];if(typeof r=="string"){if(this._registeredResources[r])throw new Error(`Resource ${r} is already registered`);let i=this._createRegisteredResource(e,void 0,r,o,s);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),i}else{if(this._registeredResourceTemplates[e])throw new Error(`Resource template ${e} is already registered`);let i=this._createRegisteredResourceTemplate(e,void 0,r,o,s);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),i}}registerResource(e,r,n,o){if(typeof r=="string"){if(this._registeredResources[r])throw new Error(`Resource ${r} is already registered`);let s=this._createRegisteredResource(e,n.title,r,n,o);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),s}else{if(this._registeredResourceTemplates[e])throw new Error(`Resource template ${e} is already registered`);let s=this._createRegisteredResourceTemplate(e,n.title,r,n,o);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),s}}_createRegisteredResource(e,r,n,o,s){let i={name:e,title:r,metadata:o,readCallback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({uri:null}),update:a=>{typeof a.uri<"u"&&a.uri!==n&&(delete this._registeredResources[n],a.uri&&(this._registeredResources[a.uri]=i)),typeof a.name<"u"&&(i.name=a.name),typeof a.title<"u"&&(i.title=a.title),typeof a.metadata<"u"&&(i.metadata=a.metadata),typeof a.callback<"u"&&(i.readCallback=a.callback),typeof a.enabled<"u"&&(i.enabled=a.enabled),this.sendResourceListChanged()}};return this._registeredResources[n]=i,i}_createRegisteredResourceTemplate(e,r,n,o,s){let i={resourceTemplate:n,title:r,metadata:o,readCallback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({name:null}),update:u=>{typeof u.name<"u"&&u.name!==e&&(delete this._registeredResourceTemplates[e],u.name&&(this._registeredResourceTemplates[u.name]=i)),typeof u.title<"u"&&(i.title=u.title),typeof u.template<"u"&&(i.resourceTemplate=u.template),typeof u.metadata<"u"&&(i.metadata=u.metadata),typeof u.callback<"u"&&(i.readCallback=u.callback),typeof u.enabled<"u"&&(i.enabled=u.enabled),this.sendResourceListChanged()}};this._registeredResourceTemplates[e]=i;let a=n.uriTemplate.variableNames;return Array.isArray(a)&&a.some(u=>!!n.completeCallback(u))&&this.setCompletionRequestHandler(),i}_createRegisteredPrompt(e,r,n,o,s){let i={title:r,description:n,argsSchema:o===void 0?void 0:Er(o),callback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({name:null}),update:a=>{typeof a.name<"u"&&a.name!==e&&(delete this._registeredPrompts[e],a.name&&(this._registeredPrompts[a.name]=i)),typeof a.title<"u"&&(i.title=a.title),typeof a.description<"u"&&(i.description=a.description),typeof a.argsSchema<"u"&&(i.argsSchema=Er(a.argsSchema)),typeof a.callback<"u"&&(i.callback=a.callback),typeof a.enabled<"u"&&(i.enabled=a.enabled),this.sendPromptListChanged()}};return this._registeredPrompts[e]=i,o&&Object.values(o).some(c=>{let u=c instanceof Ue?c._def?.innerType:c;return md(u)})&&this.setCompletionRequestHandler(),i}_createRegisteredTool(e,r,n,o,s,i,a,c,u){hd(e);let l={title:r,description:n,inputSchema:hy(o),outputSchema:hy(s),annotations:i,execution:a,_meta:c,handler:u,enabled:!0,disable:()=>l.update({enabled:!1}),enable:()=>l.update({enabled:!0}),remove:()=>l.update({name:null}),update:d=>{typeof d.name<"u"&&d.name!==e&&(typeof d.name=="string"&&hd(d.name),delete this._registeredTools[e],d.name&&(this._registeredTools[d.name]=l)),typeof d.title<"u"&&(l.title=d.title),typeof d.description<"u"&&(l.description=d.description),typeof d.paramsSchema<"u"&&(l.inputSchema=Er(d.paramsSchema)),typeof d.outputSchema<"u"&&(l.outputSchema=Er(d.outputSchema)),typeof d.callback<"u"&&(l.handler=d.callback),typeof d.annotations<"u"&&(l.annotations=d.annotations),typeof d._meta<"u"&&(l._meta=d._meta),typeof d.enabled<"u"&&(l.enabled=d.enabled),this.sendToolListChanged()}};return this._registeredTools[e]=l,this.setToolRequestHandlers(),this.sendToolListChanged(),l}tool(e,...r){if(this._registeredTools[e])throw new Error(`Tool ${e} is already registered`);let n,o,s,i;if(typeof r[0]=="string"&&(n=r.shift()),r.length>1){let c=r[0];gd(c)?(o=r.shift(),r.length>1&&typeof r[0]=="object"&&r[0]!==null&&!gd(r[0])&&(i=r.shift())):typeof c=="object"&&c!==null&&(i=r.shift())}let a=r[0];return this._createRegisteredTool(e,void 0,n,o,s,i,{taskSupport:"forbidden"},void 0,a)}registerTool(e,r,n){if(this._registeredTools[e])throw new Error(`Tool ${e} is already registered`);let{title:o,description:s,inputSchema:i,outputSchema:a,annotations:c,_meta:u}=r;return this._createRegisteredTool(e,o,s,i,a,c,{taskSupport:"forbidden"},u,n)}prompt(e,...r){if(this._registeredPrompts[e])throw new Error(`Prompt ${e} is already registered`);let n;typeof r[0]=="string"&&(n=r.shift());let o;r.length>1&&(o=r.shift());let s=r[0],i=this._createRegisteredPrompt(e,void 0,n,o,s);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),i}registerPrompt(e,r,n){if(this._registeredPrompts[e])throw new Error(`Prompt ${e} is already registered`);let{title:o,description:s,argsSchema:i}=r,a=this._createRegisteredPrompt(e,o,s,i,n);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),a}isConnected(){return this.server.transport!==void 0}async sendLoggingMessage(e,r){return this.server.sendLoggingMessage(e,r)}sendResourceListChanged(){this.isConnected()&&this.server.sendResourceListChanged()}sendToolListChanged(){this.isConnected()&&this.server.sendToolListChanged()}sendPromptListChanged(){this.isConnected()&&this.server.sendPromptListChanged()}};var GP={type:"object",properties:{}};function yy(t){return t!==null&&typeof t=="object"&&"parse"in t&&typeof t.parse=="function"&&"safeParse"in t&&typeof t.safeParse=="function"}function JP(t){return"_def"in t||"_zod"in t||yy(t)}function gd(t){return typeof t!="object"||t===null||JP(t)?!1:Object.keys(t).length===0?!0:Object.values(t).some(yy)}function hy(t){if(t)return gd(t)?Er(t):t}function WP(t){let e=Jt(t);return e?Object.entries(e).map(([r,n])=>{let o=tf(n),s=rf(n);return{name:r,description:o,required:!s}}):[]}function ir(t){let r=Jt(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=is(r);if(typeof n=="string")return n;throw new Error("Schema method literal must be a string")}function gy(t){return{completion:{values:t.slice(0,100),total:t.length,hasMore:t.length>100}}}var Io={completion:{values:[],hasMore:!1}};var yd=Oo(require("node:process"),1);var wi=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;let e=this._buffer.indexOf(`
`);if(e===-1)return null;let r=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),XP(r)}clear(){this._buffer=void 0}};function XP(t){return jf.parse(JSON.parse(t))}function _y(t){return JSON.stringify(t)+`
`}var ki=class{constructor(e=yd.default.stdin,r=yd.default.stdout){this._stdin=e,this._stdout=r,this._readBuffer=new wi,this._started=!1,this._ondata=n=>{this._readBuffer.append(n),this.processReadBuffer()},this._onerror=n=>{this.onerror?.(n)}}async start(){if(this._started)throw new Error("StdioServerTransport already started! If using Server class, note that connect() calls start() automatically.");this._started=!0,this._stdin.on("data",this._ondata),this._stdin.on("error",this._onerror)}processReadBuffer(){for(;;)try{let e=this._readBuffer.readMessage();if(e===null)break;this.onmessage?.(e)}catch(e){this.onerror?.(e)}}async close(){this._stdin.off("data",this._ondata),this._stdin.off("error",this._onerror),this._stdin.listenerCount("data")===0&&this._stdin.pause(),this._readBuffer.clear(),this.onclose?.()}send(e){return new Promise(r=>{let n=_y(e);this._stdout.write(n)?r():this._stdout.once("drain",r)})}};var Ro=Oo(require("node:crypto"),1);var xy="0123456789ABCDEFGHJKMNPQRSTVWXYZ",Si=32;var YP=16,by=10,vy=0xffffffffffff;var qr;(function(t){t.Base32IncorrectEncoding="B32_ENC_INVALID",t.DecodeTimeInvalidCharacter="DEC_TIME_CHAR",t.DecodeTimeValueMalformed="DEC_TIME_MALFORMED",t.EncodeTimeNegative="ENC_TIME_NEG",t.EncodeTimeSizeExceeded="ENC_TIME_SIZE_EXCEED",t.EncodeTimeValueMalformed="ENC_TIME_MALFORMED",t.PRNGDetectFailure="PRNG_DETECT",t.ULIDInvalid="ULID_INVALID",t.Unexpected="UNEXPECTED",t.UUIDInvalid="UUID_INVALID"})(qr||(qr={}));var Lr=class extends Error{constructor(e,r){super(`${r} (${e})`),this.name="ULIDError",this.code=e}};function QP(t){let e=Math.floor(t()*Si)%Si;return xy.charAt(e)}function ez(t){let e=tz(),r=e&&(e.crypto||e.msCrypto)||(typeof Ro.default<"u"?Ro.default:null);if(typeof r?.getRandomValues=="function")return()=>{let n=new Uint8Array(1);return r.getRandomValues(n),n[0]/256};if(typeof r?.randomBytes=="function")return()=>r.randomBytes(1).readUInt8()/256;if(Ro.default?.randomBytes)return()=>Ro.default.randomBytes(1).readUInt8()/256;throw new Lr(qr.PRNGDetectFailure,"Failed to find a reliable PRNG")}function tz(){return oz()?self:typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:null}function rz(t,e){let r="";for(;t>0;t--)r=QP(e)+r;return r}function nz(t,e=by){if(isNaN(t))throw new Lr(qr.EncodeTimeValueMalformed,`Time must be a number: ${t}`);if(t>vy)throw new Lr(qr.EncodeTimeSizeExceeded,`Cannot encode a time larger than ${vy}: ${t}`);if(t<0)throw new Lr(qr.EncodeTimeNegative,`Time must be positive: ${t}`);if(Number.isInteger(t)===!1)throw new Lr(qr.EncodeTimeValueMalformed,`Time must be an integer: ${t}`);let r,n="";for(let o=e;o>0;o--)r=t%Si,n=xy.charAt(r)+n,t=(t-r)/Si;return n}function oz(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}function $y(t,e){let r=e||ez(),n=!t||isNaN(t)?Date.now():t;return nz(n,by)+rz(YP,r)}var Ti=class{baseUrl;apiKey;teamId;projectId;brainETag=null;brainCache=null;brainParamsKey=null;constructor(e){if(this.apiKey=e?.apiKey??process.env.CONTOX_API_KEY??"",this.baseUrl=(e?.apiUrl??process.env.CONTOX_API_URL??"https://contox.dev").replace(/\/$/,""),this.teamId=e?.teamId??process.env.CONTOX_TEAM_ID??"",this.projectId=e?.projectId??process.env.CONTOX_PROJECT_ID??"",!this.apiKey)throw new Error("CONTOX_API_KEY is required. Set it as an environment variable.");if(!this.teamId)throw new Error("CONTOX_TEAM_ID is required. Set it as an environment variable.");if(!this.projectId)throw new Error("CONTOX_PROJECT_ID is required. Set it as an environment variable.")}async request(e,r={}){let n=`${this.baseUrl}/api${e}`,o=await fetch(n,{...r,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...r.headers}});if(!o.ok){let s=await o.json().catch(()=>({})),i=typeof s.error=="string"?s.error:o.statusText;throw new Error(`API error (${String(o.status)}): ${i}`)}return o.json()}async listContexts(e){let r=new URLSearchParams({teamId:this.teamId,projectId:this.projectId});return e?.schemaKey&&r.set("schemaKey",e.schemaKey),e?.tier!==void 0&&r.set("tier",String(e.tier)),e?.state&&r.set("state",e.state),e?.contextType&&r.set("contextType",e.contextType),e?.parentContextId&&r.set("parentContextId",e.parentContextId),this.request(`/contexts?${r.toString()}`)}async getContext(e){return this.request(`/contexts/${encodeURIComponent(e)}`)}async createContext(e){return this.request("/contexts",{method:"POST",body:JSON.stringify(e)})}async updateContext(e,r){return this.request(`/contexts/${encodeURIComponent(e)}`,{method:"PATCH",body:JSON.stringify(r)})}async deleteContext(e){await this.request(`/contexts/${encodeURIComponent(e)}`,{method:"DELETE"})}async findBySchemaKey(e){return(await this.listContexts({schemaKey:e}))[0]??null}async findContextByName(e){return(await this.listContexts()).find(n=>n.name===e)??null}async searchContexts(e){let r=await this.listContexts(),n=e.toLowerCase();return r.filter(o=>o.name.toLowerCase().includes(n)||(o.description?.toLowerCase().includes(n)??!1))}async searchContent(e){return this.request(`/contexts/search?q=${encodeURIComponent(e)}&projectId=${encodeURIComponent(this.projectId)}`)}async getBrain(e,r){let n=new URLSearchParams({teamId:this.teamId,projectId:this.projectId});if(r&&n.set("includeDrafts","true"),e){let u=Object.entries(e).map(([l,d])=>`${l}:${String(d)}`).join(",");n.set("entriesLimit",u)}let o=n.toString();o!==this.brainParamsKey&&(this.brainETag=null,this.brainCache=null,this.brainParamsKey=o);let s={};this.brainETag&&(s["If-None-Match"]=this.brainETag);let i=`${this.baseUrl}/api/contexts/brain?${o}`,a=await fetch(i,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...s}});if(a.status===304&&this.brainCache)return this.brainCache;if(!a.ok){let u=await a.json().catch(()=>({})),l=typeof u.error=="string"?u.error:a.statusText;throw new Error(`API error (${String(a.status)}): ${l}`)}let c=await a.json();return this.brainETag=a.headers.get("etag"),this.brainCache=c,c}async createEntry(e){return this.request("/context-entries",{method:"POST",body:JSON.stringify(e)})}async listEntries(e,r){let n=new URLSearchParams({contextId:e});return r?.limit&&n.set("limit",String(r.limit)),r?.cursorAfter&&n.set("cursorAfter",r.cursorAfter),r?.entryType&&n.set("entryType",r.entryType),this.request(`/context-entries?${n.toString()}`)}async optimisticUpdate(e,r,n,o){for(let i=0;i<3;i++){let a=await this.getContext(e),c=a.content??"",u=r(c);try{return await this.updateContext(e,{content:u,version:a.version,source:n,sourceRef:o})}catch(l){if((l instanceof Error?l.message:String(l)).includes("409")&&i<2)continue;throw l}}throw new Error("OCC: max retries exceeded")}async populate(e,r,n){return this.request("/contexts/populate",{method:"POST",body:JSON.stringify({teamId:this.teamId,projectId:this.projectId,nodes:e,dryRun:r,source:n})})}async approveContext(e){await this.request(`/contexts/${encodeURIComponent(e)}/approve?action=approve`,{method:"POST"})}async deprecateContext(e){await this.request(`/contexts/${encodeURIComponent(e)}/approve?action=deprecate`,{method:"POST"})}async getTree(){return this.request(`/contexts/tree?teamId=${encodeURIComponent(this.teamId)}&projectId=${encodeURIComponent(this.projectId)}`)}async createLink(e,r,n,o,s){await this.request("/context-links",{method:"POST",body:JSON.stringify({teamId:this.teamId,projectId:this.projectId,fromSchemaKey:e,toSchemaKey:r,linkType:n,reason:o,confidence:s,source:"mcp"})})}async getLinks(e,r){let n=new URLSearchParams({teamId:this.teamId,projectId:this.projectId,schemaKey:e});return r&&n.set("direction",r),this.request(`/context-links?${n.toString()}`)}async compactContext(e){return this.request(`/contexts/${encodeURIComponent(e)}/compact`,{method:"POST"})}static generateUlid(){return $y()}};var zi=require("node:crypto"),Pi=class{baseUrl;apiKey;projectId;hmacSecret;brainETag=null;brainCache=null;constructor(e){this.apiKey=e.apiKey,this.baseUrl=(e.apiUrl??"https://contox.dev").replace(/\/$/,""),this.projectId=e.projectId,this.hmacSecret=e.hmacSecret??null}async getBrain(e){let r=new URLSearchParams({projectId:this.projectId});e?.minConfidence!==void 0&&r.set("minConfidence",String(e.minConfidence)),e?.limit!==void 0&&r.set("limit",String(e.limit)),e?.tokenBudget!==void 0&&r.set("tokenBudget",String(e.tokenBudget)),e?.activeFiles&&e.activeFiles.length>0&&r.set("activeFiles",e.activeFiles.join(","));let n={};this.brainETag&&(n["If-None-Match"]=this.brainETag);let o=`${this.baseUrl}/api/v2/brain?${r.toString()}`,s=await fetch(o,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...n}});if(s.status===304&&this.brainCache)return this.brainCache;if(!s.ok){let a=await s.json().catch(()=>({})),c=typeof a.error=="string"?a.error:s.statusText;throw new Error(`V2 brain error (${String(s.status)}): ${c}`)}let i=await s.json();return this.brainETag=s.headers.get("etag"),this.brainCache=i,i}async search(e,r){let n=new URLSearchParams({projectId:this.projectId,q:e});return r?.limit!==void 0&&n.set("limit",String(r.limit)),r?.minSimilarity!==void 0&&n.set("minSimilarity",String(r.minSimilarity)),r?.activeFiles&&r.activeFiles.length>0&&(n.set("activeFiles",r.activeFiles.join(",")),n.set("useCompositeScore","true")),this.request(`/v2/search?${n.toString()}`)}async listItems(e){let r=new URLSearchParams({projectId:this.projectId});return e?.type&&r.set("type",e.type),e?.schemaKey&&r.set("schemaKey",e.schemaKey),e?.status&&r.set("status",e.status),e?.limit!==void 0&&r.set("limit",String(e.limit)),e?.offset!==void 0&&r.set("offset",String(e.offset)),this.request(`/v2/items?${r.toString()}`)}async getItem(e,r){let n=r?"?includeEmbedding=true":"";return this.request(`/v2/items/${encodeURIComponent(e)}${n}`)}async ingest(e){if(!this.hmacSecret)throw new Error("V2_HMAC_SECRET is required for V2 ingest");let r=JSON.stringify(e),n=new Date().toISOString(),o=(0,zi.randomUUID)(),s=(0,zi.createHmac)("sha256",this.hmacSecret).update(r).digest("hex");return this.request("/v2/ingest",{method:"POST",body:JSON.stringify({source:"mcp-server",timestamp:n,nonce:o,signature:s,projectId:this.projectId,event:e,skipEnrichment:!0})})}async analyzeHygiene(e){return this.request("/v2/hygiene",{method:"POST",body:JSON.stringify({action:"analyze",mode:e.mode,scope:{teamId:e.teamId,projectId:this.projectId},filters:e.schemaKeyPrefix?{schemaKeyPrefix:e.schemaKeyPrefix}:void 0})})}async applyHygiene(e){return this.request("/v2/hygiene",{method:"POST",body:JSON.stringify({action:"apply",scope:{teamId:e.teamId,projectId:this.projectId},plan:e.plan,selectedActionIds:e.selectedActionIds,dryRun:e.dryRun??!1})})}async autoResolve(e,r){return this.request("/v2/auto-resolve",{method:"POST",body:JSON.stringify({projectId:this.projectId,commits:e,dryRun:r??!1})})}async driftCheck(){return this.request(`/v2/projects/${encodeURIComponent(this.projectId)}/drift-check`,{method:"POST"})}async getDriftProblems(){return this.request(`/v2/projects/${encodeURIComponent(this.projectId)}/drift-check`)}async generateOnboardingGuide(){return this.request(`/v2/projects/${encodeURIComponent(this.projectId)}/onboarding-guide`,{method:"POST"})}async getChangelog(e){let r=new Date(Date.now()-(e?.days??30)*24*60*60*1e3).toISOString(),n=new URLSearchParams({mode:e?.mode??"developer",since:r,limit:"200"});return this.request(`/v2/projects/${encodeURIComponent(this.projectId)}/changelog?${n.toString()}`)}async analyzeImpact(e){let r=e?`?days=${String(e)}`:"";return this.request(`/v2/projects/${encodeURIComponent(this.projectId)}/impact${r}`,{method:"POST"})}async ask(e){return this.request("/v2/ask",{method:"POST",body:JSON.stringify({projectId:this.projectId,question:e,mode:"sync"})})}async request(e,r={}){let n=`${this.baseUrl}/api${e}`,o=await fetch(n,{...r,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...r.headers}});if(!o.ok){let s=await o.json().catch(()=>({})),i=typeof s.error=="string"?s.error:o.statusText;throw new Error(`V2 API error (${String(o.status)}): ${i}`)}return o.json()}};var wy=[{id:"architecture",name:"Architecture",description:"Tech stack, architecture decisions, design patterns, project structure, infrastructure",order:0},{id:"conventions",name:"Conventions & Rules",description:"Coding conventions, style rules, linter gotchas, naming patterns, team agreements",order:1},{id:"implementation",name:"Implementation Log",description:"Features built, components created, APIs implemented, integrations added",order:2},{id:"decisions",name:"Technical Decisions",description:"Key decisions with rationale: why X over Y, trade-offs considered, constraints",order:3},{id:"bugs",name:"Bugs & Fixes",description:"Bugs found and how they were fixed, edge cases discovered, workarounds applied",order:4},{id:"todo",name:"Todo & Next Steps",description:"Pending tasks, known issues, planned improvements, tech debt to address",order:5},{id:"sessions",name:"Session Log",description:"Chronological log of all AI sessions with date and summary",order:6}];async function ky(t,e={}){let r=e.since??new Date(Date.now()-864e5).toISOString(),n=[];n.push("# On-Call View"),n.push(""),n.push(`> Since: ${r}`),n.push("");try{let o=await t.findBySchemaKey("root/sessions");if(o){let s=await t.listEntries(o.id,{limit:5});if(n.push("## Recent Sessions"),n.push(""),s.entries.length===0)n.push("No recent sessions.");else for(let i of s.entries)n.push(`- **${i.title}** (${i.createdAt})`),i.tags&&i.tags.length>0&&n.push(`  Tags: ${i.tags.join(", ")}`);n.push("")}}catch{n.push("## Recent Sessions"),n.push(""),n.push("_Unable to fetch sessions._"),n.push("")}try{let o=await t.listContexts({state:"draft"}),s=new Date(Date.now()-7*24*60*60*1e3).toISOString(),i=o.filter(a=>(a.createdAt??"")<s);if(n.push("## Stale Drafts (>7 days)"),n.push(""),i.length===0)n.push("No stale drafts.");else{n.push(`Found ${i.length} stale draft(s):`),n.push("");for(let a of i.slice(0,10))n.push(`- **${a.name}** (schemaKey: ${a.schemaKey??"none"}, created: ${a.createdAt??"unknown"})`);i.length>10&&n.push(`- ... and ${i.length-10} more`)}n.push("")}catch{n.push("## Stale Drafts"),n.push(""),n.push("_Unable to fetch drafts._"),n.push("")}try{let o=await t.findBySchemaKey("root/bugs");if(o){let s=await t.listEntries(o.id,{limit:5});if(n.push("## Recent Bugs"),n.push(""),s.entries.length===0)n.push("No recent bugs recorded.");else for(let i of s.entries)n.push(`- **${i.title}** (${i.createdAt})`);n.push("")}}catch{n.push("## Recent Bugs"),n.push(""),n.push("_Unable to fetch bugs._"),n.push("")}try{let s=(await t.getTree()).total,i=await t.listContexts(),a=i.filter(l=>l.state==="approved").length,c=i.filter(l=>l.state==="draft").length,u=i.filter(l=>l.state==="deprecated").length;n.push("## Brain Health"),n.push(""),n.push("| Metric | Value |"),n.push("|--------|-------|"),n.push(`| Total contexts | ${s} |`),n.push(`| Approved | ${a} |`),n.push(`| Draft | ${c} |`),n.push(`| Deprecated | ${u} |`),n.push("")}catch{n.push("## Brain Health"),n.push(""),n.push("_Unable to fetch brain stats._"),n.push("")}return n.join(`
`)}var sz=new Map,_d={schemaKey:"root",name:"Project Memory",contextType:"system",tier:1,order:0,description:"Root context \u2014 project overview and metadata",storageModel:"content",writePolicy:"mcp",children:[{schemaKey:"root/cortex",name:"Cortex",contextType:"system",tier:1,order:1,description:"Auto-generated project summary \u2014 current focus, recent sessions",storageModel:"content",writePolicy:"mcp"},{schemaKey:"root/stack",name:"Stack & Infrastructure",contextType:"reference",tier:1,order:2,description:"Tech stack, architecture decisions, design patterns, project structure",storageModel:"content",writePolicy:"both",children:[{schemaKey:"root/stack/database",name:"Database Schema",contextType:"reference",tier:2,order:0,description:"Database schema, collections, indexes, relationships",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/stack/environment",name:"Environment & Config",contextType:"reference",tier:2,order:1,description:"Environment variables, configuration files, deployment settings",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/stack/deployment",name:"Deployment & CI/CD",contextType:"reference",tier:2,order:2,description:"Deployment setup, CI/CD pipelines, hosting infrastructure",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/api",name:"API Surface",contextType:"reference",tier:1,order:3,description:"API endpoints, request/response schemas, authentication",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/backend/auth",linkType:"see-also"},{toSchemaKey:"root/stack/database",linkType:"depends-on"}],children:[{schemaKey:"root/api/auth",name:"Auth & User Endpoints",contextType:"reference",tier:2,order:0,description:"Authentication, registration, password reset, session management",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/api/core",name:"Core Resource Endpoints",contextType:"reference",tier:2,order:1,description:"CRUD endpoints for core business entities",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/api/integrations",name:"Integration Endpoints",contextType:"reference",tier:2,order:2,description:"Third-party integration endpoints (Slack, VS Code, etc.)",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/frontend",name:"Frontend Architecture",contextType:"reference",tier:1,order:4,description:"Frontend components, pages, hooks, design system",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/frontend/design",linkType:"depends-on"},{toSchemaKey:"root/api",linkType:"see-also"}],children:[{schemaKey:"root/frontend/ui",name:"UI Component Library",contextType:"reference",tier:2,order:0,description:"Reusable UI components, their props and usage patterns",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/frontend/pages",name:"Page Components & Routes",contextType:"reference",tier:2,order:1,description:"Page-level components and routing structure",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/frontend/hooks",name:"Hooks & State Management",contextType:"reference",tier:2,order:2,description:"Custom hooks, state management patterns, data fetching",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/frontend/design",name:"Design System Tokens",contextType:"reference",tier:2,order:3,description:"Colors, typography, spacing, design tokens and variables",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/backend",name:"Backend Architecture",contextType:"reference",tier:1,order:5,description:"Backend modules, business logic, external integrations",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/stack/database",linkType:"depends-on"},{toSchemaKey:"root/api",linkType:"see-also"}],children:[{schemaKey:"root/backend/auth",name:"Auth & Security",contextType:"reference",tier:2,order:0,description:"Authentication middleware, RBAC, security patterns",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/backend/logic",name:"Business Logic Modules",contextType:"reference",tier:2,order:1,description:"Core business logic, validation, data processing",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/backend/integrations",name:"External Integrations",contextType:"reference",tier:2,order:2,description:"Third-party service integrations (Stripe, Appwrite, etc.)",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/packages",name:"Packages & Extensions",contextType:"reference",tier:1,order:6,description:"MCP server, CLI, Claude plugin, VS Code extension",storageModel:"content",writePolicy:"scanner",children:[{schemaKey:"root/packages/mcp",name:"MCP Server Package",contextType:"reference",tier:2,order:0,description:"MCP server implementation, tools, API client",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/packages/cli",name:"CLI Package",contextType:"reference",tier:2,order:1,description:"CLI commands, options, configuration",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/packages/plugin",name:"Claude Plugin Package",contextType:"reference",tier:2,order:2,description:"Claude Code plugin configuration and marketplace metadata",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/packages/vscode",name:"VS Code Extension",contextType:"reference",tier:2,order:3,description:"VS Code extension functionality and configuration",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/conventions",name:"Conventions & Patterns",contextType:"memory",tier:1,order:7,description:"Coding conventions, style rules, naming patterns, team agreements",storageModel:"entries",writePolicy:"both"},{schemaKey:"root/decisions",name:"Architecture Decisions",contextType:"memory",tier:1,order:8,description:"Key decisions with rationale: why X over Y, trade-offs, constraints",storageModel:"entries",writePolicy:"both"},{schemaKey:"root/todo",name:"Active Todo & Roadmap",contextType:"memory",tier:1,order:9,description:"Pending tasks, known issues, planned improvements, tech debt",storageModel:"entries",writePolicy:"both"},{schemaKey:"root/bugs",name:"Bug Registry",contextType:"memory",tier:1,order:10,description:"Bugs found and how they were fixed, edge cases, workarounds",storageModel:"entries",writePolicy:"mcp"},{schemaKey:"root/journal",name:"Implementation Journal",contextType:"memory",tier:2,order:11,description:"Features built, components created, APIs implemented",storageModel:"entries",writePolicy:"mcp"},{schemaKey:"root/sessions",name:"Session Chronicle",contextType:"system",tier:2,order:12,description:"Chronological log of all AI sessions with date and summary",storageModel:"entries",writePolicy:"mcp"},{schemaKey:"root/contracts",name:"API Contracts",contextType:"reference",tier:1,order:13,description:"Contract documents per domain \u2014 identity, IO, invariants, failure modes, SLOs",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/api",linkType:"depends-on"}],children:[{schemaKey:"root/contracts/auth",name:"Auth Contract",contextType:"reference",tier:2,order:0,description:"Cookie/bearer auth, derivation, RBAC contract",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/backend/auth",linkType:"see-also"}]},{schemaKey:"root/contracts/brain-endpoint",name:"Brain Endpoint Contract",contextType:"reference",tier:2,order:1,description:"GET /brain contract \u2014 ETag, tier assembly, token budget",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/entries",name:"Entries Contract",contextType:"reference",tier:2,order:2,description:"Context entries CRUD \u2014 ULID ordering, idempotency, cursor pagination",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/populate",name:"Populate Contract",contextType:"reference",tier:2,order:3,description:"Batch upsert contract \u2014 diffStats, dryRun, contentHash dedup",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/search",name:"Search Contract",contextType:"reference",tier:2,order:4,description:"Unified search contract \u2014 proof objects, relevance, link boost",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/links",name:"Links Contract",contextType:"reference",tier:2,order:5,description:"Context links CRUD \u2014 bidirectional queries, confidence scoring",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/compaction",name:"Compaction Contract",contextType:"reference",tier:2,order:6,description:"Entries compaction contract \u2014 rolling summary, no deletion",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/runbooks",name:"Runbooks",contextType:"reference",tier:1,order:14,description:"Operational runbooks for incident response and diagnostics",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/ops",linkType:"see-also"}],children:[{schemaKey:"root/runbooks/brain-5xx",name:"Runbook: Brain 5xx",contextType:"reference",tier:2,order:0,description:"Brain endpoint returns 500 \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/populate-stuck",name:"Runbook: Populate Stuck",contextType:"reference",tier:2,order:1,description:"Populate run stuck or failing \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/search-low-recall",name:"Runbook: Search Low Recall",contextType:"reference",tier:2,order:2,description:"Search returns poor results \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/drafts-never-approved",name:"Runbook: Drafts Never Approved",contextType:"reference",tier:2,order:3,description:"Draft contexts accumulate without approval \u2014 diagnosis",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/audit-mismatch",name:"Runbook: Audit Mismatch",contextType:"reference",tier:2,order:4,description:"Mutation audit log inconsistent \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/appwrite-throttling",name:"Runbook: Appwrite Throttling",contextType:"reference",tier:2,order:5,description:"Appwrite rate limits hit \u2014 diagnosis and mitigation",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/ops",name:"Operations & SLOs",contextType:"reference",tier:1,order:15,description:"SLOs per CUJ, error budget policy, golden signals, observability",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/contracts",linkType:"depends-on"}]},{schemaKey:"root/security",name:"Security & Threat Model",contextType:"reference",tier:1,order:16,description:"STRIDE threat model, ASVS checklist, auth surface, mitigations",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/backend/auth",linkType:"see-also"}]},{schemaKey:"root/governance",name:"Data Governance",contextType:"reference",tier:1,order:17,description:"Lifecycle rules, immutable fields, integrity jobs, state machine",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/quality",name:"Quality Gates",contextType:"reference",tier:1,order:18,description:"Test suites, contract tests, retrieval eval, populate gates",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/performance",name:"Performance & Cost",contextType:"reference",tier:1,order:19,description:"Token budgets, degradation strategy, cheap retrieval, cost tracking",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/patterns",name:"Patterns Cookbook",contextType:"reference",tier:1,order:20,description:"Canonical code patterns with snippets \u2014 OCC, idempotency, ETag, pagination",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/conventions",linkType:"see-also"}]},{schemaKey:"root/flows",name:"Data Flows",contextType:"reference",tier:1,order:21,description:"Mermaid sequence diagrams for critical paths \u2014 auth, save, populate, search",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/api",linkType:"see-also"}]},{schemaKey:"root/schema",name:"DB Schema Docs",contextType:"reference",tier:1,order:22,description:"Appwrite collections, attributes, types, indexes with justifications",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/stack/database",linkType:"see-also"}]},{schemaKey:"root/adrs",name:"Architecture Decision Records",contextType:"memory",tier:1,order:23,description:"Formal ADRs \u2014 context, options, decision, tradeoffs, consequences",storageModel:"content",writePolicy:"both",links:[{toSchemaKey:"root/decisions",linkType:"see-also"}]}]};function Sy(t){if(sz.set(t.schemaKey,t),t.children)for(let e of t.children)Sy(e)}Sy(_d);function Ty(t,e){if(t.schemaKey===e)return t;if(t.children)for(let r of t.children){let n=Ty(r,e);if(n)return n}return null}async function Py(t,e){let r=[];r.push(`# Explain: ${e}`),r.push("");let n=Ty(_d,e);if(n){if(r.push("## Schema Metadata"),r.push(""),r.push("| Property | Value |"),r.push("|----------|-------|"),r.push(`| SchemaKey | \`${n.schemaKey}\` |`),r.push(`| Name | ${n.name} |`),n.tier!==void 0&&r.push(`| Tier | ${n.tier} |`),n.contextType&&r.push(`| Context Type | ${n.contextType} |`),n.writePolicy&&r.push(`| Write Policy | ${n.writePolicy} |`),n.storageModel&&r.push(`| Storage Model | ${n.storageModel} |`),n.description&&r.push(`| Description | ${n.description} |`),n.children&&r.push(`| Children | ${n.children.length} |`),r.push(""),n.links&&n.links.length>0){r.push("### Links (Schema-Declared)"),r.push("");for(let o of n.links)r.push(`- **${o.linkType}** \u2192 \`${o.toSchemaKey}\``);r.push("")}}else r.push("> SchemaKey not found in brain-schema.ts"),r.push("");try{let o=await t.findBySchemaKey(e);if(o){if(r.push("## Context"),r.push(""),r.push("| Property | Value |"),r.push("|----------|-------|"),r.push(`| ID | ${o.id} |`),r.push(`| State | ${o.state??"unknown"} |`),r.push(`| Version | ${o.version??0} |`),o.contentHash&&r.push(`| Content Hash | ${o.contentHash.slice(0,12)}... |`),o.lastEntryAt&&r.push(`| Last Entry | ${o.lastEntryAt} |`),r.push(""),o.content){let s=o.content.length>500?o.content.slice(0,500)+"...":o.content;r.push("### Content Preview"),r.push(""),r.push(s),r.push("")}try{let s=await t.getLinks(e);if(s.outgoing.length>0||s.incoming.length>0){if(r.push("## Links (Runtime)"),r.push(""),s.outgoing.length>0){r.push("**Outgoing:**");for(let i of s.outgoing)r.push(`- ${i.linkType} \u2192 \`${i.toSchemaKey}\``);r.push("")}if(s.incoming.length>0){r.push("**Incoming:**");for(let i of s.incoming)r.push(`- ${i.linkType} \u2190 \`${i.fromSchemaKey}\``);r.push("")}}}catch{}try{let s=await t.listEntries(o.id,{limit:5});if(s.entries.length>0){r.push("## Recent Entries"),r.push("");for(let i of s.entries){r.push(`### ${i.title}`),r.push(`> ${i.entryType??"entry"} | ${i.createdAt}`);let a=i.content.length>200?i.content.slice(0,200)+"...":i.content;r.push(a),r.push("")}}}catch{}}else r.push("## Context"),r.push(""),r.push("_No context found for this schemaKey in the current project._"),r.push("")}catch(o){r.push("## Context"),r.push(""),r.push(`_Error fetching context: ${String(o)}_`),r.push("")}if(e.startsWith("root/contracts/")){r.push("## Related Contract"),r.push("");let o=e.replace("root/contracts/","");r.push(`This is a contract domain. See generated contract: \`generated/contracts/${o}.md\``),r.push("")}else{let o=e.replace("root/","").split("/")[0];if(o)try{await t.findBySchemaKey(`root/contracts/${o}`)&&(r.push("## Related Contract"),r.push(""),r.push(`See: \`root/contracts/${o}\``),r.push(""))}catch{}}return r.join(`
`)}var Ni=require("node:path"),Tn=require("node:fs");var qt=require("node:fs"),qe=require("node:path"),iz=new Set(["node_modules",".next",".git","dist","out","build",".cache",".turbo","coverage",".nyc_output",".storybook","storybook-static","__pycache__",".venv","vendor",".svn",".hg","test-results","playwright-report",".playwright"]),az=new Set(["package-lock.json","pnpm-lock.yaml","yarn.lock","bun.lockb",".DS_Store","Thumbs.db","nul"]),cz=new Set([".png",".jpg",".jpeg",".gif",".svg",".ico",".webp",".avif",".woff",".woff2",".ttf",".eot",".otf",".mp3",".mp4",".wav",".ogg",".webm",".zip",".tar",".gz",".br",".7z",".rar",".pdf",".doc",".docx",".xls",".xlsx",".exe",".dll",".so",".dylib",".wasm",".map"]),uz=32*1024,lz=[{pattern:/^README\.md$/i,reason:"Project documentation"},{pattern:/^ARCHITECTURE\.md$/i,reason:"Architecture documentation"},{pattern:/^CLAUDE\.md$/i,reason:"AI assistant instructions"},{pattern:/^AGENTS\.md$/i,reason:"AI agent instructions"},{pattern:/^RULES\.md$/i,reason:"Project rules"},{pattern:/^CONTRIBUTING\.md$/i,reason:"Contribution guidelines"},{pattern:/^\.cursorrules$/i,reason:"AI assistant rules"},{pattern:/^\.clinerules$/i,reason:"AI assistant rules"},{pattern:/^Dockerfile$/i,reason:"Container configuration"},{pattern:/^docker-compose\.ya?ml$/i,reason:"Container orchestration"},{pattern:/^\.env\.example$/i,reason:"Environment template"},{pattern:/^schema\.prisma$/i,reason:"Database schema"},{pattern:/^drizzle\.config\.\w+$/i,reason:"Database configuration"}];function dz(t){return iz.has(t)||t.startsWith(".")}function pz(t){if(az.has(t))return!0;let e=(0,qe.extname)(t).toLowerCase();return!!cz.has(e)}function fz(t){for(let{pattern:e,reason:r}of lz)if(e.test(t))return{match:!0,reason:r};return{match:!1,reason:""}}function mz(t){let e=(0,qe.extname)(t).toLowerCase();return{".ts":"TypeScript",".tsx":"TypeScript (JSX)",".js":"JavaScript",".jsx":"JavaScript (JSX)",".py":"Python",".rb":"Ruby",".go":"Go",".rs":"Rust",".java":"Java",".kt":"Kotlin",".swift":"Swift",".cs":"C#",".cpp":"C++",".c":"C",".php":"PHP",".vue":"Vue",".svelte":"Svelte",".astro":"Astro",".css":"CSS",".scss":"SCSS",".less":"LESS",".html":"HTML",".md":"Markdown",".json":"JSON",".yaml":"YAML",".yml":"YAML",".toml":"TOML",".xml":"XML",".sql":"SQL",".graphql":"GraphQL",".gql":"GraphQL",".sh":"Shell",".bash":"Shell",".zsh":"Shell",".dockerfile":"Dockerfile"}[e]??null}function hz(t,e,r){let n=[],o=[],s=[],i=/export\s+(?:const|function)\s+(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)\b/g,a;for(;(a=i.exec(t))!==null;)n.push(a[1]);let c=/export\s+const\s+(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)\s*=\s*(\w+)\(/g;for(;(a=c.exec(t))!==null;)n.includes(a[1])||n.push(a[1]),s.push(a[2]);let u=/(?:const|let)\s+(\w+Schema)\s*=\s*z\.\w+\(\{([^}]*(?:\{[^}]*\}[^}]*)*)\}\)/g;for(;(a=u.exec(t))!==null;){let d=a[1],m=a[2].replace(/\s+/g," ").trim();o.push(`${d}: { ${m.length>200?m.slice(0,200)+"...":m} }`)}let l=[...new Set(s)];return{path:e,methods:n,filePath:r,schemas:o,middleware:l}}function gz(t,e){let r=(0,qe.basename)(e).replace(/\.(tsx|jsx)$/,""),n=null,o=null,s=t.match(/export\s+default\s+function\s+(\w+)/),i=t.match(/export\s+function\s+(\w+)/);s?r=s[1]:i&&(r=i[1]);let a=[/(?:export\s+)?interface\s+(\w*Props\w*)\s*\{([^}]*(?:\{[^}]*\}[^}]*)*)\}/,/(?:export\s+)?type\s+(\w*Props\w*)\s*=\s*\{([^}]*(?:\{[^}]*\}[^}]*)*)\}/];for(let u of a){let l=t.match(u);if(l){let f=l[2].trim().split(`
`).map(m=>m.trim()).filter(m=>m&&!m.startsWith("//")&&!m.startsWith("/*"));f.length>0&&(n=f.slice(0,15).join(`
`),f.length>15&&(n+=`
// ... ${String(f.length-15)} more props`));break}}let c=t.match(/\/\*\*\s*\n([^*]*(?:\*[^/][^*]*)*)\*\/\s*\n\s*(?:export\s+)?(?:default\s+)?function/);return c&&(o=c[1].replace(/^\s*\*\s?/gm,"").trim().split(`
`)[0]??null),{name:r,filePath:e,props:n,description:o}}function Ei(t,e){let r=[],n=null,o=t.match(/^\/\*\*\s*\n([^*]*(?:\*[^/][^*]*)*)\*\/\s*\n/);o&&(n=o[1].replace(/^\s*\*\s?/gm,"").trim().split(`
`)[0]??null);let s=/export\s+(async\s+)?function\s+(\w+)\s*(<[^>]*>)?\s*\(([^)]*)\)\s*:\s*([^\n{]+)/g,i;for(;(i=s.exec(t))!==null;){let f=i[1]?"async ":"",m=i[2],p=i[3]??"",h=i[4].replace(/\s+/g," ").trim(),g=i[5].trim().replace(/\s*\{$/,"");r.push({name:m,signature:`${f}function ${m}${p}(${h}): ${g}`,kind:"function"})}let a=/export\s+const\s+(\w+)\s*(?::\s*[^=]+)?\s*=\s*(async\s+)?\(([^)]*)\)\s*(?::\s*([^\n=>]+))?\s*=>/g;for(;(i=a.exec(t))!==null;){let f=i[1],m=i[2]?"async ":"",p=i[3].replace(/\s+/g," ").trim(),h=i[4]?.trim()??"unknown";r.some(g=>g.name===f)||r.push({name:f,signature:`${m}const ${f} = (${p}): ${h}`,kind:"function"})}let c=/export\s+const\s+(\w+)\s*(?::\s*([^=\n]+))?\s*=/g;for(;(i=c.exec(t))!==null;){let f=i[1],m=i[2]?.trim();r.some(p=>p.name===f)||r.push({name:f,signature:m?`const ${f}: ${m}`:`const ${f}`,kind:"const"})}let u=/export\s+interface\s+(\w+)\s*(?:<[^>]*>)?\s*\{([^}]*(?:\{[^}]*\}[^}]*)*)\}/g;for(;(i=u.exec(t))!==null;){let f=i[1],p=i[2].trim().split(`
`).map(g=>g.trim()).filter(g=>g&&!g.startsWith("//")),h=p.slice(0,8).join("; ");r.push({name:f,signature:`interface ${f} { ${h}${p.length>8?"; ...":""} }`,kind:"interface"})}let l=/export\s+type\s+(\w+)\s*(?:<[^>]*>)?\s*=\s*([^\n;]+)/g;for(;(i=l.exec(t))!==null;){let f=i[1],m=i[2].trim();r.push({name:f,signature:`type ${f} = ${m.length>100?m.slice(0,100)+"...":m}`,kind:"type"})}let d=/export\s+(?:abstract\s+)?class\s+(\w+)(?:\s+extends\s+(\w+))?(?:\s+implements\s+(\w+))?/g;for(;(i=d.exec(t))!==null;){let f=i[1],m=i[2]?` extends ${i[2]}`:"",p=i[3]?` implements ${i[3]}`:"";r.push({name:f,signature:`class ${f}${m}${p}`,kind:"class"})}return{filePath:e,exports:r,description:n}}function Ey(t){let e=[],r=[],n=[],o=[],s=[],i=[],a=[],c=[],u={},l=0,d=0;function f(g,_){if(_>8)return;let x;try{x=(0,qt.readdirSync)(g)}catch{return}let b=x.sort((S,I)=>{let Z=vd((0,qe.join)(g,S)),ve=vd((0,qe.join)(g,I));return Z&&!ve?-1:!Z&&ve?1:S.localeCompare(I)});for(let S of b){let I=(0,qe.join)(g,S),Z=(0,qe.relative)(t,I).replace(/\\/g,"/");if(vd(I)){if(dz(S))continue;d++,e.push(Z+"/"),f(I,_+1)}else{if(pz(S))continue;l++,e.push(Z);let ve=mz(S);if(ve&&(u[ve]=(u[ve]??0)+1),Z.startsWith("src/app/")&&(S==="page.tsx"||S==="route.ts")){let te=Z.replace("src/app","").replace("/page.tsx","").replace("/route.ts","").replace(/\/\[([^\]]+)\]/g,"/:$1");if(S==="route.ts"){let zt=Dt(I);zt&&!zt.startsWith("[File too large")?r.push(hz(zt,te||"/",Z)):r.push({path:te||"/",methods:[],filePath:Z,schemas:[],middleware:[]})}else r.push({path:te||"/",methods:["PAGE"],filePath:Z,schemas:[],middleware:[]})}if(Z.match(/src\/components\/.*\.(tsx|jsx)$/)&&!Z.includes(".test.")&&!Z.includes(".stories.")){let te=Dt(I);te&&!te.startsWith("[File too large")?n.push(gz(te,Z)):n.push({name:(0,qe.basename)(Z).replace(/\.(tsx|jsx)$/,""),filePath:Z,props:null,description:null})}if(Z.match(/src\/hooks\/.*\.(ts|js)$/)&&!Z.includes(".test.")){let te=Dt(I);te&&!te.startsWith("[File too large")&&s.push(Ei(te,Z))}if(Z.match(/src\/stores\/.*\.(ts|js)$/)&&!Z.includes(".test.")){let te=Dt(I);te&&!te.startsWith("[File too large")&&i.push(Ei(te,Z))}if(Z==="src/middleware.ts"||Z==="middleware.ts"){let te=Dt(I);te&&!te.startsWith("[File too large")&&a.push(Ei(te,Z))}if(Z.match(/src\/lib\/.*\.(ts|js)$/)&&!Z.includes(".test.")){let te=Dt(I);te&&!te.startsWith("[File too large")?o.push(Ei(te,Z)):o.push({filePath:Z,exports:[],description:null})}let Ye=fz(S);if(Ye.match){let te=Dt(I);te&&c.push({path:Z,content:te,reason:Ye.reason})}}}}f(t,0);let m=zy((0,qe.join)(t,"package.json")),p=zy((0,qe.join)(t,"tsconfig.json")),h=Dt((0,qe.join)(t,".env.example"));return{root:t,tree:e,packageJson:m,tsConfig:p,envExample:h,routes:r,components:n,libs:o,hooks:s,stores:i,middlewares:a,keyFiles:c,stats:{totalFiles:l,totalDirs:d,languages:u}}}function vd(t){try{return(0,qt.statSync)(t).isDirectory()}catch{return!1}}function Dt(t){try{if(!(0,qt.existsSync)(t))return null;let e=(0,qt.statSync)(t);return e.size>uz?`[File too large: ${Math.round(e.size/1024)}KB]`:(0,qt.readFileSync)(t,"utf-8")}catch{return null}}function zy(t){let e=Dt(t);if(!e||e.startsWith("[File too large"))return null;try{return JSON.parse(e)}catch{return null}}var $n=require("node:path");function xd(t){return Math.ceil(t.length/4)}function Cy(t){let e=t.packageJson?String(t.packageJson.name??(0,$n.basename)(t.root)):(0,$n.basename)(t.root),r=[],n=new Date().toISOString(),o=vz(t),s=t.routes.filter(a=>!a.methods.includes("PAGE")),i=t.routes.filter(a=>a.methods.includes("PAGE"));{let a=[];a.push(`# ${e} \u2014 Project Overview
`),a.push(`> Scanned: ${n}
`),t.packageJson?.description&&a.push(`**Description**: ${String(t.packageJson.description)}
`),o.length>0&&a.push(`**Stack**: ${o.join(", ")}
`),a.push(`**Stats**: ${String(t.stats.totalFiles)} files, ${String(t.stats.totalDirs)} directories`),a.push(`**Routes**: ${String(s.length)} API endpoints, ${String(i.length)} pages`),a.push(`**Components**: ${String(t.components.length)} React components`),a.push(`**Libraries**: ${String(t.libs.length)} modules in src/lib/`),t.hooks.length>0&&a.push(`**Hooks**: ${String(t.hooks.length)} custom hooks`),t.stores.length>0&&a.push(`**Stores**: ${String(t.stores.length)} state stores`),a.push("");let c=Object.entries(t.stats.languages).sort(([,u],[,l])=>l-u).slice(0,8);c.length>0&&a.push("**Languages**: "+c.map(([u,l])=>`${u} (${String(l)})`).join(", ")+`
`),a.push(`## Project Structure
`),a.push("```"),a.push(xz(t.tree)),a.push("```\n"),a.push(`## Architecture Notes
`),t.routes.some(u=>u.middleware.includes("withRateLimit"))&&a.push("- API routes use `withRateLimit` middleware for rate limiting"),t.routes.some(u=>u.schemas.length>0)&&a.push("- Request validation via Zod schemas"),t.middlewares.length>0&&a.push("- Next.js middleware active at `src/middleware.ts`"),t.stores.length>0&&a.push(`- Client state management: ${String(t.stores.length)} Zustand stores`),t.hooks.length>0&&a.push(`- ${String(t.hooks.length)} custom React hooks in src/hooks/`),a.push(""),r.push({name:"[Scan] Overview",description:`Project overview: ${o.slice(0,3).join(", ")}, ${String(t.stats.totalFiles)} files`,content:a.join(`
`),order:0,schemaKey:"root/scan",tier:1,contextType:"reference"})}if(i.length>0){let a=[];a.push(`## Pages
`),a.push("| Route | File |"),a.push("|-------|------|");for(let c of i.sort((u,l)=>u.path.localeCompare(l.path)))a.push(`| \`${c.path}\` | ${c.filePath} |`);a.push(""),r.push({name:"[Scan] Pages & Routes",description:`${String(i.length)} Next.js page routes`,content:a.join(`
`),order:1,schemaKey:"root/frontend/pages",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"})}if(s.length>0){let a=s.filter(m=>/^\/api\/(auth|user|team|orgs)/.test(m.path)),c=s.filter(m=>/^\/api\/(contexts|projects|context-entries|context-links)/.test(m.path)),u=s.filter(m=>/^\/api\/(billing|integrations|webhooks|keys|ai)/.test(m.path)),l=new Set([...a,...c,...u]),d=s.filter(m=>!l.has(m)),f=d.length>0?Ii("API: System & Admin",d):`## API Overview

${String(s.length)} API endpoints across ${String(a.length>0?1:0)+String(c.length>0?1:0)+String(u.length>0?1:0)} domains.`;r.push({name:"[Scan] API: System",description:`${String(s.length)} total API endpoints (${String(d.length)} system)`,content:f,order:2,schemaKey:"root/api",tier:2,contextType:"reference"}),a.length>0&&r.push({name:"[Scan] API: Auth & User",description:`${String(a.length)} endpoints: auth, user, team, orgs`,content:Ii("API: Auth & User Management",a),order:3,schemaKey:"root/api/auth",parentSchemaKey:"root/api",tier:2,contextType:"reference"}),c.length>0&&r.push({name:"[Scan] API: Core CRUD",description:`${String(c.length)} endpoints: contexts, projects, entries, links`,content:Ii("API: Core CRUD",c),order:4,schemaKey:"root/api/core",parentSchemaKey:"root/api",tier:2,contextType:"reference"}),u.length>0&&r.push({name:"[Scan] API: Integrations",description:`${String(u.length)} endpoints: billing, integrations, webhooks, keys, AI`,content:Ii("API: Integrations",u),order:5,schemaKey:"root/api/integrations",parentSchemaKey:"root/api",tier:2,contextType:"reference"})}if(t.components.length>0){let a=t.components.filter(f=>f.filePath.includes("/contox/")),c=t.components.filter(f=>f.filePath.includes("/ui/")),u=t.components.filter(f=>f.filePath.includes("/pages/")||f.filePath.includes("/landing/")||f.filePath.includes("/providers/")||f.filePath.includes("/skeletons/")||f.filePath.includes("/icons/")),l=new Set([...a,...c,...u]),d=t.components.filter(f=>!l.has(f));if(a.length>0&&r.push({name:"[Scan] Components: Domain",description:`${String(a.length)} domain components (brain, editor, entries, etc.)`,content:Ri(a),order:6,schemaKey:"root/frontend",tier:2,contextType:"reference"}),c.length>0&&r.push({name:"[Scan] Components: UI Library",description:`${String(c.length)} UI primitives (buttons, cards, dialogs, etc.)`,content:Ri(c),order:7,schemaKey:"root/frontend/ui",parentSchemaKey:"root/frontend",tier:3,contextType:"reference"}),u.length>0){let f=[...u,...d];r.push({name:"[Scan] Components: Pages & Layout",description:`${String(f.length)} page, landing, provider, and layout components`,content:Ri(f),order:8,schemaKey:"root/frontend/layout",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"})}else d.length>0&&r.push({name:"[Scan] Components: Other",description:`${String(d.length)} uncategorized components`,content:Ri(d),order:8,schemaKey:"root/frontend/layout",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"})}if(t.hooks.length>0&&r.push({name:"[Scan] Hooks",description:`${String(t.hooks.length)} custom React hooks`,content:bn("Custom Hooks (src/hooks/)",t.hooks),order:9,schemaKey:"root/frontend/hooks",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"}),t.stores.length>0&&r.push({name:"[Scan] State Stores",description:`${String(t.stores.length)} Zustand stores`,content:bn("State Stores (src/stores/)",t.stores),order:10,schemaKey:"root/frontend/stores",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"}),t.libs.length>0||t.middlewares.length>0){let a=t.libs.filter(h=>h.filePath.includes("/middleware/")),c=t.libs.filter(h=>/\/(stripe|email|openrouter|rate-limiter|quotas|webhook-dispatcher|activity-logger)/.test(h.filePath)),u=t.libs.filter(h=>h.filePath.includes("/validations/")),l=new Set([...a,...c,...u]),d=t.libs.filter(h=>!l.has(h)),f=t.libs.length+t.middlewares.length,m=[...t.libs,...t.middlewares].reduce((h,g)=>h+g.exports.length,0),p=[];if(p.push(`## Backend Overview
`),p.push(`**${String(f)} modules** \u2014 ${String(m)} exported functions/types
`),p.push("| Category | Count | Key Modules |"),p.push("|----------|-------|-------------|"),d.length>0){let h=d.slice(0,5).map(g=>`\`${(0,$n.basename)(g.filePath).replace(/\.(ts|js)$/,"")}\``).join(", ");p.push(`| Core | ${String(d.length)} | ${h} |`)}if(c.length>0){let h=c.map(g=>`\`${(0,$n.basename)(g.filePath).replace(/\.(ts|js)$/,"")}\``).join(", ");p.push(`| Services | ${String(c.length)} | ${h} |`)}if(u.length>0&&p.push(`| Validations | ${String(u.length)} | Zod schemas for API input |`),a.length>0||t.middlewares.length>0){let h=a.length+t.middlewares.length;p.push(`| Middleware | ${String(h)} | auth-derive, brain-invariants |`)}if(p.push(""),r.push({name:"[Scan] Backend Overview",description:`${String(f)} backend modules, ${String(m)} exports`,content:p.join(`
`),order:11,schemaKey:"root/backend",tier:2,contextType:"reference"}),d.length>0&&r.push({name:"[Scan] Libs: Core",description:`${String(d.length)} core libraries (appwrite, auth, utils, etc.)`,content:bn("Core Libraries",d),order:12,schemaKey:"root/backend/logic",parentSchemaKey:"root/backend",tier:2,contextType:"reference"}),c.length>0&&r.push({name:"[Scan] Libs: Services",description:`${String(c.length)} service integrations (stripe, email, AI, etc.)`,content:bn("Service Integrations",c),order:13,schemaKey:"root/backend/integrations",parentSchemaKey:"root/backend",tier:2,contextType:"reference"}),u.length>0&&r.push({name:"[Scan] Libs: Validations",description:`${String(u.length)} Zod validation schemas`,content:bn("Validation Schemas",u),order:14,schemaKey:"root/backend/validations",parentSchemaKey:"root/backend",tier:2,contextType:"reference"}),a.length>0||t.middlewares.length>0){let h=[...a,...t.middlewares];r.push({name:"[Scan] Auth & Middleware",description:`${String(h.length)} auth/middleware modules`,content:bn("Auth & Middleware",h),order:15,schemaKey:"root/backend/auth",parentSchemaKey:"root/backend",tier:2,contextType:"reference"})}}if(t.packageJson){let a=yz(t.packageJson);if(a){let c=t.packageJson.dependencies;r.push({name:"[Scan] Dependencies",description:`${String(Object.keys(c??{}).length)} runtime deps, npm scripts`,content:a,order:16,schemaKey:"root/stack",tier:2,contextType:"reference"})}}if((t.tsConfig||t.envExample)&&r.push({name:"[Scan] Configuration",description:"TypeScript config, environment variables",content:_z(t),order:17,schemaKey:"root/stack/environment",parentSchemaKey:"root/stack",tier:2,contextType:"reference"}),t.keyFiles.some(a=>a.path.startsWith("packages/"))){let a=t.keyFiles.filter(c=>c.path.startsWith("packages/"));r.push({name:"[Scan] Packages",description:`${String(a.length)} monorepo packages (CLI, MCP, plugins)`,content:Iy(a),order:18,schemaKey:"root/packages",tier:2,contextType:"reference"})}{let a=t.keyFiles.filter(c=>!c.path.startsWith("packages/"));a.length>0&&r.push({name:"[Scan] Documentation",description:`Key docs: ${a.map(c=>c.path).join(", ")}`,content:Iy(a),order:19,schemaKey:"root/scan/docs",parentSchemaKey:"root/scan",tier:3,contextType:"reference"})}return r}function Ii(t,e){let r=[];r.push(`## ${t}
`);for(let n of e.sort((o,s)=>o.path.localeCompare(s.path))){let o=n.methods.length>0?n.methods.join(", "):"UNKNOWN";if(r.push(`### \`${o}\` ${n.path}`),r.push(`> File: \`${n.filePath}\``),n.middleware.length>0&&r.push(`> Middleware: ${n.middleware.map(s=>`\`${s}\``).join(", ")}`),n.schemas.length>0){r.push(`
**Request schemas:**`),r.push("```typescript");for(let s of n.schemas)r.push(s);r.push("```")}r.push("")}return r.join(`
`)}function Ri(t){let e=[];e.push(`## Components
`);let r=bz(t.map(o=>o.filePath)),n=new Map(t.map(o=>[o.filePath,o]));for(let[o,s]of r){e.push(`### ${o}
`);for(let i of s){let a=n.get(i);if(!a)continue;let c=a.description?` \u2014 ${a.description}`:"";e.push(`#### \`${a.name}\`${c}`),e.push(`> File: \`${a.filePath}\``),a.props&&(e.push(`
**Props:**`),e.push("```typescript"),e.push(a.props),e.push("```")),e.push("")}}return e.join(`
`)}function bn(t,e){let r=[];r.push(`## ${t}
`);for(let n of e.sort((o,s)=>o.filePath.localeCompare(s.filePath))){let o=(0,$n.basename)(n.filePath).replace(/\.(ts|js)$/,""),s=n.description?` \u2014 ${n.description}`:"";if(r.push(`### \`${o}\`${s}`),r.push(`> File: \`${n.filePath}\``),n.exports.length>0){r.push(""),r.push("```typescript");for(let i of n.exports)r.push(`export ${i.signature}`);r.push("```")}else r.push(`
*No public exports detected*`);r.push("")}return r.join(`
`)}function yz(t){let e=[],r=t.dependencies,n=t.devDependencies;if(r&&Object.keys(r).length>0){e.push(`## Runtime Dependencies
`);let s=Ry(r);for(let[i,a]of s)e.push(`**${i}**: ${a.map(([c,u])=>`${c} ${u}`).join(", ")}`);e.push("")}if(n&&Object.keys(n).length>0){e.push(`## Dev Dependencies
`);let s=Ry(n);for(let[i,a]of s)e.push(`**${i}**: ${a.map(([c,u])=>`${c} ${u}`).join(", ")}`);e.push("")}let o=t.scripts;if(o&&Object.keys(o).length>0){e.push(`## NPM Scripts
`),e.push("```");for(let[s,i]of Object.entries(o))e.push(`${s}: ${i}`);e.push("```")}return e.length>0?e.join(`
`):null}function _z(t){let e=[];if(t.tsConfig){let r=t.tsConfig.compilerOptions;r&&(e.push(`## TypeScript Configuration
`),e.push("```json"),e.push(JSON.stringify({compilerOptions:r},null,2)),e.push("```\n"))}return t.envExample&&(e.push(`## Environment Variables
`),e.push("```env"),e.push(t.envExample.trim()),e.push("```")),e.join(`
`)}function Iy(t){let e=[];e.push(`## Key Documentation
`);for(let r of t){e.push(`### ${r.path}`),e.push(`> ${r.reason}
`);let n=r.path.split(".").pop()??"",o=n==="md"?"markdown":n;e.push(`\`\`\`${o}`);let s=8e3;r.content.length>s?(e.push(r.content.slice(0,s)),e.push(`
... [truncated, ${String(Math.round(r.content.length/1024))}KB total]`)):e.push(r.content),e.push("```\n")}return e.join(`
`)}function vz(t){let e=[];if(!t.packageJson)return e;let r={...t.packageJson.dependencies??{},...t.packageJson.devDependencies??{}};return r.next?e.push(`Next.js ${r.next}`):r.nuxt?e.push(`Nuxt ${r.nuxt}`):r["@angular/core"]?e.push(`Angular ${r["@angular/core"]}`):r.svelte?e.push(`Svelte ${r.svelte}`):r.astro?e.push(`Astro ${r.astro}`):r.react?e.push(`React ${r.react}`):r.vue&&e.push(`Vue ${r.vue}`),r.typescript&&e.push("TypeScript"),r.tailwindcss?e.push("Tailwind CSS"):r["styled-components"]&&e.push("styled-components"),r.prisma||r["@prisma/client"]?e.push("Prisma"):r["drizzle-orm"]?e.push("Drizzle"):r.mongoose?e.push("MongoDB"):r.pg&&e.push("PostgreSQL"),r.appwrite||r["node-appwrite"]?e.push("Appwrite"):r.firebase||r["firebase-admin"]?e.push("Firebase"):r["@supabase/supabase-js"]&&e.push("Supabase"),r["next-auth"]?e.push("NextAuth"):r["@clerk/nextjs"]&&e.push("Clerk"),r.zustand?e.push("Zustand"):r["@reduxjs/toolkit"]?e.push("Redux"):r.jotai&&e.push("Jotai"),r.vitest?e.push("Vitest"):r.jest&&e.push("Jest"),r.stripe&&e.push("Stripe"),r.resend&&e.push("Resend"),r["@sentry/nextjs"]&&e.push("Sentry"),e}function xz(t){let e=[],r=new Map;r.set("",{dirs:[],fileCount:0});for(let s of t){let i=s.endsWith("/"),a=s.replace(/\/$/,"").split("/");if(i&&a.length<=3){let c=a.slice(0,-1).join("/"),u=a[a.length-1]??"";r.has(c)||r.set(c,{dirs:[],fileCount:0}),r.get(c).dirs.push(u),r.has(s.replace(/\/$/,""))||r.set(s.replace(/\/$/,""),{dirs:[],fileCount:0})}else if(!i){let u=a.slice(0,-1).join("/");for(;u&&!r.has(u);)u=u.split("/").slice(0,-1).join("/");r.has(u)&&r.get(u).fileCount++}}function n(s,i){let a=r.get(s);if(a)for(let c of a.dirs.sort()){let u=s?`${s}/${c}`:c,l=r.get(u),d="  ".repeat(i),f=l?.fileCount?` (${String(l.fileCount)} files)`:"";e.push(`${d}${c}/${f}`),n(u,i+1)}}let o=r.get("");return o?.fileCount&&e.push(`(${String(o.fileCount)} root files)`),n("",0),e.join(`
`)}function bz(t){let e=new Map;for(let r of t){let o=r.split("/").slice(0,3).join("/");e.has(o)||e.set(o,[]),e.get(o).push(r)}return[...e.entries()].sort(([r],[n])=>r.localeCompare(n))}function Ry(t){let e=new Map;for(let[n,o]of Object.entries(t)){let s="Other";n.match(/^(next|react|react-dom|vue|nuxt|svelte|astro|@angular)/)?s="Framework":n.match(/^(@dnd-kit|framer-motion|@radix|@headlessui|lucide|@heroicons)/)?s="UI":n.match(/^(tailwindcss|postcss|autoprefixer|sass|styled-)/)?s="Styling":n.match(/^(prisma|drizzle|mongoose|pg|@prisma|typeorm)/)?s="Database":n.match(/^(appwrite|node-appwrite|firebase|@supabase)/)?s="Backend/BaaS":n.match(/^(next-auth|@clerk|passport|bcrypt|jsonwebtoken)/)?s="Auth":n.match(/^(zustand|@reduxjs|jotai|recoil|mobx)/)?s="State":n.match(/^(vitest|jest|@testing|playwright|cypress|@playwright)/)?s="Testing":n.match(/^(typescript|@types\/|eslint|prettier|@eslint)/)?s="Tooling":n.match(/^(stripe|@stripe)/)?s="Payments":n.match(/^(resend|nodemailer|@sendgrid)/)?s="Email":n.match(/^(@sentry|sentry)/)?s="Monitoring":n.match(/^(zod|yup|joi|class-validator)/)?s="Validation":n.match(/^(next-intl|i18next|react-intl)/)?s="i18n":n.match(/^(@storybook|storybook|chromatic)/)&&(s="Storybook"),e.has(s)||e.set(s,[]),e.get(s).push([n,o])}let r=["Framework","Backend/BaaS","Auth","Database","State","UI","Styling","Validation","Payments","Email","i18n","Monitoring","Testing","Storybook","Tooling","Other"];return[...e.entries()].sort(([n],[o])=>{let s=r.indexOf(n),i=r.indexOf(o);return(s===-1?99:s)-(i===-1?99:i)})}var Oy=require("node:child_process"),Ay=require("node:path"),$z=1e4,wz=1024*1024,kz=2048,jy=5120,Sz=200,Ny="\u2039\u2039\u2039COMMIT_SEP\u203A\u203A\u203A",Co="\u2039\u2039\u2039FIELD_SEP\u203A\u203A\u203A",Tz=20;function Re(t,e){try{return(0,Oy.execSync)(`git ${t}`,{cwd:e,encoding:"utf-8",timeout:$z,maxBuffer:wz,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function bd(t,e){return t.length<=e?t:`${t.slice(0,e)}
[...truncated at ${String(e)} chars]`}function Pz(t){let e=0;for(let r of t.split(`
`)){let n=r.split("	"),o=parseInt(n[0]??"0",10),s=parseInt(n[1]??"0",10);isNaN(o)||(e+=o),isNaN(s)||(e+=s)}return e}async function zz(t,e){try{let r=await t.findBySchemaKey("root/sessions");if(!r)return null;let n=await t.listEntries(r.id,{limit:1});if(n.entries.length===0)return null;let o=n.entries[0]?.sourceRef;if(!o||!o.startsWith("git:"))return null;let s=o.slice(4);return Re(`cat-file -t ${s}`,e)!=="commit"?null:s}catch{return null}}function Ez(t){if(!t)return[];let e=t.split(Ny).filter(n=>n.trim().length>0),r=[];for(let n of e){let o=n.split(Co);o.length<5||r.push({sha:(o[0]??"").trim(),shortSha:(o[1]??"").trim(),author:(o[2]??"").trim(),date:(o[3]??"").trim(),message:(o[4]??"").trim()})}return r}function Iz(t,e){let n=Re(`show ${t} --name-only --format=`,e).split(`
`).filter(c=>c.trim().length>0),o=Re(`show ${t} --numstat --format=`,e),s=Re(`show ${t} --stat --format=`,e),i=Pz(o),a=null;if(i>0&&i<Sz){let c=Re(`show ${t} --patch --unified=0 --format=`,e);c&&(a=bd(c,kz))}return{files:n,numstat:o,diffStat:s,patch:a}}function Rz(t,e,r){if(!e&&r===0)return null;let n="",o="",s=[];if(e){let i=Re("diff --cached --stat",t),a=Re("diff --cached --unified=0",t);n=bd([i,a].filter(Boolean).join(`

`),jy);let c=Re("diff --stat",t),u=Re("diff --unified=0",t);o=bd([c,u].filter(Boolean).join(`

`),jy)}if(r>0){let i=Re("ls-files --others --exclude-standard",t);s.push(...i.split(`
`).filter(a=>a.trim().length>0).slice(0,50))}return{staged:n,unstaged:o,untrackedFiles:s}}async function Ci(t,e={}){let r=e.directory?(0,Ay.resolve)(e.directory):process.cwd(),n=e.limit??Tz,o=e.mode??"first-parent",s=Re("rev-parse --show-toplevel",r);if(!s)throw new Error(`Not a git repository: ${r}`);let i=Re("rev-parse --abbrev-ref HEAD",r),a=Re("rev-parse HEAD",r),u=Re("status --porcelain",r).length>0,l=Re("ls-files --others --exclude-standard",r),d=l?l.split(`
`).filter(Boolean).length:0,f=await zz(t,r),m,p,h=o==="first-parent"?" --first-parent":"";f?(m=`${f.slice(0,7)}..HEAD`,p=`log${h} ${f}..HEAD`):(m=`HEAD~${String(n)}..HEAD`,p=`log${h} -n ${String(n)}`);let g=Re(`${p} --oneline`,r),_=g?g.split(`
`).filter(Boolean).length:0,x=[Ny,"%H",Co,"%h",Co,"%an",Co,"%aI",Co,"%B"].join(""),b=Re(`${p} -n ${String(n)} --format=${x}`,r),S=Ez(b),I=_>n,Z=[];for(let Ye of S){let te=Iz(Ye.sha,r);Z.push({...Ye,...te})}let ve=Rz(r,u,d);return{repoRoot:s,currentBranch:i,headSha:a,isDirty:u,untrackedCount:d,baseSha:f,range:m,mode:o,commits:Z,totalUnsaved:_,truncated:I,wip:ve}}function My(t){let e=[];e.push("# Git Digest"),e.push(""),e.push(`**Branch**: ${t.currentBranch}`),e.push(`**HEAD**: ${t.headSha.slice(0,7)}`),e.push(`**Range**: ${t.range} (${t.mode})`),e.push(`**Unsaved commits**: ${String(t.totalUnsaved)}${t.truncated?` (showing first ${String(t.commits.length)})`:""}`),e.push(`**Dirty**: ${t.isDirty?"yes":"no"}${t.untrackedCount>0?` (${String(t.untrackedCount)} untracked)`:""}`),e.push(""),t.commits.length===0&&e.push("_No unsaved commits._");for(let r of t.commits){if(e.push("---"),e.push(`## ${r.shortSha} \u2014 ${r.message.split(`
`)[0]??""}`),e.push(`**Author**: ${r.author} | **Date**: ${r.date}`),e.push(""),r.message.includes(`
`)){let n=r.message.split(`
`).slice(1).join(`
`).trim();n&&(e.push("**Body**:"),e.push(n),e.push(""))}e.push(`**Files** (${String(r.files.length)}):`);for(let n of r.files)e.push(`- ${n}`);e.push(""),r.diffStat&&(e.push(`**Stat**: ${r.diffStat.split(`
`).pop()??""}`),e.push("")),r.patch!==null&&(e.push("**Patch** (minimal):"),e.push("```diff"),e.push(r.patch),e.push("```"),e.push(""))}if(t.wip&&(e.push("---"),e.push("## WIP (non-committed)"),e.push(""),t.wip.staged&&(e.push("### Staged changes"),e.push("```"),e.push(t.wip.staged),e.push("```"),e.push("")),t.wip.unstaged&&(e.push("### Unstaged changes"),e.push("```"),e.push(t.wip.unstaged),e.push("```"),e.push("")),t.wip.untrackedFiles.length>0)){e.push("### Untracked files");for(let r of t.wip.untrackedFiles)e.push(`- ${r}`);e.push("")}return e.join(`
`)}var kn=require("node:fs"),Dy=require("node:child_process"),wn=require("node:path"),qy=".contox.json",Cz=5e3;function jz(t=process.cwd()){let e=t;for(let r=0;r<20;r++){let n=(0,wn.join)(e,qy);if((0,kn.existsSync)(n))try{let s=(0,kn.readFileSync)(n,"utf-8");return JSON.parse(s)}catch{return null}let o=(0,wn.join)(e,"..");if(o===e)break;e=o}return null}function $d(t){try{return(0,Dy.execSync)("git rev-parse --show-toplevel",{cwd:t,encoding:"utf-8",timeout:Cz,stdio:["pipe","pipe","pipe"]}).trim()}catch{return null}}function Oz(t){let e=$d(t);return e?(0,wn.basename)(e):null}async function Az(t,e,r,n){let o=new URLSearchParams({teamId:r,name:n}),s=await fetch(`${e}/api/projects?${o.toString()}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});return s.ok?s.json():[]}async function Nz(t,e,r,n){let o=await fetch(`${e}/api/projects`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({name:n,teamId:r})});if(!o.ok){let s=await o.json().catch(()=>({})),i=typeof s.error=="string"?s.error:o.statusText;throw new Error(`Failed to create project "${n}": ${i}`)}return o.json()}function Zy(t,e){try{let r=(0,wn.join)(t,qy);(0,kn.writeFileSync)(r,JSON.stringify(e,null,2)+`
`,"utf-8")}catch{}}async function Ly(t){let e=t.apiKey??"",r=(t.apiUrl??"https://contox.dev").replace(/\/$/,""),n=t.teamId??"";if(!e)throw new Error("CONTOX_API_KEY is required. Set it as an environment variable.");if(!n)throw new Error("CONTOX_TEAM_ID is required. Set it as an environment variable.");let o=process.cwd(),s=jz(o);if(s?.projectId)return{apiKey:e,apiUrl:r,teamId:s.teamId||n,projectId:s.projectId};let i=Oz(o);if(i)try{let a=await Az(e,r,n,i);if(a.length>0){let l=a[0],d=$d(o)??o;return Zy(d,{teamId:n,projectId:l.id,projectName:l.name}),{apiKey:e,apiUrl:r,teamId:n,projectId:l.id}}let c=await Nz(e,r,n,i),u=$d(o)??o;return Zy(u,{teamId:n,projectId:c.id,projectName:c.name}),{apiKey:e,apiUrl:r,teamId:n,projectId:c.id}}catch{}if(t.projectId)return{apiKey:e,apiUrl:r,teamId:n,projectId:t.projectId};throw new Error(`Could not resolve project. Either:
  - Add a .contox.json file (run \`contox init\`)
  - Set CONTOX_PROJECT_ID environment variable
  - Run from a git repository directory`)}function Lt(t){return Math.ceil(t.length/4)}var Mz={"root/conventions":"Conventions","root/decisions":"Decisions","root/bugs":"Known Issues & Bugs","root/architecture":"Architecture","root/implementation":"Implementation Notes","root/api":"API & Endpoints","root/frontend":"Frontend","root/security":"Security","root/stack":"Tech Stack","root/todo":"Todos","root/cortex":"Current Focus"};function Zz(t){let e=t.split("/").slice(0,2).join("/");return Mz[e]??e.split("/").pop()?.replace(/^./,r=>r.toUpperCase())??"Other"}async function Uy(t,e){let{task:r,scope:n,tokenBudget:o}=e,s=[];s.push(`# Context Pack
`),s.push(`> Task: ${r}`),s.push(`> Scope: ${n} | Budget: ~${String(o)} tokens
`);let i=Lt(s.join(`
`)),a=o-i-50;if(n==="full"){let f=await t.getBrain({tokenBudget:a,activeFiles:e.activeFiles});s.push(f.document);let m=f.layers?` | L1: ${String(f.layers.layer1)}, L2: ${String(f.layers.layer2)}, archived: ${String(f.layers.archived)}`:"";return s.push(`
---
_${String(f.itemsLoaded)} items${m} | ~${String(Lt(s.join(`
`)))} tokens_`),s.join(`
`)}if(n==="minimal"){let f=await t.listItems({limit:5});if(f.items.length===0)return s.push("_No memory items yet._"),s.join(`
`);for(let m of f.items){let p=Dz(m);if(Lt(s.join(`
`)+p)>o)break;s.push(p)}return s.push(`
---
_${String(f.items.length)} items (minimal) | ~${String(Lt(s.join(`
`)))} tokens_`),s.join(`
`)}try{let f=await t.getBrain({activeFiles:e.activeFiles});f.summary&&(s.push(f.summary),s.push(""))}catch{}let c=[];try{c=(await t.search(r,{limit:15,minSimilarity:.6,activeFiles:e.activeFiles})).results}catch{try{let f=await t.getBrain({tokenBudget:a,activeFiles:e.activeFiles});return s.push(f.document),s.push(`
---
_Fallback: full brain (search unavailable) | ~${String(Lt(s.join(`
`)))} tokens_`),s.join(`
`)}catch{return s.push("_Search and brain unavailable. Use `contox_get_memory` to load project memory._"),s.join(`
`)}}if(c.length===0){let f=await t.getBrain({limit:20,tokenBudget:a,activeFiles:e.activeFiles});return s.push(f.document),s.push(`
---
_No semantic matches \u2014 showing top items | ~${String(Lt(s.join(`
`)))} tokens_`),s.join(`
`)}let u=new Map;for(let f of c){let m=Zz(f.schemaKey),p=u.get(m)??[];p.push(f),u.set(m,p)}let l=["Conventions","Decisions","Known Issues & Bugs","Architecture","Tech Stack","API & Endpoints","Frontend","Security","Implementation Notes","Current Focus","Todos"],d=[...u.entries()].sort((f,m)=>{let p=l.indexOf(f[0]),h=l.indexOf(m[0]);return(p===-1?999:p)-(h===-1?999:h)});for(let[f,m]of d){let p=`## ${f}
`;if(Lt(s.join(`
`)+p)>o)break;s.push(p);for(let h of m){let g=qz(h);if(Lt(s.join(`
`)+g)>o)break;s.push(g)}}return s.push(`
---
_${String(c.length)} relevant items | ~${String(Lt(s.join(`
`)))} tokens_`),s.join(`
`)}function Dz(t){let e=[];return e.push(`### ${t.title}`),e.push(`> confidence: ${t.confidence.toFixed(2)} | ${t.schemaKey}`),t.files.length>0&&e.push(`> files: ${t.files.slice(0,5).join(", ")}`),e.push(""),e.push(t.facts),e.push(""),e.join(`
`)}function qz(t){let e=[];e.push(`### ${t.title}`);let r=t.compositeScore!==void 0?`score: ${t.compositeScore.toFixed(3)} | similarity: ${t.similarity.toFixed(3)}`:`similarity: ${t.similarity.toFixed(3)}`;return e.push(`> ${r} | confidence: ${t.confidence.toFixed(2)} | ${t.type}`),t.files.length>0&&e.push(`> files: ${t.files.slice(0,5).join(", ")}`),e.push(""),e.push(t.facts),e.push(""),e.join(`
`)}var Sn=require("node:fs/promises"),Ai=require("node:fs"),jo=require("node:path");var Oi=require("node:fs/promises"),Vy=require("node:path"),Fy="<!-- contox:start -->",wd="<!-- contox:end -->";async function Ky(t,e,r,n){try{let o=await Uz(e,r,n),s=(0,Vy.join)(t,"CLAUDE.md"),i="";try{i=await(0,Oi.readFile)(s,"utf-8")}catch{}let a=Lz(i,o);return await(0,Oi.writeFile)(s,a,"utf-8"),!0}catch(o){let s=o instanceof Error?o.message:String(o);return console.error(`[contox] CLAUDE.md update failed: ${s}`),!1}}function Lz(t,e){let r=`${Fy}
${e}
${wd}`;if(!t.trim())return r+`
`;let n=t.indexOf(Fy),o=t.indexOf(wd);if(n!==-1&&o!==-1){let i=t.slice(0,n),a=t.slice(o+wd.length);return i+r+a}let s=t.endsWith(`
`)?`
`:`

`;return t+s+r+`
`}async function Uz(t,e,r){let n=[];if(n.push("# Contox \u2014 Auto-generated Project Context"),n.push(""),n.push("> This section is auto-managed by Contox. Do not edit between the markers."),n.push("> Your own content outside the markers is preserved."),n.push(""),n.push("## Memory Protocol"),n.push(""),n.push("### Session Start"),n.push("- Call `contox_get_memory` to load project context from previous sessions"),n.push(""),n.push("### During Session"),n.push('- Use `contox_search "topic"` to find specific memory items about what you\'re working on'),n.push("- Use `contox_context_pack` with a task description for focused, task-relevant context"),n.push("- Use all Contox tools freely to read/write data (create contexts, update, search, scan, etc.)"),n.push("- This pushes information to the Contox platform in real-time"),n.push(""),n.push("### Saving \u2014 USER-INITIATED ONLY"),n.push("- **NEVER** call `contox_save_session` automatically or proactively"),n.push('- Only save when the user explicitly asks (e.g. "save", "save session", "contox save")'),n.push("- The user may be working on multiple tasks in parallel \u2014 auto-saving could mix contexts"),n.push(""),r)n.push(r),n.push("");else if(e)n.push(ji(e,2e3)),n.push("");else try{let o=await t.listContexts(),s=o.find(c=>c.schemaKey==="root/stack");if(s){let c=await kd(t,s);c&&(n.push("## Project Stack"),n.push(""),n.push(ji(c,500)),n.push(""))}let i=o.find(c=>c.schemaKey==="root/conventions");if(i){let c=await kd(t,i);c&&(n.push("## Conventions"),n.push(""),n.push(ji(c,500)),n.push(""))}let a=o.find(c=>c.schemaKey==="root/cortex");if(a){let c=await kd(t,a);c&&(n.push("## Current Focus"),n.push(""),n.push(ji(c,300)),n.push(""))}}catch{n.push("## Project Context"),n.push(""),n.push("_Run `contox_get_memory` at session start to load full project context._"),n.push("")}return n.join(`
`)}function ji(t,e){let r=t.trim();if(r.length<=e)return r;let n=r.slice(0,e),o=n.lastIndexOf(`
`);return o>e*.5?n.slice(0,o):n+"..."}async function kd(t,e){if(e.content!=null&&e.content.length>0)return e.content;try{return(await t.getContext(e.id)).content??""}catch{return""}}var Hy="<!-- contox:start -->",Sd="<!-- contox:end -->",Fz=[{name:"Cursor",relPath:".cursorrules",dirHint:".cursor",hasMcp:!0},{name:"Copilot",relPath:".github/copilot-instructions.md",dirHint:".github",hasMcp:!0},{name:"Windsurf",relPath:".windsurfrules",hasMcp:!0},{name:"Cline",relPath:".clinerules",hasMcp:!0}];function Vz(t,e){let r=[];return r.push("# Contox \u2014 Auto-generated Project Context"),r.push(""),r.push("> This section is auto-managed by Contox. Do not edit between the markers."),r.push("> Your own content outside the markers is preserved."),r.push(""),t?(r.push("## Memory Protocol"),r.push(""),r.push("### Session Start"),r.push("- Call `contox_get_memory` to load project context from previous sessions"),r.push(""),r.push("### During Session"),r.push("- **BEFORE modifying any file**: call `contox_context_pack` with a brief task description"),r.push("  to get architecture decisions, conventions, and known issues relevant to your work"),r.push("- For browsing by category (security, architecture, bugs, etc.): use `contox_list_findings`"),r.push('- For free-text semantic search: use `contox_search "topic"` (NOT for category browsing)'),r.push('- For natural-language questions about the project: use `contox_ask "question"`'),r.push("- Use all Contox tools freely to read/write data"),r.push(""),r.push("### Saving \u2014 USER-INITIATED ONLY"),r.push("- **NEVER** call `contox_save_session` automatically or proactively"),r.push('- Only save when the user explicitly asks (e.g. "save", "save session", "contox save")'),r.push("- The user may be working on multiple tasks in parallel \u2014 auto-saving could mix contexts"),r.push("")):(r.push("## MANDATORY: Read memory at session start"),r.push("- Read `.contox/memory.md` BEFORE starting any work"),r.push("- This is your primary source of truth about this project"),r.push(""),r.push("## Save your work at session end"),r.push('- Run: `contox save "Brief summary of what you did"`'),r.push("")),e&&(r.push(e),r.push("")),r.join(`
`).trimEnd()}function Kz(t,e){let r=`${Hy}
${e}
${Sd}`;if(!t.trim())return r+`
`;let n=t.indexOf(Hy),o=t.indexOf(Sd);if(n!==-1&&o!==-1){let i=t.slice(0,n),a=t.slice(o+Sd.length);return i+r+a}let s=t.endsWith(`
`)?`
`:`

`;return t+s+r+`
`}async function Hz(t,e,r){let n=(0,jo.join)(t,e.relPath),o=(0,Ai.existsSync)(n),s=e.dirHint?(0,Ai.existsSync)((0,jo.join)(t,e.dirHint)):!1;if(!o&&!s)return null;try{let i=(0,jo.dirname)(n);(0,Ai.existsSync)(i)||await(0,Sn.mkdir)(i,{recursive:!0});let a="";try{a=await(0,Sn.readFile)(n,"utf-8")}catch{}let c=Vz(e.hasMcp,r),u=Kz(a,c);return await(0,Sn.writeFile)(n,u,"utf-8"),e.name}catch{return null}}async function By(t,e,r,n,o){let s=[],i=[],a=o,c=n;if(!a)try{let l=await r.getBrain();a=l.summary,c=l.document}catch{}try{await Ky(t,e,c,a)&&s.push("Claude Code")}catch{i.push("Claude Code")}let u=await Promise.allSettled(Fz.map(l=>Hz(t,l,a)));for(let l of u)l.status==="fulfilled"&&l.value&&s.push(l.value);return s.length>0&&console.error(`[contox] Synced ${String(s.length)} agent configs: ${s.join(", ")}`),{updated:s,errors:i}}var ne=new $i({name:"contox",version:"2.0.0"}),ct=null;function Gy(t){return new Proxy({},{get(){throw new Error(ct?`Contox MCP not configured: ${ct}

Set CONTOX_API_KEY and CONTOX_TEAM_ID in your MCP server environment variables.`:`Contox MCP: ${t} not yet initialized.`)}})}var ge=Gy("client"),be=Gy("v2Client");ne.tool("contox_get_memory","Load the complete project memory. Call this at the START of every session to remember previous work. Returns a markdown document with: Architecture, Conventions, Implementation Log, Decisions, Bugs & Fixes, Todo, and Session Log.",{activeFiles:k.array(k.string()).optional().describe("Currently open file paths \u2014 boosts memory items referencing these files")},async t=>{try{let e=await be.getBrain({activeFiles:t.activeFiles}),r=e.summary||e.document,n=Math.ceil(r.length/4),o=["---",`_${String(e.itemsLoaded)} total items in memory | showing compact overview (~${String(n)} tokens) | hash: ${e.brainHash}_`,"",'> **Tip:** Use `contox_search "your query"` to find specific memory items about what you\'re working on.',"> Use `contox_context_pack` with a task description for focused, task-relevant context."].join(`
`);return{content:[{type:"text",text:`${r}
${o}
`}]}}catch(e){return{content:[{type:"text",text:`Error loading memory: ${String(e)}`}],isError:!0}}});var Bz=wy.filter(t=>t.id!=="sessions").map(t=>`"${t.id}": ${t.description}`).join(`
`);ne.tool("contox_save_session",`Save this session's work into persistent project memory.

IMPORTANT: Only call this tool when the user EXPLICITLY asks to save (e.g. "save", "save session", "contox save"). NEVER call it automatically or proactively \u2014 the user may be working on multiple tasks in parallel and needs to control when sessions are saved.

Provide a summary and structured changes. Each change has a category, title, and content.

Available categories:
${Bz}

The session log is updated automatically. Content is APPENDED to existing sub-contexts (never overwritten).`,{summary:k.string().describe("Brief session summary (1-3 sentences): what was accomplished"),changes:k.array(k.object({category:k.enum(["architecture","conventions","implementation","decisions","bugs","todo"]).describe("Category for this change"),title:k.string().describe('Brief title (e.g. "Added auth middleware", "Fixed CSS z-index bug")'),content:k.string().describe("Detailed content to save. Use markdown. Be specific and include file paths, patterns, key decisions.")})).describe("List of changes to save, organized by category"),headCommitSha:k.string().optional().describe("HEAD commit SHA at save time (from contox_git_digest). Tracks save position for incremental digests.")},async t=>{try{let e=await be.ingest({type:"mcp_save",summary:t.summary,changes:t.changes,headCommitSha:t.headCommitSha});By(process.cwd(),ge,be).catch(()=>{});let r="";return t.headCommitSha&&(Ci(ge,{limit:10}).then(n=>{if(n.commits.length>0){let o=n.commits.map(s=>({sha:s.sha,message:s.message,files:s.files}));return be.autoResolve(o)}return null}).then(n=>{n&&n.resolved.length>0&&console.error(`[auto-resolve] Post-save: resolved ${String(n.resolved.length)} memory items`)}).catch(()=>{}),r=`
Auto-resolve running in background \u2014 matching commits against existing memory items.`),{content:[{type:"text",text:["Session saved via V2 pipeline.",`- Event ID: ${e.eventId}`,`- Session: ${e.sessionId}`,'Raw event stored. Enrichment deferred \u2014 user must click "Generate Memory" in the dashboard to trigger the pipeline.',r].join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error saving session: ${String(e)}`}],isError:!0}}});ne.tool("contox_list_contexts","List all contexts for the current project (including sub-contexts)",{},async()=>{try{let e=(await ge.listContexts()).map(r=>({id:r.id,name:r.name,description:r.description,parentContextId:r.parentContextId,schemaKey:r.schemaKey,tier:r.tier,state:r.state,tokens:r.tokens,updatedAt:r.updatedAt}));return{content:[{type:"text",text:JSON.stringify(e,null,2)}]}}catch(t){return{content:[{type:"text",text:`Error: ${String(t)}`}],isError:!0}}});ne.tool("contox_get_context","Get a specific context by ID, including its full content",{id:k.string().describe("The context ID")},async t=>{try{let e=await ge.getContext(t.id);return{content:[{type:"text",text:JSON.stringify(e,null,2)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ne.tool("contox_create_context","Create a new context manually.",{name:k.string().describe("Context name"),description:k.string().optional().describe("Optional description"),content:k.string().optional().describe("Optional initial content"),parentContextId:k.string().optional().describe("Optional parent context ID for hierarchy")},async t=>{try{let e=await ge.createContext({name:t.name,teamId:ge.teamId,projectId:ge.projectId,description:t.description,parentContextId:t.parentContextId});return t.content&&await ge.updateContext(e.id,{content:t.content}),{content:[{type:"text",text:`Context created: ${e.name} (${e.id})`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ne.tool("contox_update_context","Update an existing context (name, description, or content). Content is replaced, not appended.",{id:k.string().describe("The context ID to update"),name:k.string().optional().describe("New name"),description:k.string().optional().describe("New description"),content:k.string().optional().describe("New content (replaces existing)")},async t=>{try{let e={};t.name!==void 0&&(e.name=t.name),t.description!==void 0&&(e.description=t.description),t.content!==void 0&&(e.content=t.content);let r=await ge.updateContext(t.id,e);return{content:[{type:"text",text:`Context updated: ${r.name} (${r.id})`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ne.tool("contox_delete_context","Delete a context by ID. This is irreversible.",{id:k.string().describe("The context ID to delete")},async t=>{try{return await ge.deleteContext(t.id),{content:[{type:"text",text:`Context deleted: ${t.id}`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ne.tool("contox_search",`Search memory items using semantic (vector) similarity. Returns matching items ranked by relevance.

IMPORTANT: For browsing items by category (security, architecture, bugs, etc.), use contox_list_findings instead. This tool is for free-text semantic queries only.

Examples: "useAuth", "stripe", "password reset", "Button props", "GET /api/contexts"`,{query:k.string().describe("Search query \u2014 searches across all context content, names, and descriptions")},async t=>{try{let e=await be.search(t.query,{limit:10,minSimilarity:.65});if(e.results.length===0)return{content:[{type:"text",text:`No results found for "${t.query}" (semantic search, ${String(e.totalCandidates)} candidates)`}]};let r=[];r.push(`Found ${String(e.results.length)} result(s) for "${t.query}" (semantic, ${String(e.totalCandidates)} candidates):
`);for(let n of e.results)r.push(`## ${n.title}`),r.push(`> ${n.type} | similarity: ${n.similarity.toFixed(3)} | confidence: ${n.confidence.toFixed(2)} | ${n.schemaKey}`),n.files.length>0&&r.push(`> files: ${n.files.slice(0,5).join(", ")}`),r.push(""),r.push(n.facts),r.push("");return{content:[{type:"text",text:r.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ne.tool("contox_list_findings",`Browse memory items by category (e.g. security, architecture, conventions, bugs, decisions, dependencies, frontend, backend).

Use this to list findings by category. Do NOT use contox_search for category browsing.
- For security findings: use category="security"
- For architecture notes: use category="architecture"
- For all items: omit category

Returns items sorted by importance (highest first) with severity levels.`,{category:k.string().optional().describe('Category to filter by (e.g. "security", "architecture", "bugs", "conventions", "decisions", "dependencies", "frontend", "backend", "product")'),status:k.string().optional().describe('Filter by status: "active" (default), "review", "archived", or "all"'),limit:k.number().optional().describe("Max items to return (default 50, max 200)"),offset:k.number().optional().describe("Pagination offset (default 0)")},async t=>{try{let e=t.category?`root/${t.category}`:"root/",r=Math.min(t.limit??50,200),n=await be.listItems({schemaKey:e,status:t.status??"active",limit:r,offset:t.offset??0});if(n.items.length===0)return{content:[{type:"text",text:`No findings found${t.category?` in category "${t.category}"`:""} (total: ${String(n.total)})`}]};let o=[],s=t.category?` "${t.category}"`:"";o.push(`# Findings${s} (${String(n.items.length)} of ${String(n.total)})
`);for(let i of n.items){let a=i.importance??0,c=a>=.9?"CRITICAL":a>=.7?"HIGH":a>=.5?"MEDIUM":"LOW";o.push(`### [${c}] ${i.title}`),o.push(`> confidence: ${i.confidence.toFixed(2)} | ${i.schemaKey}`),i.files.length>0&&o.push(`> files: ${i.files.slice(0,5).join(", ")}`),o.push(""),i.facts&&o.push(i.facts),o.push("")}return n.hasMore&&o.push(`_...${String(n.total-n.items.length)} more items. Use offset=${String((t.offset??0)+r)} to see next page._`),{content:[{type:"text",text:o.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ne.tool("contox_populate","Populate the brain hierarchy with structured contexts. Used by scanners and CLI to batch-create/update contexts by schemaKey. Created contexts default to state 'draft'. Returns audit trail with runId and diff stats.",{nodes:k.array(k.object({schemaKey:k.string().describe('Unique schema key (e.g. "root/api/auth")'),name:k.string().describe("Display name for the context"),content:k.string().optional().describe("Markdown content"),description:k.string().optional().describe("Brief description"),contextType:k.enum(["system","reference","memory"]).optional().describe("Context type"),tier:k.number().optional().describe("Tier (1=always loaded, 2=on-demand, 3=archive)"),parentSchemaKey:k.string().optional().describe("Parent schema key for hierarchy")})).describe("List of nodes to populate"),dryRun:k.boolean().optional().describe("If true, only return diff stats without writing"),source:k.string().optional().describe('Source identifier (e.g. "cli-scan", "mcp-populate")')},async t=>{try{let e=await ge.populate(t.nodes,t.dryRun,t.source);return{content:[{type:"text",text:[`Populate ${t.dryRun?"(dry run) ":""}completed.`,`- Run ID: ${e.runId}`,`- Created: ${String(e.created)}`,`- Updated: ${String(e.updated)}`,`- Unchanged: ${String(e.unchanged)}`,`- Errors: ${String(e.errors)}`].join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ne.tool("contox_add_entry","Add an entry to a journal-like context (bugs, implementation journal, sessions). Entries are INSERT-only (event-sourced) and idempotent via idempotencyKey. Uses client-generated ULID for monotone ordering.",{contextId:k.string().describe("Target context ID"),title:k.string().describe("Entry title (max 200 chars)"),content:k.string().describe("Entry content in markdown"),entryType:k.string().optional().describe('Entry type (e.g. "bug-fix", "feature", "session")'),tags:k.array(k.string()).optional().describe("Tags for categorization"),idempotencyKey:k.string().optional().describe("Idempotency key for retry safety"),source:k.string().optional().describe("Source identifier"),sourceRef:k.string().optional().describe("Source reference (commit SHA, session ID, etc.)")},async t=>{try{let e=await ge.createEntry({contextId:t.contextId,title:t.title,content:t.content,entryType:t.entryType,tags:t.tags,idempotencyKey:t.idempotencyKey,source:t.source,sourceRef:t.sourceRef});return{content:[{type:"text",text:`Entry added: ${e.title} (${e.id})`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ne.tool("contox_get_tree","Get the hierarchical brain tree for the current project. Returns a nested tree of contexts with schemaKey, tier, state, contextType, and children. Useful for understanding the project knowledge structure at a glance.",{},async()=>{try{let t=await ge.getTree();return{content:[{type:"text",text:JSON.stringify(t.tree,null,2)}]}}catch(t){return{content:[{type:"text",text:`Error: ${String(t)}`}],isError:!0}}});ne.tool("contox_approve","Approve or deprecate a context (state machine). Approved contexts are included in the brain document. Deprecated contexts are hidden. Only works on contexts with a state (draft \u2192 approved \u2192 deprecated).",{id:k.string().describe("The context ID"),action:k.enum(["approve","deprecate"]).describe('"approve" to make visible in brain, "deprecate" to hide')},async t=>{try{return t.action==="approve"?await ge.approveContext(t.id):await ge.deprecateContext(t.id),{content:[{type:"text",text:`Context ${t.action==="approve"?"approved":"deprecated"}: ${t.id}`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ne.tool("contox_get_links","Get links for a context by its schemaKey. Returns incoming and outgoing links with linkType, reason, and confidence. Links represent relationships between contexts (see-also, depends-on, child-of, related).",{schemaKey:k.string().describe('The schemaKey of the context (e.g. "root/api/auth")'),direction:k.enum(["both","outgoing","incoming"]).optional().describe("Filter direction (default: both)")},async t=>{try{let e=await ge.getLinks(t.schemaKey,t.direction),r=[];if(e.outgoing.length>0){r.push(`## Outgoing (${String(e.outgoing.length)})`);for(let n of e.outgoing)r.push(`- \u2192 ${n.toSchemaKey} [${n.linkType}]${n.reason?` \u2014 ${n.reason}`:""}${n.confidence!==null?` (conf: ${String(n.confidence)})`:""}`)}if(e.incoming.length>0){r.push(`## Incoming (${String(e.incoming.length)})`);for(let n of e.incoming)r.push(`- \u2190 ${n.fromSchemaKey} [${n.linkType}]${n.reason?` \u2014 ${n.reason}`:""}${n.confidence!==null?` (conf: ${String(n.confidence)})`:""}`)}return r.length===0&&r.push(`No links found for "${t.schemaKey}"`),{content:[{type:"text",text:r.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ne.tool("contox_add_link",'Create a directed link between two contexts by their schemaKeys. Links form a knowledge graph \u2014 use them to express relationships like "depends-on", "see-also", "child-of", or "related".',{from:k.string().describe('Source schemaKey (e.g. "root/frontend/hooks")'),to:k.string().describe('Target schemaKey (e.g. "root/api/auth")'),linkType:k.enum(["see-also","depends-on","child-of","related"]).describe("Type of relationship"),reason:k.string().optional().describe("Why this link exists"),confidence:k.number().optional().describe("Confidence score 0-1 (e.g. 0.9 = very confident)")},async t=>{try{return await ge.createLink(t.from,t.to,t.linkType,t.reason,t.confidence),{content:[{type:"text",text:`Link created: ${t.from} \u2192 ${t.to} [${t.linkType}]`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ne.tool("contox_compact","Compact entries for a journal-like context (bugs, journal, sessions). Summarizes all entries into a single content block, reducing token count while preserving key information. Use when a context has too many entries.",{id:k.string().describe("The context ID to compact")},async t=>{try{let e=await ge.compactContext(t.id);return{content:[{type:"text",text:[`Compaction completed for context ${t.id}:`,`- Entries processed: ${String(e.entriesCount)}`,`- Summary length: ${String(e.summaryLength)} chars`,`- ${e.message}`].join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ne.tool("contox_oncall_view","View on-call operational summary for the current project. Shows recent sessions, stale drafts (>7 days), recent bugs, and brain health stats. Use this for a quick project health check.",{since:k.string().optional().describe("ISO date string \u2014 show data since this time (default: last 24h)")},async t=>{try{return{content:[{type:"text",text:await ky(ge,{since:t.since})}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ne.tool("contox_explain_schemakey","Deep-dive into any brain schemaKey. Returns: schema metadata (tier, contextType, writePolicy), context content preview, runtime links (incoming/outgoing), recent entries, and related contracts. Use this to understand any part of the brain.",{schemaKey:k.string().describe('The schemaKey to explain (e.g. "root/contracts/auth", "root/bugs")')},async t=>{try{return{content:[{type:"text",text:await Py(ge,t.schemaKey)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ne.tool("contox_scan",`Scan a local codebase directory and push ~15-20 hierarchical sub-contexts to the project brain. Walks the filesystem to extract routes, components, libraries, hooks, stores, dependencies, and key documentation files. Results are organized into granular sub-contexts mapped to brain schemaKeys and pushed via the populate API with content-hash dedup.

Use this to index a codebase so the AI can understand the project structure without reading source files. The scan respects .gitignore-like exclusions (node_modules, .next, dist, etc.) and reads files up to 32KB.`,{directory:k.string().optional().describe("Absolute path to the project root directory to scan. Defaults to the current working directory."),dryRun:k.boolean().optional().describe("If true, scan and build sub-contexts but do not push to the API. Returns what would be created/updated.")},async t=>{try{let e=(0,Ni.resolve)(t.directory??process.cwd());if(!(0,Tn.existsSync)(e)||!(0,Tn.statSync)(e).isDirectory())return{content:[{type:"text",text:`Error: "${e}" is not a valid directory.`}],isError:!0};let r=(0,Tn.existsSync)((0,Ni.resolve)(e,".git")),n=(0,Tn.existsSync)((0,Ni.resolve)(e,"package.json"));if(!r&&!n)return{content:[{type:"text",text:"Error: Directory must be a project root (must contain .git or package.json)."}],isError:!0};let o=Ey(e),s=o.routes.filter(_=>!_.methods.includes("PAGE")),i=o.routes.filter(_=>_.methods.includes("PAGE")),a=[...o.libs,...o.hooks,...o.stores].reduce((_,x)=>_+x.exports.length,0),c=Cy(o),u=0;for(let _ of c)u+=xd(_.content);let l=[`Scan completed for: ${e}`,`- Files: ${String(o.stats.totalFiles)}, Directories: ${String(o.stats.totalDirs)}`,`- API endpoints: ${String(s.length)}, Pages: ${String(i.length)}`,`- Components: ${String(o.components.length)}, Libraries: ${String(o.libs.length)}, Hooks: ${String(o.hooks.length)}, Stores: ${String(o.stores.length)}`,`- Exported functions/types: ${String(a)}`,`- Key documentation files: ${String(o.keyFiles.length)}`,`- Sub-contexts generated: ${String(c.length)} (~${String(u)} tokens)`];if(t.dryRun){l.push(""),l.push("Sub-contexts (dry run \u2014 not pushed):");for(let _ of c){let x=xd(_.content);l.push(`  - ${_.name} [${_.schemaKey}] (~${String(x)} tokens)`)}return{content:[{type:"text",text:l.join(`
`)}]}}let d=c.sort((_,x)=>{let b=_.schemaKey.split("/").length,S=x.schemaKey.split("/").length;return b!==S?b-S:_.order-x.order}).map(_=>({schemaKey:_.schemaKey,name:_.name,content:_.content,description:_.description,contextType:_.contextType??"reference",tier:_.tier??2,parentSchemaKey:_.parentSchemaKey})),f=50,m=0,p=0,h=0,g=0;for(let _=0;_<d.length;_+=f){let x=d.slice(_,_+f),b=await ge.populate(x,!1,"mcp-scan");m+=b.created,p+=b.updated,h+=b.unchanged,g+=b.errors}return l.push(""),l.push("Populate results:"),l.push(`- Created: ${String(m)}`),l.push(`- Updated: ${String(p)}`),l.push(`- Unchanged: ${String(h)}`),g>0&&l.push(`- Errors: ${String(g)}`),{content:[{type:"text",text:l.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error scanning codebase: ${String(e)}`}],isError:!0}}});ne.tool("contox_git_digest",`Read git commits since last save. Returns structured commit data (SHA, message, files, diff stats, smart patches) + WIP evidence for Claude to analyze and enrich before saving.

Uses SHA-based range tracking (not dates) for reliable incremental digests. The base SHA is read from the last session entry's sourceRef field.`,{directory:k.string().optional().describe("Absolute path to the git repo root. Defaults to the current working directory."),limit:k.number().optional().describe("Max commits to return. Default 20."),mode:k.enum(["first-parent","all"]).optional().describe("first-parent (default): clean shipping journal. all: exhaustive including merge commits.")},async t=>{try{let e=await Ci(ge,{directory:t.directory,limit:t.limit,mode:t.mode});return{content:[{type:"text",text:My(e)}]}}catch(e){return{content:[{type:"text",text:`Error reading git digest: ${String(e)}`}],isError:!0}}});ne.tool("contox_context_pack",`Build a focused context pack for the current task. Uses V2 semantic search to find the most relevant memory items and assembles a token-budgeted markdown document.

RECOMMENDED: Build a focused context pack BEFORE starting any coding task. This tool uses semantic search to find architecture decisions, conventions, known bugs, and past implementations relevant to your current task. Call this with a brief task description to get the context you need.

Scopes:
- "relevant" (default): Semantic search for task-related items only
- "full": Complete brain document, truncated to budget
- "minimal": Top 5 highest-confidence items

Falls back to full brain if semantic search is unavailable.`,{task:k.string().describe("Current task description \u2014 used for semantic search"),scope:k.enum(["full","relevant","minimal"]).default("relevant").describe("How much context to include"),tokenBudget:k.number().default(4e3).describe("Approximate token budget for the pack"),activeFiles:k.array(k.string()).optional().describe("Currently open file paths \u2014 boosts memory items referencing these files")},async t=>{try{return{content:[{type:"text",text:await Uy(be,{task:t.task,scope:t.scope,tokenBudget:t.tokenBudget,activeFiles:t.activeFiles})}]}}catch(e){return{content:[{type:"text",text:`Error building context pack: ${String(e)}`}],isError:!0}}});ne.tool("contox_ask",`Ask a natural-language question about your project memory. Uses semantic search to find relevant memory items, then synthesizes a cited answer using an LLM.

Returns a markdown answer with [Source N] citations, the matched sources, similarity scores, and token usage.

Requires embeddings to exist (run a Genesis scan first).`,{question:k.string().min(3).describe("The question to ask about the project memory")},async t=>{try{let e=await be.ask(t.question);return{content:[{type:"text",text:[e.answer,"","---",`_${String(e.sources.length)} sources | avg similarity: ${(e.avgSimilarity*100).toFixed(0)}% | ${String(e.usage.totalTokens)} tokens | model: ${e.model}_`].join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error asking question: ${String(e)}`}],isError:!0}}});ne.tool("contox_hygiene",`Run the Memory Hygiene Agent to analyze and clean up memory items.

Modes:
- "quick": Analyze the 20 most recent items (fast, low cost)
- "weekly": Analyze all items updated in the last 7 days

The agent proposes safe, minimal edits: rename titles, retag, merge duplicates, deprecate superseded items, flag quality issues, redact secrets. It NEVER auto-applies changes.

Two-phase workflow:
1. Call without "apply" to get a HygienePlan (proposed actions)
2. Call with "apply" + selectedActionIds to execute chosen actions

Each action has a confidence score and requiresHumanApproval flag.`,{mode:k.enum(["quick","weekly"]).default("quick").describe('Analysis mode: "quick" (20 recent items) or "weekly" (last 7 days)'),schemaKeyPrefix:k.string().optional().describe('Filter items by schemaKey prefix (e.g. "root/bugs")'),apply:k.array(k.string()).optional().describe("Action IDs to apply from a previous plan. Omit to analyze only."),plan:k.string().optional().describe("JSON-stringified HygienePlan from a previous analyze call. Required when applying."),dryRun:k.boolean().optional().describe("If true, show what would be applied without executing.")},async t=>{try{let e=process.env.CONTOX_TEAM_ID??"";if(t.apply&&t.apply.length>0){if(!t.plan)return{content:[{type:"text",text:'Error: "plan" is required when applying actions.'}],isError:!0};let o;try{o=JSON.parse(t.plan)}catch{return{content:[{type:"text",text:'Error: "plan" must be valid JSON.'}],isError:!0}}let s=await be.applyHygiene({teamId:e,plan:o,selectedActionIds:t.apply,dryRun:t.dryRun}),i=[`Hygiene Apply ${t.dryRun?"(DRY RUN) ":""}Result:`,`- Applied: ${String(s.appliedActionIds.length)}`,`- Skipped: ${String(s.skippedActionIds.length)}`,`- Errors: ${String(s.errors.length)}`];if(s.errors.length>0){i.push("","Errors:");for(let a of s.errors)i.push(`  - ${a.actionId}: ${a.message}`)}return{content:[{type:"text",text:i.join(`
`)}]}}let r=await be.analyzeHygiene({mode:t.mode,teamId:e,schemaKeyPrefix:t.schemaKeyPrefix}),n=[`Memory Hygiene Report (${t.mode} mode)`,`${"\u2500".repeat(40)}`,`Items analyzed: ${String(r.metrics.totalMemories)}`,`Actions proposed: ${String(r.metrics.actionsCount)}`,`Tokens: ${String(r.usage.promptTokens)}+${String(r.usage.completionTokens)}`,"",r.summary];if(r.warnings.length>0){n.push("","Warnings:");for(let o of r.warnings)n.push(`  WARNING: ${o}`)}if(r.actions.length>0){n.push("");let o=new Map;for(let s of r.actions){let i=o.get(s.type)??[];i.push(s),o.set(s.type,i)}for(let[s,i]of o){n.push(`${s} (${String(i.length)})`);for(let a of i){let c=a.requiresHumanApproval?" [NEEDS APPROVAL]":"";n.push(`  \u2022 ${a.reason} (confidence: ${String(a.confidence)})${c}`),n.push(`    id: ${a.actionId} | targets: ${a.targetMemoryIds.join(", ")}`)}n.push("")}n.push("To apply actions, call contox_hygiene with:","  apply: [actionId1, actionId2, ...]",`  plan: '${JSON.stringify(r)}'`)}return{content:[{type:"text",text:n.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ne.tool("contox_auto_resolve",`Automatically resolve memory items when code fixes are committed. Analyzes recent git commits, matches modified files against existing BugFix/Todo/security memory items, and marks resolved items as archived.

Use this AFTER committing fixes to automatically update the project memory. The tool:
1. Reads recent git commits (since last save)
2. Matches commit files against memory items' file references
3. Uses keyword matching (fix, resolve, patch, secure, etc.) as a secondary signal
4. Archives high-confidence matches, flags medium-confidence ones for review

Supports dry-run mode to preview what would be resolved without making changes.`,{directory:k.string().optional().describe("Absolute path to the git repo root. Defaults to the current working directory."),limit:k.number().optional().describe("Max commits to analyze. Default 20."),dryRun:k.boolean().optional().describe("If true, show what would be resolved without making changes.")},async t=>{try{let e=await Ci(ge,{directory:t.directory,limit:t.limit});if(e.commits.length===0)return{content:[{type:"text",text:"No commits found to analyze. Nothing to resolve."}]};let r=e.commits.map(s=>({sha:s.sha,message:s.message,files:s.files})),n=await be.autoResolve(r,t.dryRun),o=[];if(n.dryRun?o.push("# Auto-Resolve (DRY RUN)"):o.push("# Auto-Resolve Results"),o.push(""),o.push(`Analyzed **${String(e.commits.length)}** commits against **${String(n.totalItemsScanned)}** active memory items.`),o.push(""),n.resolved.length===0)o.push("No memory items matched the committed changes.");else{o.push(`## Resolved (${String(n.resolved.length)})`),o.push("");for(let s of n.resolved){let i=s.newStatus==="archived"?"[RESOLVED]":"[REVIEW]";o.push(`${i} **${s.title}** (${s.type})`),o.push(`  - Match: ${s.matchType} | Confidence: ${String(s.confidence)}`),o.push(`  - Commit: ${s.commitSha.slice(0,7)}`),s.matchedFiles.length>0&&o.push(`  - Files: ${s.matchedFiles.join(", ")}`),o.push(`  - Status: ${s.previousStatus} \u2192 ${s.newStatus}`),o.push("")}}if(n.skipped.length>0){o.push(`## Skipped (${String(n.skipped.length)})`);for(let s of n.skipped)o.push(`- ${s.title}: ${s.reason}`);o.push("")}return{content:[{type:"text",text:o.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error auto-resolving: ${String(e)}`}],isError:!0}}});ne.tool("contox_drift_check",'Run architecture drift detection. Compares recent enriched items against established project conventions to detect violations. Returns detected drifts with severity levels. Use "check" to run analysis, "list" to view existing drift problems.',{action:k.enum(["check","list"]).describe('"check" to run drift analysis on recent items, "list" to view existing drift problems')},async t=>{if(!be)return{content:[{type:"text",text:ct?`Not configured: ${ct}`:"Not configured \u2014 set CONTOX_API_KEY"}],isError:!0};try{if(t.action==="list"){let n=await be.getDriftProblems();if(n.problems.length===0)return{content:[{type:"text",text:"No drift problems found for this project."}]};let o=[`# Drift Problems (${String(n.total)})`,""];for(let s of n.problems){let i=s.severity==="critical"?"\u{1F534}":s.severity==="high"?"\u{1F7E0}":s.severity==="medium"?"\u{1F7E1}":"\u{1F535}";o.push(`${i} **[${s.severity.toUpperCase()}]** ${s.description}`),o.push(`  Status: ${s.status} | Created: ${s.createdAt.split("T")[0]??s.createdAt}`),s.itemIds.length>0&&o.push(`  Related items: ${s.itemIds.join(", ")}`),o.push("")}return{content:[{type:"text",text:o.join(`
`)}]}}let e=await be.driftCheck(),r=["# Architecture Drift Check","",e.message,"",`- Items checked: **${String(e.itemsChecked)}**`,`- Baseline conventions: **${String(e.baselineSize)}**`,`- Drifts detected: **${String(e.driftsDetected)}**`];if(e.details.length>0){r.push(""),r.push("## Detected Drifts"),r.push("");for(let n of e.details){let o=n.severity==="critical"?"\u{1F534}":n.severity==="high"?"\u{1F7E0}":n.severity==="medium"?"\u{1F7E1}":"\u{1F535}";r.push(`${o} **[${n.severity.toUpperCase()}]** Convention: "${n.convention}"`),r.push(`  Violation: ${n.violation}`),n.files.length>0&&r.push(`  Files: ${n.files.join(", ")}`),r.push("")}}return e.usage.promptTokens>0&&r.push(`_LLM usage: ${String(e.usage.promptTokens)} prompt + ${String(e.usage.completionTokens)} completion tokens_`),{content:[{type:"text",text:r.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error running drift check: ${String(e)}`}],isError:!0}}});ne.tool("contox_impact_radar","Analyze change ripple effects across project modules. Uses brain data (module map from Genesis scan + architecture notes) to determine which modules are directly changed and which are indirectly affected (ripple effects). Returns per-module risk assessment. Requires a Genesis scan to build the module map.",{days:k.number().min(1).max(30).optional().describe("Number of days to analyze (default 7)")},async t=>{if(!be)return{content:[{type:"text",text:ct?`Not configured: ${ct}`:"Not configured \u2014 set CONTOX_API_KEY"}],isError:!0};try{let e=await be.analyzeImpact(t.days),r=["# Impact Radar","",e.message,"",`- Files changed: **${String(e.totalFilesChanged)}**`,`- Modules affected: **${String(e.modulesAffected)}**`,`- Ripple effects: **${String(e.rippleCount)}**`,`- Changes analyzed: **${String(e.changesAnalyzed)}**`];if(e.modules.length>0){r.push(""),r.push("## Impacted Modules"),r.push("");for(let n of e.modules){let o=n.riskLevel==="critical"?"\u{1F534}":n.riskLevel==="high"?"\u{1F7E0}":n.riskLevel==="medium"?"\u{1F7E1}":"\u{1F535}",s=n.rippleFrom.length>0&&n.directChanges===0?" _(ripple)_":"";r.push(`${o} **[${n.riskLevel.toUpperCase()}]** ${n.module}${s}`),r.push(`  ${n.reason}`),n.directChanges>0&&r.push(`  Direct changes: ${String(n.directChanges)} file(s)`),n.rippleFrom.length>0&&r.push(`  Ripple from: ${n.rippleFrom.join(", ")}`),n.files.length>0&&r.push(`  Files: ${n.files.join(", ")}`),r.push("")}}return e.usage.promptTokens>0&&r.push(`_LLM usage: ${String(e.usage.promptTokens)} prompt + ${String(e.usage.completionTokens)} completion tokens_`),{content:[{type:"text",text:r.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error running impact analysis: ${String(e)}`}],isError:!0}}});ne.tool("contox_onboarding_guide","Generate a smart onboarding guide for the project. Creates a structured 9-section developer guide from the project's brain data: Project Overview, Getting Started, Architecture Guide, Code Conventions, Feature Inventory, Common Tasks, Key Files, Gotchas, and Glossary. Uses LLM to synthesize brain data into readable prose.",{},async()=>{if(!be)return{content:[{type:"text",text:ct?`Not configured: ${ct}`:"Not configured \u2014 set CONTOX_API_KEY"}],isError:!0};try{let t=await be.generateOnboardingGuide(),e=[`# ${t.projectName} \u2014 Onboarding Guide`,"",`> Generated: ${t.guide.generatedAt.split("T")[0]??t.guide.generatedAt}`,`> Based on ${String(t.guide.itemsUsed)} memory items`,""];for(let r of t.guide.sections)if(e.push(`## ${r.title}`),e.push(""),e.push(r.content),e.push(""),r.keyFiles.length>0){e.push("**Key files:**");for(let n of r.keyFiles)e.push(`- \`${n}\``);e.push("")}return e.push("---"),e.push(`_${String(t.guide.usage.promptTokens+t.guide.usage.completionTokens)} tokens used_`),{content:[{type:"text",text:e.join(`
`)}]}}catch(t){return{content:[{type:"text",text:`Error generating onboarding guide: ${String(t)}`}],isError:!0}}});ne.tool("contox_changelog",'Get the auto-generated project changelog. Aggregates session-level changelogs into daily entries with audience mode filtering. Modes: "developer" (technical details), "product" (features & impact), "executive" (business value).',{mode:k.enum(["developer","product","executive"]).optional().describe('Audience mode for changelog output. Default: "developer"'),days:k.number().optional().describe("Number of days to include. Default: 30")},async t=>{if(!be)return{content:[{type:"text",text:ct?`Not configured: ${ct}`:"Not configured \u2014 set CONTOX_API_KEY"}],isError:!0};try{let e=t.mode??"developer",r=t.days??30,n=await be.getChangelog({mode:e,days:r});if(n.entries.length===0)return{content:[{type:"text",text:`No changelog entries in the last ${String(r)} days. Changelogs are auto-generated from enriched development sessions.`}]};let o=[`# Project Changelog (${e}, last ${String(r)} days)`,"",`**${String(n.total)} day(s)** with activity`,""];for(let s of n.entries){if(o.push(`## ${s.date}`),o.push(""),o.push(`*${String(s.sessionCount)} session(s) | ${String(s.filesModified.length)} files*`),o.push(""),o.push(s.summary),o.push(""),s.changelog&&(o.push(s.changelog),o.push("")),s.risks.length>0){o.push("**Risks:**");for(let i of s.risks)o.push(`- \u26A0\uFE0F ${i}`);o.push("")}if(s.impacts.length>0){o.push("**Impacts:**");for(let i of s.impacts)o.push(`- \u2705 ${i}`);o.push("")}o.push("---"),o.push("")}return{content:[{type:"text",text:o.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error fetching changelog: ${String(e)}`}],isError:!0}}});async function Gz(){let t=new ki;await ne.connect(t);try{let e=await Ly({apiKey:process.env.CONTOX_API_KEY,apiUrl:process.env.CONTOX_API_URL,teamId:process.env.CONTOX_TEAM_ID,projectId:process.env.CONTOX_PROJECT_ID});ge=new Ti(e),be=new Pi({apiKey:e.apiKey??"",apiUrl:e.apiUrl,projectId:e.projectId??"",hmacSecret:process.env.CONTOX_HMAC_SECRET??process.env.V2_HMAC_SECRET_MCP??process.env.V2_HMAC_SECRET})}catch(e){ct=e instanceof Error?e.message:String(e),console.error(`[contox-mcp] Initialization failed: ${ct}`)}}Gz().catch(t=>{console.error("Fatal error:",t),process.exit(1)});
