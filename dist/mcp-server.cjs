#!/usr/bin/env node
"use strict";var Uy=Object.create;var Oi=Object.defineProperty;var Vy=Object.getOwnPropertyDescriptor;var Fy=Object.getOwnPropertyNames;var Ky=Object.getPrototypeOf,Hy=Object.prototype.hasOwnProperty;var T=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ai=(t,e)=>{for(var r in e)Oi(t,r,{get:e[r],enumerable:!0})},By=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Fy(e))!Hy.call(t,o)&&o!==r&&Oi(t,o,{get:()=>e[o],enumerable:!(n=Vy(e,o))||n.enumerable});return t};var Ro=(t,e,r)=>(r=t!=null?Uy(Ky(t)):{},By(e||!t||!t.__esModule?Oi(r,"default",{value:t,enumerable:!0}):r,t));var eo=T(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.regexpCode=Q.getEsmExportName=Q.getProperty=Q.safeStringify=Q.stringify=Q.strConcat=Q.addCodeArg=Q.str=Q._=Q.nil=Q._Code=Q.Name=Q.IDENTIFIER=Q._CodeOrName=void 0;var Yn=class{};Q._CodeOrName=Yn;Q.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var Er=class extends Yn{constructor(e){if(super(),!Q.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};Q.Name=Er;var nt=class extends Yn{constructor(e){super(),this._items=typeof e=="string"?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let e=this._items[0];return e===""||e==='""'}get str(){var e;return(e=this._str)!==null&&e!==void 0?e:this._str=this._items.reduce((r,n)=>`${r}${n}`,"")}get names(){var e;return(e=this._names)!==null&&e!==void 0?e:this._names=this._items.reduce((r,n)=>(n instanceof Er&&(r[n.str]=(r[n.str]||0)+1),r),{})}};Q._Code=nt;Q.nil=new nt("");function vm(t,...e){let r=[t[0]],n=0;for(;n<e.length;)vu(r,e[n]),r.push(t[++n]);return new nt(r)}Q._=vm;var _u=new nt("+");function xm(t,...e){let r=[Qn(t[0])],n=0;for(;n<e.length;)r.push(_u),vu(r,e[n]),r.push(_u,Qn(t[++n]));return B$(r),new nt(r)}Q.str=xm;function vu(t,e){e instanceof nt?t.push(...e._items):e instanceof Er?t.push(e):t.push(W$(e))}Q.addCodeArg=vu;function B$(t){let e=1;for(;e<t.length-1;){if(t[e]===_u){let r=J$(t[e-1],t[e+1]);if(r!==void 0){t.splice(e-1,3,r);continue}t[e++]="+"}e++}}function J$(t,e){if(e==='""')return t;if(t==='""')return e;if(typeof t=="string")return e instanceof Er||t[t.length-1]!=='"'?void 0:typeof e!="string"?`${t.slice(0,-1)}${e}"`:e[0]==='"'?t.slice(0,-1)+e.slice(1):void 0;if(typeof e=="string"&&e[0]==='"'&&!(t instanceof Er))return`"${t}${e.slice(1)}`}function G$(t,e){return e.emptyStr()?t:t.emptyStr()?e:xm`${t}${e}`}Q.strConcat=G$;function W$(t){return typeof t=="number"||typeof t=="boolean"||t===null?t:Qn(Array.isArray(t)?t.join(","):t)}function X$(t){return new nt(Qn(t))}Q.stringify=X$;function Qn(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}Q.safeStringify=Qn;function Y$(t){return typeof t=="string"&&Q.IDENTIFIER.test(t)?new nt(`.${t}`):vm`[${t}]`}Q.getProperty=Y$;function Q$(t){if(typeof t=="string"&&Q.IDENTIFIER.test(t))return new nt(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)}Q.getEsmExportName=Q$;function ew(t){return new nt(t.toString())}Q.regexpCode=ew});var $u=T(Ke=>{"use strict";Object.defineProperty(Ke,"__esModule",{value:!0});Ke.ValueScope=Ke.ValueScopeName=Ke.Scope=Ke.varKinds=Ke.UsedValueState=void 0;var Fe=eo(),xu=class extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}},js;(function(t){t[t.Started=0]="Started",t[t.Completed=1]="Completed"})(js||(Ke.UsedValueState=js={}));Ke.varKinds={const:new Fe.Name("const"),let:new Fe.Name("let"),var:new Fe.Name("var")};var Os=class{constructor({prefixes:e,parent:r}={}){this._names={},this._prefixes=e,this._parent=r}toName(e){return e instanceof Fe.Name?e:this.name(e)}name(e){return new Fe.Name(this._newName(e))}_newName(e){let r=this._names[e]||this._nameGroup(e);return`${e}${r.index++}`}_nameGroup(e){var r,n;if(!((n=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||n===void 0)&&n.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}};Ke.Scope=Os;var As=class extends Fe.Name{constructor(e,r){super(r),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=(0,Fe._)`.${new Fe.Name(r)}[${n}]`}};Ke.ValueScopeName=As;var tw=(0,Fe._)`\n`,bu=class extends Os{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?tw:Fe.nil}}get(){return this._scope}name(e){return new As(e,this._newName(e))}value(e,r){var n;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let o=this.toName(e),{prefix:s}=o,i=(n=r.key)!==null&&n!==void 0?n:r.ref,a=this._values[s];if(a){let l=a.get(i);if(l)return l}else a=this._values[s]=new Map;a.set(i,o);let c=this._scope[s]||(this._scope[s]=[]),u=c.length;return c[u]=r.ref,o.setValue(r,{property:s,itemIndex:u}),o}getValue(e,r){let n=this._values[e];if(n)return n.get(r)}scopeRefs(e,r=this._values){return this._reduceValues(r,n=>{if(n.scopePath===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return(0,Fe._)`${e}${n.scopePath}`})}scopeCode(e=this._values,r,n){return this._reduceValues(e,o=>{if(o.value===void 0)throw new Error(`CodeGen: name "${o}" has no value`);return o.value.code},r,n)}_reduceValues(e,r,n={},o){let s=Fe.nil;for(let i in e){let a=e[i];if(!a)continue;let c=n[i]=n[i]||new Map;a.forEach(u=>{if(c.has(u))return;c.set(u,js.Started);let l=r(u);if(l){let d=this.opts.es5?Ke.varKinds.var:Ke.varKinds.const;s=(0,Fe._)`${s}${d} ${u} = ${l};${this.opts._n}`}else if(l=o?.(u))s=(0,Fe._)`${s}${l}${this.opts._n}`;else throw new xu(u);c.set(u,js.Completed)})}return s}};Ke.ValueScope=bu});var F=T(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.or=K.and=K.not=K.CodeGen=K.operators=K.varKinds=K.ValueScopeName=K.ValueScope=K.Scope=K.Name=K.regexpCode=K.stringify=K.getProperty=K.nil=K.strConcat=K.str=K._=void 0;var X=eo(),pt=$u(),Xt=eo();Object.defineProperty(K,"_",{enumerable:!0,get:function(){return Xt._}});Object.defineProperty(K,"str",{enumerable:!0,get:function(){return Xt.str}});Object.defineProperty(K,"strConcat",{enumerable:!0,get:function(){return Xt.strConcat}});Object.defineProperty(K,"nil",{enumerable:!0,get:function(){return Xt.nil}});Object.defineProperty(K,"getProperty",{enumerable:!0,get:function(){return Xt.getProperty}});Object.defineProperty(K,"stringify",{enumerable:!0,get:function(){return Xt.stringify}});Object.defineProperty(K,"regexpCode",{enumerable:!0,get:function(){return Xt.regexpCode}});Object.defineProperty(K,"Name",{enumerable:!0,get:function(){return Xt.Name}});var Ds=$u();Object.defineProperty(K,"Scope",{enumerable:!0,get:function(){return Ds.Scope}});Object.defineProperty(K,"ValueScope",{enumerable:!0,get:function(){return Ds.ValueScope}});Object.defineProperty(K,"ValueScopeName",{enumerable:!0,get:function(){return Ds.ValueScopeName}});Object.defineProperty(K,"varKinds",{enumerable:!0,get:function(){return Ds.varKinds}});K.operators={GT:new X._Code(">"),GTE:new X._Code(">="),LT:new X._Code("<"),LTE:new X._Code("<="),EQ:new X._Code("==="),NEQ:new X._Code("!=="),NOT:new X._Code("!"),OR:new X._Code("||"),AND:new X._Code("&&"),ADD:new X._Code("+")};var jt=class{optimizeNodes(){return this}optimizeNames(e,r){return this}},wu=class extends jt{constructor(e,r,n){super(),this.varKind=e,this.name=r,this.rhs=n}render({es5:e,_n:r}){let n=e?pt.varKinds.var:this.varKind,o=this.rhs===void 0?"":` = ${this.rhs}`;return`${n} ${this.name}${o};`+r}optimizeNames(e,r){if(e[this.name.str])return this.rhs&&(this.rhs=on(this.rhs,e,r)),this}get names(){return this.rhs instanceof X._CodeOrName?this.rhs.names:{}}},Ns=class extends jt{constructor(e,r,n){super(),this.lhs=e,this.rhs=r,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof X.Name&&!e[this.lhs.str]&&!this.sideEffects))return this.rhs=on(this.rhs,e,r),this}get names(){let e=this.lhs instanceof X.Name?{}:{...this.lhs.names};return Ms(e,this.rhs)}},ku=class extends Ns{constructor(e,r,n,o){super(e,n,o),this.op=r}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}},Su=class extends jt{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}},Tu=class extends jt{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}},Pu=class extends jt{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}},zu=class extends jt{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,r){return this.code=on(this.code,e,r),this}get names(){return this.code instanceof X._CodeOrName?this.code.names:{}}},to=class extends jt{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((r,n)=>r+n.render(e),"")}optimizeNodes(){let{nodes:e}=this,r=e.length;for(;r--;){let n=e[r].optimizeNodes();Array.isArray(n)?e.splice(r,1,...n):n?e[r]=n:e.splice(r,1)}return e.length>0?this:void 0}optimizeNames(e,r){let{nodes:n}=this,o=n.length;for(;o--;){let s=n[o];s.optimizeNames(e,r)||(rw(e,s.names),n.splice(o,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,r)=>Cr(e,r.names),{})}},Ot=class extends to{render(e){return"{"+e._n+super.render(e)+"}"+e._n}},Eu=class extends to{},nn=class extends Ot{};nn.kind="else";var Ir=class t extends Ot{constructor(e,r){super(r),this.condition=e}render(e){let r=`if(${this.condition})`+super.render(e);return this.else&&(r+="else "+this.else.render(e)),r}optimizeNodes(){super.optimizeNodes();let e=this.condition;if(e===!0)return this.nodes;let r=this.else;if(r){let n=r.optimizeNodes();r=this.else=Array.isArray(n)?new nn(n):n}if(r)return e===!1?r instanceof t?r:r.nodes:this.nodes.length?this:new t(bm(e),r instanceof t?[r]:r.nodes);if(!(e===!1||!this.nodes.length))return this}optimizeNames(e,r){var n;if(this.else=(n=this.else)===null||n===void 0?void 0:n.optimizeNames(e,r),!!(super.optimizeNames(e,r)||this.else))return this.condition=on(this.condition,e,r),this}get names(){let e=super.names;return Ms(e,this.condition),this.else&&Cr(e,this.else.names),e}};Ir.kind="if";var Rr=class extends Ot{};Rr.kind="for";var Iu=class extends Rr{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iteration=on(this.iteration,e,r),this}get names(){return Cr(super.names,this.iteration.names)}},Ru=class extends Rr{constructor(e,r,n,o){super(),this.varKind=e,this.name=r,this.from=n,this.to=o}render(e){let r=e.es5?pt.varKinds.var:this.varKind,{name:n,from:o,to:s}=this;return`for(${r} ${n}=${o}; ${n}<${s}; ${n}++)`+super.render(e)}get names(){let e=Ms(super.names,this.from);return Ms(e,this.to)}},Zs=class extends Rr{constructor(e,r,n,o){super(),this.loop=e,this.varKind=r,this.name=n,this.iterable=o}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iterable=on(this.iterable,e,r),this}get names(){return Cr(super.names,this.iterable.names)}},ro=class extends Ot{constructor(e,r,n){super(),this.name=e,this.args=r,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}};ro.kind="func";var no=class extends to{render(e){return"return "+super.render(e)}};no.kind="return";var Cu=class extends Ot{render(e){let r="try"+super.render(e);return this.catch&&(r+=this.catch.render(e)),this.finally&&(r+=this.finally.render(e)),r}optimizeNodes(){var e,r;return super.optimizeNodes(),(e=this.catch)===null||e===void 0||e.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(e,r){var n,o;return super.optimizeNames(e,r),(n=this.catch)===null||n===void 0||n.optimizeNames(e,r),(o=this.finally)===null||o===void 0||o.optimizeNames(e,r),this}get names(){let e=super.names;return this.catch&&Cr(e,this.catch.names),this.finally&&Cr(e,this.finally.names),e}},oo=class extends Ot{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}};oo.kind="catch";var so=class extends Ot{render(e){return"finally"+super.render(e)}};so.kind="finally";var ju=class{constructor(e,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=e,this._scope=new pt.Scope({parent:e}),this._nodes=[new Eu]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,r){let n=this._extScope.value(e,r);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,r){return this._extScope.getValue(e,r)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,r,n,o){let s=this._scope.toName(r);return n!==void 0&&o&&(this._constants[s.str]=n),this._leafNode(new wu(e,s,n)),s}const(e,r,n){return this._def(pt.varKinds.const,e,r,n)}let(e,r,n){return this._def(pt.varKinds.let,e,r,n)}var(e,r,n){return this._def(pt.varKinds.var,e,r,n)}assign(e,r,n){return this._leafNode(new Ns(e,r,n))}add(e,r){return this._leafNode(new ku(e,K.operators.ADD,r))}code(e){return typeof e=="function"?e():e!==X.nil&&this._leafNode(new zu(e)),this}object(...e){let r=["{"];for(let[n,o]of e)r.length>1&&r.push(","),r.push(n),(n!==o||this.opts.es5)&&(r.push(":"),(0,X.addCodeArg)(r,o));return r.push("}"),new X._Code(r)}if(e,r,n){if(this._blockNode(new Ir(e)),r&&n)this.code(r).else().code(n).endIf();else if(r)this.code(r).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new Ir(e))}else(){return this._elseNode(new nn)}endIf(){return this._endBlockNode(Ir,nn)}_for(e,r){return this._blockNode(e),r&&this.code(r).endFor(),this}for(e,r){return this._for(new Iu(e),r)}forRange(e,r,n,o,s=this.opts.es5?pt.varKinds.var:pt.varKinds.let){let i=this._scope.toName(e);return this._for(new Ru(s,i,r,n),()=>o(i))}forOf(e,r,n,o=pt.varKinds.const){let s=this._scope.toName(e);if(this.opts.es5){let i=r instanceof X.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,X._)`${i}.length`,a=>{this.var(s,(0,X._)`${i}[${a}]`),n(s)})}return this._for(new Zs("of",o,s,r),()=>n(s))}forIn(e,r,n,o=this.opts.es5?pt.varKinds.var:pt.varKinds.const){if(this.opts.ownProperties)return this.forOf(e,(0,X._)`Object.keys(${r})`,n);let s=this._scope.toName(e);return this._for(new Zs("in",o,s,r),()=>n(s))}endFor(){return this._endBlockNode(Rr)}label(e){return this._leafNode(new Su(e))}break(e){return this._leafNode(new Tu(e))}return(e){let r=new no;if(this._blockNode(r),this.code(e),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(no)}try(e,r,n){if(!r&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');let o=new Cu;if(this._blockNode(o),this.code(e),r){let s=this.name("e");this._currNode=o.catch=new oo(s),r(s)}return n&&(this._currNode=o.finally=new so,this.code(n)),this._endBlockNode(oo,so)}throw(e){return this._leafNode(new Pu(e))}block(e,r){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(r),this}endBlock(e){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let n=this._nodes.length-r;if(n<0||e!==void 0&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=r,this}func(e,r=X.nil,n,o){return this._blockNode(new ro(e,r,n)),o&&this.code(o).endFunc(),this}endFunc(){return this._endBlockNode(ro)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,r){let n=this._currNode;if(n instanceof e||r&&n instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${e.kind}/${r.kind}`:e.kind}"`)}_elseNode(e){let r=this._currNode;if(!(r instanceof Ir))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=e,this}get _root(){return this._nodes[0]}get _currNode(){let e=this._nodes;return e[e.length-1]}set _currNode(e){let r=this._nodes;r[r.length-1]=e}};K.CodeGen=ju;function Cr(t,e){for(let r in e)t[r]=(t[r]||0)+(e[r]||0);return t}function Ms(t,e){return e instanceof X._CodeOrName?Cr(t,e.names):t}function on(t,e,r){if(t instanceof X.Name)return n(t);if(!o(t))return t;return new X._Code(t._items.reduce((s,i)=>(i instanceof X.Name&&(i=n(i)),i instanceof X._Code?s.push(...i._items):s.push(i),s),[]));function n(s){let i=r[s.str];return i===void 0||e[s.str]!==1?s:(delete e[s.str],i)}function o(s){return s instanceof X._Code&&s._items.some(i=>i instanceof X.Name&&e[i.str]===1&&r[i.str]!==void 0)}}function rw(t,e){for(let r in e)t[r]=(t[r]||0)-(e[r]||0)}function bm(t){return typeof t=="boolean"||typeof t=="number"||t===null?!t:(0,X._)`!${Ou(t)}`}K.not=bm;var nw=$m(K.operators.AND);function ow(...t){return t.reduce(nw)}K.and=ow;var sw=$m(K.operators.OR);function iw(...t){return t.reduce(sw)}K.or=iw;function $m(t){return(e,r)=>e===X.nil?r:r===X.nil?e:(0,X._)`${Ou(e)} ${t} ${Ou(r)}`}function Ou(t){return t instanceof X.Name?t:(0,X._)`(${t})`}});var ee=T(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.checkStrictMode=H.getErrorPath=H.Type=H.useFunc=H.setEvaluated=H.evaluatedPropsToName=H.mergeEvaluated=H.eachItem=H.unescapeJsonPointer=H.escapeJsonPointer=H.escapeFragment=H.unescapeFragment=H.schemaRefOrVal=H.schemaHasRulesButRef=H.schemaHasRules=H.checkUnknownRules=H.alwaysValidSchema=H.toHash=void 0;var se=F(),aw=eo();function cw(t){let e={};for(let r of t)e[r]=!0;return e}H.toHash=cw;function uw(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:(Sm(t,e),!Tm(e,t.self.RULES.all))}H.alwaysValidSchema=uw;function Sm(t,e=t.schema){let{opts:r,self:n}=t;if(!r.strictSchema||typeof e=="boolean")return;let o=n.RULES.keywords;for(let s in e)o[s]||Em(t,`unknown keyword: "${s}"`)}H.checkUnknownRules=Sm;function Tm(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(e[r])return!0;return!1}H.schemaHasRules=Tm;function lw(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}H.schemaHasRulesButRef=lw;function dw({topSchemaRef:t,schemaPath:e},r,n,o){if(!o){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,se._)`${r}`}return(0,se._)`${t}${e}${(0,se.getProperty)(n)}`}H.schemaRefOrVal=dw;function pw(t){return Pm(decodeURIComponent(t))}H.unescapeFragment=pw;function fw(t){return encodeURIComponent(Nu(t))}H.escapeFragment=fw;function Nu(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}H.escapeJsonPointer=Nu;function Pm(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}H.unescapeJsonPointer=Pm;function mw(t,e){if(Array.isArray(t))for(let r of t)e(r);else e(t)}H.eachItem=mw;function wm({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:n}){return(o,s,i,a)=>{let c=i===void 0?s:i instanceof se.Name?(s instanceof se.Name?t(o,s,i):e(o,s,i),i):s instanceof se.Name?(e(o,i,s),s):r(s,i);return a===se.Name&&!(c instanceof se.Name)?n(o,c):c}}H.mergeEvaluated={props:wm({mergeNames:(t,e,r)=>t.if((0,se._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,se._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,se._)`${r} || {}`).code((0,se._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,se._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,se._)`${r} || {}`),Zu(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:zm}),items:wm({mergeNames:(t,e,r)=>t.if((0,se._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,se._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,se._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,se._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function zm(t,e){if(e===!0)return t.var("props",!0);let r=t.var("props",(0,se._)`{}`);return e!==void 0&&Zu(t,r,e),r}H.evaluatedPropsToName=zm;function Zu(t,e,r){Object.keys(r).forEach(n=>t.assign((0,se._)`${e}${(0,se.getProperty)(n)}`,!0))}H.setEvaluated=Zu;var km={};function hw(t,e){return t.scopeValue("func",{ref:e,code:km[e.code]||(km[e.code]=new aw._Code(e.code))})}H.useFunc=hw;var Au;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(Au||(H.Type=Au={}));function gw(t,e,r){if(t instanceof se.Name){let n=e===Au.Num;return r?n?(0,se._)`"[" + ${t} + "]"`:(0,se._)`"['" + ${t} + "']"`:n?(0,se._)`"/" + ${t}`:(0,se._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,se.getProperty)(t).toString():"/"+Nu(t)}H.getErrorPath=gw;function Em(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}H.checkStrictMode=Em});var At=T(Mu=>{"use strict";Object.defineProperty(Mu,"__esModule",{value:!0});var Ce=F(),yw={data:new Ce.Name("data"),valCxt:new Ce.Name("valCxt"),instancePath:new Ce.Name("instancePath"),parentData:new Ce.Name("parentData"),parentDataProperty:new Ce.Name("parentDataProperty"),rootData:new Ce.Name("rootData"),dynamicAnchors:new Ce.Name("dynamicAnchors"),vErrors:new Ce.Name("vErrors"),errors:new Ce.Name("errors"),this:new Ce.Name("this"),self:new Ce.Name("self"),scope:new Ce.Name("scope"),json:new Ce.Name("json"),jsonPos:new Ce.Name("jsonPos"),jsonLen:new Ce.Name("jsonLen"),jsonPart:new Ce.Name("jsonPart")};Mu.default=yw});var io=T(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.extendErrors=je.resetErrorsCount=je.reportExtraError=je.reportError=je.keyword$DataError=je.keywordError=void 0;var Y=F(),qs=ee(),Ze=At();je.keywordError={message:({keyword:t})=>(0,Y.str)`must pass "${t}" keyword validation`};je.keyword$DataError={message:({keyword:t,schemaType:e})=>e?(0,Y.str)`"${t}" keyword must be ${e} ($data)`:(0,Y.str)`"${t}" keyword is invalid ($data)`};function _w(t,e=je.keywordError,r,n){let{it:o}=t,{gen:s,compositeRule:i,allErrors:a}=o,c=Cm(t,e,r);n??(i||a)?Im(s,c):Rm(o,(0,Y._)`[${c}]`)}je.reportError=_w;function vw(t,e=je.keywordError,r){let{it:n}=t,{gen:o,compositeRule:s,allErrors:i}=n,a=Cm(t,e,r);Im(o,a),s||i||Rm(n,Ze.default.vErrors)}je.reportExtraError=vw;function xw(t,e){t.assign(Ze.default.errors,e),t.if((0,Y._)`${Ze.default.vErrors} !== null`,()=>t.if(e,()=>t.assign((0,Y._)`${Ze.default.vErrors}.length`,e),()=>t.assign(Ze.default.vErrors,null)))}je.resetErrorsCount=xw;function bw({gen:t,keyword:e,schemaValue:r,data:n,errsCount:o,it:s}){if(o===void 0)throw new Error("ajv implementation error");let i=t.name("err");t.forRange("i",o,Ze.default.errors,a=>{t.const(i,(0,Y._)`${Ze.default.vErrors}[${a}]`),t.if((0,Y._)`${i}.instancePath === undefined`,()=>t.assign((0,Y._)`${i}.instancePath`,(0,Y.strConcat)(Ze.default.instancePath,s.errorPath))),t.assign((0,Y._)`${i}.schemaPath`,(0,Y.str)`${s.errSchemaPath}/${e}`),s.opts.verbose&&(t.assign((0,Y._)`${i}.schema`,r),t.assign((0,Y._)`${i}.data`,n))})}je.extendErrors=bw;function Im(t,e){let r=t.const("err",e);t.if((0,Y._)`${Ze.default.vErrors} === null`,()=>t.assign(Ze.default.vErrors,(0,Y._)`[${r}]`),(0,Y._)`${Ze.default.vErrors}.push(${r})`),t.code((0,Y._)`${Ze.default.errors}++`)}function Rm(t,e){let{gen:r,validateName:n,schemaEnv:o}=t;o.$async?r.throw((0,Y._)`new ${t.ValidationError}(${e})`):(r.assign((0,Y._)`${n}.errors`,e),r.return(!1))}var jr={keyword:new Y.Name("keyword"),schemaPath:new Y.Name("schemaPath"),params:new Y.Name("params"),propertyName:new Y.Name("propertyName"),message:new Y.Name("message"),schema:new Y.Name("schema"),parentSchema:new Y.Name("parentSchema")};function Cm(t,e,r){let{createErrors:n}=t.it;return n===!1?(0,Y._)`{}`:$w(t,e,r)}function $w(t,e,r={}){let{gen:n,it:o}=t,s=[ww(o,r),kw(t,r)];return Sw(t,e,s),n.object(...s)}function ww({errorPath:t},{instancePath:e}){let r=e?(0,Y.str)`${t}${(0,qs.getErrorPath)(e,qs.Type.Str)}`:t;return[Ze.default.instancePath,(0,Y.strConcat)(Ze.default.instancePath,r)]}function kw({keyword:t,it:{errSchemaPath:e}},{schemaPath:r,parentSchema:n}){let o=n?e:(0,Y.str)`${e}/${t}`;return r&&(o=(0,Y.str)`${o}${(0,qs.getErrorPath)(r,qs.Type.Str)}`),[jr.schemaPath,o]}function Sw(t,{params:e,message:r},n){let{keyword:o,data:s,schemaValue:i,it:a}=t,{opts:c,propertyName:u,topSchemaRef:l,schemaPath:d}=a;n.push([jr.keyword,o],[jr.params,typeof e=="function"?e(t):e||(0,Y._)`{}`]),c.messages&&n.push([jr.message,typeof r=="function"?r(t):r]),c.verbose&&n.push([jr.schema,i],[jr.parentSchema,(0,Y._)`${l}${d}`],[Ze.default.data,s]),u&&n.push([jr.propertyName,u])}});var Om=T(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});sn.boolOrEmptySchema=sn.topBoolOrEmptySchema=void 0;var Tw=io(),Pw=F(),zw=At(),Ew={message:"boolean schema is false"};function Iw(t){let{gen:e,schema:r,validateName:n}=t;r===!1?jm(t,!1):typeof r=="object"&&r.$async===!0?e.return(zw.default.data):(e.assign((0,Pw._)`${n}.errors`,null),e.return(!0))}sn.topBoolOrEmptySchema=Iw;function Rw(t,e){let{gen:r,schema:n}=t;n===!1?(r.var(e,!1),jm(t)):r.var(e,!0)}sn.boolOrEmptySchema=Rw;function jm(t,e){let{gen:r,data:n}=t,o={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,Tw.reportError)(o,Ew,void 0,e)}});var Du=T(an=>{"use strict";Object.defineProperty(an,"__esModule",{value:!0});an.getRules=an.isJSONType=void 0;var Cw=["string","number","integer","boolean","null","object","array"],jw=new Set(Cw);function Ow(t){return typeof t=="string"&&jw.has(t)}an.isJSONType=Ow;function Aw(){let t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}an.getRules=Aw});var qu=T(Yt=>{"use strict";Object.defineProperty(Yt,"__esModule",{value:!0});Yt.shouldUseRule=Yt.shouldUseGroup=Yt.schemaHasRulesForType=void 0;function Nw({schema:t,self:e},r){let n=e.RULES.types[r];return n&&n!==!0&&Am(t,n)}Yt.schemaHasRulesForType=Nw;function Am(t,e){return e.rules.some(r=>Nm(t,r))}Yt.shouldUseGroup=Am;function Nm(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(n=>t[n]!==void 0))}Yt.shouldUseRule=Nm});var ao=T(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.reportTypeError=Oe.checkDataTypes=Oe.checkDataType=Oe.coerceAndCheckDataType=Oe.getJSONTypes=Oe.getSchemaTypes=Oe.DataType=void 0;var Zw=Du(),Mw=qu(),Dw=io(),U=F(),Zm=ee(),cn;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(cn||(Oe.DataType=cn={}));function qw(t){let e=Mm(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}Oe.getSchemaTypes=qw;function Mm(t){let e=Array.isArray(t)?t:t?[t]:[];if(e.every(Zw.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}Oe.getJSONTypes=Mm;function Lw(t,e){let{gen:r,data:n,opts:o}=t,s=Uw(e,o.coerceTypes),i=e.length>0&&!(s.length===0&&e.length===1&&(0,Mw.schemaHasRulesForType)(t,e[0]));if(i){let a=Uu(e,n,o.strictNumbers,cn.Wrong);r.if(a,()=>{s.length?Vw(t,e,s):Vu(t)})}return i}Oe.coerceAndCheckDataType=Lw;var Dm=new Set(["string","number","integer","boolean","null"]);function Uw(t,e){return e?t.filter(r=>Dm.has(r)||e==="array"&&r==="array"):[]}function Vw(t,e,r){let{gen:n,data:o,opts:s}=t,i=n.let("dataType",(0,U._)`typeof ${o}`),a=n.let("coerced",(0,U._)`undefined`);s.coerceTypes==="array"&&n.if((0,U._)`${i} == 'object' && Array.isArray(${o}) && ${o}.length == 1`,()=>n.assign(o,(0,U._)`${o}[0]`).assign(i,(0,U._)`typeof ${o}`).if(Uu(e,o,s.strictNumbers),()=>n.assign(a,o))),n.if((0,U._)`${a} !== undefined`);for(let u of r)(Dm.has(u)||u==="array"&&s.coerceTypes==="array")&&c(u);n.else(),Vu(t),n.endIf(),n.if((0,U._)`${a} !== undefined`,()=>{n.assign(o,a),Fw(t,a)});function c(u){switch(u){case"string":n.elseIf((0,U._)`${i} == "number" || ${i} == "boolean"`).assign(a,(0,U._)`"" + ${o}`).elseIf((0,U._)`${o} === null`).assign(a,(0,U._)`""`);return;case"number":n.elseIf((0,U._)`${i} == "boolean" || ${o} === null
              || (${i} == "string" && ${o} && ${o} == +${o})`).assign(a,(0,U._)`+${o}`);return;case"integer":n.elseIf((0,U._)`${i} === "boolean" || ${o} === null
              || (${i} === "string" && ${o} && ${o} == +${o} && !(${o} % 1))`).assign(a,(0,U._)`+${o}`);return;case"boolean":n.elseIf((0,U._)`${o} === "false" || ${o} === 0 || ${o} === null`).assign(a,!1).elseIf((0,U._)`${o} === "true" || ${o} === 1`).assign(a,!0);return;case"null":n.elseIf((0,U._)`${o} === "" || ${o} === 0 || ${o} === false`),n.assign(a,null);return;case"array":n.elseIf((0,U._)`${i} === "string" || ${i} === "number"
              || ${i} === "boolean" || ${o} === null`).assign(a,(0,U._)`[${o}]`)}}}function Fw({gen:t,parentData:e,parentDataProperty:r},n){t.if((0,U._)`${e} !== undefined`,()=>t.assign((0,U._)`${e}[${r}]`,n))}function Lu(t,e,r,n=cn.Correct){let o=n===cn.Correct?U.operators.EQ:U.operators.NEQ,s;switch(t){case"null":return(0,U._)`${e} ${o} null`;case"array":s=(0,U._)`Array.isArray(${e})`;break;case"object":s=(0,U._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":s=i((0,U._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":s=i();break;default:return(0,U._)`typeof ${e} ${o} ${t}`}return n===cn.Correct?s:(0,U.not)(s);function i(a=U.nil){return(0,U.and)((0,U._)`typeof ${e} == "number"`,a,r?(0,U._)`isFinite(${e})`:U.nil)}}Oe.checkDataType=Lu;function Uu(t,e,r,n){if(t.length===1)return Lu(t[0],e,r,n);let o,s=(0,Zm.toHash)(t);if(s.array&&s.object){let i=(0,U._)`typeof ${e} != "object"`;o=s.null?i:(0,U._)`!${e} || ${i}`,delete s.null,delete s.array,delete s.object}else o=U.nil;s.number&&delete s.integer;for(let i in s)o=(0,U.and)(o,Lu(i,e,r,n));return o}Oe.checkDataTypes=Uu;var Kw={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,U._)`{type: ${t}}`:(0,U._)`{type: ${e}}`};function Vu(t){let e=Hw(t);(0,Dw.reportError)(e,Kw)}Oe.reportTypeError=Vu;function Hw(t){let{gen:e,data:r,schema:n}=t,o=(0,Zm.schemaRefOrVal)(t,n,"type");return{gen:e,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:t}}});var Lm=T(Ls=>{"use strict";Object.defineProperty(Ls,"__esModule",{value:!0});Ls.assignDefaults=void 0;var un=F(),Bw=ee();function Jw(t,e){let{properties:r,items:n}=t.schema;if(e==="object"&&r)for(let o in r)qm(t,o,r[o].default);else e==="array"&&Array.isArray(n)&&n.forEach((o,s)=>qm(t,s,o.default))}Ls.assignDefaults=Jw;function qm(t,e,r){let{gen:n,compositeRule:o,data:s,opts:i}=t;if(r===void 0)return;let a=(0,un._)`${s}${(0,un.getProperty)(e)}`;if(o){(0,Bw.checkStrictMode)(t,`default is ignored for: ${a}`);return}let c=(0,un._)`${a} === undefined`;i.useDefaults==="empty"&&(c=(0,un._)`${c} || ${a} === null || ${a} === ""`),n.if(c,(0,un._)`${a} = ${(0,un.stringify)(r)}`)}});var ot=T(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.validateUnion=oe.validateArray=oe.usePattern=oe.callValidateCode=oe.schemaProperties=oe.allSchemaProperties=oe.noPropertyInData=oe.propertyInData=oe.isOwnProperty=oe.hasPropFunc=oe.reportMissingProp=oe.checkMissingProp=oe.checkReportMissingProp=void 0;var ue=F(),Fu=ee(),Qt=At(),Gw=ee();function Ww(t,e){let{gen:r,data:n,it:o}=t;r.if(Hu(r,n,e,o.opts.ownProperties),()=>{t.setParams({missingProperty:(0,ue._)`${e}`},!0),t.error()})}oe.checkReportMissingProp=Ww;function Xw({gen:t,data:e,it:{opts:r}},n,o){return(0,ue.or)(...n.map(s=>(0,ue.and)(Hu(t,e,s,r.ownProperties),(0,ue._)`${o} = ${s}`)))}oe.checkMissingProp=Xw;function Yw(t,e){t.setParams({missingProperty:e},!0),t.error()}oe.reportMissingProp=Yw;function Um(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,ue._)`Object.prototype.hasOwnProperty`})}oe.hasPropFunc=Um;function Ku(t,e,r){return(0,ue._)`${Um(t)}.call(${e}, ${r})`}oe.isOwnProperty=Ku;function Qw(t,e,r,n){let o=(0,ue._)`${e}${(0,ue.getProperty)(r)} !== undefined`;return n?(0,ue._)`${o} && ${Ku(t,e,r)}`:o}oe.propertyInData=Qw;function Hu(t,e,r,n){let o=(0,ue._)`${e}${(0,ue.getProperty)(r)} === undefined`;return n?(0,ue.or)(o,(0,ue.not)(Ku(t,e,r))):o}oe.noPropertyInData=Hu;function Vm(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}oe.allSchemaProperties=Vm;function e0(t,e){return Vm(e).filter(r=>!(0,Fu.alwaysValidSchema)(t,e[r]))}oe.schemaProperties=e0;function t0({schemaCode:t,data:e,it:{gen:r,topSchemaRef:n,schemaPath:o,errorPath:s},it:i},a,c,u){let l=u?(0,ue._)`${t}, ${e}, ${n}${o}`:e,d=[[Qt.default.instancePath,(0,ue.strConcat)(Qt.default.instancePath,s)],[Qt.default.parentData,i.parentData],[Qt.default.parentDataProperty,i.parentDataProperty],[Qt.default.rootData,Qt.default.rootData]];i.opts.dynamicRef&&d.push([Qt.default.dynamicAnchors,Qt.default.dynamicAnchors]);let f=(0,ue._)`${l}, ${r.object(...d)}`;return c!==ue.nil?(0,ue._)`${a}.call(${c}, ${f})`:(0,ue._)`${a}(${f})`}oe.callValidateCode=t0;var r0=(0,ue._)`new RegExp`;function n0({gen:t,it:{opts:e}},r){let n=e.unicodeRegExp?"u":"",{regExp:o}=e.code,s=o(r,n);return t.scopeValue("pattern",{key:s.toString(),ref:s,code:(0,ue._)`${o.code==="new RegExp"?r0:(0,Gw.useFunc)(t,o)}(${r}, ${n})`})}oe.usePattern=n0;function o0(t){let{gen:e,data:r,keyword:n,it:o}=t,s=e.name("valid");if(o.allErrors){let a=e.let("valid",!0);return i(()=>e.assign(a,!1)),a}return e.var(s,!0),i(()=>e.break()),s;function i(a){let c=e.const("len",(0,ue._)`${r}.length`);e.forRange("i",0,c,u=>{t.subschema({keyword:n,dataProp:u,dataPropType:Fu.Type.Num},s),e.if((0,ue.not)(s),a)})}}oe.validateArray=o0;function s0(t){let{gen:e,schema:r,keyword:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(c=>(0,Fu.alwaysValidSchema)(o,c))&&!o.opts.unevaluated)return;let i=e.let("valid",!1),a=e.name("_valid");e.block(()=>r.forEach((c,u)=>{let l=t.subschema({keyword:n,schemaProp:u,compositeRule:!0},a);e.assign(i,(0,ue._)`${i} || ${a}`),t.mergeValidEvaluated(l,a)||e.if((0,ue.not)(i))})),t.result(i,()=>t.reset(),()=>t.error(!0))}oe.validateUnion=s0});var Hm=T(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.validateKeywordUsage=bt.validSchemaType=bt.funcKeywordCode=bt.macroKeywordCode=void 0;var Me=F(),Or=At(),i0=ot(),a0=io();function c0(t,e){let{gen:r,keyword:n,schema:o,parentSchema:s,it:i}=t,a=e.macro.call(i.self,o,s,i),c=Km(r,n,a);i.opts.validateSchema!==!1&&i.self.validateSchema(a,!0);let u=r.name("valid");t.subschema({schema:a,schemaPath:Me.nil,errSchemaPath:`${i.errSchemaPath}/${n}`,topSchemaRef:c,compositeRule:!0},u),t.pass(u,()=>t.error(!0))}bt.macroKeywordCode=c0;function u0(t,e){var r;let{gen:n,keyword:o,schema:s,parentSchema:i,$data:a,it:c}=t;d0(c,e);let u=!a&&e.compile?e.compile.call(c.self,s,i,c):e.validate,l=Km(n,o,u),d=n.let("valid");t.block$data(d,f),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function f(){if(e.errors===!1)h(),e.modifying&&Fm(t),g(()=>t.error());else{let _=e.async?m():p();e.modifying&&Fm(t),g(()=>l0(t,_))}}function m(){let _=n.let("ruleErrs",null);return n.try(()=>h((0,Me._)`await `),x=>n.assign(d,!1).if((0,Me._)`${x} instanceof ${c.ValidationError}`,()=>n.assign(_,(0,Me._)`${x}.errors`),()=>n.throw(x))),_}function p(){let _=(0,Me._)`${l}.errors`;return n.assign(_,null),h(Me.nil),_}function h(_=e.async?(0,Me._)`await `:Me.nil){let x=c.opts.passContext?Or.default.this:Or.default.self,b=!("compile"in e&&!a||e.schema===!1);n.assign(d,(0,Me._)`${_}${(0,i0.callValidateCode)(t,l,x,b)}`,e.modifying)}function g(_){var x;n.if((0,Me.not)((x=e.valid)!==null&&x!==void 0?x:d),_)}}bt.funcKeywordCode=u0;function Fm(t){let{gen:e,data:r,it:n}=t;e.if(n.parentData,()=>e.assign(r,(0,Me._)`${n.parentData}[${n.parentDataProperty}]`))}function l0(t,e){let{gen:r}=t;r.if((0,Me._)`Array.isArray(${e})`,()=>{r.assign(Or.default.vErrors,(0,Me._)`${Or.default.vErrors} === null ? ${e} : ${Or.default.vErrors}.concat(${e})`).assign(Or.default.errors,(0,Me._)`${Or.default.vErrors}.length`),(0,a0.extendErrors)(t)},()=>t.error())}function d0({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function Km(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,Me.stringify)(r)})}function p0(t,e,r=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(t):n==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==n||r&&typeof t>"u")}bt.validSchemaType=p0;function f0({schema:t,opts:e,self:r,errSchemaPath:n},o,s){if(Array.isArray(o.keyword)?!o.keyword.includes(s):o.keyword!==s)throw new Error("ajv implementation error");let i=o.dependencies;if(i?.some(a=>!Object.prototype.hasOwnProperty.call(t,a)))throw new Error(`parent schema must have dependencies of ${s}: ${i.join(",")}`);if(o.validateSchema&&!o.validateSchema(t[s])){let c=`keyword "${s}" value is invalid at path "${n}": `+r.errorsText(o.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(c);else throw new Error(c)}}bt.validateKeywordUsage=f0});var Jm=T(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.extendSubschemaMode=er.extendSubschemaData=er.getSubschema=void 0;var $t=F(),Bm=ee();function m0(t,{keyword:e,schemaProp:r,schema:n,schemaPath:o,errSchemaPath:s,topSchemaRef:i}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){let a=t.schema[e];return r===void 0?{schema:a,schemaPath:(0,$t._)`${t.schemaPath}${(0,$t.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:a[r],schemaPath:(0,$t._)`${t.schemaPath}${(0,$t.getProperty)(e)}${(0,$t.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,Bm.escapeFragment)(r)}`}}if(n!==void 0){if(o===void 0||s===void 0||i===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:o,topSchemaRef:i,errSchemaPath:s}}throw new Error('either "keyword" or "schema" must be passed')}er.getSubschema=m0;function h0(t,e,{dataProp:r,dataPropType:n,data:o,dataTypes:s,propertyName:i}){if(o!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=e;if(r!==void 0){let{errorPath:u,dataPathArr:l,opts:d}=e,f=a.let("data",(0,$t._)`${e.data}${(0,$t.getProperty)(r)}`,!0);c(f),t.errorPath=(0,$t.str)`${u}${(0,Bm.getErrorPath)(r,n,d.jsPropertySyntax)}`,t.parentDataProperty=(0,$t._)`${r}`,t.dataPathArr=[...l,t.parentDataProperty]}if(o!==void 0){let u=o instanceof $t.Name?o:a.let("data",o,!0);c(u),i!==void 0&&(t.propertyName=i)}s&&(t.dataTypes=s);function c(u){t.data=u,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,u]}}er.extendSubschemaData=h0;function g0(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:n,createErrors:o,allErrors:s}){n!==void 0&&(t.compositeRule=n),o!==void 0&&(t.createErrors=o),s!==void 0&&(t.allErrors=s),t.jtdDiscriminator=e,t.jtdMetadata=r}er.extendSubschemaMode=g0});var Bu=T((Wj,Gm)=>{"use strict";Gm.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,o,s;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(o=n;o--!==0;)if(!t(e[o],r[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(r).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(r,s[o]))return!1;for(o=n;o--!==0;){var i=s[o];if(!t(e[i],r[i]))return!1}return!0}return e!==e&&r!==r}});var Xm=T((Xj,Wm)=>{"use strict";var tr=Wm.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var n=typeof r=="function"?r:r.pre||function(){},o=r.post||function(){};Us(e,n,o,t,"",t)};tr.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};tr.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};tr.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};tr.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function Us(t,e,r,n,o,s,i,a,c,u){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,o,s,i,a,c,u);for(var l in n){var d=n[l];if(Array.isArray(d)){if(l in tr.arrayKeywords)for(var f=0;f<d.length;f++)Us(t,e,r,d[f],o+"/"+l+"/"+f,s,o,l,n,f)}else if(l in tr.propsKeywords){if(d&&typeof d=="object")for(var m in d)Us(t,e,r,d[m],o+"/"+l+"/"+y0(m),s,o,l,n,m)}else(l in tr.keywords||t.allKeys&&!(l in tr.skipKeywords))&&Us(t,e,r,d,o+"/"+l,s,o,l,n)}r(n,o,s,i,a,c,u)}}function y0(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}});var co=T(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.getSchemaRefs=He.resolveUrl=He.normalizeId=He._getFullPath=He.getFullPath=He.inlineRef=void 0;var _0=ee(),v0=Bu(),x0=Xm(),b0=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function $0(t,e=!0){return typeof t=="boolean"?!0:e===!0?!Ju(t):e?Ym(t)<=e:!1}He.inlineRef=$0;var w0=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function Ju(t){for(let e in t){if(w0.has(e))return!0;let r=t[e];if(Array.isArray(r)&&r.some(Ju)||typeof r=="object"&&Ju(r))return!0}return!1}function Ym(t){let e=0;for(let r in t){if(r==="$ref")return 1/0;if(e++,!b0.has(r)&&(typeof t[r]=="object"&&(0,_0.eachItem)(t[r],n=>e+=Ym(n)),e===1/0))return 1/0}return e}function Qm(t,e="",r){r!==!1&&(e=ln(e));let n=t.parse(e);return eh(t,n)}He.getFullPath=Qm;function eh(t,e){return t.serialize(e).split("#")[0]+"#"}He._getFullPath=eh;var k0=/#\/?$/;function ln(t){return t?t.replace(k0,""):""}He.normalizeId=ln;function S0(t,e,r){return r=ln(r),t.resolve(e,r)}He.resolveUrl=S0;var T0=/^[a-z_][-a-z0-9._]*$/i;function P0(t,e){if(typeof t=="boolean")return{};let{schemaId:r,uriResolver:n}=this.opts,o=ln(t[r]||e),s={"":o},i=Qm(n,o,!1),a={},c=new Set;return x0(t,{allKeys:!0},(d,f,m,p)=>{if(p===void 0)return;let h=i+f,g=s[p];typeof d[r]=="string"&&(g=_.call(this,d[r])),x.call(this,d.$anchor),x.call(this,d.$dynamicAnchor),s[f]=g;function _(b){let k=this.opts.uriResolver.resolve;if(b=ln(g?k(g,b):b),c.has(b))throw l(b);c.add(b);let I=this.refs[b];return typeof I=="string"&&(I=this.refs[I]),typeof I=="object"?u(d,I.schema,b):b!==ln(h)&&(b[0]==="#"?(u(d,a[b],b),a[b]=d):this.refs[b]=h),b}function x(b){if(typeof b=="string"){if(!T0.test(b))throw new Error(`invalid anchor "${b}"`);_.call(this,`#${b}`)}}}),a;function u(d,f,m){if(f!==void 0&&!v0(d,f))throw l(m)}function l(d){return new Error(`reference "${d}" resolves to more than one schema`)}}He.getSchemaRefs=P0});var po=T(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});rr.getData=rr.KeywordCxt=rr.validateFunctionCode=void 0;var sh=Om(),th=ao(),Wu=qu(),Vs=ao(),z0=Lm(),lo=Hm(),Gu=Jm(),O=F(),q=At(),E0=co(),Nt=ee(),uo=io();function I0(t){if(ch(t)&&(uh(t),ah(t))){j0(t);return}ih(t,()=>(0,sh.topBoolOrEmptySchema)(t))}rr.validateFunctionCode=I0;function ih({gen:t,validateName:e,schema:r,schemaEnv:n,opts:o},s){o.code.es5?t.func(e,(0,O._)`${q.default.data}, ${q.default.valCxt}`,n.$async,()=>{t.code((0,O._)`"use strict"; ${rh(r,o)}`),C0(t,o),t.code(s)}):t.func(e,(0,O._)`${q.default.data}, ${R0(o)}`,n.$async,()=>t.code(rh(r,o)).code(s))}function R0(t){return(0,O._)`{${q.default.instancePath}="", ${q.default.parentData}, ${q.default.parentDataProperty}, ${q.default.rootData}=${q.default.data}${t.dynamicRef?(0,O._)`, ${q.default.dynamicAnchors}={}`:O.nil}}={}`}function C0(t,e){t.if(q.default.valCxt,()=>{t.var(q.default.instancePath,(0,O._)`${q.default.valCxt}.${q.default.instancePath}`),t.var(q.default.parentData,(0,O._)`${q.default.valCxt}.${q.default.parentData}`),t.var(q.default.parentDataProperty,(0,O._)`${q.default.valCxt}.${q.default.parentDataProperty}`),t.var(q.default.rootData,(0,O._)`${q.default.valCxt}.${q.default.rootData}`),e.dynamicRef&&t.var(q.default.dynamicAnchors,(0,O._)`${q.default.valCxt}.${q.default.dynamicAnchors}`)},()=>{t.var(q.default.instancePath,(0,O._)`""`),t.var(q.default.parentData,(0,O._)`undefined`),t.var(q.default.parentDataProperty,(0,O._)`undefined`),t.var(q.default.rootData,q.default.data),e.dynamicRef&&t.var(q.default.dynamicAnchors,(0,O._)`{}`)})}function j0(t){let{schema:e,opts:r,gen:n}=t;ih(t,()=>{r.$comment&&e.$comment&&dh(t),M0(t),n.let(q.default.vErrors,null),n.let(q.default.errors,0),r.unevaluated&&O0(t),lh(t),L0(t)})}function O0(t){let{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,O._)`${r}.evaluated`),e.if((0,O._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,O._)`${t.evaluated}.props`,(0,O._)`undefined`)),e.if((0,O._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,O._)`${t.evaluated}.items`,(0,O._)`undefined`))}function rh(t,e){let r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,O._)`/*# sourceURL=${r} */`:O.nil}function A0(t,e){if(ch(t)&&(uh(t),ah(t))){N0(t,e);return}(0,sh.boolOrEmptySchema)(t,e)}function ah({schema:t,self:e}){if(typeof t=="boolean")return!t;for(let r in t)if(e.RULES.all[r])return!0;return!1}function ch(t){return typeof t.schema!="boolean"}function N0(t,e){let{schema:r,gen:n,opts:o}=t;o.$comment&&r.$comment&&dh(t),D0(t),q0(t);let s=n.const("_errs",q.default.errors);lh(t,s),n.var(e,(0,O._)`${s} === ${q.default.errors}`)}function uh(t){(0,Nt.checkUnknownRules)(t),Z0(t)}function lh(t,e){if(t.opts.jtd)return nh(t,[],!1,e);let r=(0,th.getSchemaTypes)(t.schema),n=(0,th.coerceAndCheckDataType)(t,r);nh(t,r,!n,e)}function Z0(t){let{schema:e,errSchemaPath:r,opts:n,self:o}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,Nt.schemaHasRulesButRef)(e,o.RULES)&&o.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function M0(t){let{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,Nt.checkStrictMode)(t,"default is ignored in the schema root")}function D0(t){let e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,E0.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function q0(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function dh({gen:t,schemaEnv:e,schema:r,errSchemaPath:n,opts:o}){let s=r.$comment;if(o.$comment===!0)t.code((0,O._)`${q.default.self}.logger.log(${s})`);else if(typeof o.$comment=="function"){let i=(0,O.str)`${n}/$comment`,a=t.scopeValue("root",{ref:e.root});t.code((0,O._)`${q.default.self}.opts.$comment(${s}, ${i}, ${a}.schema)`)}}function L0(t){let{gen:e,schemaEnv:r,validateName:n,ValidationError:o,opts:s}=t;r.$async?e.if((0,O._)`${q.default.errors} === 0`,()=>e.return(q.default.data),()=>e.throw((0,O._)`new ${o}(${q.default.vErrors})`)):(e.assign((0,O._)`${n}.errors`,q.default.vErrors),s.unevaluated&&U0(t),e.return((0,O._)`${q.default.errors} === 0`))}function U0({gen:t,evaluated:e,props:r,items:n}){r instanceof O.Name&&t.assign((0,O._)`${e}.props`,r),n instanceof O.Name&&t.assign((0,O._)`${e}.items`,n)}function nh(t,e,r,n){let{gen:o,schema:s,data:i,allErrors:a,opts:c,self:u}=t,{RULES:l}=u;if(s.$ref&&(c.ignoreKeywordsWithRef||!(0,Nt.schemaHasRulesButRef)(s,l))){o.block(()=>fh(t,"$ref",l.all.$ref.definition));return}c.jtd||V0(t,e),o.block(()=>{for(let f of l.rules)d(f);d(l.post)});function d(f){(0,Wu.shouldUseGroup)(s,f)&&(f.type?(o.if((0,Vs.checkDataType)(f.type,i,c.strictNumbers)),oh(t,f),e.length===1&&e[0]===f.type&&r&&(o.else(),(0,Vs.reportTypeError)(t)),o.endIf()):oh(t,f),a||o.if((0,O._)`${q.default.errors} === ${n||0}`))}}function oh(t,e){let{gen:r,schema:n,opts:{useDefaults:o}}=t;o&&(0,z0.assignDefaults)(t,e.type),r.block(()=>{for(let s of e.rules)(0,Wu.shouldUseRule)(n,s)&&fh(t,s.keyword,s.definition,e.type)})}function V0(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(F0(t,e),t.opts.allowUnionTypes||K0(t,e),H0(t,t.dataTypes))}function F0(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{ph(t.dataTypes,r)||Xu(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),J0(t,e)}}function K0(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&Xu(t,"use allowUnionTypes to allow union type keyword")}function H0(t,e){let r=t.self.RULES.all;for(let n in r){let o=r[n];if(typeof o=="object"&&(0,Wu.shouldUseRule)(t.schema,o)){let{type:s}=o.definition;s.length&&!s.some(i=>B0(e,i))&&Xu(t,`missing type "${s.join(",")}" for keyword "${n}"`)}}}function B0(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function ph(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function J0(t,e){let r=[];for(let n of t.dataTypes)ph(e,n)?r.push(n):e.includes("integer")&&n==="number"&&r.push("integer");t.dataTypes=r}function Xu(t,e){let r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,Nt.checkStrictMode)(t,e,t.opts.strictTypes)}var Fs=class{constructor(e,r,n){if((0,lo.validateKeywordUsage)(e,r,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Nt.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",mh(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,lo.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",q.default.errors))}result(e,r,n){this.failResult((0,O.not)(e),r,n)}failResult(e,r,n){this.gen.if(e),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,O.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:r}=this;this.fail((0,O._)`${r} !== undefined && (${(0,O.or)(this.invalid$data(),e)})`)}error(e,r,n){if(r){this.setParams(r),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,r){(e?uo.reportExtraError:uo.reportError)(this,this.def.error,r)}$dataError(){(0,uo.reportError)(this,this.def.$dataError||uo.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,uo.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,n=O.nil){this.gen.block(()=>{this.check$data(e,n),r()})}check$data(e=O.nil,r=O.nil){if(!this.$data)return;let{gen:n,schemaCode:o,schemaType:s,def:i}=this;n.if((0,O.or)((0,O._)`${o} === undefined`,r)),e!==O.nil&&n.assign(e,!0),(s.length||i.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==O.nil&&n.assign(e,!1)),n.else()}invalid$data(){let{gen:e,schemaCode:r,schemaType:n,def:o,it:s}=this;return(0,O.or)(i(),a());function i(){if(n.length){if(!(r instanceof O.Name))throw new Error("ajv implementation error");let c=Array.isArray(n)?n:[n];return(0,O._)`${(0,Vs.checkDataTypes)(c,r,s.opts.strictNumbers,Vs.DataType.Wrong)}`}return O.nil}function a(){if(o.validateSchema){let c=e.scopeValue("validate$data",{ref:o.validateSchema});return(0,O._)`!${c}(${r})`}return O.nil}}subschema(e,r){let n=(0,Gu.getSubschema)(this.it,e);(0,Gu.extendSubschemaData)(n,this.it,e),(0,Gu.extendSubschemaMode)(n,e);let o={...this.it,...n,items:void 0,props:void 0};return A0(o,r),o}mergeEvaluated(e,r){let{it:n,gen:o}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=Nt.mergeEvaluated.props(o,e.props,n.props,r)),n.items!==!0&&e.items!==void 0&&(n.items=Nt.mergeEvaluated.items(o,e.items,n.items,r)))}mergeValidEvaluated(e,r){let{it:n,gen:o}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return o.if(r,()=>this.mergeEvaluated(e,O.Name)),!0}};rr.KeywordCxt=Fs;function fh(t,e,r,n){let o=new Fs(t,r,e);"code"in r?r.code(o,n):o.$data&&r.validate?(0,lo.funcKeywordCode)(o,r):"macro"in r?(0,lo.macroKeywordCode)(o,r):(r.compile||r.validate)&&(0,lo.funcKeywordCode)(o,r)}var G0=/^\/(?:[^~]|~0|~1)*$/,W0=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function mh(t,{dataLevel:e,dataNames:r,dataPathArr:n}){let o,s;if(t==="")return q.default.rootData;if(t[0]==="/"){if(!G0.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);o=t,s=q.default.rootData}else{let u=W0.exec(t);if(!u)throw new Error(`Invalid JSON-pointer: ${t}`);let l=+u[1];if(o=u[2],o==="#"){if(l>=e)throw new Error(c("property/index",l));return n[e-l]}if(l>e)throw new Error(c("data",l));if(s=r[e-l],!o)return s}let i=s,a=o.split("/");for(let u of a)u&&(s=(0,O._)`${s}${(0,O.getProperty)((0,Nt.unescapeJsonPointer)(u))}`,i=(0,O._)`${i} && ${s}`);return i;function c(u,l){return`Cannot access ${u} ${l} levels up, current level is ${e}`}}rr.getData=mh});var Ks=T(Qu=>{"use strict";Object.defineProperty(Qu,"__esModule",{value:!0});var Yu=class extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}};Qu.default=Yu});var fo=T(rl=>{"use strict";Object.defineProperty(rl,"__esModule",{value:!0});var el=co(),tl=class extends Error{constructor(e,r,n,o){super(o||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,el.resolveUrl)(e,r,n),this.missingSchema=(0,el.normalizeId)((0,el.getFullPath)(e,this.missingRef))}};rl.default=tl});var Bs=T(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});st.resolveSchema=st.getCompilingSchema=st.resolveRef=st.compileSchema=st.SchemaEnv=void 0;var ft=F(),X0=Ks(),Ar=At(),mt=co(),hh=ee(),Y0=po(),dn=class{constructor(e){var r;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,mt.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}};st.SchemaEnv=dn;function ol(t){let e=gh.call(this,t);if(e)return e;let r=(0,mt.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:o}=this.opts.code,{ownProperties:s}=this.opts,i=new ft.CodeGen(this.scope,{es5:n,lines:o,ownProperties:s}),a;t.$async&&(a=i.scopeValue("Error",{ref:X0.default,code:(0,ft._)`require("ajv/dist/runtime/validation_error").default`}));let c=i.scopeName("validate");t.validateName=c;let u={gen:i,allErrors:this.opts.allErrors,data:Ar.default.data,parentData:Ar.default.parentData,parentDataProperty:Ar.default.parentDataProperty,dataNames:[Ar.default.data],dataPathArr:[ft.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:i.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,ft.stringify)(t.schema)}:{ref:t.schema}),validateName:c,ValidationError:a,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:ft.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,ft._)`""`,opts:this.opts,self:this},l;try{this._compilations.add(t),(0,Y0.validateFunctionCode)(u),i.optimize(this.opts.code.optimize);let d=i.toString();l=`${i.scopeRefs(Ar.default.scope)}return ${d}`,this.opts.code.process&&(l=this.opts.code.process(l,t));let m=new Function(`${Ar.default.self}`,`${Ar.default.scope}`,l)(this,this.scope.get());if(this.scope.value(c,{ref:m}),m.errors=null,m.schema=t.schema,m.schemaEnv=t,t.$async&&(m.$async=!0),this.opts.code.source===!0&&(m.source={validateName:c,validateCode:d,scopeValues:i._values}),this.opts.unevaluated){let{props:p,items:h}=u;m.evaluated={props:p instanceof ft.Name?void 0:p,items:h instanceof ft.Name?void 0:h,dynamicProps:p instanceof ft.Name,dynamicItems:h instanceof ft.Name},m.source&&(m.source.evaluated=(0,ft.stringify)(m.evaluated))}return t.validate=m,t}catch(d){throw delete t.validate,delete t.validateName,l&&this.logger.error("Error compiling schema, function code:",l),d}finally{this._compilations.delete(t)}}st.compileSchema=ol;function Q0(t,e,r){var n;r=(0,mt.resolveUrl)(this.opts.uriResolver,e,r);let o=t.refs[r];if(o)return o;let s=rk.call(this,t,r);if(s===void 0){let i=(n=t.localRefs)===null||n===void 0?void 0:n[r],{schemaId:a}=this.opts;i&&(s=new dn({schema:i,schemaId:a,root:t,baseId:e}))}if(s!==void 0)return t.refs[r]=ek.call(this,s)}st.resolveRef=Q0;function ek(t){return(0,mt.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:ol.call(this,t)}function gh(t){for(let e of this._compilations)if(tk(e,t))return e}st.getCompilingSchema=gh;function tk(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function rk(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||Hs.call(this,t,e)}function Hs(t,e){let r=this.opts.uriResolver.parse(e),n=(0,mt._getFullPath)(this.opts.uriResolver,r),o=(0,mt.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===o)return nl.call(this,r,t);let s=(0,mt.normalizeId)(n),i=this.refs[s]||this.schemas[s];if(typeof i=="string"){let a=Hs.call(this,t,i);return typeof a?.schema!="object"?void 0:nl.call(this,r,a)}if(typeof i?.schema=="object"){if(i.validate||ol.call(this,i),s===(0,mt.normalizeId)(e)){let{schema:a}=i,{schemaId:c}=this.opts,u=a[c];return u&&(o=(0,mt.resolveUrl)(this.opts.uriResolver,o,u)),new dn({schema:a,schemaId:c,root:t,baseId:o})}return nl.call(this,r,i)}}st.resolveSchema=Hs;var nk=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function nl(t,{baseId:e,schema:r,root:n}){var o;if(((o=t.fragment)===null||o===void 0?void 0:o[0])!=="/")return;for(let a of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let c=r[(0,hh.unescapeFragment)(a)];if(c===void 0)return;r=c;let u=typeof r=="object"&&r[this.opts.schemaId];!nk.has(a)&&u&&(e=(0,mt.resolveUrl)(this.opts.uriResolver,e,u))}let s;if(typeof r!="boolean"&&r.$ref&&!(0,hh.schemaHasRulesButRef)(r,this.RULES)){let a=(0,mt.resolveUrl)(this.opts.uriResolver,e,r.$ref);s=Hs.call(this,n,a)}let{schemaId:i}=this.opts;if(s=s||new dn({schema:r,schemaId:i,root:n,baseId:e}),s.schema!==s.root.schema)return s}});var yh=T((nO,ok)=>{ok.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var il=T((oO,bh)=>{"use strict";var sk=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),vh=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function sl(t){let e="",r=0,n=0;for(n=0;n<t.length;n++)if(r=t[n].charCodeAt(0),r!==48){if(!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n];break}for(n+=1;n<t.length;n++){if(r=t[n].charCodeAt(0),!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n]}return e}var ik=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function _h(t){return t.length=0,!0}function ak(t,e,r){if(t.length){let n=sl(t);if(n!=="")e.push(n);else return r.error=!0,!1;t.length=0}return!0}function ck(t){let e=0,r={error:!1,address:"",zone:""},n=[],o=[],s=!1,i=!1,a=ak;for(let c=0;c<t.length;c++){let u=t[c];if(!(u==="["||u==="]"))if(u===":"){if(s===!0&&(i=!0),!a(o,n,r))break;if(++e>7){r.error=!0;break}c>0&&t[c-1]===":"&&(s=!0),n.push(":");continue}else if(u==="%"){if(!a(o,n,r))break;a=_h}else{o.push(u);continue}}return o.length&&(a===_h?r.zone=o.join(""):i?n.push(o.join("")):n.push(sl(o))),r.address=n.join(""),r}function xh(t){if(uk(t,":")<2)return{host:t,isIPV6:!1};let e=ck(t);if(e.error)return{host:t,isIPV6:!1};{let r=e.address,n=e.address;return e.zone&&(r+="%"+e.zone,n+="%25"+e.zone),{host:r,isIPV6:!0,escapedHost:n}}}function uk(t,e){let r=0;for(let n=0;n<t.length;n++)t[n]===e&&r++;return r}function lk(t){let e=t,r=[],n=-1,o=0;for(;o=e.length;){if(o===1){if(e===".")break;if(e==="/"){r.push("/");break}else{r.push(e);break}}else if(o===2){if(e[0]==="."){if(e[1]===".")break;if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&(e[1]==="."||e[1]==="/")){r.push("/");break}}else if(o===3&&e==="/.."){r.length!==0&&r.pop(),r.push("/");break}if(e[0]==="."){if(e[1]==="."){if(e[2]==="/"){e=e.slice(3);continue}}else if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&e[1]==="."){if(e[2]==="/"){e=e.slice(2);continue}else if(e[2]==="."&&e[3]==="/"){e=e.slice(3),r.length!==0&&r.pop();continue}}if((n=e.indexOf("/",1))===-1){r.push(e);break}else r.push(e.slice(0,n)),e=e.slice(n)}return r.join("")}function dk(t,e){let r=e!==!0?escape:unescape;return t.scheme!==void 0&&(t.scheme=r(t.scheme)),t.userinfo!==void 0&&(t.userinfo=r(t.userinfo)),t.host!==void 0&&(t.host=r(t.host)),t.path!==void 0&&(t.path=r(t.path)),t.query!==void 0&&(t.query=r(t.query)),t.fragment!==void 0&&(t.fragment=r(t.fragment)),t}function pk(t){let e=[];if(t.userinfo!==void 0&&(e.push(t.userinfo),e.push("@")),t.host!==void 0){let r=unescape(t.host);if(!vh(r)){let n=xh(r);n.isIPV6===!0?r=`[${n.escapedHost}]`:r=t.host}e.push(r)}return(typeof t.port=="number"||typeof t.port=="string")&&(e.push(":"),e.push(String(t.port))),e.length?e.join(""):void 0}bh.exports={nonSimpleDomain:ik,recomposeAuthority:pk,normalizeComponentEncoding:dk,removeDotSegments:lk,isIPv4:vh,isUUID:sk,normalizeIPv6:xh,stringArrayToHexStripped:sl}});var Th=T((sO,Sh)=>{"use strict";var{isUUID:fk}=il(),mk=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,hk=["http","https","ws","wss","urn","urn:uuid"];function gk(t){return hk.indexOf(t)!==-1}function al(t){return t.secure===!0?!0:t.secure===!1?!1:t.scheme?t.scheme.length===3&&(t.scheme[0]==="w"||t.scheme[0]==="W")&&(t.scheme[1]==="s"||t.scheme[1]==="S")&&(t.scheme[2]==="s"||t.scheme[2]==="S"):!1}function $h(t){return t.host||(t.error=t.error||"HTTP URIs must have a host."),t}function wh(t){let e=String(t.scheme).toLowerCase()==="https";return(t.port===(e?443:80)||t.port==="")&&(t.port=void 0),t.path||(t.path="/"),t}function yk(t){return t.secure=al(t),t.resourceName=(t.path||"/")+(t.query?"?"+t.query:""),t.path=void 0,t.query=void 0,t}function _k(t){if((t.port===(al(t)?443:80)||t.port==="")&&(t.port=void 0),typeof t.secure=="boolean"&&(t.scheme=t.secure?"wss":"ws",t.secure=void 0),t.resourceName){let[e,r]=t.resourceName.split("?");t.path=e&&e!=="/"?e:void 0,t.query=r,t.resourceName=void 0}return t.fragment=void 0,t}function vk(t,e){if(!t.path)return t.error="URN can not be parsed",t;let r=t.path.match(mk);if(r){let n=e.scheme||t.scheme||"urn";t.nid=r[1].toLowerCase(),t.nss=r[2];let o=`${n}:${e.nid||t.nid}`,s=cl(o);t.path=void 0,s&&(t=s.parse(t,e))}else t.error=t.error||"URN can not be parsed.";return t}function xk(t,e){if(t.nid===void 0)throw new Error("URN without nid cannot be serialized");let r=e.scheme||t.scheme||"urn",n=t.nid.toLowerCase(),o=`${r}:${e.nid||n}`,s=cl(o);s&&(t=s.serialize(t,e));let i=t,a=t.nss;return i.path=`${n||e.nid}:${a}`,e.skipEscape=!0,i}function bk(t,e){let r=t;return r.uuid=r.nss,r.nss=void 0,!e.tolerant&&(!r.uuid||!fk(r.uuid))&&(r.error=r.error||"UUID is not valid."),r}function $k(t){let e=t;return e.nss=(t.uuid||"").toLowerCase(),e}var kh={scheme:"http",domainHost:!0,parse:$h,serialize:wh},wk={scheme:"https",domainHost:kh.domainHost,parse:$h,serialize:wh},Js={scheme:"ws",domainHost:!0,parse:yk,serialize:_k},kk={scheme:"wss",domainHost:Js.domainHost,parse:Js.parse,serialize:Js.serialize},Sk={scheme:"urn",parse:vk,serialize:xk,skipNormalize:!0},Tk={scheme:"urn:uuid",parse:bk,serialize:$k,skipNormalize:!0},Gs={http:kh,https:wk,ws:Js,wss:kk,urn:Sk,"urn:uuid":Tk};Object.setPrototypeOf(Gs,null);function cl(t){return t&&(Gs[t]||Gs[t.toLowerCase()])||void 0}Sh.exports={wsIsSecure:al,SCHEMES:Gs,isValidSchemeName:gk,getSchemeHandler:cl}});var Eh=T((iO,Xs)=>{"use strict";var{normalizeIPv6:Pk,removeDotSegments:mo,recomposeAuthority:zk,normalizeComponentEncoding:Ws,isIPv4:Ek,nonSimpleDomain:Ik}=il(),{SCHEMES:Rk,getSchemeHandler:Ph}=Th();function Ck(t,e){return typeof t=="string"?t=wt(Zt(t,e),e):typeof t=="object"&&(t=Zt(wt(t,e),e)),t}function jk(t,e,r){let n=r?Object.assign({scheme:"null"},r):{scheme:"null"},o=zh(Zt(t,n),Zt(e,n),n,!0);return n.skipEscape=!0,wt(o,n)}function zh(t,e,r,n){let o={};return n||(t=Zt(wt(t,r),r),e=Zt(wt(e,r),r)),r=r||{},!r.tolerant&&e.scheme?(o.scheme=e.scheme,o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=mo(e.path||""),o.query=e.query):(e.userinfo!==void 0||e.host!==void 0||e.port!==void 0?(o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=mo(e.path||""),o.query=e.query):(e.path?(e.path[0]==="/"?o.path=mo(e.path):((t.userinfo!==void 0||t.host!==void 0||t.port!==void 0)&&!t.path?o.path="/"+e.path:t.path?o.path=t.path.slice(0,t.path.lastIndexOf("/")+1)+e.path:o.path=e.path,o.path=mo(o.path)),o.query=e.query):(o.path=t.path,e.query!==void 0?o.query=e.query:o.query=t.query),o.userinfo=t.userinfo,o.host=t.host,o.port=t.port),o.scheme=t.scheme),o.fragment=e.fragment,o}function Ok(t,e,r){return typeof t=="string"?(t=unescape(t),t=wt(Ws(Zt(t,r),!0),{...r,skipEscape:!0})):typeof t=="object"&&(t=wt(Ws(t,!0),{...r,skipEscape:!0})),typeof e=="string"?(e=unescape(e),e=wt(Ws(Zt(e,r),!0),{...r,skipEscape:!0})):typeof e=="object"&&(e=wt(Ws(e,!0),{...r,skipEscape:!0})),t.toLowerCase()===e.toLowerCase()}function wt(t,e){let r={host:t.host,scheme:t.scheme,userinfo:t.userinfo,port:t.port,path:t.path,query:t.query,nid:t.nid,nss:t.nss,uuid:t.uuid,fragment:t.fragment,reference:t.reference,resourceName:t.resourceName,secure:t.secure,error:""},n=Object.assign({},e),o=[],s=Ph(n.scheme||r.scheme);s&&s.serialize&&s.serialize(r,n),r.path!==void 0&&(n.skipEscape?r.path=unescape(r.path):(r.path=escape(r.path),r.scheme!==void 0&&(r.path=r.path.split("%3A").join(":")))),n.reference!=="suffix"&&r.scheme&&o.push(r.scheme,":");let i=zk(r);if(i!==void 0&&(n.reference!=="suffix"&&o.push("//"),o.push(i),r.path&&r.path[0]!=="/"&&o.push("/")),r.path!==void 0){let a=r.path;!n.absolutePath&&(!s||!s.absolutePath)&&(a=mo(a)),i===void 0&&a[0]==="/"&&a[1]==="/"&&(a="/%2F"+a.slice(2)),o.push(a)}return r.query!==void 0&&o.push("?",r.query),r.fragment!==void 0&&o.push("#",r.fragment),o.join("")}var Ak=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function Zt(t,e){let r=Object.assign({},e),n={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},o=!1;r.reference==="suffix"&&(r.scheme?t=r.scheme+":"+t:t="//"+t);let s=t.match(Ak);if(s){if(n.scheme=s[1],n.userinfo=s[3],n.host=s[4],n.port=parseInt(s[5],10),n.path=s[6]||"",n.query=s[7],n.fragment=s[8],isNaN(n.port)&&(n.port=s[5]),n.host)if(Ek(n.host)===!1){let c=Pk(n.host);n.host=c.host.toLowerCase(),o=c.isIPV6}else o=!0;n.scheme===void 0&&n.userinfo===void 0&&n.host===void 0&&n.port===void 0&&n.query===void 0&&!n.path?n.reference="same-document":n.scheme===void 0?n.reference="relative":n.fragment===void 0?n.reference="absolute":n.reference="uri",r.reference&&r.reference!=="suffix"&&r.reference!==n.reference&&(n.error=n.error||"URI is not a "+r.reference+" reference.");let i=Ph(r.scheme||n.scheme);if(!r.unicodeSupport&&(!i||!i.unicodeSupport)&&n.host&&(r.domainHost||i&&i.domainHost)&&o===!1&&Ik(n.host))try{n.host=URL.domainToASCII(n.host.toLowerCase())}catch(a){n.error=n.error||"Host's domain name can not be converted to ASCII: "+a}(!i||i&&!i.skipNormalize)&&(t.indexOf("%")!==-1&&(n.scheme!==void 0&&(n.scheme=unescape(n.scheme)),n.host!==void 0&&(n.host=unescape(n.host))),n.path&&(n.path=escape(unescape(n.path))),n.fragment&&(n.fragment=encodeURI(decodeURIComponent(n.fragment)))),i&&i.parse&&i.parse(n,r)}else n.error=n.error||"URI can not be parsed.";return n}var ul={SCHEMES:Rk,normalize:Ck,resolve:jk,resolveComponent:zh,equal:Ok,serialize:wt,parse:Zt};Xs.exports=ul;Xs.exports.default=ul;Xs.exports.fastUri=ul});var Rh=T(ll=>{"use strict";Object.defineProperty(ll,"__esModule",{value:!0});var Ih=Eh();Ih.code='require("ajv/dist/runtime/uri").default';ll.default=Ih});var Dh=T(ze=>{"use strict";Object.defineProperty(ze,"__esModule",{value:!0});ze.CodeGen=ze.Name=ze.nil=ze.stringify=ze.str=ze._=ze.KeywordCxt=void 0;var Nk=po();Object.defineProperty(ze,"KeywordCxt",{enumerable:!0,get:function(){return Nk.KeywordCxt}});var pn=F();Object.defineProperty(ze,"_",{enumerable:!0,get:function(){return pn._}});Object.defineProperty(ze,"str",{enumerable:!0,get:function(){return pn.str}});Object.defineProperty(ze,"stringify",{enumerable:!0,get:function(){return pn.stringify}});Object.defineProperty(ze,"nil",{enumerable:!0,get:function(){return pn.nil}});Object.defineProperty(ze,"Name",{enumerable:!0,get:function(){return pn.Name}});Object.defineProperty(ze,"CodeGen",{enumerable:!0,get:function(){return pn.CodeGen}});var Zk=Ks(),Nh=fo(),Mk=Du(),ho=Bs(),Dk=F(),go=co(),Ys=ao(),pl=ee(),Ch=yh(),qk=Rh(),Zh=(t,e)=>new RegExp(t,e);Zh.code="new RegExp";var Lk=["removeAdditional","useDefaults","coerceTypes"],Uk=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),Vk={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},Fk={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},jh=200;function Kk(t){var e,r,n,o,s,i,a,c,u,l,d,f,m,p,h,g,_,x,b,k,I,M,ve,Xe,te;let Pt=t.strict,ji=(e=t.code)===null||e===void 0?void 0:e.optimize,$d=ji===!0||ji===void 0?1:ji||0,wd=(n=(r=t.code)===null||r===void 0?void 0:r.regExp)!==null&&n!==void 0?n:Zh,Ly=(o=t.uriResolver)!==null&&o!==void 0?o:qk.default;return{strictSchema:(i=(s=t.strictSchema)!==null&&s!==void 0?s:Pt)!==null&&i!==void 0?i:!0,strictNumbers:(c=(a=t.strictNumbers)!==null&&a!==void 0?a:Pt)!==null&&c!==void 0?c:!0,strictTypes:(l=(u=t.strictTypes)!==null&&u!==void 0?u:Pt)!==null&&l!==void 0?l:"log",strictTuples:(f=(d=t.strictTuples)!==null&&d!==void 0?d:Pt)!==null&&f!==void 0?f:"log",strictRequired:(p=(m=t.strictRequired)!==null&&m!==void 0?m:Pt)!==null&&p!==void 0?p:!1,code:t.code?{...t.code,optimize:$d,regExp:wd}:{optimize:$d,regExp:wd},loopRequired:(h=t.loopRequired)!==null&&h!==void 0?h:jh,loopEnum:(g=t.loopEnum)!==null&&g!==void 0?g:jh,meta:(_=t.meta)!==null&&_!==void 0?_:!0,messages:(x=t.messages)!==null&&x!==void 0?x:!0,inlineRefs:(b=t.inlineRefs)!==null&&b!==void 0?b:!0,schemaId:(k=t.schemaId)!==null&&k!==void 0?k:"$id",addUsedSchema:(I=t.addUsedSchema)!==null&&I!==void 0?I:!0,validateSchema:(M=t.validateSchema)!==null&&M!==void 0?M:!0,validateFormats:(ve=t.validateFormats)!==null&&ve!==void 0?ve:!0,unicodeRegExp:(Xe=t.unicodeRegExp)!==null&&Xe!==void 0?Xe:!0,int32range:(te=t.int32range)!==null&&te!==void 0?te:!0,uriResolver:Ly}}var yo=class{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...Kk(e)};let{es5:r,lines:n}=this.opts.code;this.scope=new Dk.ValueScope({scope:{},prefixes:Uk,es5:r,lines:n}),this.logger=Xk(e.logger);let o=e.validateFormats;e.validateFormats=!1,this.RULES=(0,Mk.getRules)(),Oh.call(this,Vk,e,"NOT SUPPORTED"),Oh.call(this,Fk,e,"DEPRECATED","warn"),this._metaOpts=Gk.call(this),e.formats&&Bk.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&Jk.call(this,e.keywords),typeof e.meta=="object"&&this.addMetaSchema(e.meta),Hk.call(this),e.validateFormats=o}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:e,meta:r,schemaId:n}=this.opts,o=Ch;n==="id"&&(o={...Ch},o.id=o.$id,delete o.$id),r&&e&&this.addMetaSchema(o,o[n],!1)}defaultMeta(){let{meta:e,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof e=="object"?e[r]||e:void 0}validate(e,r){let n;if(typeof e=="string"){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);let o=n(r);return"$async"in n||(this.errors=n.errors),o}compile(e,r){let n=this._addSchema(e,r);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:n}=this.opts;return o.call(this,e,r);async function o(l,d){await s.call(this,l.$schema);let f=this._addSchema(l,d);return f.validate||i.call(this,f)}async function s(l){l&&!this.getSchema(l)&&await o.call(this,{$ref:l},!0)}async function i(l){try{return this._compileSchemaEnv(l)}catch(d){if(!(d instanceof Nh.default))throw d;return a.call(this,d),await c.call(this,d.missingSchema),i.call(this,l)}}function a({missingSchema:l,missingRef:d}){if(this.refs[l])throw new Error(`AnySchema ${l} is loaded but ${d} cannot be resolved`)}async function c(l){let d=await u.call(this,l);this.refs[l]||await s.call(this,d.$schema),this.refs[l]||this.addSchema(d,l,r)}async function u(l){let d=this._loading[l];if(d)return d;try{return await(this._loading[l]=n(l))}finally{delete this._loading[l]}}}addSchema(e,r,n,o=this.opts.validateSchema){if(Array.isArray(e)){for(let i of e)this.addSchema(i,void 0,n,o);return this}let s;if(typeof e=="object"){let{schemaId:i}=this.opts;if(s=e[i],s!==void 0&&typeof s!="string")throw new Error(`schema ${i} must be string`)}return r=(0,go.normalizeId)(r||s),this._checkUnique(r),this.schemas[r]=this._addSchema(e,n,r,o,!0),this}addMetaSchema(e,r,n=this.opts.validateSchema){return this.addSchema(e,r,!0,n),this}validateSchema(e,r){if(typeof e=="boolean")return!0;let n;if(n=e.$schema,n!==void 0&&typeof n!="string")throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let o=this.validate(n,e);if(!o&&r){let s="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(s);else throw new Error(s)}return o}getSchema(e){let r;for(;typeof(r=Ah.call(this,e))=="string";)e=r;if(r===void 0){let{schemaId:n}=this.opts,o=new ho.SchemaEnv({schema:{},schemaId:n});if(r=ho.resolveSchema.call(this,o,e),!r)return;this.refs[e]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=Ah.call(this,e);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{let r=e;this._cache.delete(r);let n=e[this.opts.schemaId];return n&&(n=(0,go.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(let r of e)this.addKeyword(r);return this}addKeyword(e,r){let n;if(typeof e=="string")n=e,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=n);else if(typeof e=="object"&&r===void 0){if(r=e,n=r.keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(Qk.call(this,n,r),!r)return(0,pl.eachItem)(n,s=>dl.call(this,s)),this;tS.call(this,r);let o={...r,type:(0,Ys.getJSONTypes)(r.type),schemaType:(0,Ys.getJSONTypes)(r.schemaType)};return(0,pl.eachItem)(n,o.type.length===0?s=>dl.call(this,s,o):s=>o.type.forEach(i=>dl.call(this,s,o,i))),this}getKeyword(e){let r=this.RULES.all[e];return typeof r=="object"?r.definition:!!r}removeKeyword(e){let{RULES:r}=this;delete r.keywords[e],delete r.all[e];for(let n of r.rules){let o=n.rules.findIndex(s=>s.keyword===e);o>=0&&n.rules.splice(o,1)}return this}addFormat(e,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[e]=r,this}errorsText(e=this.errors,{separator:r=", ",dataVar:n="data"}={}){return!e||e.length===0?"No errors":e.map(o=>`${n}${o.instancePath} ${o.message}`).reduce((o,s)=>o+r+s)}$dataMetaSchema(e,r){let n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(let o of r){let s=o.split("/").slice(1),i=e;for(let a of s)i=i[a];for(let a in n){let c=n[a];if(typeof c!="object")continue;let{$data:u}=c.definition,l=i[a];u&&l&&(i[a]=Mh(l))}}return e}_removeAllSchemas(e,r){for(let n in e){let o=e[n];(!r||r.test(n))&&(typeof o=="string"?delete e[n]:o&&!o.meta&&(this._cache.delete(o.schema),delete e[n]))}}_addSchema(e,r,n,o=this.opts.validateSchema,s=this.opts.addUsedSchema){let i,{schemaId:a}=this.opts;if(typeof e=="object")i=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof e!="boolean")throw new Error("schema must be object or boolean")}let c=this._cache.get(e);if(c!==void 0)return c;n=(0,go.normalizeId)(i||n);let u=go.getSchemaRefs.call(this,e,n);return c=new ho.SchemaEnv({schema:e,schemaId:a,meta:r,baseId:n,localRefs:u}),this._cache.set(c.schema,c),s&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=c),o&&this.validateSchema(e,!0),c}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):ho.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){let r=this.opts;this.opts=this._metaOpts;try{ho.compileSchema.call(this,e)}finally{this.opts=r}}};yo.ValidationError=Zk.default;yo.MissingRefError=Nh.default;ze.default=yo;function Oh(t,e,r,n="error"){for(let o in t){let s=o;s in e&&this.logger[n](`${r}: option ${o}. ${t[s]}`)}}function Ah(t){return t=(0,go.normalizeId)(t),this.schemas[t]||this.refs[t]}function Hk(){let t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(let e in t)this.addSchema(t[e],e)}function Bk(){for(let t in this.opts.formats){let e=this.opts.formats[t];e&&this.addFormat(t,e)}}function Jk(t){if(Array.isArray(t)){this.addVocabulary(t);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let e in t){let r=t[e];r.keyword||(r.keyword=e),this.addKeyword(r)}}function Gk(){let t={...this.opts};for(let e of Lk)delete t[e];return t}var Wk={log(){},warn(){},error(){}};function Xk(t){if(t===!1)return Wk;if(t===void 0)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}var Yk=/^[a-z_$][a-z0-9_$:-]*$/i;function Qk(t,e){let{RULES:r}=this;if((0,pl.eachItem)(t,n=>{if(r.keywords[n])throw new Error(`Keyword ${n} is already defined`);if(!Yk.test(n))throw new Error(`Keyword ${n} has invalid name`)}),!!e&&e.$data&&!("code"in e||"validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function dl(t,e,r){var n;let o=e?.post;if(r&&o)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:s}=this,i=o?s.post:s.rules.find(({type:c})=>c===r);if(i||(i={type:r,rules:[]},s.rules.push(i)),s.keywords[t]=!0,!e)return;let a={keyword:t,definition:{...e,type:(0,Ys.getJSONTypes)(e.type),schemaType:(0,Ys.getJSONTypes)(e.schemaType)}};e.before?eS.call(this,i,a,e.before):i.rules.push(a),s.all[t]=a,(n=e.implements)===null||n===void 0||n.forEach(c=>this.addKeyword(c))}function eS(t,e,r){let n=t.rules.findIndex(o=>o.keyword===r);n>=0?t.rules.splice(n,0,e):(t.rules.push(e),this.logger.warn(`rule ${r} is not defined`))}function tS(t){let{metaSchema:e}=t;e!==void 0&&(t.$data&&this.opts.$data&&(e=Mh(e)),t.validateSchema=this.compile(e,!0))}var rS={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function Mh(t){return{anyOf:[t,rS]}}});var qh=T(fl=>{"use strict";Object.defineProperty(fl,"__esModule",{value:!0});var nS={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};fl.default=nS});var Fh=T(Nr=>{"use strict";Object.defineProperty(Nr,"__esModule",{value:!0});Nr.callRef=Nr.getValidate=void 0;var oS=fo(),Lh=ot(),Be=F(),fn=At(),Uh=Bs(),Qs=ee(),sS={keyword:"$ref",schemaType:"string",code(t){let{gen:e,schema:r,it:n}=t,{baseId:o,schemaEnv:s,validateName:i,opts:a,self:c}=n,{root:u}=s;if((r==="#"||r==="#/")&&o===u.baseId)return d();let l=Uh.resolveRef.call(c,u,o,r);if(l===void 0)throw new oS.default(n.opts.uriResolver,o,r);if(l instanceof Uh.SchemaEnv)return f(l);return m(l);function d(){if(s===u)return ei(t,i,s,s.$async);let p=e.scopeValue("root",{ref:u});return ei(t,(0,Be._)`${p}.validate`,u,u.$async)}function f(p){let h=Vh(t,p);ei(t,h,p,p.$async)}function m(p){let h=e.scopeValue("schema",a.code.source===!0?{ref:p,code:(0,Be.stringify)(p)}:{ref:p}),g=e.name("valid"),_=t.subschema({schema:p,dataTypes:[],schemaPath:Be.nil,topSchemaRef:h,errSchemaPath:r},g);t.mergeEvaluated(_),t.ok(g)}}};function Vh(t,e){let{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,Be._)`${r.scopeValue("wrapper",{ref:e})}.validate`}Nr.getValidate=Vh;function ei(t,e,r,n){let{gen:o,it:s}=t,{allErrors:i,schemaEnv:a,opts:c}=s,u=c.passContext?fn.default.this:Be.nil;n?l():d();function l(){if(!a.$async)throw new Error("async schema referenced by sync schema");let p=o.let("valid");o.try(()=>{o.code((0,Be._)`await ${(0,Lh.callValidateCode)(t,e,u)}`),m(e),i||o.assign(p,!0)},h=>{o.if((0,Be._)`!(${h} instanceof ${s.ValidationError})`,()=>o.throw(h)),f(h),i||o.assign(p,!1)}),t.ok(p)}function d(){t.result((0,Lh.callValidateCode)(t,e,u),()=>m(e),()=>f(e))}function f(p){let h=(0,Be._)`${p}.errors`;o.assign(fn.default.vErrors,(0,Be._)`${fn.default.vErrors} === null ? ${h} : ${fn.default.vErrors}.concat(${h})`),o.assign(fn.default.errors,(0,Be._)`${fn.default.vErrors}.length`)}function m(p){var h;if(!s.opts.unevaluated)return;let g=(h=r?.validate)===null||h===void 0?void 0:h.evaluated;if(s.props!==!0)if(g&&!g.dynamicProps)g.props!==void 0&&(s.props=Qs.mergeEvaluated.props(o,g.props,s.props));else{let _=o.var("props",(0,Be._)`${p}.evaluated.props`);s.props=Qs.mergeEvaluated.props(o,_,s.props,Be.Name)}if(s.items!==!0)if(g&&!g.dynamicItems)g.items!==void 0&&(s.items=Qs.mergeEvaluated.items(o,g.items,s.items));else{let _=o.var("items",(0,Be._)`${p}.evaluated.items`);s.items=Qs.mergeEvaluated.items(o,_,s.items,Be.Name)}}}Nr.callRef=ei;Nr.default=sS});var Kh=T(ml=>{"use strict";Object.defineProperty(ml,"__esModule",{value:!0});var iS=qh(),aS=Fh(),cS=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",iS.default,aS.default];ml.default=cS});var Hh=T(hl=>{"use strict";Object.defineProperty(hl,"__esModule",{value:!0});var ti=F(),nr=ti.operators,ri={maximum:{okStr:"<=",ok:nr.LTE,fail:nr.GT},minimum:{okStr:">=",ok:nr.GTE,fail:nr.LT},exclusiveMaximum:{okStr:"<",ok:nr.LT,fail:nr.GTE},exclusiveMinimum:{okStr:">",ok:nr.GT,fail:nr.LTE}},uS={message:({keyword:t,schemaCode:e})=>(0,ti.str)`must be ${ri[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,ti._)`{comparison: ${ri[t].okStr}, limit: ${e}}`},lS={keyword:Object.keys(ri),type:"number",schemaType:"number",$data:!0,error:uS,code(t){let{keyword:e,data:r,schemaCode:n}=t;t.fail$data((0,ti._)`${r} ${ri[e].fail} ${n} || isNaN(${r})`)}};hl.default=lS});var Bh=T(gl=>{"use strict";Object.defineProperty(gl,"__esModule",{value:!0});var _o=F(),dS={message:({schemaCode:t})=>(0,_o.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,_o._)`{multipleOf: ${t}}`},pS={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:dS,code(t){let{gen:e,data:r,schemaCode:n,it:o}=t,s=o.opts.multipleOfPrecision,i=e.let("res"),a=s?(0,_o._)`Math.abs(Math.round(${i}) - ${i}) > 1e-${s}`:(0,_o._)`${i} !== parseInt(${i})`;t.fail$data((0,_o._)`(${n} === 0 || (${i} = ${r}/${n}, ${a}))`)}};gl.default=pS});var Gh=T(yl=>{"use strict";Object.defineProperty(yl,"__esModule",{value:!0});function Jh(t){let e=t.length,r=0,n=0,o;for(;n<e;)r++,o=t.charCodeAt(n++),o>=55296&&o<=56319&&n<e&&(o=t.charCodeAt(n),(o&64512)===56320&&n++);return r}yl.default=Jh;Jh.code='require("ajv/dist/runtime/ucs2length").default'});var Wh=T(_l=>{"use strict";Object.defineProperty(_l,"__esModule",{value:!0});var Zr=F(),fS=ee(),mS=Gh(),hS={message({keyword:t,schemaCode:e}){let r=t==="maxLength"?"more":"fewer";return(0,Zr.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,Zr._)`{limit: ${t}}`},gS={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:hS,code(t){let{keyword:e,data:r,schemaCode:n,it:o}=t,s=e==="maxLength"?Zr.operators.GT:Zr.operators.LT,i=o.opts.unicode===!1?(0,Zr._)`${r}.length`:(0,Zr._)`${(0,fS.useFunc)(t.gen,mS.default)}(${r})`;t.fail$data((0,Zr._)`${i} ${s} ${n}`)}};_l.default=gS});var Xh=T(vl=>{"use strict";Object.defineProperty(vl,"__esModule",{value:!0});var yS=ot(),ni=F(),_S={message:({schemaCode:t})=>(0,ni.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,ni._)`{pattern: ${t}}`},vS={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:_S,code(t){let{data:e,$data:r,schema:n,schemaCode:o,it:s}=t,i=s.opts.unicodeRegExp?"u":"",a=r?(0,ni._)`(new RegExp(${o}, ${i}))`:(0,yS.usePattern)(t,n);t.fail$data((0,ni._)`!${a}.test(${e})`)}};vl.default=vS});var Yh=T(xl=>{"use strict";Object.defineProperty(xl,"__esModule",{value:!0});var vo=F(),xS={message({keyword:t,schemaCode:e}){let r=t==="maxProperties"?"more":"fewer";return(0,vo.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,vo._)`{limit: ${t}}`},bS={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:xS,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxProperties"?vo.operators.GT:vo.operators.LT;t.fail$data((0,vo._)`Object.keys(${r}).length ${o} ${n}`)}};xl.default=bS});var Qh=T(bl=>{"use strict";Object.defineProperty(bl,"__esModule",{value:!0});var xo=ot(),bo=F(),$S=ee(),wS={message:({params:{missingProperty:t}})=>(0,bo.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,bo._)`{missingProperty: ${t}}`},kS={keyword:"required",type:"object",schemaType:"array",$data:!0,error:wS,code(t){let{gen:e,schema:r,schemaCode:n,data:o,$data:s,it:i}=t,{opts:a}=i;if(!s&&r.length===0)return;let c=r.length>=a.loopRequired;if(i.allErrors?u():l(),a.strictRequired){let m=t.parentSchema.properties,{definedProperties:p}=t.it;for(let h of r)if(m?.[h]===void 0&&!p.has(h)){let g=i.schemaEnv.baseId+i.errSchemaPath,_=`required property "${h}" is not defined at "${g}" (strictRequired)`;(0,$S.checkStrictMode)(i,_,i.opts.strictRequired)}}function u(){if(c||s)t.block$data(bo.nil,d);else for(let m of r)(0,xo.checkReportMissingProp)(t,m)}function l(){let m=e.let("missing");if(c||s){let p=e.let("valid",!0);t.block$data(p,()=>f(m,p)),t.ok(p)}else e.if((0,xo.checkMissingProp)(t,r,m)),(0,xo.reportMissingProp)(t,m),e.else()}function d(){e.forOf("prop",n,m=>{t.setParams({missingProperty:m}),e.if((0,xo.noPropertyInData)(e,o,m,a.ownProperties),()=>t.error())})}function f(m,p){t.setParams({missingProperty:m}),e.forOf(m,n,()=>{e.assign(p,(0,xo.propertyInData)(e,o,m,a.ownProperties)),e.if((0,bo.not)(p),()=>{t.error(),e.break()})},bo.nil)}}};bl.default=kS});var eg=T($l=>{"use strict";Object.defineProperty($l,"__esModule",{value:!0});var $o=F(),SS={message({keyword:t,schemaCode:e}){let r=t==="maxItems"?"more":"fewer";return(0,$o.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,$o._)`{limit: ${t}}`},TS={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:SS,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxItems"?$o.operators.GT:$o.operators.LT;t.fail$data((0,$o._)`${r}.length ${o} ${n}`)}};$l.default=TS});var oi=T(wl=>{"use strict";Object.defineProperty(wl,"__esModule",{value:!0});var tg=Bu();tg.code='require("ajv/dist/runtime/equal").default';wl.default=tg});var rg=T(Sl=>{"use strict";Object.defineProperty(Sl,"__esModule",{value:!0});var kl=ao(),Ee=F(),PS=ee(),zS=oi(),ES={message:({params:{i:t,j:e}})=>(0,Ee.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,Ee._)`{i: ${t}, j: ${e}}`},IS={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:ES,code(t){let{gen:e,data:r,$data:n,schema:o,parentSchema:s,schemaCode:i,it:a}=t;if(!n&&!o)return;let c=e.let("valid"),u=s.items?(0,kl.getSchemaTypes)(s.items):[];t.block$data(c,l,(0,Ee._)`${i} === false`),t.ok(c);function l(){let p=e.let("i",(0,Ee._)`${r}.length`),h=e.let("j");t.setParams({i:p,j:h}),e.assign(c,!0),e.if((0,Ee._)`${p} > 1`,()=>(d()?f:m)(p,h))}function d(){return u.length>0&&!u.some(p=>p==="object"||p==="array")}function f(p,h){let g=e.name("item"),_=(0,kl.checkDataTypes)(u,g,a.opts.strictNumbers,kl.DataType.Wrong),x=e.const("indices",(0,Ee._)`{}`);e.for((0,Ee._)`;${p}--;`,()=>{e.let(g,(0,Ee._)`${r}[${p}]`),e.if(_,(0,Ee._)`continue`),u.length>1&&e.if((0,Ee._)`typeof ${g} == "string"`,(0,Ee._)`${g} += "_"`),e.if((0,Ee._)`typeof ${x}[${g}] == "number"`,()=>{e.assign(h,(0,Ee._)`${x}[${g}]`),t.error(),e.assign(c,!1).break()}).code((0,Ee._)`${x}[${g}] = ${p}`)})}function m(p,h){let g=(0,PS.useFunc)(e,zS.default),_=e.name("outer");e.label(_).for((0,Ee._)`;${p}--;`,()=>e.for((0,Ee._)`${h} = ${p}; ${h}--;`,()=>e.if((0,Ee._)`${g}(${r}[${p}], ${r}[${h}])`,()=>{t.error(),e.assign(c,!1).break(_)})))}}};Sl.default=IS});var ng=T(Pl=>{"use strict";Object.defineProperty(Pl,"__esModule",{value:!0});var Tl=F(),RS=ee(),CS=oi(),jS={message:"must be equal to constant",params:({schemaCode:t})=>(0,Tl._)`{allowedValue: ${t}}`},OS={keyword:"const",$data:!0,error:jS,code(t){let{gen:e,data:r,$data:n,schemaCode:o,schema:s}=t;n||s&&typeof s=="object"?t.fail$data((0,Tl._)`!${(0,RS.useFunc)(e,CS.default)}(${r}, ${o})`):t.fail((0,Tl._)`${s} !== ${r}`)}};Pl.default=OS});var og=T(zl=>{"use strict";Object.defineProperty(zl,"__esModule",{value:!0});var wo=F(),AS=ee(),NS=oi(),ZS={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,wo._)`{allowedValues: ${t}}`},MS={keyword:"enum",schemaType:"array",$data:!0,error:ZS,code(t){let{gen:e,data:r,$data:n,schema:o,schemaCode:s,it:i}=t;if(!n&&o.length===0)throw new Error("enum must have non-empty array");let a=o.length>=i.opts.loopEnum,c,u=()=>c??(c=(0,AS.useFunc)(e,NS.default)),l;if(a||n)l=e.let("valid"),t.block$data(l,d);else{if(!Array.isArray(o))throw new Error("ajv implementation error");let m=e.const("vSchema",s);l=(0,wo.or)(...o.map((p,h)=>f(m,h)))}t.pass(l);function d(){e.assign(l,!1),e.forOf("v",s,m=>e.if((0,wo._)`${u()}(${r}, ${m})`,()=>e.assign(l,!0).break()))}function f(m,p){let h=o[p];return typeof h=="object"&&h!==null?(0,wo._)`${u()}(${r}, ${m}[${p}])`:(0,wo._)`${r} === ${h}`}}};zl.default=MS});var sg=T(El=>{"use strict";Object.defineProperty(El,"__esModule",{value:!0});var DS=Hh(),qS=Bh(),LS=Wh(),US=Xh(),VS=Yh(),FS=Qh(),KS=eg(),HS=rg(),BS=ng(),JS=og(),GS=[DS.default,qS.default,LS.default,US.default,VS.default,FS.default,KS.default,HS.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},BS.default,JS.default];El.default=GS});var Rl=T(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});ko.validateAdditionalItems=void 0;var Mr=F(),Il=ee(),WS={message:({params:{len:t}})=>(0,Mr.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,Mr._)`{limit: ${t}}`},XS={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:WS,code(t){let{parentSchema:e,it:r}=t,{items:n}=e;if(!Array.isArray(n)){(0,Il.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}ig(t,n)}};function ig(t,e){let{gen:r,schema:n,data:o,keyword:s,it:i}=t;i.items=!0;let a=r.const("len",(0,Mr._)`${o}.length`);if(n===!1)t.setParams({len:e.length}),t.pass((0,Mr._)`${a} <= ${e.length}`);else if(typeof n=="object"&&!(0,Il.alwaysValidSchema)(i,n)){let u=r.var("valid",(0,Mr._)`${a} <= ${e.length}`);r.if((0,Mr.not)(u),()=>c(u)),t.ok(u)}function c(u){r.forRange("i",e.length,a,l=>{t.subschema({keyword:s,dataProp:l,dataPropType:Il.Type.Num},u),i.allErrors||r.if((0,Mr.not)(u),()=>r.break())})}}ko.validateAdditionalItems=ig;ko.default=XS});var Cl=T(So=>{"use strict";Object.defineProperty(So,"__esModule",{value:!0});So.validateTuple=void 0;var ag=F(),si=ee(),YS=ot(),QS={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){let{schema:e,it:r}=t;if(Array.isArray(e))return cg(t,"additionalItems",e);r.items=!0,!(0,si.alwaysValidSchema)(r,e)&&t.ok((0,YS.validateArray)(t))}};function cg(t,e,r=t.schema){let{gen:n,parentSchema:o,data:s,keyword:i,it:a}=t;l(o),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=si.mergeEvaluated.items(n,r.length,a.items));let c=n.name("valid"),u=n.const("len",(0,ag._)`${s}.length`);r.forEach((d,f)=>{(0,si.alwaysValidSchema)(a,d)||(n.if((0,ag._)`${u} > ${f}`,()=>t.subschema({keyword:i,schemaProp:f,dataProp:f},c)),t.ok(c))});function l(d){let{opts:f,errSchemaPath:m}=a,p=r.length,h=p===d.minItems&&(p===d.maxItems||d[e]===!1);if(f.strictTuples&&!h){let g=`"${i}" is ${p}-tuple, but minItems or maxItems/${e} are not specified or different at path "${m}"`;(0,si.checkStrictMode)(a,g,f.strictTuples)}}}So.validateTuple=cg;So.default=QS});var ug=T(jl=>{"use strict";Object.defineProperty(jl,"__esModule",{value:!0});var eT=Cl(),tT={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,eT.validateTuple)(t,"items")};jl.default=tT});var dg=T(Ol=>{"use strict";Object.defineProperty(Ol,"__esModule",{value:!0});var lg=F(),rT=ee(),nT=ot(),oT=Rl(),sT={message:({params:{len:t}})=>(0,lg.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,lg._)`{limit: ${t}}`},iT={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:sT,code(t){let{schema:e,parentSchema:r,it:n}=t,{prefixItems:o}=r;n.items=!0,!(0,rT.alwaysValidSchema)(n,e)&&(o?(0,oT.validateAdditionalItems)(t,o):t.ok((0,nT.validateArray)(t)))}};Ol.default=iT});var pg=T(Al=>{"use strict";Object.defineProperty(Al,"__esModule",{value:!0});var it=F(),ii=ee(),aT={message:({params:{min:t,max:e}})=>e===void 0?(0,it.str)`must contain at least ${t} valid item(s)`:(0,it.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,it._)`{minContains: ${t}}`:(0,it._)`{minContains: ${t}, maxContains: ${e}}`},cT={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:aT,code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:s}=t,i,a,{minContains:c,maxContains:u}=n;s.opts.next?(i=c===void 0?1:c,a=u):i=1;let l=e.const("len",(0,it._)`${o}.length`);if(t.setParams({min:i,max:a}),a===void 0&&i===0){(0,ii.checkStrictMode)(s,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&i>a){(0,ii.checkStrictMode)(s,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,ii.alwaysValidSchema)(s,r)){let h=(0,it._)`${l} >= ${i}`;a!==void 0&&(h=(0,it._)`${h} && ${l} <= ${a}`),t.pass(h);return}s.items=!0;let d=e.name("valid");a===void 0&&i===1?m(d,()=>e.if(d,()=>e.break())):i===0?(e.let(d,!0),a!==void 0&&e.if((0,it._)`${o}.length > 0`,f)):(e.let(d,!1),f()),t.result(d,()=>t.reset());function f(){let h=e.name("_valid"),g=e.let("count",0);m(h,()=>e.if(h,()=>p(g)))}function m(h,g){e.forRange("i",0,l,_=>{t.subschema({keyword:"contains",dataProp:_,dataPropType:ii.Type.Num,compositeRule:!0},h),g()})}function p(h){e.code((0,it._)`${h}++`),a===void 0?e.if((0,it._)`${h} >= ${i}`,()=>e.assign(d,!0).break()):(e.if((0,it._)`${h} > ${a}`,()=>e.assign(d,!1).break()),i===1?e.assign(d,!0):e.if((0,it._)`${h} >= ${i}`,()=>e.assign(d,!0)))}}};Al.default=cT});var hg=T(kt=>{"use strict";Object.defineProperty(kt,"__esModule",{value:!0});kt.validateSchemaDeps=kt.validatePropertyDeps=kt.error=void 0;var Nl=F(),uT=ee(),To=ot();kt.error={message:({params:{property:t,depsCount:e,deps:r}})=>{let n=e===1?"property":"properties";return(0,Nl.str)`must have ${n} ${r} when property ${t} is present`},params:({params:{property:t,depsCount:e,deps:r,missingProperty:n}})=>(0,Nl._)`{property: ${t},
    missingProperty: ${n},
    depsCount: ${e},
    deps: ${r}}`};var lT={keyword:"dependencies",type:"object",schemaType:"object",error:kt.error,code(t){let[e,r]=dT(t);fg(t,e),mg(t,r)}};function dT({schema:t}){let e={},r={};for(let n in t){if(n==="__proto__")continue;let o=Array.isArray(t[n])?e:r;o[n]=t[n]}return[e,r]}function fg(t,e=t.schema){let{gen:r,data:n,it:o}=t;if(Object.keys(e).length===0)return;let s=r.let("missing");for(let i in e){let a=e[i];if(a.length===0)continue;let c=(0,To.propertyInData)(r,n,i,o.opts.ownProperties);t.setParams({property:i,depsCount:a.length,deps:a.join(", ")}),o.allErrors?r.if(c,()=>{for(let u of a)(0,To.checkReportMissingProp)(t,u)}):(r.if((0,Nl._)`${c} && (${(0,To.checkMissingProp)(t,a,s)})`),(0,To.reportMissingProp)(t,s),r.else())}}kt.validatePropertyDeps=fg;function mg(t,e=t.schema){let{gen:r,data:n,keyword:o,it:s}=t,i=r.name("valid");for(let a in e)(0,uT.alwaysValidSchema)(s,e[a])||(r.if((0,To.propertyInData)(r,n,a,s.opts.ownProperties),()=>{let c=t.subschema({keyword:o,schemaProp:a},i);t.mergeValidEvaluated(c,i)},()=>r.var(i,!0)),t.ok(i))}kt.validateSchemaDeps=mg;kt.default=lT});var yg=T(Zl=>{"use strict";Object.defineProperty(Zl,"__esModule",{value:!0});var gg=F(),pT=ee(),fT={message:"property name must be valid",params:({params:t})=>(0,gg._)`{propertyName: ${t.propertyName}}`},mT={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:fT,code(t){let{gen:e,schema:r,data:n,it:o}=t;if((0,pT.alwaysValidSchema)(o,r))return;let s=e.name("valid");e.forIn("key",n,i=>{t.setParams({propertyName:i}),t.subschema({keyword:"propertyNames",data:i,dataTypes:["string"],propertyName:i,compositeRule:!0},s),e.if((0,gg.not)(s),()=>{t.error(!0),o.allErrors||e.break()})}),t.ok(s)}};Zl.default=mT});var Dl=T(Ml=>{"use strict";Object.defineProperty(Ml,"__esModule",{value:!0});var ai=ot(),ht=F(),hT=At(),ci=ee(),gT={message:"must NOT have additional properties",params:({params:t})=>(0,ht._)`{additionalProperty: ${t.additionalProperty}}`},yT={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:gT,code(t){let{gen:e,schema:r,parentSchema:n,data:o,errsCount:s,it:i}=t;if(!s)throw new Error("ajv implementation error");let{allErrors:a,opts:c}=i;if(i.props=!0,c.removeAdditional!=="all"&&(0,ci.alwaysValidSchema)(i,r))return;let u=(0,ai.allSchemaProperties)(n.properties),l=(0,ai.allSchemaProperties)(n.patternProperties);d(),t.ok((0,ht._)`${s} === ${hT.default.errors}`);function d(){e.forIn("key",o,g=>{!u.length&&!l.length?p(g):e.if(f(g),()=>p(g))})}function f(g){let _;if(u.length>8){let x=(0,ci.schemaRefOrVal)(i,n.properties,"properties");_=(0,ai.isOwnProperty)(e,x,g)}else u.length?_=(0,ht.or)(...u.map(x=>(0,ht._)`${g} === ${x}`)):_=ht.nil;return l.length&&(_=(0,ht.or)(_,...l.map(x=>(0,ht._)`${(0,ai.usePattern)(t,x)}.test(${g})`))),(0,ht.not)(_)}function m(g){e.code((0,ht._)`delete ${o}[${g}]`)}function p(g){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){m(g);return}if(r===!1){t.setParams({additionalProperty:g}),t.error(),a||e.break();return}if(typeof r=="object"&&!(0,ci.alwaysValidSchema)(i,r)){let _=e.name("valid");c.removeAdditional==="failing"?(h(g,_,!1),e.if((0,ht.not)(_),()=>{t.reset(),m(g)})):(h(g,_),a||e.if((0,ht.not)(_),()=>e.break()))}}function h(g,_,x){let b={keyword:"additionalProperties",dataProp:g,dataPropType:ci.Type.Str};x===!1&&Object.assign(b,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(b,_)}}};Ml.default=yT});var xg=T(Ll=>{"use strict";Object.defineProperty(Ll,"__esModule",{value:!0});var _T=po(),_g=ot(),ql=ee(),vg=Dl(),vT={keyword:"properties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:s}=t;s.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&vg.default.code(new _T.KeywordCxt(s,vg.default,"additionalProperties"));let i=(0,_g.allSchemaProperties)(r);for(let d of i)s.definedProperties.add(d);s.opts.unevaluated&&i.length&&s.props!==!0&&(s.props=ql.mergeEvaluated.props(e,(0,ql.toHash)(i),s.props));let a=i.filter(d=>!(0,ql.alwaysValidSchema)(s,r[d]));if(a.length===0)return;let c=e.name("valid");for(let d of a)u(d)?l(d):(e.if((0,_g.propertyInData)(e,o,d,s.opts.ownProperties)),l(d),s.allErrors||e.else().var(c,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(c);function u(d){return s.opts.useDefaults&&!s.compositeRule&&r[d].default!==void 0}function l(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},c)}}};Ll.default=vT});var kg=T(Ul=>{"use strict";Object.defineProperty(Ul,"__esModule",{value:!0});var bg=ot(),ui=F(),$g=ee(),wg=ee(),xT={keyword:"patternProperties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,data:n,parentSchema:o,it:s}=t,{opts:i}=s,a=(0,bg.allSchemaProperties)(r),c=a.filter(h=>(0,$g.alwaysValidSchema)(s,r[h]));if(a.length===0||c.length===a.length&&(!s.opts.unevaluated||s.props===!0))return;let u=i.strictSchema&&!i.allowMatchingProperties&&o.properties,l=e.name("valid");s.props!==!0&&!(s.props instanceof ui.Name)&&(s.props=(0,wg.evaluatedPropsToName)(e,s.props));let{props:d}=s;f();function f(){for(let h of a)u&&m(h),s.allErrors?p(h):(e.var(l,!0),p(h),e.if(l))}function m(h){for(let g in u)new RegExp(h).test(g)&&(0,$g.checkStrictMode)(s,`property ${g} matches pattern ${h} (use allowMatchingProperties)`)}function p(h){e.forIn("key",n,g=>{e.if((0,ui._)`${(0,bg.usePattern)(t,h)}.test(${g})`,()=>{let _=c.includes(h);_||t.subschema({keyword:"patternProperties",schemaProp:h,dataProp:g,dataPropType:wg.Type.Str},l),s.opts.unevaluated&&d!==!0?e.assign((0,ui._)`${d}[${g}]`,!0):!_&&!s.allErrors&&e.if((0,ui.not)(l),()=>e.break())})})}}};Ul.default=xT});var Sg=T(Vl=>{"use strict";Object.defineProperty(Vl,"__esModule",{value:!0});var bT=ee(),$T={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){let{gen:e,schema:r,it:n}=t;if((0,bT.alwaysValidSchema)(n,r)){t.fail();return}let o=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),t.failResult(o,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};Vl.default=$T});var Tg=T(Fl=>{"use strict";Object.defineProperty(Fl,"__esModule",{value:!0});var wT=ot(),kT={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:wT.validateUnion,error:{message:"must match a schema in anyOf"}};Fl.default=kT});var Pg=T(Kl=>{"use strict";Object.defineProperty(Kl,"__esModule",{value:!0});var li=F(),ST=ee(),TT={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,li._)`{passingSchemas: ${t.passing}}`},PT={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:TT,code(t){let{gen:e,schema:r,parentSchema:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(o.opts.discriminator&&n.discriminator)return;let s=r,i=e.let("valid",!1),a=e.let("passing",null),c=e.name("_valid");t.setParams({passing:a}),e.block(u),t.result(i,()=>t.reset(),()=>t.error(!0));function u(){s.forEach((l,d)=>{let f;(0,ST.alwaysValidSchema)(o,l)?e.var(c,!0):f=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},c),d>0&&e.if((0,li._)`${c} && ${i}`).assign(i,!1).assign(a,(0,li._)`[${a}, ${d}]`).else(),e.if(c,()=>{e.assign(i,!0),e.assign(a,d),f&&t.mergeEvaluated(f,li.Name)})})}}};Kl.default=PT});var zg=T(Hl=>{"use strict";Object.defineProperty(Hl,"__esModule",{value:!0});var zT=ee(),ET={keyword:"allOf",schemaType:"array",code(t){let{gen:e,schema:r,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");let o=e.name("valid");r.forEach((s,i)=>{if((0,zT.alwaysValidSchema)(n,s))return;let a=t.subschema({keyword:"allOf",schemaProp:i},o);t.ok(o),t.mergeEvaluated(a)})}};Hl.default=ET});var Rg=T(Bl=>{"use strict";Object.defineProperty(Bl,"__esModule",{value:!0});var di=F(),Ig=ee(),IT={message:({params:t})=>(0,di.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,di._)`{failingKeyword: ${t.ifClause}}`},RT={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:IT,code(t){let{gen:e,parentSchema:r,it:n}=t;r.then===void 0&&r.else===void 0&&(0,Ig.checkStrictMode)(n,'"if" without "then" and "else" is ignored');let o=Eg(n,"then"),s=Eg(n,"else");if(!o&&!s)return;let i=e.let("valid",!0),a=e.name("_valid");if(c(),t.reset(),o&&s){let l=e.let("ifClause");t.setParams({ifClause:l}),e.if(a,u("then",l),u("else",l))}else o?e.if(a,u("then")):e.if((0,di.not)(a),u("else"));t.pass(i,()=>t.error(!0));function c(){let l=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);t.mergeEvaluated(l)}function u(l,d){return()=>{let f=t.subschema({keyword:l},a);e.assign(i,a),t.mergeValidEvaluated(f,i),d?e.assign(d,(0,di._)`${l}`):t.setParams({ifClause:l})}}}};function Eg(t,e){let r=t.schema[e];return r!==void 0&&!(0,Ig.alwaysValidSchema)(t,r)}Bl.default=RT});var Cg=T(Jl=>{"use strict";Object.defineProperty(Jl,"__esModule",{value:!0});var CT=ee(),jT={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,CT.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};Jl.default=jT});var jg=T(Gl=>{"use strict";Object.defineProperty(Gl,"__esModule",{value:!0});var OT=Rl(),AT=ug(),NT=Cl(),ZT=dg(),MT=pg(),DT=hg(),qT=yg(),LT=Dl(),UT=xg(),VT=kg(),FT=Sg(),KT=Tg(),HT=Pg(),BT=zg(),JT=Rg(),GT=Cg();function WT(t=!1){let e=[FT.default,KT.default,HT.default,BT.default,JT.default,GT.default,qT.default,LT.default,DT.default,UT.default,VT.default];return t?e.push(AT.default,ZT.default):e.push(OT.default,NT.default),e.push(MT.default),e}Gl.default=WT});var Og=T(Wl=>{"use strict";Object.defineProperty(Wl,"__esModule",{value:!0});var xe=F(),XT={message:({schemaCode:t})=>(0,xe.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,xe._)`{format: ${t}}`},YT={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:XT,code(t,e){let{gen:r,data:n,$data:o,schema:s,schemaCode:i,it:a}=t,{opts:c,errSchemaPath:u,schemaEnv:l,self:d}=a;if(!c.validateFormats)return;o?f():m();function f(){let p=r.scopeValue("formats",{ref:d.formats,code:c.code.formats}),h=r.const("fDef",(0,xe._)`${p}[${i}]`),g=r.let("fType"),_=r.let("format");r.if((0,xe._)`typeof ${h} == "object" && !(${h} instanceof RegExp)`,()=>r.assign(g,(0,xe._)`${h}.type || "string"`).assign(_,(0,xe._)`${h}.validate`),()=>r.assign(g,(0,xe._)`"string"`).assign(_,h)),t.fail$data((0,xe.or)(x(),b()));function x(){return c.strictSchema===!1?xe.nil:(0,xe._)`${i} && !${_}`}function b(){let k=l.$async?(0,xe._)`(${h}.async ? await ${_}(${n}) : ${_}(${n}))`:(0,xe._)`${_}(${n})`,I=(0,xe._)`(typeof ${_} == "function" ? ${k} : ${_}.test(${n}))`;return(0,xe._)`${_} && ${_} !== true && ${g} === ${e} && !${I}`}}function m(){let p=d.formats[s];if(!p){x();return}if(p===!0)return;let[h,g,_]=b(p);h===e&&t.pass(k());function x(){if(c.strictSchema===!1){d.logger.warn(I());return}throw new Error(I());function I(){return`unknown format "${s}" ignored in schema at path "${u}"`}}function b(I){let M=I instanceof RegExp?(0,xe.regexpCode)(I):c.code.formats?(0,xe._)`${c.code.formats}${(0,xe.getProperty)(s)}`:void 0,ve=r.scopeValue("formats",{key:s,ref:I,code:M});return typeof I=="object"&&!(I instanceof RegExp)?[I.type||"string",I.validate,(0,xe._)`${ve}.validate`]:["string",I,ve]}function k(){if(typeof p=="object"&&!(p instanceof RegExp)&&p.async){if(!l.$async)throw new Error("async format in sync schema");return(0,xe._)`await ${_}(${n})`}return typeof g=="function"?(0,xe._)`${_}(${n})`:(0,xe._)`${_}.test(${n})`}}}};Wl.default=YT});var Ag=T(Xl=>{"use strict";Object.defineProperty(Xl,"__esModule",{value:!0});var QT=Og(),eP=[QT.default];Xl.default=eP});var Ng=T(mn=>{"use strict";Object.defineProperty(mn,"__esModule",{value:!0});mn.contentVocabulary=mn.metadataVocabulary=void 0;mn.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];mn.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var Mg=T(Yl=>{"use strict";Object.defineProperty(Yl,"__esModule",{value:!0});var tP=Kh(),rP=sg(),nP=jg(),oP=Ag(),Zg=Ng(),sP=[tP.default,rP.default,(0,nP.default)(),oP.default,Zg.metadataVocabulary,Zg.contentVocabulary];Yl.default=sP});var qg=T(pi=>{"use strict";Object.defineProperty(pi,"__esModule",{value:!0});pi.DiscrError=void 0;var Dg;(function(t){t.Tag="tag",t.Mapping="mapping"})(Dg||(pi.DiscrError=Dg={}))});var Ug=T(ed=>{"use strict";Object.defineProperty(ed,"__esModule",{value:!0});var hn=F(),Ql=qg(),Lg=Bs(),iP=fo(),aP=ee(),cP={message:({params:{discrError:t,tagName:e}})=>t===Ql.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,hn._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},uP={keyword:"discriminator",type:"object",schemaType:"object",error:cP,code(t){let{gen:e,data:r,schema:n,parentSchema:o,it:s}=t,{oneOf:i}=o;if(!s.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!i)throw new Error("discriminator: requires oneOf keyword");let c=e.let("valid",!1),u=e.const("tag",(0,hn._)`${r}${(0,hn.getProperty)(a)}`);e.if((0,hn._)`typeof ${u} == "string"`,()=>l(),()=>t.error(!1,{discrError:Ql.DiscrError.Tag,tag:u,tagName:a})),t.ok(c);function l(){let m=f();e.if(!1);for(let p in m)e.elseIf((0,hn._)`${u} === ${p}`),e.assign(c,d(m[p]));e.else(),t.error(!1,{discrError:Ql.DiscrError.Mapping,tag:u,tagName:a}),e.endIf()}function d(m){let p=e.name("valid"),h=t.subschema({keyword:"oneOf",schemaProp:m},p);return t.mergeEvaluated(h,hn.Name),p}function f(){var m;let p={},h=_(o),g=!0;for(let k=0;k<i.length;k++){let I=i[k];if(I?.$ref&&!(0,aP.schemaHasRulesButRef)(I,s.self.RULES)){let ve=I.$ref;if(I=Lg.resolveRef.call(s.self,s.schemaEnv.root,s.baseId,ve),I instanceof Lg.SchemaEnv&&(I=I.schema),I===void 0)throw new iP.default(s.opts.uriResolver,s.baseId,ve)}let M=(m=I?.properties)===null||m===void 0?void 0:m[a];if(typeof M!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);g=g&&(h||_(I)),x(M,k)}if(!g)throw new Error(`discriminator: "${a}" must be required`);return p;function _({required:k}){return Array.isArray(k)&&k.includes(a)}function x(k,I){if(k.const)b(k.const,I);else if(k.enum)for(let M of k.enum)b(M,I);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function b(k,I){if(typeof k!="string"||k in p)throw new Error(`discriminator: "${a}" values must be unique strings`);p[k]=I}}}};ed.default=uP});var Vg=T((JO,lP)=>{lP.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var rd=T((le,td)=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.MissingRefError=le.ValidationError=le.CodeGen=le.Name=le.nil=le.stringify=le.str=le._=le.KeywordCxt=le.Ajv=void 0;var dP=Dh(),pP=Mg(),fP=Ug(),Fg=Vg(),mP=["/properties"],fi="http://json-schema.org/draft-07/schema",gn=class extends dP.default{_addVocabularies(){super._addVocabularies(),pP.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(fP.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let e=this.opts.$data?this.$dataMetaSchema(Fg,mP):Fg;this.addMetaSchema(e,fi,!1),this.refs["http://json-schema.org/schema"]=fi}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(fi)?fi:void 0)}};le.Ajv=gn;td.exports=le=gn;td.exports.Ajv=gn;Object.defineProperty(le,"__esModule",{value:!0});le.default=gn;var hP=po();Object.defineProperty(le,"KeywordCxt",{enumerable:!0,get:function(){return hP.KeywordCxt}});var yn=F();Object.defineProperty(le,"_",{enumerable:!0,get:function(){return yn._}});Object.defineProperty(le,"str",{enumerable:!0,get:function(){return yn.str}});Object.defineProperty(le,"stringify",{enumerable:!0,get:function(){return yn.stringify}});Object.defineProperty(le,"nil",{enumerable:!0,get:function(){return yn.nil}});Object.defineProperty(le,"Name",{enumerable:!0,get:function(){return yn.Name}});Object.defineProperty(le,"CodeGen",{enumerable:!0,get:function(){return yn.CodeGen}});var gP=Ks();Object.defineProperty(le,"ValidationError",{enumerable:!0,get:function(){return gP.default}});var yP=fo();Object.defineProperty(le,"MissingRefError",{enumerable:!0,get:function(){return yP.default}})});var Yg=T(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.formatNames=Tt.fastFormats=Tt.fullFormats=void 0;function St(t,e){return{validate:t,compare:e}}Tt.fullFormats={date:St(Jg,id),time:St(od(!0),ad),"date-time":St(Kg(!0),Wg),"iso-time":St(od(),Gg),"iso-date-time":St(Kg(),Xg),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:wP,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:IP,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:kP,int32:{type:"number",validate:PP},int64:{type:"number",validate:zP},float:{type:"number",validate:Bg},double:{type:"number",validate:Bg},password:!0,binary:!0};Tt.fastFormats={...Tt.fullFormats,date:St(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,id),time:St(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,ad),"date-time":St(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,Wg),"iso-time":St(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,Gg),"iso-date-time":St(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,Xg),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};Tt.formatNames=Object.keys(Tt.fullFormats);function _P(t){return t%4===0&&(t%100!==0||t%400===0)}var vP=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,xP=[0,31,28,31,30,31,30,31,31,30,31,30,31];function Jg(t){let e=vP.exec(t);if(!e)return!1;let r=+e[1],n=+e[2],o=+e[3];return n>=1&&n<=12&&o>=1&&o<=(n===2&&_P(r)?29:xP[n])}function id(t,e){if(t&&e)return t>e?1:t<e?-1:0}var nd=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function od(t){return function(r){let n=nd.exec(r);if(!n)return!1;let o=+n[1],s=+n[2],i=+n[3],a=n[4],c=n[5]==="-"?-1:1,u=+(n[6]||0),l=+(n[7]||0);if(u>23||l>59||t&&!a)return!1;if(o<=23&&s<=59&&i<60)return!0;let d=s-l*c,f=o-u*c-(d<0?1:0);return(f===23||f===-1)&&(d===59||d===-1)&&i<61}}function ad(t,e){if(!(t&&e))return;let r=new Date("2020-01-01T"+t).valueOf(),n=new Date("2020-01-01T"+e).valueOf();if(r&&n)return r-n}function Gg(t,e){if(!(t&&e))return;let r=nd.exec(t),n=nd.exec(e);if(r&&n)return t=r[1]+r[2]+r[3],e=n[1]+n[2]+n[3],t>e?1:t<e?-1:0}var sd=/t|\s/i;function Kg(t){let e=od(t);return function(n){let o=n.split(sd);return o.length===2&&Jg(o[0])&&e(o[1])}}function Wg(t,e){if(!(t&&e))return;let r=new Date(t).valueOf(),n=new Date(e).valueOf();if(r&&n)return r-n}function Xg(t,e){if(!(t&&e))return;let[r,n]=t.split(sd),[o,s]=e.split(sd),i=id(r,o);if(i!==void 0)return i||ad(n,s)}var bP=/\/|:/,$P=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function wP(t){return bP.test(t)&&$P.test(t)}var Hg=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function kP(t){return Hg.lastIndex=0,Hg.test(t)}var SP=-(2**31),TP=2**31-1;function PP(t){return Number.isInteger(t)&&t<=TP&&t>=SP}function zP(t){return Number.isInteger(t)}function Bg(){return!0}var EP=/[^\\]\\Z/;function IP(t){if(EP.test(t))return!1;try{return new RegExp(t),!0}catch{return!1}}});var Qg=T(_n=>{"use strict";Object.defineProperty(_n,"__esModule",{value:!0});_n.formatLimitDefinition=void 0;var RP=rd(),gt=F(),or=gt.operators,mi={formatMaximum:{okStr:"<=",ok:or.LTE,fail:or.GT},formatMinimum:{okStr:">=",ok:or.GTE,fail:or.LT},formatExclusiveMaximum:{okStr:"<",ok:or.LT,fail:or.GTE},formatExclusiveMinimum:{okStr:">",ok:or.GT,fail:or.LTE}},CP={message:({keyword:t,schemaCode:e})=>(0,gt.str)`should be ${mi[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,gt._)`{comparison: ${mi[t].okStr}, limit: ${e}}`};_n.formatLimitDefinition={keyword:Object.keys(mi),type:"string",schemaType:"string",$data:!0,error:CP,code(t){let{gen:e,data:r,schemaCode:n,keyword:o,it:s}=t,{opts:i,self:a}=s;if(!i.validateFormats)return;let c=new RP.KeywordCxt(s,a.RULES.all.format.definition,"format");c.$data?u():l();function u(){let f=e.scopeValue("formats",{ref:a.formats,code:i.code.formats}),m=e.const("fmt",(0,gt._)`${f}[${c.schemaCode}]`);t.fail$data((0,gt.or)((0,gt._)`typeof ${m} != "object"`,(0,gt._)`${m} instanceof RegExp`,(0,gt._)`typeof ${m}.compare != "function"`,d(m)))}function l(){let f=c.schema,m=a.formats[f];if(!m||m===!0)return;if(typeof m!="object"||m instanceof RegExp||typeof m.compare!="function")throw new Error(`"${o}": format "${f}" does not define "compare" function`);let p=e.scopeValue("formats",{key:f,ref:m,code:i.code.formats?(0,gt._)`${i.code.formats}${(0,gt.getProperty)(f)}`:void 0});t.fail$data(d(p))}function d(f){return(0,gt._)`${f}.compare(${r}, ${n}) ${mi[o].fail} 0`}},dependencies:["format"]};var jP=t=>(t.addKeyword(_n.formatLimitDefinition),t);_n.default=jP});var ny=T((Po,ry)=>{"use strict";Object.defineProperty(Po,"__esModule",{value:!0});var vn=Yg(),OP=Qg(),cd=F(),ey=new cd.Name("fullFormats"),AP=new cd.Name("fastFormats"),ud=(t,e={keywords:!0})=>{if(Array.isArray(e))return ty(t,e,vn.fullFormats,ey),t;let[r,n]=e.mode==="fast"?[vn.fastFormats,AP]:[vn.fullFormats,ey],o=e.formats||vn.formatNames;return ty(t,o,r,n),e.keywords&&(0,OP.default)(t),t};ud.get=(t,e="full")=>{let n=(e==="fast"?vn.fastFormats:vn.fullFormats)[t];if(!n)throw new Error(`Unknown format "${t}"`);return n};function ty(t,e,r,n){var o,s;(o=(s=t.opts.code).formats)!==null&&o!==void 0||(s.formats=(0,cd._)`require("ajv-formats/dist/formats").${n}`);for(let i of e)t.addFormat(i,r[i])}ry.exports=Po=ud;Object.defineProperty(Po,"__esModule",{value:!0});Po.default=ud});var z={};Ai(z,{BRAND:()=>v_,DIRTY:()=>ir,EMPTY_PATH:()=>Xy,INVALID:()=>N,NEVER:()=>rv,OK:()=>Re,ParseStatus:()=>we,Schema:()=>V,ZodAny:()=>Vt,ZodArray:()=>Rt,ZodBigInt:()=>cr,ZodBoolean:()=>ur,ZodBranded:()=>Tn,ZodCatch:()=>xr,ZodDate:()=>lr,ZodDefault:()=>vr,ZodDiscriminatedUnion:()=>Oo,ZodEffects:()=>Qe,ZodEnum:()=>yr,ZodError:()=>qe,ZodFirstPartyTypeKind:()=>w,ZodFunction:()=>No,ZodIntersection:()=>mr,ZodIssueCode:()=>$,ZodLazy:()=>hr,ZodLiteral:()=>gr,ZodMap:()=>Hr,ZodNaN:()=>Jr,ZodNativeEnum:()=>_r,ZodNever:()=>ct,ZodNull:()=>pr,ZodNullable:()=>vt,ZodNumber:()=>ar,ZodObject:()=>Ue,ZodOptional:()=>Le,ZodParsedType:()=>P,ZodPipeline:()=>Pn,ZodPromise:()=>Ft,ZodReadonly:()=>br,ZodRecord:()=>Ao,ZodSchema:()=>V,ZodSet:()=>Br,ZodString:()=>Ut,ZodSymbol:()=>Fr,ZodTransformer:()=>Qe,ZodTuple:()=>_t,ZodType:()=>V,ZodUndefined:()=>dr,ZodUnion:()=>fr,ZodUnknown:()=>It,ZodVoid:()=>Kr,addIssueToContext:()=>S,any:()=>z_,array:()=>C_,bigint:()=>w_,boolean:()=>Od,coerce:()=>tv,custom:()=>Rd,date:()=>k_,datetimeRegex:()=>Ed,defaultErrorMap:()=>zt,discriminatedUnion:()=>A_,effect:()=>B_,enum:()=>F_,function:()=>L_,getErrorMap:()=>Lr,getParsedType:()=>yt,instanceof:()=>b_,intersection:()=>N_,isAborted:()=>Co,isAsync:()=>Ur,isDirty:()=>jo,isValid:()=>Lt,late:()=>x_,lazy:()=>U_,literal:()=>V_,makeIssue:()=>Sn,map:()=>D_,nan:()=>$_,nativeEnum:()=>K_,never:()=>I_,null:()=>P_,nullable:()=>G_,number:()=>jd,object:()=>Di,objectUtil:()=>Ni,oboolean:()=>ev,onumber:()=>Q_,optional:()=>J_,ostring:()=>Y_,pipeline:()=>X_,preprocess:()=>W_,promise:()=>H_,quotelessJson:()=>Jy,record:()=>M_,set:()=>q_,setErrorMap:()=>Wy,strictObject:()=>j_,string:()=>Cd,symbol:()=>S_,transformer:()=>B_,tuple:()=>Z_,undefined:()=>T_,union:()=>O_,unknown:()=>E_,util:()=>B,void:()=>R_});var B;(function(t){t.assertEqual=o=>{};function e(o){}t.assertIs=e;function r(o){throw new Error}t.assertNever=r,t.arrayToEnum=o=>{let s={};for(let i of o)s[i]=i;return s},t.getValidEnumValues=o=>{let s=t.objectKeys(o).filter(a=>typeof o[o[a]]!="number"),i={};for(let a of s)i[a]=o[a];return t.objectValues(i)},t.objectValues=o=>t.objectKeys(o).map(function(s){return o[s]}),t.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{let s=[];for(let i in o)Object.prototype.hasOwnProperty.call(o,i)&&s.push(i);return s},t.find=(o,s)=>{for(let i of o)if(s(i))return i},t.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function n(o,s=" | "){return o.map(i=>typeof i=="string"?`'${i}'`:i).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(o,s)=>typeof s=="bigint"?s.toString():s})(B||(B={}));var Ni;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Ni||(Ni={}));var P=B.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),yt=t=>{switch(typeof t){case"undefined":return P.undefined;case"string":return P.string;case"number":return Number.isNaN(t)?P.nan:P.number;case"boolean":return P.boolean;case"function":return P.function;case"bigint":return P.bigint;case"symbol":return P.symbol;case"object":return Array.isArray(t)?P.array:t===null?P.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?P.promise:typeof Map<"u"&&t instanceof Map?P.map:typeof Set<"u"&&t instanceof Set?P.set:typeof Date<"u"&&t instanceof Date?P.date:P.object;default:return P.unknown}};var $=B.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Jy=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),qe=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},o=s=>{for(let i of s.issues)if(i.code==="invalid_union")i.unionErrors.map(o);else if(i.code==="invalid_return_type")o(i.returnTypeError);else if(i.code==="invalid_arguments")o(i.argumentsError);else if(i.path.length===0)n._errors.push(r(i));else{let a=n,c=0;for(;c<i.path.length;){let u=i.path[c];c===i.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(i))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return o(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,B.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let o of this.issues)if(o.path.length>0){let s=o.path[0];r[s]=r[s]||[],r[s].push(e(o))}else n.push(e(o));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};qe.create=t=>new qe(t);var Gy=(t,e)=>{let r;switch(t.code){case $.invalid_type:t.received===P.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case $.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,B.jsonStringifyReplacer)}`;break;case $.unrecognized_keys:r=`Unrecognized key(s) in object: ${B.joinValues(t.keys,", ")}`;break;case $.invalid_union:r="Invalid input";break;case $.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${B.joinValues(t.options)}`;break;case $.invalid_enum_value:r=`Invalid enum value. Expected ${B.joinValues(t.options)}, received '${t.received}'`;break;case $.invalid_arguments:r="Invalid function arguments";break;case $.invalid_return_type:r="Invalid function return type";break;case $.invalid_date:r="Invalid date";break;case $.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:B.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case $.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case $.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case $.custom:r="Invalid input";break;case $.invalid_intersection_types:r="Intersection results could not be merged";break;case $.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case $.not_finite:r="Number must be finite";break;default:r=e.defaultError,B.assertNever(t)}return{message:r}},zt=Gy;var kd=zt;function Wy(t){kd=t}function Lr(){return kd}var Sn=t=>{let{data:e,path:r,errorMaps:n,issueData:o}=t,s=[...r,...o.path||[]],i={...o,path:s};if(o.message!==void 0)return{...o,path:s,message:o.message};let a="",c=n.filter(u=>!!u).slice().reverse();for(let u of c)a=u(i,{data:e,defaultError:a}).message;return{...o,path:s,message:a}},Xy=[];function S(t,e){let r=Lr(),n=Sn({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===zt?void 0:zt].filter(o=>!!o)});t.common.issues.push(n)}var we=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let o of r){if(o.status==="aborted")return N;o.status==="dirty"&&e.dirty(),n.push(o.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let o of r){let s=await o.key,i=await o.value;n.push({key:s,value:i})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let o of r){let{key:s,value:i}=o;if(s.status==="aborted"||i.status==="aborted")return N;s.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof i.value<"u"||o.alwaysSet)&&(n[s.value]=i.value)}return{status:e.value,value:n}}},N=Object.freeze({status:"aborted"}),ir=t=>({status:"dirty",value:t}),Re=t=>({status:"valid",value:t}),Co=t=>t.status==="aborted",jo=t=>t.status==="dirty",Lt=t=>t.status==="valid",Ur=t=>typeof Promise<"u"&&t instanceof Promise;var R;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(R||(R={}));var Ye=class{constructor(e,r,n,o){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Sd=(t,e)=>{if(Lt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new qe(t.common.issues);return this._error=r,this._error}}};function L(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:o}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:o}:{errorMap:(i,a)=>{let{message:c}=t;return i.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??n??a.defaultError}:i.code!=="invalid_type"?{message:a.defaultError}:{message:c??r??a.defaultError}},description:o}}var V=class{get description(){return this._def.description}_getType(e){return yt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:yt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new we,ctx:{common:e.parent.common,data:e.data,parsedType:yt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(Ur(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){let n={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:yt(e)},o=this._parseSync({data:e,path:n.path,parent:n});return Sd(n,o)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:yt(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:r});return Lt(n)?{value:n.value}:{issues:r.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(n=>Lt(n)?{value:n.value}:{issues:r.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:yt(e)},o=this._parse({data:e,path:n.path,parent:n}),s=await(Ur(o)?o:Promise.resolve(o));return Sd(n,s)}refine(e,r){let n=o=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(o):r;return this._refinement((o,s)=>{let i=e(o),a=()=>s.addIssue({code:$.custom,...n(o)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(a(),!1)):i?!0:(a(),!1)})}refinement(e,r){return this._refinement((n,o)=>e(n)?!0:(o.addIssue(typeof r=="function"?r(n,o):r),!1))}_refinement(e){return new Qe({schema:this,typeName:w.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Le.create(this,this._def)}nullable(){return vt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Rt.create(this)}promise(){return Ft.create(this,this._def)}or(e){return fr.create([this,e],this._def)}and(e){return mr.create(this,e,this._def)}transform(e){return new Qe({...L(this._def),schema:this,typeName:w.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new vr({...L(this._def),innerType:this,defaultValue:r,typeName:w.ZodDefault})}brand(){return new Tn({typeName:w.ZodBranded,type:this,...L(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new xr({...L(this._def),innerType:this,catchValue:r,typeName:w.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Pn.create(this,e)}readonly(){return br.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Yy=/^c[^\s-]{8,}$/i,Qy=/^[0-9a-z]+$/,e_=/^[0-9A-HJKMNP-TV-Z]{26}$/i,t_=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,r_=/^[a-z0-9_-]{21}$/i,n_=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,o_=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,s_=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,i_="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Zi,a_=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,c_=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,u_=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,l_=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,d_=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,p_=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Pd="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",f_=new RegExp(`^${Pd}$`);function zd(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function m_(t){return new RegExp(`^${zd(t)}$`)}function Ed(t){let e=`${Pd}T${zd(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function h_(t,e){return!!((e==="v4"||!e)&&a_.test(t)||(e==="v6"||!e)&&u_.test(t))}function g_(t,e){if(!n_.test(t))return!1;try{let[r]=t.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),o=JSON.parse(atob(n));return!(typeof o!="object"||o===null||"typ"in o&&o?.typ!=="JWT"||!o.alg||e&&o.alg!==e)}catch{return!1}}function y_(t,e){return!!((e==="v4"||!e)&&c_.test(t)||(e==="v6"||!e)&&l_.test(t))}var Ut=class t extends V{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==P.string){let s=this._getOrReturnCtx(e);return S(s,{code:$.invalid_type,expected:P.string,received:s.parsedType}),N}let n=new we,o;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(o=this._getOrReturnCtx(e,o),S(o,{code:$.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(o=this._getOrReturnCtx(e,o),S(o,{code:$.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let i=e.data.length>s.value,a=e.data.length<s.value;(i||a)&&(o=this._getOrReturnCtx(e,o),i?S(o,{code:$.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&S(o,{code:$.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")s_.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"email",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")Zi||(Zi=new RegExp(i_,"u")),Zi.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"emoji",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")t_.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"uuid",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")r_.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"nanoid",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")Yy.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"cuid",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")Qy.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"cuid2",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")e_.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"ulid",code:$.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{o=this._getOrReturnCtx(e,o),S(o,{validation:"url",code:$.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"regex",code:$.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(o=this._getOrReturnCtx(e,o),S(o,{code:$.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(o=this._getOrReturnCtx(e,o),S(o,{code:$.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(o=this._getOrReturnCtx(e,o),S(o,{code:$.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?Ed(s).test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{code:$.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?f_.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{code:$.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?m_(s).test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{code:$.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?o_.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"duration",code:$.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?h_(e.data,s.version)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"ip",code:$.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?g_(e.data,s.alg)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"jwt",code:$.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?y_(e.data,s.version)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"cidr",code:$.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?d_.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"base64",code:$.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?p_.test(e.data)||(o=this._getOrReturnCtx(e,o),S(o,{validation:"base64url",code:$.invalid_string,message:s.message}),n.dirty()):B.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(o=>e.test(o),{validation:r,code:$.invalid_string,...R.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...R.errToObj(e)})}url(e){return this._addCheck({kind:"url",...R.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...R.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...R.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...R.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...R.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...R.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...R.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...R.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...R.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...R.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...R.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...R.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...R.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...R.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...R.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...R.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...R.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...R.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...R.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...R.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...R.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...R.errToObj(r)})}nonempty(e){return this.min(1,R.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Ut.create=t=>new Ut({checks:[],typeName:w.ZodString,coerce:t?.coerce??!1,...L(t)});function __(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,s=Number.parseInt(t.toFixed(o).replace(".","")),i=Number.parseInt(e.toFixed(o).replace(".",""));return s%i/10**o}var ar=class t extends V{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==P.number){let s=this._getOrReturnCtx(e);return S(s,{code:$.invalid_type,expected:P.number,received:s.parsedType}),N}let n,o=new we;for(let s of this._def.checks)s.kind==="int"?B.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{code:$.invalid_type,expected:"integer",received:"float",message:s.message}),o.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),S(n,{code:$.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),S(n,{code:$.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="multipleOf"?__(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),S(n,{code:$.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{code:$.not_finite,message:s.message}),o.dirty()):B.assertNever(s);return{status:o.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,R.toString(r))}gt(e,r){return this.setLimit("min",e,!1,R.toString(r))}lte(e,r){return this.setLimit("max",e,!0,R.toString(r))}lt(e,r){return this.setLimit("max",e,!1,R.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:R.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:R.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:R.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:R.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:R.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:R.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&B.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};ar.create=t=>new ar({checks:[],typeName:w.ZodNumber,coerce:t?.coerce||!1,...L(t)});var cr=class t extends V{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==P.bigint)return this._getInvalidInput(e);let n,o=new we;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),S(n,{code:$.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),S(n,{code:$.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),S(n,{code:$.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):B.assertNever(s);return{status:o.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return S(r,{code:$.invalid_type,expected:P.bigint,received:r.parsedType}),N}gte(e,r){return this.setLimit("min",e,!0,R.toString(r))}gt(e,r){return this.setLimit("min",e,!1,R.toString(r))}lte(e,r){return this.setLimit("max",e,!0,R.toString(r))}lt(e,r){return this.setLimit("max",e,!1,R.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:R.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:R.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};cr.create=t=>new cr({checks:[],typeName:w.ZodBigInt,coerce:t?.coerce??!1,...L(t)});var ur=class extends V{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==P.boolean){let n=this._getOrReturnCtx(e);return S(n,{code:$.invalid_type,expected:P.boolean,received:n.parsedType}),N}return Re(e.data)}};ur.create=t=>new ur({typeName:w.ZodBoolean,coerce:t?.coerce||!1,...L(t)});var lr=class t extends V{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==P.date){let s=this._getOrReturnCtx(e);return S(s,{code:$.invalid_type,expected:P.date,received:s.parsedType}),N}if(Number.isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return S(s,{code:$.invalid_date}),N}let n=new we,o;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(o=this._getOrReturnCtx(e,o),S(o,{code:$.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(o=this._getOrReturnCtx(e,o),S(o,{code:$.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):B.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:R.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:R.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};lr.create=t=>new lr({checks:[],coerce:t?.coerce||!1,typeName:w.ZodDate,...L(t)});var Fr=class extends V{_parse(e){if(this._getType(e)!==P.symbol){let n=this._getOrReturnCtx(e);return S(n,{code:$.invalid_type,expected:P.symbol,received:n.parsedType}),N}return Re(e.data)}};Fr.create=t=>new Fr({typeName:w.ZodSymbol,...L(t)});var dr=class extends V{_parse(e){if(this._getType(e)!==P.undefined){let n=this._getOrReturnCtx(e);return S(n,{code:$.invalid_type,expected:P.undefined,received:n.parsedType}),N}return Re(e.data)}};dr.create=t=>new dr({typeName:w.ZodUndefined,...L(t)});var pr=class extends V{_parse(e){if(this._getType(e)!==P.null){let n=this._getOrReturnCtx(e);return S(n,{code:$.invalid_type,expected:P.null,received:n.parsedType}),N}return Re(e.data)}};pr.create=t=>new pr({typeName:w.ZodNull,...L(t)});var Vt=class extends V{constructor(){super(...arguments),this._any=!0}_parse(e){return Re(e.data)}};Vt.create=t=>new Vt({typeName:w.ZodAny,...L(t)});var It=class extends V{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Re(e.data)}};It.create=t=>new It({typeName:w.ZodUnknown,...L(t)});var ct=class extends V{_parse(e){let r=this._getOrReturnCtx(e);return S(r,{code:$.invalid_type,expected:P.never,received:r.parsedType}),N}};ct.create=t=>new ct({typeName:w.ZodNever,...L(t)});var Kr=class extends V{_parse(e){if(this._getType(e)!==P.undefined){let n=this._getOrReturnCtx(e);return S(n,{code:$.invalid_type,expected:P.void,received:n.parsedType}),N}return Re(e.data)}};Kr.create=t=>new Kr({typeName:w.ZodVoid,...L(t)});var Rt=class t extends V{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),o=this._def;if(r.parsedType!==P.array)return S(r,{code:$.invalid_type,expected:P.array,received:r.parsedType}),N;if(o.exactLength!==null){let i=r.data.length>o.exactLength.value,a=r.data.length<o.exactLength.value;(i||a)&&(S(r,{code:i?$.too_big:$.too_small,minimum:a?o.exactLength.value:void 0,maximum:i?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),n.dirty())}if(o.minLength!==null&&r.data.length<o.minLength.value&&(S(r,{code:$.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),n.dirty()),o.maxLength!==null&&r.data.length>o.maxLength.value&&(S(r,{code:$.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((i,a)=>o.type._parseAsync(new Ye(r,i,r.path,a)))).then(i=>we.mergeArray(n,i));let s=[...r.data].map((i,a)=>o.type._parseSync(new Ye(r,i,r.path,a)));return we.mergeArray(n,s)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:R.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:R.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:R.toString(r)}})}nonempty(e){return this.min(1,e)}};Rt.create=(t,e)=>new Rt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:w.ZodArray,...L(e)});function Vr(t){if(t instanceof Ue){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=Le.create(Vr(n))}return new Ue({...t._def,shape:()=>e})}else return t instanceof Rt?new Rt({...t._def,type:Vr(t.element)}):t instanceof Le?Le.create(Vr(t.unwrap())):t instanceof vt?vt.create(Vr(t.unwrap())):t instanceof _t?_t.create(t.items.map(e=>Vr(e))):t}var Ue=class t extends V{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=B.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==P.object){let u=this._getOrReturnCtx(e);return S(u,{code:$.invalid_type,expected:P.object,received:u.parsedType}),N}let{status:n,ctx:o}=this._processInputParams(e),{shape:s,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof ct&&this._def.unknownKeys==="strip"))for(let u in o.data)i.includes(u)||a.push(u);let c=[];for(let u of i){let l=s[u],d=o.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Ye(o,d,o.path,u)),alwaysSet:u in o.data})}if(this._def.catchall instanceof ct){let u=this._def.unknownKeys;if(u==="passthrough")for(let l of a)c.push({key:{status:"valid",value:l},value:{status:"valid",value:o.data[l]}});else if(u==="strict")a.length>0&&(S(o,{code:$.unrecognized_keys,keys:a}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let l of a){let d=o.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Ye(o,d,o.path,l)),alwaysSet:l in o.data})}}return o.common.async?Promise.resolve().then(async()=>{let u=[];for(let l of c){let d=await l.key,f=await l.value;u.push({key:d,value:f,alwaysSet:l.alwaysSet})}return u}).then(u=>we.mergeObjectSync(n,u)):we.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return R.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{let o=this._def.errorMap?.(r,n).message??n.defaultError;return r.code==="unrecognized_keys"?{message:R.errToObj(e).message??o}:{message:o}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:w.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};for(let n of B.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}omit(e){let r={};for(let n of B.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}deepPartial(){return Vr(this)}partial(e){let r={};for(let n of B.objectKeys(this.shape)){let o=this.shape[n];e&&!e[n]?r[n]=o:r[n]=o.optional()}return new t({...this._def,shape:()=>r})}required(e){let r={};for(let n of B.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof Le;)s=s._def.innerType;r[n]=s}return new t({...this._def,shape:()=>r})}keyof(){return Id(B.objectKeys(this.shape))}};Ue.create=(t,e)=>new Ue({shape:()=>t,unknownKeys:"strip",catchall:ct.create(),typeName:w.ZodObject,...L(e)});Ue.strictCreate=(t,e)=>new Ue({shape:()=>t,unknownKeys:"strict",catchall:ct.create(),typeName:w.ZodObject,...L(e)});Ue.lazycreate=(t,e)=>new Ue({shape:t,unknownKeys:"strip",catchall:ct.create(),typeName:w.ZodObject,...L(e)});var fr=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function o(s){for(let a of s)if(a.result.status==="valid")return a.result;for(let a of s)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;let i=s.map(a=>new qe(a.ctx.common.issues));return S(r,{code:$.invalid_union,unionErrors:i}),N}if(r.common.async)return Promise.all(n.map(async s=>{let i={...r,common:{...r.common,issues:[]},parent:null};return{result:await s._parseAsync({data:r.data,path:r.path,parent:i}),ctx:i}})).then(o);{let s,i=[];for(let c of n){let u={...r,common:{...r.common,issues:[]},parent:null},l=c._parseSync({data:r.data,path:r.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!s&&(s={result:l,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(s)return r.common.issues.push(...s.ctx.common.issues),s.result;let a=i.map(c=>new qe(c));return S(r,{code:$.invalid_union,unionErrors:a}),N}}get options(){return this._def.options}};fr.create=(t,e)=>new fr({options:t,typeName:w.ZodUnion,...L(e)});var Et=t=>t instanceof hr?Et(t.schema):t instanceof Qe?Et(t.innerType()):t instanceof gr?[t.value]:t instanceof yr?t.options:t instanceof _r?B.objectValues(t.enum):t instanceof vr?Et(t._def.innerType):t instanceof dr?[void 0]:t instanceof pr?[null]:t instanceof Le?[void 0,...Et(t.unwrap())]:t instanceof vt?[null,...Et(t.unwrap())]:t instanceof Tn||t instanceof br?Et(t.unwrap()):t instanceof xr?Et(t._def.innerType):[],Oo=class t extends V{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==P.object)return S(r,{code:$.invalid_type,expected:P.object,received:r.parsedType}),N;let n=this.discriminator,o=r.data[n],s=this.optionsMap.get(o);return s?r.common.async?s._parseAsync({data:r.data,path:r.path,parent:r}):s._parseSync({data:r.data,path:r.path,parent:r}):(S(r,{code:$.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),N)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let o=new Map;for(let s of r){let i=Et(s.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of i){if(o.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);o.set(a,s)}}return new t({typeName:w.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:o,...L(n)})}};function Mi(t,e){let r=yt(t),n=yt(e);if(t===e)return{valid:!0,data:t};if(r===P.object&&n===P.object){let o=B.objectKeys(e),s=B.objectKeys(t).filter(a=>o.indexOf(a)!==-1),i={...t,...e};for(let a of s){let c=Mi(t[a],e[a]);if(!c.valid)return{valid:!1};i[a]=c.data}return{valid:!0,data:i}}else if(r===P.array&&n===P.array){if(t.length!==e.length)return{valid:!1};let o=[];for(let s=0;s<t.length;s++){let i=t[s],a=e[s],c=Mi(i,a);if(!c.valid)return{valid:!1};o.push(c.data)}return{valid:!0,data:o}}else return r===P.date&&n===P.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var mr=class extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=(s,i)=>{if(Co(s)||Co(i))return N;let a=Mi(s.value,i.value);return a.valid?((jo(s)||jo(i))&&r.dirty(),{status:r.value,value:a.data}):(S(n,{code:$.invalid_intersection_types}),N)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,i])=>o(s,i)):o(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};mr.create=(t,e,r)=>new mr({left:t,right:e,typeName:w.ZodIntersection,...L(r)});var _t=class t extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.array)return S(n,{code:$.invalid_type,expected:P.array,received:n.parsedType}),N;if(n.data.length<this._def.items.length)return S(n,{code:$.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),N;!this._def.rest&&n.data.length>this._def.items.length&&(S(n,{code:$.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let s=[...n.data].map((i,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new Ye(n,i,n.path,a)):null}).filter(i=>!!i);return n.common.async?Promise.all(s).then(i=>we.mergeArray(r,i)):we.mergeArray(r,s)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};_t.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new _t({items:t,typeName:w.ZodTuple,rest:null,...L(e)})};var Ao=class t extends V{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.object)return S(n,{code:$.invalid_type,expected:P.object,received:n.parsedType}),N;let o=[],s=this._def.keyType,i=this._def.valueType;for(let a in n.data)o.push({key:s._parse(new Ye(n,a,n.path,a)),value:i._parse(new Ye(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?we.mergeObjectAsync(r,o):we.mergeObjectSync(r,o)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof V?new t({keyType:e,valueType:r,typeName:w.ZodRecord,...L(n)}):new t({keyType:Ut.create(),valueType:e,typeName:w.ZodRecord,...L(r)})}},Hr=class extends V{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.map)return S(n,{code:$.invalid_type,expected:P.map,received:n.parsedType}),N;let o=this._def.keyType,s=this._def.valueType,i=[...n.data.entries()].map(([a,c],u)=>({key:o._parse(new Ye(n,a,n.path,[u,"key"])),value:s._parse(new Ye(n,c,n.path,[u,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of i){let u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return N;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}})}else{let a=new Map;for(let c of i){let u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return N;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}}}};Hr.create=(t,e,r)=>new Hr({valueType:e,keyType:t,typeName:w.ZodMap,...L(r)});var Br=class t extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.set)return S(n,{code:$.invalid_type,expected:P.set,received:n.parsedType}),N;let o=this._def;o.minSize!==null&&n.data.size<o.minSize.value&&(S(n,{code:$.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),r.dirty()),o.maxSize!==null&&n.data.size>o.maxSize.value&&(S(n,{code:$.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),r.dirty());let s=this._def.valueType;function i(c){let u=new Set;for(let l of c){if(l.status==="aborted")return N;l.status==="dirty"&&r.dirty(),u.add(l.value)}return{status:r.value,value:u}}let a=[...n.data.values()].map((c,u)=>s._parse(new Ye(n,c,n.path,u)));return n.common.async?Promise.all(a).then(c=>i(c)):i(a)}min(e,r){return new t({...this._def,minSize:{value:e,message:R.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:R.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};Br.create=(t,e)=>new Br({valueType:t,minSize:null,maxSize:null,typeName:w.ZodSet,...L(e)});var No=class t extends V{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==P.function)return S(r,{code:$.invalid_type,expected:P.function,received:r.parsedType}),N;function n(a,c){return Sn({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Lr(),zt].filter(u=>!!u),issueData:{code:$.invalid_arguments,argumentsError:c}})}function o(a,c){return Sn({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Lr(),zt].filter(u=>!!u),issueData:{code:$.invalid_return_type,returnTypeError:c}})}let s={errorMap:r.common.contextualErrorMap},i=r.data;if(this._def.returns instanceof Ft){let a=this;return Re(async function(...c){let u=new qe([]),l=await a._def.args.parseAsync(c,s).catch(m=>{throw u.addIssue(n(c,m)),u}),d=await Reflect.apply(i,this,l);return await a._def.returns._def.type.parseAsync(d,s).catch(m=>{throw u.addIssue(o(d,m)),u})})}else{let a=this;return Re(function(...c){let u=a._def.args.safeParse(c,s);if(!u.success)throw new qe([n(c,u.error)]);let l=Reflect.apply(i,this,u.data),d=a._def.returns.safeParse(l,s);if(!d.success)throw new qe([o(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:_t.create(e).rest(It.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||_t.create([]).rest(It.create()),returns:r||It.create(),typeName:w.ZodFunction,...L(n)})}},hr=class extends V{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};hr.create=(t,e)=>new hr({getter:t,typeName:w.ZodLazy,...L(e)});var gr=class extends V{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return S(r,{received:r.data,code:$.invalid_literal,expected:this._def.value}),N}return{status:"valid",value:e.data}}get value(){return this._def.value}};gr.create=(t,e)=>new gr({value:t,typeName:w.ZodLiteral,...L(e)});function Id(t,e){return new yr({values:t,typeName:w.ZodEnum,...L(e)})}var yr=class t extends V{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return S(r,{expected:B.joinValues(n),received:r.parsedType,code:$.invalid_type}),N}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return S(r,{received:r.data,code:$.invalid_enum_value,options:n}),N}return Re(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};yr.create=Id;var _r=class extends V{_parse(e){let r=B.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==P.string&&n.parsedType!==P.number){let o=B.objectValues(r);return S(n,{expected:B.joinValues(o),received:n.parsedType,code:$.invalid_type}),N}if(this._cache||(this._cache=new Set(B.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let o=B.objectValues(r);return S(n,{received:n.data,code:$.invalid_enum_value,options:o}),N}return Re(e.data)}get enum(){return this._def.values}};_r.create=(t,e)=>new _r({values:t,typeName:w.ZodNativeEnum,...L(e)});var Ft=class extends V{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==P.promise&&r.common.async===!1)return S(r,{code:$.invalid_type,expected:P.promise,received:r.parsedType}),N;let n=r.parsedType===P.promise?r.data:Promise.resolve(r.data);return Re(n.then(o=>this._def.type.parseAsync(o,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Ft.create=(t,e)=>new Ft({type:t,typeName:w.ZodPromise,...L(e)});var Qe=class extends V{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===w.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=this._def.effect||null,s={addIssue:i=>{S(n,i),i.fatal?r.abort():r.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),o.type==="preprocess"){let i=o.transform(n.data,s);if(n.common.async)return Promise.resolve(i).then(async a=>{if(r.value==="aborted")return N;let c=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return c.status==="aborted"?N:c.status==="dirty"?ir(c.value):r.value==="dirty"?ir(c.value):c});{if(r.value==="aborted")return N;let a=this._def.schema._parseSync({data:i,path:n.path,parent:n});return a.status==="aborted"?N:a.status==="dirty"?ir(a.value):r.value==="dirty"?ir(a.value):a}}if(o.type==="refinement"){let i=a=>{let c=o.refinement(a,s);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?N:(a.status==="dirty"&&r.dirty(),i(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?N:(a.status==="dirty"&&r.dirty(),i(a.value).then(()=>({status:r.value,value:a.value}))))}if(o.type==="transform")if(n.common.async===!1){let i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Lt(i))return N;let a=o.transform(i.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>Lt(i)?Promise.resolve(o.transform(i.value,s)).then(a=>({status:r.value,value:a})):N);B.assertNever(o)}};Qe.create=(t,e,r)=>new Qe({schema:t,typeName:w.ZodEffects,effect:e,...L(r)});Qe.createWithPreprocess=(t,e,r)=>new Qe({schema:e,effect:{type:"preprocess",transform:t},typeName:w.ZodEffects,...L(r)});var Le=class extends V{_parse(e){return this._getType(e)===P.undefined?Re(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Le.create=(t,e)=>new Le({innerType:t,typeName:w.ZodOptional,...L(e)});var vt=class extends V{_parse(e){return this._getType(e)===P.null?Re(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};vt.create=(t,e)=>new vt({innerType:t,typeName:w.ZodNullable,...L(e)});var vr=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===P.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};vr.create=(t,e)=>new vr({innerType:t,typeName:w.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...L(e)});var xr=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},o=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Ur(o)?o.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new qe(n.common.issues)},input:n.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new qe(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};xr.create=(t,e)=>new xr({innerType:t,typeName:w.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...L(e)});var Jr=class extends V{_parse(e){if(this._getType(e)!==P.nan){let n=this._getOrReturnCtx(e);return S(n,{code:$.invalid_type,expected:P.nan,received:n.parsedType}),N}return{status:"valid",value:e.data}}};Jr.create=t=>new Jr({typeName:w.ZodNaN,...L(t)});var v_=Symbol("zod_brand"),Tn=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},Pn=class t extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?N:s.status==="dirty"?(r.dirty(),ir(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{let o=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?N:o.status==="dirty"?(r.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:w.ZodPipeline})}},br=class extends V{_parse(e){let r=this._def.innerType._parse(e),n=o=>(Lt(o)&&(o.value=Object.freeze(o.value)),o);return Ur(r)?r.then(o=>n(o)):n(r)}unwrap(){return this._def.innerType}};br.create=(t,e)=>new br({innerType:t,typeName:w.ZodReadonly,...L(e)});function Td(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function Rd(t,e={},r){return t?Vt.create().superRefine((n,o)=>{let s=t(n);if(s instanceof Promise)return s.then(i=>{if(!i){let a=Td(e,n),c=a.fatal??r??!0;o.addIssue({code:"custom",...a,fatal:c})}});if(!s){let i=Td(e,n),a=i.fatal??r??!0;o.addIssue({code:"custom",...i,fatal:a})}}):Vt.create()}var x_={object:Ue.lazycreate},w;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(w||(w={}));var b_=(t,e={message:`Input not instance of ${t.name}`})=>Rd(r=>r instanceof t,e),Cd=Ut.create,jd=ar.create,$_=Jr.create,w_=cr.create,Od=ur.create,k_=lr.create,S_=Fr.create,T_=dr.create,P_=pr.create,z_=Vt.create,E_=It.create,I_=ct.create,R_=Kr.create,C_=Rt.create,Di=Ue.create,j_=Ue.strictCreate,O_=fr.create,A_=Oo.create,N_=mr.create,Z_=_t.create,M_=Ao.create,D_=Hr.create,q_=Br.create,L_=No.create,U_=hr.create,V_=gr.create,F_=yr.create,K_=_r.create,H_=Ft.create,B_=Qe.create,J_=Le.create,G_=vt.create,W_=Qe.createWithPreprocess,X_=Pn.create,Y_=()=>Cd().optional(),Q_=()=>jd().optional(),ev=()=>Od().optional(),tv={string:t=>Ut.create({...t,coerce:!0}),number:t=>ar.create({...t,coerce:!0}),boolean:t=>ur.create({...t,coerce:!0}),bigint:t=>cr.create({...t,coerce:!0}),date:t=>lr.create({...t,coerce:!0})};var rv=N;var nv=Object.freeze({status:"aborted"});function v(t,e,r){function n(a,c){var u;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(u=a._zod).traits??(u.traits=new Set),a._zod.traits.add(t),e(a,c);for(let l in i.prototype)l in a||Object.defineProperty(a,l,{value:i.prototype[l].bind(a)});a._zod.constr=i,a._zod.def=c}let o=r?.Parent??Object;class s extends o{}Object.defineProperty(s,"name",{value:t});function i(a){var c;let u=r?.Parent?new s:this;n(u,a),(c=u._zod).deferred??(c.deferred=[]);for(let l of u._zod.deferred)l();return u}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(t)}),Object.defineProperty(i,"name",{value:t}),i}var ov=Symbol("zod_brand"),Ct=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},Zo={};function Je(t){return t&&Object.assign(Zo,t),Zo}var J={};Ai(J,{BIGINT_FORMAT_RANGES:()=>Nd,Class:()=>Li,NUMBER_FORMAT_RANGES:()=>Ji,aborted:()=>wr,allowsEval:()=>Ki,assert:()=>uv,assertEqual:()=>sv,assertIs:()=>av,assertNever:()=>cv,assertNotEqual:()=>iv,assignProp:()=>Fi,cached:()=>In,captureStackTrace:()=>Do,cleanEnum:()=>$v,cleanRegex:()=>Cn,clone:()=>Ge,createTransparentProxy:()=>hv,defineLazy:()=>ie,esc:()=>$r,escapeRegex:()=>Kt,extend:()=>_v,finalizeIssue:()=>ut,floatSafeRemainder:()=>Vi,getElementAtPath:()=>lv,getEnumValues:()=>En,getLengthableOrigin:()=>jn,getParsedType:()=>mv,getSizableOrigin:()=>Zd,isObject:()=>Gr,isPlainObject:()=>Wr,issue:()=>Gi,joinValues:()=>Mo,jsonStringifyReplacer:()=>Ui,merge:()=>vv,normalizeParams:()=>Z,nullish:()=>Rn,numKeys:()=>fv,omit:()=>yv,optionalKeys:()=>Bi,partial:()=>xv,pick:()=>gv,prefixIssues:()=>xt,primitiveTypes:()=>Ad,promiseAllObject:()=>dv,propertyKeyTypes:()=>Hi,randomString:()=>pv,required:()=>bv,stringifyPrimitive:()=>qo,unwrapMessage:()=>zn});function sv(t){return t}function iv(t){return t}function av(t){}function cv(t){throw new Error}function uv(t){}function En(t){let e=Object.values(t).filter(n=>typeof n=="number");return Object.entries(t).filter(([n,o])=>e.indexOf(+n)===-1).map(([n,o])=>o)}function Mo(t,e="|"){return t.map(r=>qo(r)).join(e)}function Ui(t,e){return typeof e=="bigint"?e.toString():e}function In(t){return{get value(){{let r=t();return Object.defineProperty(this,"value",{value:r}),r}throw new Error("cached value already set")}}}function Rn(t){return t==null}function Cn(t){let e=t.startsWith("^")?1:0,r=t.endsWith("$")?t.length-1:t.length;return t.slice(e,r)}function Vi(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,s=Number.parseInt(t.toFixed(o).replace(".","")),i=Number.parseInt(e.toFixed(o).replace(".",""));return s%i/10**o}function ie(t,e,r){Object.defineProperty(t,e,{get(){{let o=r();return t[e]=o,o}throw new Error("cached value already set")},set(o){Object.defineProperty(t,e,{value:o})},configurable:!0})}function Fi(t,e,r){Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}function lv(t,e){return e?e.reduce((r,n)=>r?.[n],t):t}function dv(t){let e=Object.keys(t),r=e.map(n=>t[n]);return Promise.all(r).then(n=>{let o={};for(let s=0;s<e.length;s++)o[e[s]]=n[s];return o})}function pv(t=10){let e="abcdefghijklmnopqrstuvwxyz",r="";for(let n=0;n<t;n++)r+=e[Math.floor(Math.random()*e.length)];return r}function $r(t){return JSON.stringify(t)}var Do=Error.captureStackTrace?Error.captureStackTrace:(...t)=>{};function Gr(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}var Ki=In(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let t=Function;return new t(""),!0}catch{return!1}});function Wr(t){if(Gr(t)===!1)return!1;let e=t.constructor;if(e===void 0)return!0;let r=e.prototype;return!(Gr(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function fv(t){let e=0;for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}var mv=t=>{let e=typeof t;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(t)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(t)?"array":t===null?"null":t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?"promise":typeof Map<"u"&&t instanceof Map?"map":typeof Set<"u"&&t instanceof Set?"set":typeof Date<"u"&&t instanceof Date?"date":typeof File<"u"&&t instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},Hi=new Set(["string","number","symbol"]),Ad=new Set(["string","number","bigint","boolean","symbol","undefined"]);function Kt(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ge(t,e,r){let n=new t._zod.constr(e??t._zod.def);return(!e||r?.parent)&&(n._zod.parent=t),n}function Z(t){let e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function hv(t){let e;return new Proxy({},{get(r,n,o){return e??(e=t()),Reflect.get(e,n,o)},set(r,n,o,s){return e??(e=t()),Reflect.set(e,n,o,s)},has(r,n){return e??(e=t()),Reflect.has(e,n)},deleteProperty(r,n){return e??(e=t()),Reflect.deleteProperty(e,n)},ownKeys(r){return e??(e=t()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(r,n){return e??(e=t()),Reflect.getOwnPropertyDescriptor(e,n)},defineProperty(r,n,o){return e??(e=t()),Reflect.defineProperty(e,n,o)}})}function qo(t){return typeof t=="bigint"?t.toString()+"n":typeof t=="string"?`"${t}"`:`${t}`}function Bi(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}var Ji={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},Nd={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function gv(t,e){let r={},n=t._zod.def;for(let o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&(r[o]=n.shape[o])}return Ge(t,{...t._zod.def,shape:r,checks:[]})}function yv(t,e){let r={...t._zod.def.shape},n=t._zod.def;for(let o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&delete r[o]}return Ge(t,{...t._zod.def,shape:r,checks:[]})}function _v(t,e){if(!Wr(e))throw new Error("Invalid input to extend: expected a plain object");let r={...t._zod.def,get shape(){let n={...t._zod.def.shape,...e};return Fi(this,"shape",n),n},checks:[]};return Ge(t,r)}function vv(t,e){return Ge(t,{...t._zod.def,get shape(){let r={...t._zod.def.shape,...e._zod.def.shape};return Fi(this,"shape",r),r},catchall:e._zod.def.catchall,checks:[]})}function xv(t,e,r){let n=e._zod.def.shape,o={...n};if(r)for(let s in r){if(!(s in n))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=t?new t({type:"optional",innerType:n[s]}):n[s])}else for(let s in n)o[s]=t?new t({type:"optional",innerType:n[s]}):n[s];return Ge(e,{...e._zod.def,shape:o,checks:[]})}function bv(t,e,r){let n=e._zod.def.shape,o={...n};if(r)for(let s in r){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=new t({type:"nonoptional",innerType:n[s]}))}else for(let s in n)o[s]=new t({type:"nonoptional",innerType:n[s]});return Ge(e,{...e._zod.def,shape:o,checks:[]})}function wr(t,e=0){for(let r=e;r<t.issues.length;r++)if(t.issues[r]?.continue!==!0)return!0;return!1}function xt(t,e){return e.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(t),r})}function zn(t){return typeof t=="string"?t:t?.message}function ut(t,e,r){let n={...t,path:t.path??[]};if(!t.message){let o=zn(t.inst?._zod.def?.error?.(t))??zn(e?.error?.(t))??zn(r.customError?.(t))??zn(r.localeError?.(t))??"Invalid input";n.message=o}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}function Zd(t){return t instanceof Set?"set":t instanceof Map?"map":t instanceof File?"file":"unknown"}function jn(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function Gi(...t){let[e,r,n]=t;return typeof e=="string"?{message:e,code:"custom",input:r,inst:n}:{...e}}function $v(t){return Object.entries(t).filter(([e,r])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}var Li=class{constructor(...e){}};var Md=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),Object.defineProperty(t,"message",{get(){return JSON.stringify(e,Ui,2)},enumerable:!0}),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},Lo=v("$ZodError",Md),On=v("$ZodError",Md,{Parent:Error});function Wi(t,e=r=>r.message){let r={},n=[];for(let o of t.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(e(o))):n.push(e(o));return{formErrors:n,fieldErrors:r}}function Xi(t,e){let r=e||function(s){return s.message},n={_errors:[]},o=s=>{for(let i of s.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(a=>o({issues:a}));else if(i.code==="invalid_key")o({issues:i.issues});else if(i.code==="invalid_element")o({issues:i.issues});else if(i.path.length===0)n._errors.push(r(i));else{let a=n,c=0;for(;c<i.path.length;){let u=i.path[c];c===i.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(i))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return o(t),n}var Yi=t=>(e,r,n,o)=>{let s=n?Object.assign(n,{async:!1}):{async:!1},i=e._zod.run({value:r,issues:[]},s);if(i instanceof Promise)throw new Ct;if(i.issues.length){let a=new(o?.Err??t)(i.issues.map(c=>ut(c,s,Je())));throw Do(a,o?.callee),a}return i.value},Qi=Yi(On),ea=t=>async(e,r,n,o)=>{let s=n?Object.assign(n,{async:!0}):{async:!0},i=e._zod.run({value:r,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){let a=new(o?.Err??t)(i.issues.map(c=>ut(c,s,Je())));throw Do(a,o?.callee),a}return i.value},ta=ea(On),ra=t=>(e,r,n)=>{let o=n?{...n,async:!1}:{async:!1},s=e._zod.run({value:r,issues:[]},o);if(s instanceof Promise)throw new Ct;return s.issues.length?{success:!1,error:new(t??Lo)(s.issues.map(i=>ut(i,o,Je())))}:{success:!0,data:s.value}},kr=ra(On),na=t=>async(e,r,n)=>{let o=n?Object.assign(n,{async:!0}):{async:!0},s=e._zod.run({value:r,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new t(s.issues.map(i=>ut(i,o,Je())))}:{success:!0,data:s.value}},Sr=na(On);var Dd=/^[cC][^\s-]{8,}$/,qd=/^[0-9a-z]+$/,Ld=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Ud=/^[0-9a-vA-V]{20}$/,Vd=/^[A-Za-z0-9]{27}$/,Fd=/^[a-zA-Z0-9_-]{21}$/,Kd=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/;var Hd=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,oa=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/;var Bd=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;var kv="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Jd(){return new RegExp(kv,"u")}var Gd=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Wd=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,Xd=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Yd=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Qd=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,sa=/^[A-Za-z0-9_-]*$/,ep=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/;var tp=/^\+(?:[0-9]){6,14}[0-9]$/,rp="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",np=new RegExp(`^${rp}$`);function op(t){let e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function sp(t){return new RegExp(`^${op(t)}$`)}function ip(t){let e=op({precision:t.precision}),r=["Z"];t.local&&r.push(""),t.offset&&r.push("([+-]\\d{2}:\\d{2})");let n=`${e}(?:${r.join("|")})`;return new RegExp(`^${rp}T(?:${n})$`)}var ap=t=>{let e=t?`[\\s\\S]{${t?.minimum??0},${t?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)};var cp=/^\d+$/,up=/^-?\d+(?:\.\d+)?/i,lp=/true|false/i,dp=/null/i;var pp=/^[^A-Z]*$/,fp=/^[^a-z]*$/;var ke=v("$ZodCheck",(t,e)=>{var r;t._zod??(t._zod={}),t._zod.def=e,(r=t._zod).onattach??(r.onattach=[])}),mp={number:"number",bigint:"bigint",object:"date"},ia=v("$ZodCheckLessThan",(t,e)=>{ke.init(t,e);let r=mp[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,s=(e.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<s&&(e.inclusive?o.maximum=e.value:o.exclusiveMaximum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value<=e.value:n.value<e.value)||n.issues.push({origin:r,code:"too_big",maximum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),aa=v("$ZodCheckGreaterThan",(t,e)=>{ke.init(t,e);let r=mp[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,s=(e.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>s&&(e.inclusive?o.minimum=e.value:o.exclusiveMinimum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value>=e.value:n.value>e.value)||n.issues.push({origin:r,code:"too_small",minimum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),hp=v("$ZodCheckMultipleOf",(t,e)=>{ke.init(t,e),t._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=e.value)}),t._zod.check=r=>{if(typeof r.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%e.value===BigInt(0):Vi(r.value,e.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:e.value,input:r.value,inst:t,continue:!e.abort})}}),gp=v("$ZodCheckNumberFormat",(t,e)=>{ke.init(t,e),e.format=e.format||"float64";let r=e.format?.includes("int"),n=r?"int":"number",[o,s]=Ji[e.format];t._zod.onattach.push(i=>{let a=i._zod.bag;a.format=e.format,a.minimum=o,a.maximum=s,r&&(a.pattern=cp)}),t._zod.check=i=>{let a=i.value;if(r){if(!Number.isInteger(a)){i.issues.push({expected:n,format:e.format,code:"invalid_type",input:a,inst:t});return}if(!Number.isSafeInteger(a)){a>0?i.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort}):i.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort});return}}a<o&&i.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:t,continue:!e.abort}),a>s&&i.issues.push({origin:"number",input:a,code:"too_big",maximum:s,inst:t})}});var yp=v("$ZodCheckMaxLength",(t,e)=>{var r;ke.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Rn(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let o=n.value;if(o.length<=e.maximum)return;let i=jn(o);n.issues.push({origin:i,code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),_p=v("$ZodCheckMinLength",(t,e)=>{var r;ke.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Rn(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let o=n.value;if(o.length>=e.minimum)return;let i=jn(o);n.issues.push({origin:i,code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),vp=v("$ZodCheckLengthEquals",(t,e)=>{var r;ke.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Rn(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag;o.minimum=e.length,o.maximum=e.length,o.length=e.length}),t._zod.check=n=>{let o=n.value,s=o.length;if(s===e.length)return;let i=jn(o),a=s>e.length;n.issues.push({origin:i,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),An=v("$ZodCheckStringFormat",(t,e)=>{var r,n;ke.init(t,e),t._zod.onattach.push(o=>{let s=o._zod.bag;s.format=e.format,e.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(e.pattern))}),e.pattern?(r=t._zod).check??(r.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:e.format,input:o.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(n=t._zod).check??(n.check=()=>{})}),xp=v("$ZodCheckRegex",(t,e)=>{An.init(t,e),t._zod.check=r=>{e.pattern.lastIndex=0,!e.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),bp=v("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=pp),An.init(t,e)}),$p=v("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=fp),An.init(t,e)}),wp=v("$ZodCheckIncludes",(t,e)=>{ke.init(t,e);let r=Kt(e.includes),n=new RegExp(typeof e.position=="number"?`^.{${e.position}}${r}`:r);e.pattern=n,t._zod.onattach.push(o=>{let s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),t._zod.check=o=>{o.value.includes(e.includes,e.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:o.value,inst:t,continue:!e.abort})}}),kp=v("$ZodCheckStartsWith",(t,e)=>{ke.init(t,e);let r=new RegExp(`^${Kt(e.prefix)}.*`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.startsWith(e.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:n.value,inst:t,continue:!e.abort})}}),Sp=v("$ZodCheckEndsWith",(t,e)=>{ke.init(t,e);let r=new RegExp(`.*${Kt(e.suffix)}$`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.endsWith(e.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:n.value,inst:t,continue:!e.abort})}});var Tp=v("$ZodCheckOverwrite",(t,e)=>{ke.init(t,e),t._zod.check=r=>{r.value=e.tx(r.value)}});var Vo=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let n=e.split(`
`).filter(i=>i),o=Math.min(...n.map(i=>i.length-i.trimStart().length)),s=n.map(i=>i.slice(o)).map(i=>" ".repeat(this.indent*2)+i);for(let i of s)this.content.push(i)}compile(){let e=Function,r=this?.args,o=[...(this?.content??[""]).map(s=>`  ${s}`)];return new e(...r,o.join(`
`))}};var zp={major:4,minor:0,patch:0};var ne=v("$ZodType",(t,e)=>{var r;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=zp;let n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(let o of n)for(let s of o._zod.onattach)s(t);if(n.length===0)(r=t._zod).deferred??(r.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{let o=(s,i,a)=>{let c=wr(s),u;for(let l of i){if(l._zod.def.when){if(!l._zod.def.when(s))continue}else if(c)continue;let d=s.issues.length,f=l._zod.check(s);if(f instanceof Promise&&a?.async===!1)throw new Ct;if(u||f instanceof Promise)u=(u??Promise.resolve()).then(async()=>{await f,s.issues.length!==d&&(c||(c=wr(s,d)))});else{if(s.issues.length===d)continue;c||(c=wr(s,d))}}return u?u.then(()=>s):s};t._zod.run=(s,i)=>{let a=t._zod.parse(s,i);if(a instanceof Promise){if(i.async===!1)throw new Ct;return a.then(c=>o(c,n,i))}return o(a,n,i)}}t["~standard"]={validate:o=>{try{let s=kr(t,o);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return Sr(t,o).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}}),Nn=v("$ZodString",(t,e)=>{ne.init(t,e),t._zod.pattern=[...t?._zod.bag?.patterns??[]].pop()??ap(t._zod.bag),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),ae=v("$ZodStringFormat",(t,e)=>{An.init(t,e),Nn.init(t,e)}),ua=v("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=Hd),ae.init(t,e)}),la=v("$ZodUUID",(t,e)=>{if(e.version){let n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(n===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=oa(n))}else e.pattern??(e.pattern=oa());ae.init(t,e)}),da=v("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=Bd),ae.init(t,e)}),pa=v("$ZodURL",(t,e)=>{ae.init(t,e),t._zod.check=r=>{try{let n=r.value,o=new URL(n),s=o.href;e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(o.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:ep.source,input:r.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:r.value,inst:t,continue:!e.abort})),!n.endsWith("/")&&s.endsWith("/")?r.value=s.slice(0,-1):r.value=s;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:t,continue:!e.abort})}}}),fa=v("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=Jd()),ae.init(t,e)}),ma=v("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=Fd),ae.init(t,e)}),ha=v("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=Dd),ae.init(t,e)}),ga=v("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=qd),ae.init(t,e)}),ya=v("$ZodULID",(t,e)=>{e.pattern??(e.pattern=Ld),ae.init(t,e)}),_a=v("$ZodXID",(t,e)=>{e.pattern??(e.pattern=Ud),ae.init(t,e)}),va=v("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=Vd),ae.init(t,e)}),Mp=v("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=ip(e)),ae.init(t,e)}),Dp=v("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=np),ae.init(t,e)}),qp=v("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=sp(e)),ae.init(t,e)}),Lp=v("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=Kd),ae.init(t,e)}),xa=v("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=Gd),ae.init(t,e),t._zod.onattach.push(r=>{let n=r._zod.bag;n.format="ipv4"})}),ba=v("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=Wd),ae.init(t,e),t._zod.onattach.push(r=>{let n=r._zod.bag;n.format="ipv6"}),t._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:t,continue:!e.abort})}}}),$a=v("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=Xd),ae.init(t,e)}),wa=v("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=Yd),ae.init(t,e),t._zod.check=r=>{let[n,o]=r.value.split("/");try{if(!o)throw new Error;let s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${n}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:t,continue:!e.abort})}}});function Up(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}var ka=v("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=Qd),ae.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),t._zod.check=r=>{Up(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:t,continue:!e.abort})}});function Sv(t){if(!sa.test(t))return!1;let e=t.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=e.padEnd(Math.ceil(e.length/4)*4,"=");return Up(r)}var Sa=v("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=sa),ae.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),t._zod.check=r=>{Sv(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:t,continue:!e.abort})}}),Ta=v("$ZodE164",(t,e)=>{e.pattern??(e.pattern=tp),ae.init(t,e)});function Tv(t,e=null){try{let r=t.split(".");if(r.length!==3)return!1;let[n]=r;if(!n)return!1;let o=JSON.parse(atob(n));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||e&&(!("alg"in o)||o.alg!==e))}catch{return!1}}var Pa=v("$ZodJWT",(t,e)=>{ae.init(t,e),t._zod.check=r=>{Tv(r.value,e.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:t,continue:!e.abort})}});var Ko=v("$ZodNumber",(t,e)=>{ne.init(t,e),t._zod.pattern=t._zod.bag.pattern??up,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=Number(r.value)}catch{}let o=r.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return r;let s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:o,inst:t,...s?{received:s}:{}}),r}}),za=v("$ZodNumber",(t,e)=>{gp.init(t,e),Ko.init(t,e)}),Ea=v("$ZodBoolean",(t,e)=>{ne.init(t,e),t._zod.pattern=lp,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=!!r.value}catch{}let o=r.value;return typeof o=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:t}),r}});var Ia=v("$ZodNull",(t,e)=>{ne.init(t,e),t._zod.pattern=dp,t._zod.values=new Set([null]),t._zod.parse=(r,n)=>{let o=r.value;return o===null||r.issues.push({expected:"null",code:"invalid_type",input:o,inst:t}),r}});var Ra=v("$ZodUnknown",(t,e)=>{ne.init(t,e),t._zod.parse=r=>r}),Ca=v("$ZodNever",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)});function Ep(t,e,r){t.issues.length&&e.issues.push(...xt(r,t.issues)),e.value[r]=t.value}var ja=v("$ZodArray",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Array.isArray(o))return r.issues.push({expected:"array",code:"invalid_type",input:o,inst:t}),r;r.value=Array(o.length);let s=[];for(let i=0;i<o.length;i++){let a=o[i],c=e.element._zod.run({value:a,issues:[]},n);c instanceof Promise?s.push(c.then(u=>Ep(u,r,i))):Ep(c,r,i)}return s.length?Promise.all(s).then(()=>r):r}});function Fo(t,e,r){t.issues.length&&e.issues.push(...xt(r,t.issues)),e.value[r]=t.value}function Ip(t,e,r,n){t.issues.length?n[r]===void 0?r in n?e.value[r]=void 0:e.value[r]=t.value:e.issues.push(...xt(r,t.issues)):t.value===void 0?r in n&&(e.value[r]=void 0):e.value[r]=t.value}var Ho=v("$ZodObject",(t,e)=>{ne.init(t,e);let r=In(()=>{let d=Object.keys(e.shape);for(let m of d)if(!(e.shape[m]instanceof ne))throw new Error(`Invalid element at key "${m}": expected a Zod schema`);let f=Bi(e.shape);return{shape:e.shape,keys:d,keySet:new Set(d),numKeys:d.length,optionalKeys:new Set(f)}});ie(t._zod,"propValues",()=>{let d=e.shape,f={};for(let m in d){let p=d[m]._zod;if(p.values){f[m]??(f[m]=new Set);for(let h of p.values)f[m].add(h)}}return f});let n=d=>{let f=new Vo(["shape","payload","ctx"]),m=r.value,p=x=>{let b=$r(x);return`shape[${b}]._zod.run({ value: input[${b}], issues: [] }, ctx)`};f.write("const input = payload.value;");let h=Object.create(null),g=0;for(let x of m.keys)h[x]=`key_${g++}`;f.write("const newResult = {}");for(let x of m.keys)if(m.optionalKeys.has(x)){let b=h[x];f.write(`const ${b} = ${p(x)};`);let k=$r(x);f.write(`
        if (${b}.issues.length) {
          if (input[${k}] === undefined) {
            if (${k} in input) {
              newResult[${k}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${b}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${k}, ...iss.path] : [${k}],
              }))
            );
          }
        } else if (${b}.value === undefined) {
          if (${k} in input) newResult[${k}] = undefined;
        } else {
          newResult[${k}] = ${b}.value;
        }
        `)}else{let b=h[x];f.write(`const ${b} = ${p(x)};`),f.write(`
          if (${b}.issues.length) payload.issues = payload.issues.concat(${b}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${$r(x)}, ...iss.path] : [${$r(x)}]
          })));`),f.write(`newResult[${$r(x)}] = ${b}.value`)}f.write("payload.value = newResult;"),f.write("return payload;");let _=f.compile();return(x,b)=>_(d,x,b)},o,s=Gr,i=!Zo.jitless,c=i&&Ki.value,u=e.catchall,l;t._zod.parse=(d,f)=>{l??(l=r.value);let m=d.value;if(!s(m))return d.issues.push({expected:"object",code:"invalid_type",input:m,inst:t}),d;let p=[];if(i&&c&&f?.async===!1&&f.jitless!==!0)o||(o=n(e.shape)),d=o(d,f);else{d.value={};let b=l.shape;for(let k of l.keys){let I=b[k],M=I._zod.run({value:m[k],issues:[]},f),ve=I._zod.optin==="optional"&&I._zod.optout==="optional";M instanceof Promise?p.push(M.then(Xe=>ve?Ip(Xe,d,k,m):Fo(Xe,d,k))):ve?Ip(M,d,k,m):Fo(M,d,k)}}if(!u)return p.length?Promise.all(p).then(()=>d):d;let h=[],g=l.keySet,_=u._zod,x=_.def.type;for(let b of Object.keys(m)){if(g.has(b))continue;if(x==="never"){h.push(b);continue}let k=_.run({value:m[b],issues:[]},f);k instanceof Promise?p.push(k.then(I=>Fo(I,d,b))):Fo(k,d,b)}return h.length&&d.issues.push({code:"unrecognized_keys",keys:h,input:m,inst:t}),p.length?Promise.all(p).then(()=>d):d}});function Rp(t,e,r,n){for(let o of t)if(o.issues.length===0)return e.value=o.value,e;return e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(o=>o.issues.map(s=>ut(s,n,Je())))}),e}var Bo=v("$ZodUnion",(t,e)=>{ne.init(t,e),ie(t._zod,"optin",()=>e.options.some(r=>r._zod.optin==="optional")?"optional":void 0),ie(t._zod,"optout",()=>e.options.some(r=>r._zod.optout==="optional")?"optional":void 0),ie(t._zod,"values",()=>{if(e.options.every(r=>r._zod.values))return new Set(e.options.flatMap(r=>Array.from(r._zod.values)))}),ie(t._zod,"pattern",()=>{if(e.options.every(r=>r._zod.pattern)){let r=e.options.map(n=>n._zod.pattern);return new RegExp(`^(${r.map(n=>Cn(n.source)).join("|")})$`)}}),t._zod.parse=(r,n)=>{let o=!1,s=[];for(let i of e.options){let a=i._zod.run({value:r.value,issues:[]},n);if(a instanceof Promise)s.push(a),o=!0;else{if(a.issues.length===0)return a;s.push(a)}}return o?Promise.all(s).then(i=>Rp(i,r,t,n)):Rp(s,r,t,n)}}),Oa=v("$ZodDiscriminatedUnion",(t,e)=>{Bo.init(t,e);let r=t._zod.parse;ie(t._zod,"propValues",()=>{let o={};for(let s of e.options){let i=s._zod.propValues;if(!i||Object.keys(i).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(let[a,c]of Object.entries(i)){o[a]||(o[a]=new Set);for(let u of c)o[a].add(u)}}return o});let n=In(()=>{let o=e.options,s=new Map;for(let i of o){let a=i._zod.propValues[e.discriminator];if(!a||a.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(i)}"`);for(let c of a){if(s.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);s.set(c,i)}}return s});t._zod.parse=(o,s)=>{let i=o.value;if(!Gr(i))return o.issues.push({code:"invalid_type",expected:"object",input:i,inst:t}),o;let a=n.value.get(i?.[e.discriminator]);return a?a._zod.run(o,s):e.unionFallback?r(o,s):(o.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:i,path:[e.discriminator],inst:t}),o)}}),Aa=v("$ZodIntersection",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=r.value,s=e.left._zod.run({value:o,issues:[]},n),i=e.right._zod.run({value:o,issues:[]},n);return s instanceof Promise||i instanceof Promise?Promise.all([s,i]).then(([c,u])=>Cp(r,c,u)):Cp(r,s,i)}});function ca(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(Wr(t)&&Wr(e)){let r=Object.keys(e),n=Object.keys(t).filter(s=>r.indexOf(s)!==-1),o={...t,...e};for(let s of n){let i=ca(t[s],e[s]);if(!i.valid)return{valid:!1,mergeErrorPath:[s,...i.mergeErrorPath]};o[s]=i.data}return{valid:!0,data:o}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};let r=[];for(let n=0;n<t.length;n++){let o=t[n],s=e[n],i=ca(o,s);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};r.push(i.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function Cp(t,e,r){if(e.issues.length&&t.issues.push(...e.issues),r.issues.length&&t.issues.push(...r.issues),wr(t))return t;let n=ca(e.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return t.value=n.data,t}var Na=v("$ZodRecord",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Wr(o))return r.issues.push({expected:"record",code:"invalid_type",input:o,inst:t}),r;let s=[];if(e.keyType._zod.values){let i=e.keyType._zod.values;r.value={};for(let c of i)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){let u=e.valueType._zod.run({value:o[c],issues:[]},n);u instanceof Promise?s.push(u.then(l=>{l.issues.length&&r.issues.push(...xt(c,l.issues)),r.value[c]=l.value})):(u.issues.length&&r.issues.push(...xt(c,u.issues)),r.value[c]=u.value)}let a;for(let c in o)i.has(c)||(a=a??[],a.push(c));a&&a.length>0&&r.issues.push({code:"unrecognized_keys",input:o,inst:t,keys:a})}else{r.value={};for(let i of Reflect.ownKeys(o)){if(i==="__proto__")continue;let a=e.keyType._zod.run({value:i,issues:[]},n);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){r.issues.push({origin:"record",code:"invalid_key",issues:a.issues.map(u=>ut(u,n,Je())),input:i,path:[i],inst:t}),r.value[a.value]=a.value;continue}let c=e.valueType._zod.run({value:o[i],issues:[]},n);c instanceof Promise?s.push(c.then(u=>{u.issues.length&&r.issues.push(...xt(i,u.issues)),r.value[a.value]=u.value})):(c.issues.length&&r.issues.push(...xt(i,c.issues)),r.value[a.value]=c.value)}}return s.length?Promise.all(s).then(()=>r):r}});var Za=v("$ZodEnum",(t,e)=>{ne.init(t,e);let r=En(e.entries);t._zod.values=new Set(r),t._zod.pattern=new RegExp(`^(${r.filter(n=>Hi.has(typeof n)).map(n=>typeof n=="string"?Kt(n):n.toString()).join("|")})$`),t._zod.parse=(n,o)=>{let s=n.value;return t._zod.values.has(s)||n.issues.push({code:"invalid_value",values:r,input:s,inst:t}),n}}),Ma=v("$ZodLiteral",(t,e)=>{ne.init(t,e),t._zod.values=new Set(e.values),t._zod.pattern=new RegExp(`^(${e.values.map(r=>typeof r=="string"?Kt(r):r?r.toString():String(r)).join("|")})$`),t._zod.parse=(r,n)=>{let o=r.value;return t._zod.values.has(o)||r.issues.push({code:"invalid_value",values:e.values,input:o,inst:t}),r}});var Da=v("$ZodTransform",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=e.transform(r.value,r);if(n.async)return(o instanceof Promise?o:Promise.resolve(o)).then(i=>(r.value=i,r));if(o instanceof Promise)throw new Ct;return r.value=o,r}}),qa=v("$ZodOptional",(t,e)=>{ne.init(t,e),t._zod.optin="optional",t._zod.optout="optional",ie(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),ie(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Cn(r.source)})?$`):void 0}),t._zod.parse=(r,n)=>e.innerType._zod.optin==="optional"?e.innerType._zod.run(r,n):r.value===void 0?r:e.innerType._zod.run(r,n)}),La=v("$ZodNullable",(t,e)=>{ne.init(t,e),ie(t._zod,"optin",()=>e.innerType._zod.optin),ie(t._zod,"optout",()=>e.innerType._zod.optout),ie(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Cn(r.source)}|null)$`):void 0}),ie(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(r,n)=>r.value===null?r:e.innerType._zod.run(r,n)}),Ua=v("$ZodDefault",(t,e)=>{ne.init(t,e),t._zod.optin="optional",ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(r.value===void 0)return r.value=e.defaultValue,r;let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>jp(s,e)):jp(o,e)}});function jp(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}var Va=v("$ZodPrefault",(t,e)=>{ne.init(t,e),t._zod.optin="optional",ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>(r.value===void 0&&(r.value=e.defaultValue),e.innerType._zod.run(r,n))}),Fa=v("$ZodNonOptional",(t,e)=>{ne.init(t,e),ie(t._zod,"values",()=>{let r=e.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>Op(s,t)):Op(o,t)}});function Op(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}var Ka=v("$ZodCatch",(t,e)=>{ne.init(t,e),t._zod.optin="optional",ie(t._zod,"optout",()=>e.innerType._zod.optout),ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>(r.value=s.value,s.issues.length&&(r.value=e.catchValue({...r,error:{issues:s.issues.map(i=>ut(i,n,Je()))},input:r.value}),r.issues=[]),r)):(r.value=o.value,o.issues.length&&(r.value=e.catchValue({...r,error:{issues:o.issues.map(s=>ut(s,n,Je()))},input:r.value}),r.issues=[]),r)}});var Ha=v("$ZodPipe",(t,e)=>{ne.init(t,e),ie(t._zod,"values",()=>e.in._zod.values),ie(t._zod,"optin",()=>e.in._zod.optin),ie(t._zod,"optout",()=>e.out._zod.optout),t._zod.parse=(r,n)=>{let o=e.in._zod.run(r,n);return o instanceof Promise?o.then(s=>Ap(s,e,n)):Ap(o,e,n)}});function Ap(t,e,r){return wr(t)?t:e.out._zod.run({value:t.value,issues:t.issues},r)}var Ba=v("$ZodReadonly",(t,e)=>{ne.init(t,e),ie(t._zod,"propValues",()=>e.innerType._zod.propValues),ie(t._zod,"values",()=>e.innerType._zod.values),ie(t._zod,"optin",()=>e.innerType._zod.optin),ie(t._zod,"optout",()=>e.innerType._zod.optout),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(Np):Np(o)}});function Np(t){return t.value=Object.freeze(t.value),t}var Ja=v("$ZodCustom",(t,e)=>{ke.init(t,e),ne.init(t,e),t._zod.parse=(r,n)=>r,t._zod.check=r=>{let n=r.value,o=e.fn(n);if(o instanceof Promise)return o.then(s=>Zp(s,r,n,t));Zp(o,r,n,t)}});function Zp(t,e,r,n){if(!t){let o={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(o.params=n._zod.def.params),e.issues.push(Gi(o))}}var Pv=t=>{let e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return e},zv=()=>{let t={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function e(n){return t[n]??null}let r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return n=>{switch(n.code){case"invalid_type":return`Invalid input: expected ${n.expected}, received ${Pv(n.input)}`;case"invalid_value":return n.values.length===1?`Invalid input: expected ${qo(n.values[0])}`:`Invalid option: expected one of ${Mo(n.values,"|")}`;case"too_big":{let o=n.inclusive?"<=":"<",s=e(n.origin);return s?`Too big: expected ${n.origin??"value"} to have ${o}${n.maximum.toString()} ${s.unit??"elements"}`:`Too big: expected ${n.origin??"value"} to be ${o}${n.maximum.toString()}`}case"too_small":{let o=n.inclusive?">=":">",s=e(n.origin);return s?`Too small: expected ${n.origin} to have ${o}${n.minimum.toString()} ${s.unit}`:`Too small: expected ${n.origin} to be ${o}${n.minimum.toString()}`}case"invalid_format":{let o=n;return o.format==="starts_with"?`Invalid string: must start with "${o.prefix}"`:o.format==="ends_with"?`Invalid string: must end with "${o.suffix}"`:o.format==="includes"?`Invalid string: must include "${o.includes}"`:o.format==="regex"?`Invalid string: must match pattern ${o.pattern}`:`Invalid ${r[o.format]??n.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${n.divisor}`;case"unrecognized_keys":return`Unrecognized key${n.keys.length>1?"s":""}: ${Mo(n.keys,", ")}`;case"invalid_key":return`Invalid key in ${n.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${n.origin}`;default:return"Invalid input"}}};function Vp(){return{localeError:zv()}}var Ev=Symbol("ZodOutput"),Iv=Symbol("ZodInput"),Zn=class{constructor(){this._map=new Map,this._idmap=new Map}add(e,...r){let n=r[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let r=this._map.get(e);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(e),this}get(e){let r=e._zod.parent;if(r){let n={...this.get(r)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}};function Fp(){return new Zn}var Ht=Fp();function Ga(t,e){return new t({type:"string",...Z(e)})}function Wa(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...Z(e)})}function Jo(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...Z(e)})}function Xa(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...Z(e)})}function Ya(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...Z(e)})}function Qa(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...Z(e)})}function ec(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...Z(e)})}function tc(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...Z(e)})}function rc(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...Z(e)})}function nc(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...Z(e)})}function oc(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...Z(e)})}function sc(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...Z(e)})}function ic(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...Z(e)})}function ac(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...Z(e)})}function cc(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...Z(e)})}function uc(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...Z(e)})}function lc(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...Z(e)})}function dc(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...Z(e)})}function pc(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...Z(e)})}function fc(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...Z(e)})}function mc(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...Z(e)})}function hc(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...Z(e)})}function gc(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...Z(e)})}function Kp(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...Z(e)})}function Hp(t,e){return new t({type:"string",format:"date",check:"string_format",...Z(e)})}function Bp(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...Z(e)})}function Jp(t,e){return new t({type:"string",format:"duration",check:"string_format",...Z(e)})}function yc(t,e){return new t({type:"number",checks:[],...Z(e)})}function _c(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...Z(e)})}function vc(t,e){return new t({type:"boolean",...Z(e)})}function xc(t,e){return new t({type:"null",...Z(e)})}function bc(t){return new t({type:"unknown"})}function $c(t,e){return new t({type:"never",...Z(e)})}function Go(t,e){return new ia({check:"less_than",...Z(e),value:t,inclusive:!1})}function Mn(t,e){return new ia({check:"less_than",...Z(e),value:t,inclusive:!0})}function Wo(t,e){return new aa({check:"greater_than",...Z(e),value:t,inclusive:!1})}function Dn(t,e){return new aa({check:"greater_than",...Z(e),value:t,inclusive:!0})}function Xo(t,e){return new hp({check:"multiple_of",...Z(e),value:t})}function Yo(t,e){return new yp({check:"max_length",...Z(e),maximum:t})}function Xr(t,e){return new _p({check:"min_length",...Z(e),minimum:t})}function Qo(t,e){return new vp({check:"length_equals",...Z(e),length:t})}function wc(t,e){return new xp({check:"string_format",format:"regex",...Z(e),pattern:t})}function kc(t){return new bp({check:"string_format",format:"lowercase",...Z(t)})}function Sc(t){return new $p({check:"string_format",format:"uppercase",...Z(t)})}function Tc(t,e){return new wp({check:"string_format",format:"includes",...Z(e),includes:t})}function Pc(t,e){return new kp({check:"string_format",format:"starts_with",...Z(e),prefix:t})}function zc(t,e){return new Sp({check:"string_format",format:"ends_with",...Z(e),suffix:t})}function Tr(t){return new Tp({check:"overwrite",tx:t})}function Ec(t){return Tr(e=>e.normalize(t))}function Ic(){return Tr(t=>t.trim())}function Rc(){return Tr(t=>t.toLowerCase())}function Cc(){return Tr(t=>t.toUpperCase())}function Gp(t,e,r){return new t({type:"array",element:e,...Z(r)})}function jc(t,e,r){let n=Z(r);return n.abort??(n.abort=!0),new t({type:"custom",check:"custom",fn:e,...n})}function Oc(t,e,r){return new t({type:"custom",check:"custom",fn:e,...Z(r)})}var es=class{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??Ht,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,r={path:[],schemaPath:[]}){var n;let o=e._zod.def,s={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},i=this.seen.get(e);if(i)return i.count++,r.schemaPath.includes(e)&&(i.cycle=r.path),i.schema;let a={schema:{},count:1,cycle:void 0,path:r.path};this.seen.set(e,a);let c=e._zod.toJSONSchema?.();if(c)a.schema=c;else{let d={...r,schemaPath:[...r.schemaPath,e],path:r.path},f=e._zod.parent;if(f)a.ref=f,this.process(f,d),this.seen.get(f).isParent=!0;else{let m=a.schema;switch(o.type){case"string":{let p=m;p.type="string";let{minimum:h,maximum:g,format:_,patterns:x,contentEncoding:b}=e._zod.bag;if(typeof h=="number"&&(p.minLength=h),typeof g=="number"&&(p.maxLength=g),_&&(p.format=s[_]??_,p.format===""&&delete p.format),b&&(p.contentEncoding=b),x&&x.size>0){let k=[...x];k.length===1?p.pattern=k[0].source:k.length>1&&(a.schema.allOf=[...k.map(I=>({...this.target==="draft-7"?{type:"string"}:{},pattern:I.source}))])}break}case"number":{let p=m,{minimum:h,maximum:g,format:_,multipleOf:x,exclusiveMaximum:b,exclusiveMinimum:k}=e._zod.bag;typeof _=="string"&&_.includes("int")?p.type="integer":p.type="number",typeof k=="number"&&(p.exclusiveMinimum=k),typeof h=="number"&&(p.minimum=h,typeof k=="number"&&(k>=h?delete p.minimum:delete p.exclusiveMinimum)),typeof b=="number"&&(p.exclusiveMaximum=b),typeof g=="number"&&(p.maximum=g,typeof b=="number"&&(b<=g?delete p.maximum:delete p.exclusiveMaximum)),typeof x=="number"&&(p.multipleOf=x);break}case"boolean":{let p=m;p.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{m.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{m.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{let p=m,{minimum:h,maximum:g}=e._zod.bag;typeof h=="number"&&(p.minItems=h),typeof g=="number"&&(p.maxItems=g),p.type="array",p.items=this.process(o.element,{...d,path:[...d.path,"items"]});break}case"object":{let p=m;p.type="object",p.properties={};let h=o.shape;for(let x in h)p.properties[x]=this.process(h[x],{...d,path:[...d.path,"properties",x]});let g=new Set(Object.keys(h)),_=new Set([...g].filter(x=>{let b=o.shape[x]._zod;return this.io==="input"?b.optin===void 0:b.optout===void 0}));_.size>0&&(p.required=Array.from(_)),o.catchall?._zod.def.type==="never"?p.additionalProperties=!1:o.catchall?o.catchall&&(p.additionalProperties=this.process(o.catchall,{...d,path:[...d.path,"additionalProperties"]})):this.io==="output"&&(p.additionalProperties=!1);break}case"union":{let p=m;p.anyOf=o.options.map((h,g)=>this.process(h,{...d,path:[...d.path,"anyOf",g]}));break}case"intersection":{let p=m,h=this.process(o.left,{...d,path:[...d.path,"allOf",0]}),g=this.process(o.right,{...d,path:[...d.path,"allOf",1]}),_=b=>"allOf"in b&&Object.keys(b).length===1,x=[..._(h)?h.allOf:[h],..._(g)?g.allOf:[g]];p.allOf=x;break}case"tuple":{let p=m;p.type="array";let h=o.items.map((x,b)=>this.process(x,{...d,path:[...d.path,"prefixItems",b]}));if(this.target==="draft-2020-12"?p.prefixItems=h:p.items=h,o.rest){let x=this.process(o.rest,{...d,path:[...d.path,"items"]});this.target==="draft-2020-12"?p.items=x:p.additionalItems=x}o.rest&&(p.items=this.process(o.rest,{...d,path:[...d.path,"items"]}));let{minimum:g,maximum:_}=e._zod.bag;typeof g=="number"&&(p.minItems=g),typeof _=="number"&&(p.maxItems=_);break}case"record":{let p=m;p.type="object",p.propertyNames=this.process(o.keyType,{...d,path:[...d.path,"propertyNames"]}),p.additionalProperties=this.process(o.valueType,{...d,path:[...d.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{let p=m,h=En(o.entries);h.every(g=>typeof g=="number")&&(p.type="number"),h.every(g=>typeof g=="string")&&(p.type="string"),p.enum=h;break}case"literal":{let p=m,h=[];for(let g of o.values)if(g===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof g=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");h.push(Number(g))}else h.push(g);if(h.length!==0)if(h.length===1){let g=h[0];p.type=g===null?"null":typeof g,p.const=g}else h.every(g=>typeof g=="number")&&(p.type="number"),h.every(g=>typeof g=="string")&&(p.type="string"),h.every(g=>typeof g=="boolean")&&(p.type="string"),h.every(g=>g===null)&&(p.type="null"),p.enum=h;break}case"file":{let p=m,h={type:"string",format:"binary",contentEncoding:"binary"},{minimum:g,maximum:_,mime:x}=e._zod.bag;g!==void 0&&(h.minLength=g),_!==void 0&&(h.maxLength=_),x?x.length===1?(h.contentMediaType=x[0],Object.assign(p,h)):p.anyOf=x.map(b=>({...h,contentMediaType:b})):Object.assign(p,h);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{let p=this.process(o.innerType,d);m.anyOf=[p,{type:"null"}];break}case"nonoptional":{this.process(o.innerType,d),a.ref=o.innerType;break}case"success":{let p=m;p.type="boolean";break}case"default":{this.process(o.innerType,d),a.ref=o.innerType,m.default=JSON.parse(JSON.stringify(o.defaultValue));break}case"prefault":{this.process(o.innerType,d),a.ref=o.innerType,this.io==="input"&&(m._prefault=JSON.parse(JSON.stringify(o.defaultValue)));break}case"catch":{this.process(o.innerType,d),a.ref=o.innerType;let p;try{p=o.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}m.default=p;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{let p=m,h=e._zod.pattern;if(!h)throw new Error("Pattern not found in template literal");p.type="string",p.pattern=h.source;break}case"pipe":{let p=this.io==="input"?o.in._zod.def.type==="transform"?o.out:o.in:o.out;this.process(p,d),a.ref=p;break}case"readonly":{this.process(o.innerType,d),a.ref=o.innerType,m.readOnly=!0;break}case"promise":{this.process(o.innerType,d),a.ref=o.innerType;break}case"optional":{this.process(o.innerType,d),a.ref=o.innerType;break}case"lazy":{let p=e._zod.innerType;this.process(p,d),a.ref=p;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}default:}}}let u=this.metadataRegistry.get(e);return u&&Object.assign(a.schema,u),this.io==="input"&&be(e)&&(delete a.schema.examples,delete a.schema.default),this.io==="input"&&a.schema._prefault&&((n=a.schema).default??(n.default=a.schema._prefault)),delete a.schema._prefault,this.seen.get(e).schema}emit(e,r){let n={cycles:r?.cycles??"ref",reused:r?.reused??"inline",external:r?.external??void 0},o=this.seen.get(e);if(!o)throw new Error("Unprocessed schema. This is a bug in Zod.");let s=l=>{let d=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){let h=n.external.registry.get(l[0])?.id,g=n.external.uri??(x=>x);if(h)return{ref:g(h)};let _=l[1].defId??l[1].schema.id??`schema${this.counter++}`;return l[1].defId=_,{defId:_,ref:`${g("__shared")}#/${d}/${_}`}}if(l[1]===o)return{ref:"#"};let m=`#/${d}/`,p=l[1].schema.id??`__schema${this.counter++}`;return{defId:p,ref:m+p}},i=l=>{if(l[1].schema.$ref)return;let d=l[1],{ref:f,defId:m}=s(l);d.def={...d.schema},m&&(d.defId=m);let p=d.schema;for(let h in p)delete p[h];p.$ref=f};if(n.cycles==="throw")for(let l of this.seen.entries()){let d=l[1];if(d.cycle)throw new Error(`Cycle detected: #/${d.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let l of this.seen.entries()){let d=l[1];if(e===l[0]){i(l);continue}if(n.external){let m=n.external.registry.get(l[0])?.id;if(e!==l[0]&&m){i(l);continue}}if(this.metadataRegistry.get(l[0])?.id){i(l);continue}if(d.cycle){i(l);continue}if(d.count>1&&n.reused==="ref"){i(l);continue}}let a=(l,d)=>{let f=this.seen.get(l),m=f.def??f.schema,p={...m};if(f.ref===null)return;let h=f.ref;if(f.ref=null,h){a(h,d);let g=this.seen.get(h).schema;g.$ref&&d.target==="draft-7"?(m.allOf=m.allOf??[],m.allOf.push(g)):(Object.assign(m,g),Object.assign(m,p))}f.isParent||this.override({zodSchema:l,jsonSchema:m,path:f.path??[]})};for(let l of[...this.seen.entries()].reverse())a(l[0],{target:this.target});let c={};if(this.target==="draft-2020-12"?c.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?c.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),n.external?.uri){let l=n.external.registry.get(e)?.id;if(!l)throw new Error("Schema is missing an `id` property");c.$id=n.external.uri(l)}Object.assign(c,o.def);let u=n.external?.defs??{};for(let l of this.seen.entries()){let d=l[1];d.def&&d.defId&&(u[d.defId]=d.def)}n.external||Object.keys(u).length>0&&(this.target==="draft-2020-12"?c.$defs=u:c.definitions=u);try{return JSON.parse(JSON.stringify(c))}catch{throw new Error("Error converting schema to JSON.")}}};function Ac(t,e){if(t instanceof Zn){let n=new es(e),o={};for(let a of t._idmap.entries()){let[c,u]=a;n.process(u)}let s={},i={registry:t,uri:e?.uri,defs:o};for(let a of t._idmap.entries()){let[c,u]=a;s[c]=n.emit(u,{...e,external:i})}if(Object.keys(o).length>0){let a=n.target==="draft-2020-12"?"$defs":"definitions";s.__shared={[a]:o}}return{schemas:s}}let r=new es(e);return r.process(t),r.emit(t,e)}function be(t,e){let r=e??{seen:new Set};if(r.seen.has(t))return!1;r.seen.add(t);let o=t._zod.def;switch(o.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return be(o.element,r);case"object":{for(let s in o.shape)if(be(o.shape[s],r))return!0;return!1}case"union":{for(let s of o.options)if(be(s,r))return!0;return!1}case"intersection":return be(o.left,r)||be(o.right,r);case"tuple":{for(let s of o.items)if(be(s,r))return!0;return!!(o.rest&&be(o.rest,r))}case"record":return be(o.keyType,r)||be(o.valueType,r);case"map":return be(o.keyType,r)||be(o.valueType,r);case"set":return be(o.valueType,r);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return be(o.innerType,r);case"lazy":return be(o.getter(),r);case"default":return be(o.innerType,r);case"prefault":return be(o.innerType,r);case"custom":return!1;case"transform":return!0;case"pipe":return be(o.in,r)||be(o.out,r);case"success":return!1;case"catch":return!1;default:}throw new Error(`Unknown schema type: ${o.type}`)}var dx=v("ZodMiniType",(t,e)=>{if(!t._zod)throw new Error("Uninitialized schema in ZodMiniType.");ne.init(t,e),t.def=e,t.parse=(r,n)=>Qi(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>kr(t,r,n),t.parseAsync=async(r,n)=>ta(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>Sr(t,r,n),t.check=(...r)=>t.clone({...e,checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),t.clone=(r,n)=>Ge(t,r,n),t.brand=()=>t,t.register=(r,n)=>(r.add(t,n),t)});var px=v("ZodMiniObject",(t,e)=>{Ho.init(t,e),dx.init(t,e),J.defineLazy(t,"shape",()=>e.shape)});function Nc(t,e){let r={type:"object",get shape(){return J.assignProp(this,"shape",{...t}),this.shape},...J.normalizeParams(e)};return new px(r)}function et(t){return!!t._zod}function zr(t){let e=Object.values(t);if(e.length===0)return Nc({});let r=e.every(et),n=e.every(o=>!et(o));if(r)return Nc(t);if(n)return Di(t);throw new Error("Mixed Zod versions detected in object shape.")}function Bt(t,e){return et(t)?kr(t,e):t.safeParse(e)}async function ts(t,e){return et(t)?await Sr(t,e):await t.safeParseAsync(e)}function Jt(t){if(!t)return;let e;if(et(t)?e=t._zod?.def?.shape:e=t.shape,!!e){if(typeof e=="function")try{return e()}catch{return}return e}}function Yr(t){if(t){if(typeof t=="object"){let e=t,r=t;if(!e._def&&!r._zod){let n=Object.values(t);if(n.length>0&&n.every(o=>typeof o=="object"&&o!==null&&(o._def!==void 0||o._zod!==void 0||typeof o.parse=="function")))return zr(t)}}if(et(t)){let r=t._zod?.def;if(r&&(r.type==="object"||r.shape!==void 0))return t}else if(t.shape!==void 0)return t}}function rs(t){if(t&&typeof t=="object"){if("message"in t&&typeof t.message=="string")return t.message;if("issues"in t&&Array.isArray(t.issues)&&t.issues.length>0){let e=t.issues[0];if(e&&typeof e=="object"&&"message"in e)return String(e.message)}try{return JSON.stringify(t)}catch{return String(t)}}return String(t)}function Xp(t){return t.description}function Yp(t){if(et(t))return t._zod?.def?.type==="optional";let e=t;return typeof t.isOptional=="function"?t.isOptional():e._def?.typeName==="ZodOptional"}function ns(t){if(et(t)){let s=t._zod?.def;if(s){if(s.value!==void 0)return s.value;if(Array.isArray(s.values)&&s.values.length>0)return s.values[0]}}let r=t._def;if(r){if(r.value!==void 0)return r.value;if(Array.isArray(r.values)&&r.values.length>0)return r.values[0]}let n=t.value;if(n!==void 0)return n}var qn={};Ai(qn,{ZodISODate:()=>ef,ZodISODateTime:()=>Qp,ZodISODuration:()=>rf,ZodISOTime:()=>tf,date:()=>Mc,datetime:()=>Zc,duration:()=>qc,time:()=>Dc});var Qp=v("ZodISODateTime",(t,e)=>{Mp.init(t,e),pe.init(t,e)});function Zc(t){return Kp(Qp,t)}var ef=v("ZodISODate",(t,e)=>{Dp.init(t,e),pe.init(t,e)});function Mc(t){return Hp(ef,t)}var tf=v("ZodISOTime",(t,e)=>{qp.init(t,e),pe.init(t,e)});function Dc(t){return Bp(tf,t)}var rf=v("ZodISODuration",(t,e)=>{Lp.init(t,e),pe.init(t,e)});function qc(t){return Jp(rf,t)}var nf=(t,e)=>{Lo.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:r=>Xi(t,r)},flatten:{value:r=>Wi(t,r)},addIssue:{value:r=>t.issues.push(r)},addIssues:{value:r=>t.issues.push(...r)},isEmpty:{get(){return t.issues.length===0}}})},lI=v("ZodError",nf),Ln=v("ZodError",nf,{Parent:Error});var of=Yi(Ln),sf=ea(Ln),af=ra(Ln),cf=na(Ln);var _e=v("ZodType",(t,e)=>(ne.init(t,e),t.def=e,Object.defineProperty(t,"_def",{value:e}),t.check=(...r)=>t.clone({...e,checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),t.clone=(r,n)=>Ge(t,r,n),t.brand=()=>t,t.register=(r,n)=>(r.add(t,n),t),t.parse=(r,n)=>of(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>af(t,r,n),t.parseAsync=async(r,n)=>sf(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>cf(t,r,n),t.spa=t.safeParseAsync,t.refine=(r,n)=>t.check(ub(r,n)),t.superRefine=r=>t.check(lb(r)),t.overwrite=r=>t.check(Tr(r)),t.optional=()=>ye(t),t.nullable=()=>df(t),t.nullish=()=>ye(df(t)),t.nonoptional=r=>rb(t,r),t.array=()=>G(t),t.or=r=>ce([t,r]),t.and=r=>ss(t,r),t.transform=r=>Uc(t,gf(r)),t.default=r=>Qx(t,r),t.prefault=r=>tb(t,r),t.catch=r=>ob(t,r),t.pipe=r=>Uc(t,r),t.readonly=()=>ab(t),t.describe=r=>{let n=t.clone();return Ht.add(n,{description:r}),n},Object.defineProperty(t,"description",{get(){return Ht.get(t)?.description},configurable:!0}),t.meta=(...r)=>{if(r.length===0)return Ht.get(t);let n=t.clone();return Ht.add(n,r[0]),n},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),pf=v("_ZodString",(t,e)=>{Nn.init(t,e),_e.init(t,e);let r=t._zod.bag;t.format=r.format??null,t.minLength=r.minimum??null,t.maxLength=r.maximum??null,t.regex=(...n)=>t.check(wc(...n)),t.includes=(...n)=>t.check(Tc(...n)),t.startsWith=(...n)=>t.check(Pc(...n)),t.endsWith=(...n)=>t.check(zc(...n)),t.min=(...n)=>t.check(Xr(...n)),t.max=(...n)=>t.check(Yo(...n)),t.length=(...n)=>t.check(Qo(...n)),t.nonempty=(...n)=>t.check(Xr(1,...n)),t.lowercase=n=>t.check(kc(n)),t.uppercase=n=>t.check(Sc(n)),t.trim=()=>t.check(Ic()),t.normalize=(...n)=>t.check(Ec(...n)),t.toLowerCase=()=>t.check(Rc()),t.toUpperCase=()=>t.check(Cc())}),bx=v("ZodString",(t,e)=>{Nn.init(t,e),pf.init(t,e),t.email=r=>t.check(Wa($x,r)),t.url=r=>t.check(tc(wx,r)),t.jwt=r=>t.check(gc(Mx,r)),t.emoji=r=>t.check(rc(kx,r)),t.guid=r=>t.check(Jo(uf,r)),t.uuid=r=>t.check(Xa(os,r)),t.uuidv4=r=>t.check(Ya(os,r)),t.uuidv6=r=>t.check(Qa(os,r)),t.uuidv7=r=>t.check(ec(os,r)),t.nanoid=r=>t.check(nc(Sx,r)),t.guid=r=>t.check(Jo(uf,r)),t.cuid=r=>t.check(oc(Tx,r)),t.cuid2=r=>t.check(sc(Px,r)),t.ulid=r=>t.check(ic(zx,r)),t.base64=r=>t.check(fc(Ax,r)),t.base64url=r=>t.check(mc(Nx,r)),t.xid=r=>t.check(ac(Ex,r)),t.ksuid=r=>t.check(cc(Ix,r)),t.ipv4=r=>t.check(uc(Rx,r)),t.ipv6=r=>t.check(lc(Cx,r)),t.cidrv4=r=>t.check(dc(jx,r)),t.cidrv6=r=>t.check(pc(Ox,r)),t.e164=r=>t.check(hc(Zx,r)),t.datetime=r=>t.check(Zc(r)),t.date=r=>t.check(Mc(r)),t.time=r=>t.check(Dc(r)),t.duration=r=>t.check(qc(r))});function y(t){return Ga(bx,t)}var pe=v("ZodStringFormat",(t,e)=>{ae.init(t,e),pf.init(t,e)}),$x=v("ZodEmail",(t,e)=>{da.init(t,e),pe.init(t,e)});var uf=v("ZodGUID",(t,e)=>{ua.init(t,e),pe.init(t,e)});var os=v("ZodUUID",(t,e)=>{la.init(t,e),pe.init(t,e)});var wx=v("ZodURL",(t,e)=>{pa.init(t,e),pe.init(t,e)});var kx=v("ZodEmoji",(t,e)=>{fa.init(t,e),pe.init(t,e)});var Sx=v("ZodNanoID",(t,e)=>{ma.init(t,e),pe.init(t,e)});var Tx=v("ZodCUID",(t,e)=>{ha.init(t,e),pe.init(t,e)});var Px=v("ZodCUID2",(t,e)=>{ga.init(t,e),pe.init(t,e)});var zx=v("ZodULID",(t,e)=>{ya.init(t,e),pe.init(t,e)});var Ex=v("ZodXID",(t,e)=>{_a.init(t,e),pe.init(t,e)});var Ix=v("ZodKSUID",(t,e)=>{va.init(t,e),pe.init(t,e)});var Rx=v("ZodIPv4",(t,e)=>{xa.init(t,e),pe.init(t,e)});var Cx=v("ZodIPv6",(t,e)=>{ba.init(t,e),pe.init(t,e)});var jx=v("ZodCIDRv4",(t,e)=>{$a.init(t,e),pe.init(t,e)});var Ox=v("ZodCIDRv6",(t,e)=>{wa.init(t,e),pe.init(t,e)});var Ax=v("ZodBase64",(t,e)=>{ka.init(t,e),pe.init(t,e)});var Nx=v("ZodBase64URL",(t,e)=>{Sa.init(t,e),pe.init(t,e)});var Zx=v("ZodE164",(t,e)=>{Ta.init(t,e),pe.init(t,e)});var Mx=v("ZodJWT",(t,e)=>{Pa.init(t,e),pe.init(t,e)});var ff=v("ZodNumber",(t,e)=>{Ko.init(t,e),_e.init(t,e),t.gt=(n,o)=>t.check(Wo(n,o)),t.gte=(n,o)=>t.check(Dn(n,o)),t.min=(n,o)=>t.check(Dn(n,o)),t.lt=(n,o)=>t.check(Go(n,o)),t.lte=(n,o)=>t.check(Mn(n,o)),t.max=(n,o)=>t.check(Mn(n,o)),t.int=n=>t.check(lf(n)),t.safe=n=>t.check(lf(n)),t.positive=n=>t.check(Wo(0,n)),t.nonnegative=n=>t.check(Dn(0,n)),t.negative=n=>t.check(Go(0,n)),t.nonpositive=n=>t.check(Mn(0,n)),t.multipleOf=(n,o)=>t.check(Xo(n,o)),t.step=(n,o)=>t.check(Xo(n,o)),t.finite=()=>t;let r=t._zod.bag;t.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),t.isFinite=!0,t.format=r.format??null});function re(t){return yc(ff,t)}var Dx=v("ZodNumberFormat",(t,e)=>{za.init(t,e),ff.init(t,e)});function lf(t){return _c(Dx,t)}var qx=v("ZodBoolean",(t,e)=>{Ea.init(t,e),_e.init(t,e)});function $e(t){return vc(qx,t)}var Lx=v("ZodNull",(t,e)=>{Ia.init(t,e),_e.init(t,e)});function Vc(t){return xc(Lx,t)}var Ux=v("ZodUnknown",(t,e)=>{Ra.init(t,e),_e.init(t,e)});function fe(){return bc(Ux)}var Vx=v("ZodNever",(t,e)=>{Ca.init(t,e),_e.init(t,e)});function Fx(t){return $c(Vx,t)}var Kx=v("ZodArray",(t,e)=>{ja.init(t,e),_e.init(t,e),t.element=e.element,t.min=(r,n)=>t.check(Xr(r,n)),t.nonempty=r=>t.check(Xr(1,r)),t.max=(r,n)=>t.check(Yo(r,n)),t.length=(r,n)=>t.check(Qo(r,n)),t.unwrap=()=>t.element});function G(t,e){return Gp(Kx,t,e)}var mf=v("ZodObject",(t,e)=>{Ho.init(t,e),_e.init(t,e),J.defineLazy(t,"shape",()=>e.shape),t.keyof=()=>Ve(Object.keys(t._zod.def.shape)),t.catchall=r=>t.clone({...t._zod.def,catchall:r}),t.passthrough=()=>t.clone({...t._zod.def,catchall:fe()}),t.loose=()=>t.clone({...t._zod.def,catchall:fe()}),t.strict=()=>t.clone({...t._zod.def,catchall:Fx()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=r=>J.extend(t,r),t.merge=r=>J.merge(t,r),t.pick=r=>J.pick(t,r),t.omit=r=>J.omit(t,r),t.partial=(...r)=>J.partial(yf,t,r[0]),t.required=(...r)=>J.required(_f,t,r[0])});function E(t,e){let r={type:"object",get shape(){return J.assignProp(this,"shape",{...t}),this.shape},...J.normalizeParams(e)};return new mf(r)}function Ae(t,e){return new mf({type:"object",get shape(){return J.assignProp(this,"shape",{...t}),this.shape},catchall:fe(),...J.normalizeParams(e)})}var hf=v("ZodUnion",(t,e)=>{Bo.init(t,e),_e.init(t,e),t.options=e.options});function ce(t,e){return new hf({type:"union",options:t,...J.normalizeParams(e)})}var Hx=v("ZodDiscriminatedUnion",(t,e)=>{hf.init(t,e),Oa.init(t,e)});function Fc(t,e,r){return new Hx({type:"union",options:e,discriminator:t,...J.normalizeParams(r)})}var Bx=v("ZodIntersection",(t,e)=>{Aa.init(t,e),_e.init(t,e)});function ss(t,e){return new Bx({type:"intersection",left:t,right:e})}var Jx=v("ZodRecord",(t,e)=>{Na.init(t,e),_e.init(t,e),t.keyType=e.keyType,t.valueType=e.valueType});function me(t,e,r){return new Jx({type:"record",keyType:t,valueType:e,...J.normalizeParams(r)})}var Lc=v("ZodEnum",(t,e)=>{Za.init(t,e),_e.init(t,e),t.enum=e.entries,t.options=Object.values(e.entries);let r=new Set(Object.keys(e.entries));t.extract=(n,o)=>{let s={};for(let i of n)if(r.has(i))s[i]=e.entries[i];else throw new Error(`Key ${i} not found in enum`);return new Lc({...e,checks:[],...J.normalizeParams(o),entries:s})},t.exclude=(n,o)=>{let s={...e.entries};for(let i of n)if(r.has(i))delete s[i];else throw new Error(`Key ${i} not found in enum`);return new Lc({...e,checks:[],...J.normalizeParams(o),entries:s})}});function Ve(t,e){let r=Array.isArray(t)?Object.fromEntries(t.map(n=>[n,n])):t;return new Lc({type:"enum",entries:r,...J.normalizeParams(e)})}var Gx=v("ZodLiteral",(t,e)=>{Ma.init(t,e),_e.init(t,e),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function j(t,e){return new Gx({type:"literal",values:Array.isArray(t)?t:[t],...J.normalizeParams(e)})}var Wx=v("ZodTransform",(t,e)=>{Da.init(t,e),_e.init(t,e),t._zod.parse=(r,n)=>{r.addIssue=s=>{if(typeof s=="string")r.issues.push(J.issue(s,r.value,e));else{let i=s;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=t),i.continue??(i.continue=!0),r.issues.push(J.issue(i))}};let o=e.transform(r.value,r);return o instanceof Promise?o.then(s=>(r.value=s,r)):(r.value=o,r)}});function gf(t){return new Wx({type:"transform",transform:t})}var yf=v("ZodOptional",(t,e)=>{qa.init(t,e),_e.init(t,e),t.unwrap=()=>t._zod.def.innerType});function ye(t){return new yf({type:"optional",innerType:t})}var Xx=v("ZodNullable",(t,e)=>{La.init(t,e),_e.init(t,e),t.unwrap=()=>t._zod.def.innerType});function df(t){return new Xx({type:"nullable",innerType:t})}var Yx=v("ZodDefault",(t,e)=>{Ua.init(t,e),_e.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function Qx(t,e){return new Yx({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}var eb=v("ZodPrefault",(t,e)=>{Va.init(t,e),_e.init(t,e),t.unwrap=()=>t._zod.def.innerType});function tb(t,e){return new eb({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}var _f=v("ZodNonOptional",(t,e)=>{Fa.init(t,e),_e.init(t,e),t.unwrap=()=>t._zod.def.innerType});function rb(t,e){return new _f({type:"nonoptional",innerType:t,...J.normalizeParams(e)})}var nb=v("ZodCatch",(t,e)=>{Ka.init(t,e),_e.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function ob(t,e){return new nb({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}var sb=v("ZodPipe",(t,e)=>{Ha.init(t,e),_e.init(t,e),t.in=e.in,t.out=e.out});function Uc(t,e){return new sb({type:"pipe",in:t,out:e})}var ib=v("ZodReadonly",(t,e)=>{Ba.init(t,e),_e.init(t,e)});function ab(t){return new ib({type:"readonly",innerType:t})}var vf=v("ZodCustom",(t,e)=>{Ja.init(t,e),_e.init(t,e)});function cb(t){let e=new ke({check:"custom"});return e._zod.check=t,e}function xf(t,e){return jc(vf,t??(()=>!0),e)}function ub(t,e={}){return Oc(vf,t,e)}function lb(t){let e=cb(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(J.issue(n,r.value,e._zod.def));else{let o=n;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=e),o.continue??(o.continue=!e._zod.def.abort),r.issues.push(J.issue(o))}},t(r.value,r)));return e}function Kc(t,e){return Uc(gf(t),e)}Je(Vp());var Bc="2025-11-25";var bf=[Bc,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],Gt="io.modelcontextprotocol/related-task",as="2.0",Se=xf(t=>t!==null&&(typeof t=="object"||typeof t=="function")),$f=ce([y(),re().int()]),wf=y(),kI=Ae({ttl:ce([re(),Vc()]).optional(),pollInterval:re().optional()}),db=E({ttl:re().optional()}),pb=E({taskId:y()}),Jc=Ae({progressToken:$f.optional(),[Gt]:pb.optional()}),We=E({_meta:Jc.optional()}),Un=We.extend({task:db.optional()}),kf=t=>Un.safeParse(t).success,Te=E({method:y(),params:We.loose().optional()}),tt=E({_meta:Jc.optional()}),rt=E({method:y(),params:tt.loose().optional()}),Pe=Ae({_meta:Jc.optional()}),cs=ce([y(),re().int()]),Sf=E({jsonrpc:j(as),id:cs,...Te.shape}).strict(),Gc=t=>Sf.safeParse(t).success,Tf=E({jsonrpc:j(as),...rt.shape}).strict(),Pf=t=>Tf.safeParse(t).success,Wc=E({jsonrpc:j(as),id:cs,result:Pe}).strict(),Vn=t=>Wc.safeParse(t).success;var A;(function(t){t[t.ConnectionClosed=-32e3]="ConnectionClosed",t[t.RequestTimeout=-32001]="RequestTimeout",t[t.ParseError=-32700]="ParseError",t[t.InvalidRequest=-32600]="InvalidRequest",t[t.MethodNotFound=-32601]="MethodNotFound",t[t.InvalidParams=-32602]="InvalidParams",t[t.InternalError=-32603]="InternalError",t[t.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(A||(A={}));var Xc=E({jsonrpc:j(as),id:cs.optional(),error:E({code:re().int(),message:y(),data:fe().optional()})}).strict();var zf=t=>Xc.safeParse(t).success;var Ef=ce([Sf,Tf,Wc,Xc]),SI=ce([Wc,Xc]),us=Pe.strict(),fb=tt.extend({requestId:cs.optional(),reason:y().optional()}),ls=rt.extend({method:j("notifications/cancelled"),params:fb}),mb=E({src:y(),mimeType:y().optional(),sizes:G(y()).optional(),theme:Ve(["light","dark"]).optional()}),Fn=E({icons:G(mb).optional()}),Qr=E({name:y(),title:y().optional()}),If=Qr.extend({...Qr.shape,...Fn.shape,version:y(),websiteUrl:y().optional(),description:y().optional()}),hb=ss(E({applyDefaults:$e().optional()}),me(y(),fe())),gb=Kc(t=>t&&typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).length===0?{form:{}}:t,ss(E({form:hb.optional(),url:Se.optional()}),me(y(),fe()).optional())),yb=Ae({list:Se.optional(),cancel:Se.optional(),requests:Ae({sampling:Ae({createMessage:Se.optional()}).optional(),elicitation:Ae({create:Se.optional()}).optional()}).optional()}),_b=Ae({list:Se.optional(),cancel:Se.optional(),requests:Ae({tools:Ae({call:Se.optional()}).optional()}).optional()}),vb=E({experimental:me(y(),Se).optional(),sampling:E({context:Se.optional(),tools:Se.optional()}).optional(),elicitation:gb.optional(),roots:E({listChanged:$e().optional()}).optional(),tasks:yb.optional()}),xb=We.extend({protocolVersion:y(),capabilities:vb,clientInfo:If}),Yc=Te.extend({method:j("initialize"),params:xb});var bb=E({experimental:me(y(),Se).optional(),logging:Se.optional(),completions:Se.optional(),prompts:E({listChanged:$e().optional()}).optional(),resources:E({subscribe:$e().optional(),listChanged:$e().optional()}).optional(),tools:E({listChanged:$e().optional()}).optional(),tasks:_b.optional()}),$b=Pe.extend({protocolVersion:y(),capabilities:bb,serverInfo:If,instructions:y().optional()}),Qc=rt.extend({method:j("notifications/initialized"),params:tt.optional()});var ds=Te.extend({method:j("ping"),params:We.optional()}),wb=E({progress:re(),total:ye(re()),message:ye(y())}),kb=E({...tt.shape,...wb.shape,progressToken:$f}),ps=rt.extend({method:j("notifications/progress"),params:kb}),Sb=We.extend({cursor:wf.optional()}),Kn=Te.extend({params:Sb.optional()}),Hn=Pe.extend({nextCursor:wf.optional()}),Tb=Ve(["working","input_required","completed","failed","cancelled"]),Bn=E({taskId:y(),status:Tb,ttl:ce([re(),Vc()]),createdAt:y(),lastUpdatedAt:y(),pollInterval:ye(re()),statusMessage:ye(y())}),en=Pe.extend({task:Bn}),Pb=tt.merge(Bn),Jn=rt.extend({method:j("notifications/tasks/status"),params:Pb}),fs=Te.extend({method:j("tasks/get"),params:We.extend({taskId:y()})}),ms=Pe.merge(Bn),hs=Te.extend({method:j("tasks/result"),params:We.extend({taskId:y()})}),TI=Pe.loose(),gs=Kn.extend({method:j("tasks/list")}),ys=Hn.extend({tasks:G(Bn)}),_s=Te.extend({method:j("tasks/cancel"),params:We.extend({taskId:y()})}),Rf=Pe.merge(Bn),Cf=E({uri:y(),mimeType:ye(y()),_meta:me(y(),fe()).optional()}),jf=Cf.extend({text:y()}),eu=y().refine(t=>{try{return atob(t),!0}catch{return!1}},{message:"Invalid Base64 string"}),Of=Cf.extend({blob:eu}),Gn=Ve(["user","assistant"]),tn=E({audience:G(Gn).optional(),priority:re().min(0).max(1).optional(),lastModified:qn.datetime({offset:!0}).optional()}),Af=E({...Qr.shape,...Fn.shape,uri:y(),description:ye(y()),mimeType:ye(y()),annotations:tn.optional(),_meta:ye(Ae({}))}),zb=E({...Qr.shape,...Fn.shape,uriTemplate:y(),description:ye(y()),mimeType:ye(y()),annotations:tn.optional(),_meta:ye(Ae({}))}),vs=Kn.extend({method:j("resources/list")}),Eb=Hn.extend({resources:G(Af)}),xs=Kn.extend({method:j("resources/templates/list")}),Ib=Hn.extend({resourceTemplates:G(zb)}),tu=We.extend({uri:y()}),Rb=tu,bs=Te.extend({method:j("resources/read"),params:Rb}),Cb=Pe.extend({contents:G(ce([jf,Of]))}),jb=rt.extend({method:j("notifications/resources/list_changed"),params:tt.optional()}),Ob=tu,Ab=Te.extend({method:j("resources/subscribe"),params:Ob}),Nb=tu,Zb=Te.extend({method:j("resources/unsubscribe"),params:Nb}),Mb=tt.extend({uri:y()}),Db=rt.extend({method:j("notifications/resources/updated"),params:Mb}),qb=E({name:y(),description:ye(y()),required:ye($e())}),Lb=E({...Qr.shape,...Fn.shape,description:ye(y()),arguments:ye(G(qb)),_meta:ye(Ae({}))}),$s=Kn.extend({method:j("prompts/list")}),Ub=Hn.extend({prompts:G(Lb)}),Vb=We.extend({name:y(),arguments:me(y(),y()).optional()}),ws=Te.extend({method:j("prompts/get"),params:Vb}),ru=E({type:j("text"),text:y(),annotations:tn.optional(),_meta:me(y(),fe()).optional()}),nu=E({type:j("image"),data:eu,mimeType:y(),annotations:tn.optional(),_meta:me(y(),fe()).optional()}),ou=E({type:j("audio"),data:eu,mimeType:y(),annotations:tn.optional(),_meta:me(y(),fe()).optional()}),Fb=E({type:j("tool_use"),name:y(),id:y(),input:me(y(),fe()),_meta:me(y(),fe()).optional()}),Kb=E({type:j("resource"),resource:ce([jf,Of]),annotations:tn.optional(),_meta:me(y(),fe()).optional()}),Hb=Af.extend({type:j("resource_link")}),su=ce([ru,nu,ou,Hb,Kb]),Bb=E({role:Gn,content:su}),Jb=Pe.extend({description:y().optional(),messages:G(Bb)}),Gb=rt.extend({method:j("notifications/prompts/list_changed"),params:tt.optional()}),Wb=E({title:y().optional(),readOnlyHint:$e().optional(),destructiveHint:$e().optional(),idempotentHint:$e().optional(),openWorldHint:$e().optional()}),Xb=E({taskSupport:Ve(["required","optional","forbidden"]).optional()}),Nf=E({...Qr.shape,...Fn.shape,description:y().optional(),inputSchema:E({type:j("object"),properties:me(y(),Se).optional(),required:G(y()).optional()}).catchall(fe()),outputSchema:E({type:j("object"),properties:me(y(),Se).optional(),required:G(y()).optional()}).catchall(fe()).optional(),annotations:Wb.optional(),execution:Xb.optional(),_meta:me(y(),fe()).optional()}),ks=Kn.extend({method:j("tools/list")}),Yb=Hn.extend({tools:G(Nf)}),Ss=Pe.extend({content:G(su).default([]),structuredContent:me(y(),fe()).optional(),isError:$e().optional()}),PI=Ss.or(Pe.extend({toolResult:fe()})),Qb=Un.extend({name:y(),arguments:me(y(),fe()).optional()}),rn=Te.extend({method:j("tools/call"),params:Qb}),e$=rt.extend({method:j("notifications/tools/list_changed"),params:tt.optional()}),zI=E({autoRefresh:$e().default(!0),debounceMs:re().int().nonnegative().default(300)}),Wn=Ve(["debug","info","notice","warning","error","critical","alert","emergency"]),t$=We.extend({level:Wn}),iu=Te.extend({method:j("logging/setLevel"),params:t$}),r$=tt.extend({level:Wn,logger:y().optional(),data:fe()}),n$=rt.extend({method:j("notifications/message"),params:r$}),o$=E({name:y().optional()}),s$=E({hints:G(o$).optional(),costPriority:re().min(0).max(1).optional(),speedPriority:re().min(0).max(1).optional(),intelligencePriority:re().min(0).max(1).optional()}),i$=E({mode:Ve(["auto","required","none"]).optional()}),a$=E({type:j("tool_result"),toolUseId:y().describe("The unique identifier for the corresponding tool call."),content:G(su).default([]),structuredContent:E({}).loose().optional(),isError:$e().optional(),_meta:me(y(),fe()).optional()}),c$=Fc("type",[ru,nu,ou]),is=Fc("type",[ru,nu,ou,Fb,a$]),u$=E({role:Gn,content:ce([is,G(is)]),_meta:me(y(),fe()).optional()}),l$=Un.extend({messages:G(u$),modelPreferences:s$.optional(),systemPrompt:y().optional(),includeContext:Ve(["none","thisServer","allServers"]).optional(),temperature:re().optional(),maxTokens:re().int(),stopSequences:G(y()).optional(),metadata:Se.optional(),tools:G(Nf).optional(),toolChoice:i$.optional()}),d$=Te.extend({method:j("sampling/createMessage"),params:l$}),au=Pe.extend({model:y(),stopReason:ye(Ve(["endTurn","stopSequence","maxTokens"]).or(y())),role:Gn,content:c$}),cu=Pe.extend({model:y(),stopReason:ye(Ve(["endTurn","stopSequence","maxTokens","toolUse"]).or(y())),role:Gn,content:ce([is,G(is)])}),p$=E({type:j("boolean"),title:y().optional(),description:y().optional(),default:$e().optional()}),f$=E({type:j("string"),title:y().optional(),description:y().optional(),minLength:re().optional(),maxLength:re().optional(),format:Ve(["email","uri","date","date-time"]).optional(),default:y().optional()}),m$=E({type:Ve(["number","integer"]),title:y().optional(),description:y().optional(),minimum:re().optional(),maximum:re().optional(),default:re().optional()}),h$=E({type:j("string"),title:y().optional(),description:y().optional(),enum:G(y()),default:y().optional()}),g$=E({type:j("string"),title:y().optional(),description:y().optional(),oneOf:G(E({const:y(),title:y()})),default:y().optional()}),y$=E({type:j("string"),title:y().optional(),description:y().optional(),enum:G(y()),enumNames:G(y()).optional(),default:y().optional()}),_$=ce([h$,g$]),v$=E({type:j("array"),title:y().optional(),description:y().optional(),minItems:re().optional(),maxItems:re().optional(),items:E({type:j("string"),enum:G(y())}),default:G(y()).optional()}),x$=E({type:j("array"),title:y().optional(),description:y().optional(),minItems:re().optional(),maxItems:re().optional(),items:E({anyOf:G(E({const:y(),title:y()}))}),default:G(y()).optional()}),b$=ce([v$,x$]),$$=ce([y$,_$,b$]),w$=ce([$$,p$,f$,m$]),k$=Un.extend({mode:j("form").optional(),message:y(),requestedSchema:E({type:j("object"),properties:me(y(),w$),required:G(y()).optional()})}),S$=Un.extend({mode:j("url"),message:y(),elicitationId:y(),url:y().url()}),T$=ce([k$,S$]),P$=Te.extend({method:j("elicitation/create"),params:T$}),z$=tt.extend({elicitationId:y()}),E$=rt.extend({method:j("notifications/elicitation/complete"),params:z$}),Ts=Pe.extend({action:Ve(["accept","decline","cancel"]),content:Kc(t=>t===null?void 0:t,me(y(),ce([y(),re(),$e(),G(y())])).optional())}),I$=E({type:j("ref/resource"),uri:y()});var R$=E({type:j("ref/prompt"),name:y()}),C$=We.extend({ref:ce([R$,I$]),argument:E({name:y(),value:y()}),context:E({arguments:me(y(),y()).optional()}).optional()}),Ps=Te.extend({method:j("completion/complete"),params:C$});function Zf(t){if(t.params.ref.type!=="ref/prompt")throw new TypeError(`Expected CompleteRequestPrompt, but got ${t.params.ref.type}`)}function Mf(t){if(t.params.ref.type!=="ref/resource")throw new TypeError(`Expected CompleteRequestResourceTemplate, but got ${t.params.ref.type}`)}var j$=Pe.extend({completion:Ae({values:G(y()).max(100),total:ye(re().int()),hasMore:ye($e())})}),O$=E({uri:y().startsWith("file://"),name:y().optional(),_meta:me(y(),fe()).optional()}),A$=Te.extend({method:j("roots/list"),params:We.optional()}),uu=Pe.extend({roots:G(O$)}),N$=rt.extend({method:j("notifications/roots/list_changed"),params:tt.optional()}),EI=ce([ds,Yc,Ps,iu,ws,$s,vs,xs,bs,Ab,Zb,rn,ks,fs,hs,gs,_s]),II=ce([ls,ps,Qc,N$,Jn]),RI=ce([us,au,cu,Ts,uu,ms,ys,en]),CI=ce([ds,d$,P$,A$,fs,hs,gs,_s]),jI=ce([ls,ps,n$,Db,jb,e$,Gb,Jn,E$]),OI=ce([us,$b,j$,Jb,Ub,Eb,Ib,Cb,Ss,Yb,ms,ys,en]),C=class t extends Error{constructor(e,r,n){super(`MCP error ${e}: ${r}`),this.code=e,this.data=n,this.name="McpError"}static fromError(e,r,n){if(e===A.UrlElicitationRequired&&n){let o=n;if(o.elicitations)return new Hc(o.elicitations,r)}return new t(e,r,n)}},Hc=class extends C{constructor(e,r=`URL elicitation${e.length>1?"s":""} required`){super(A.UrlElicitationRequired,r,{elicitations:e})}get elicitations(){return this.data?.elicitations??[]}};function Wt(t){return t==="completed"||t==="failed"||t==="cancelled"}var qf=Symbol("Let zodToJsonSchema decide on which parser to use");var Df={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Lf=t=>typeof t=="string"?{...Df,name:t}:{...Df,...t};var Uf=t=>{let e=Lf(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,o])=>[o._def,{def:o._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function lu(t,e,r,n){n?.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function W(t,e,r,n,o){t[e]=r,lu(t,e,n,o)}var zs=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")};function he(t){if(t.target!=="openAi")return{};let e=[...t.basePath,t.definitionPath,t.openAiAnyTypeName];return t.flags.hasReferencedOpenAiAnyType=!0,{$ref:t.$refStrategy==="relative"?zs(e,t.currentPath):e.join("/")}}function Vf(t,e){let r={type:"array"};return t.type?._def&&t.type?._def?.typeName!==w.ZodAny&&(r.items=D(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&W(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&W(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(W(r,"minItems",t.exactLength.value,t.exactLength.message,e),W(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function Ff(t,e){let r={type:"integer",format:"int64"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?W(r,"minimum",n.value,n.message,e):W(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),W(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?W(r,"maximum",n.value,n.message,e):W(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),W(r,"maximum",n.value,n.message,e));break;case"multipleOf":W(r,"multipleOf",n.value,n.message,e);break}return r}function Kf(){return{type:"boolean"}}function Es(t,e){return D(t.type._def,e)}var Hf=(t,e)=>D(t.innerType._def,e);function du(t,e,r){let n=r??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((o,s)=>du(t,e,o))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Z$(t,e)}}var Z$=(t,e)=>{let r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(let n of t.checks)switch(n.kind){case"min":W(r,"minimum",n.value,n.message,e);break;case"max":W(r,"maximum",n.value,n.message,e);break}return r};function Bf(t,e){return{...D(t.innerType._def,e),default:t.defaultValue()}}function Jf(t,e){return e.effectStrategy==="input"?D(t.schema._def,e):he(e)}function Gf(t){return{type:"string",enum:Array.from(t.values)}}var M$=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function Wf(t,e){let r=[D(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),D(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,o=[];return r.forEach(s=>{if(M$(s))o.push(...s.allOf),s.unevaluatedProperties===void 0&&(n=void 0);else{let i=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:a,...c}=s;i=c}else n=void 0;o.push(i)}}),o.length?{allOf:o,...n}:void 0}function Xf(t,e){let r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}var pu,lt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(pu===void 0&&(pu=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),pu),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Is(t,e){let r={type:"string"};if(t.checks)for(let n of t.checks)switch(n.kind){case"min":W(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e);break;case"max":W(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":dt(r,"email",n.message,e);break;case"format:idn-email":dt(r,"idn-email",n.message,e);break;case"pattern:zod":Ne(r,lt.email,n.message,e);break}break;case"url":dt(r,"uri",n.message,e);break;case"uuid":dt(r,"uuid",n.message,e);break;case"regex":Ne(r,n.regex,n.message,e);break;case"cuid":Ne(r,lt.cuid,n.message,e);break;case"cuid2":Ne(r,lt.cuid2,n.message,e);break;case"startsWith":Ne(r,RegExp(`^${fu(n.value,e)}`),n.message,e);break;case"endsWith":Ne(r,RegExp(`${fu(n.value,e)}$`),n.message,e);break;case"datetime":dt(r,"date-time",n.message,e);break;case"date":dt(r,"date",n.message,e);break;case"time":dt(r,"time",n.message,e);break;case"duration":dt(r,"duration",n.message,e);break;case"length":W(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e),W(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"includes":{Ne(r,RegExp(fu(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&dt(r,"ipv4",n.message,e),n.version!=="v4"&&dt(r,"ipv6",n.message,e);break}case"base64url":Ne(r,lt.base64url,n.message,e);break;case"jwt":Ne(r,lt.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&Ne(r,lt.ipv4Cidr,n.message,e),n.version!=="v4"&&Ne(r,lt.ipv6Cidr,n.message,e);break}case"emoji":Ne(r,lt.emoji(),n.message,e);break;case"ulid":{Ne(r,lt.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{dt(r,"binary",n.message,e);break}case"contentEncoding:base64":{W(r,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{Ne(r,lt.base64,n.message,e);break}}break}case"nanoid":Ne(r,lt.nanoid,n.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}function fu(t,e){return e.patternStrategy==="escape"?q$(t):t}var D$=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function q$(t){let e="";for(let r=0;r<t.length;r++)D$.has(t[r])||(e+="\\"),e+=t[r];return e}function dt(t,e,r,n){t.format||t.anyOf?.some(o=>o.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&n.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&n.errorMessages&&{errorMessage:{format:r}}})):W(t,"format",e,r,n)}function Ne(t,e,r,n){t.pattern||t.allOf?.some(o=>o.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&n.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:Yf(e,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):W(t,"pattern",Yf(e,n),r,n)}function Yf(t,e){if(!e.applyRegexFlags||!t.flags)return t.source;let r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},n=r.i?t.source.toLowerCase():t.source,o="",s=!1,i=!1,a=!1;for(let c=0;c<n.length;c++){if(s){o+=n[c],s=!1;continue}if(r.i){if(i){if(n[c].match(/[a-z]/)){a?(o+=n[c],o+=`${n[c-2]}-${n[c]}`.toUpperCase(),a=!1):n[c+1]==="-"&&n[c+2]?.match(/[a-z]/)?(o+=n[c],a=!0):o+=`${n[c]}${n[c].toUpperCase()}`;continue}}else if(n[c].match(/[a-z]/)){o+=`[${n[c]}${n[c].toUpperCase()}]`;continue}}if(r.m){if(n[c]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(n[c]==="$"){o+=`($|(?=[\r
]))`;continue}}if(r.s&&n[c]==="."){o+=i?`${n[c]}\r
`:`[${n[c]}\r
]`;continue}o+=n[c],n[c]==="\\"?s=!0:i&&n[c]==="]"?i=!1:!i&&n[c]==="["&&(i=!0)}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return o}function Rs(t,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&t.keyType?._def.typeName===w.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((n,o)=>({...n,[o]:D(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",o]})??he(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let r={type:"object",additionalProperties:D(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return r;if(t.keyType?._def.typeName===w.ZodString&&t.keyType._def.checks?.length){let{type:n,...o}=Is(t.keyType._def,e);return{...r,propertyNames:o}}else{if(t.keyType?._def.typeName===w.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};if(t.keyType?._def.typeName===w.ZodBranded&&t.keyType._def.type._def.typeName===w.ZodString&&t.keyType._def.type._def.checks?.length){let{type:n,...o}=Es(t.keyType._def,e);return{...r,propertyNames:o}}}return r}function Qf(t,e){if(e.mapStrategy==="record")return Rs(t,e);let r=D(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||he(e),n=D(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||he(e);return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function em(t){let e=t.values,n=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),o=Array.from(new Set(n.map(s=>typeof s)));return{type:o.length===1?o[0]==="string"?"string":"number":["string","number"],enum:n}}function tm(t){return t.target==="openAi"?void 0:{not:he({...t,currentPath:[...t.currentPath,"not"]})}}function rm(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var Xn={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function om(t,e){if(e.target==="openApi3")return nm(t,e);let r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(n=>n._def.typeName in Xn&&(!n._def.checks||!n._def.checks.length))){let n=r.reduce((o,s)=>{let i=Xn[s._def.typeName];return i&&!o.includes(i)?[...o,i]:o},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=r.reduce((o,s)=>{let i=typeof s._def.value;switch(i){case"string":case"number":case"boolean":return[...o,i];case"bigint":return[...o,"integer"];case"object":if(s._def.value===null)return[...o,"null"];case"symbol":case"undefined":case"function":default:return o}},[]);if(n.length===r.length){let o=n.filter((s,i,a)=>a.indexOf(s)===i);return{type:o.length>1?o:o[0],enum:r.reduce((s,i)=>s.includes(i._def.value)?s:[...s,i._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,o)=>[...n,...o._def.values.filter(s=>!n.includes(s))],[])};return nm(t,e)}var nm=(t,e)=>{let r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((n,o)=>D(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${o}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function sm(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:Xn[t.innerType._def.typeName],nullable:!0}:{type:[Xn[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=D(t.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let r=D(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function im(t,e){let r={type:"number"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"int":r.type="integer",lu(r,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?W(r,"minimum",n.value,n.message,e):W(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),W(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?W(r,"maximum",n.value,n.message,e):W(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),W(r,"maximum",n.value,n.message,e));break;case"multipleOf":W(r,"multipleOf",n.value,n.message,e);break}return r}function am(t,e){let r=e.target==="openAi",n={type:"object",properties:{}},o=[],s=t.shape();for(let a in s){let c=s[a];if(c===void 0||c._def===void 0)continue;let u=U$(c);u&&r&&(c._def.typeName==="ZodOptional"&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),u=!1);let l=D(c._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});l!==void 0&&(n.properties[a]=l,u||o.push(a))}o.length&&(n.required=o);let i=L$(t,e);return i!==void 0&&(n.additionalProperties=i),n}function L$(t,e){if(t.catchall._def.typeName!=="ZodNever")return D(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function U$(t){try{return t.isOptional()}catch{return!0}}var cm=(t,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return D(t.innerType._def,e);let r=D(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:he(e)},r]}:he(e)};var um=(t,e)=>{if(e.pipeStrategy==="input")return D(t.in._def,e);if(e.pipeStrategy==="output")return D(t.out._def,e);let r=D(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=D(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(o=>o!==void 0)}};function lm(t,e){return D(t.type._def,e)}function dm(t,e){let n={type:"array",uniqueItems:!0,items:D(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&W(n,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&W(n,"maxItems",t.maxSize.value,t.maxSize.message,e),n}function pm(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,n)=>D(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:D(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,n)=>D(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function fm(t){return{not:he(t)}}function mm(t){return he(t)}var hm=(t,e)=>D(t.innerType._def,e);var gm=(t,e,r)=>{switch(e){case w.ZodString:return Is(t,r);case w.ZodNumber:return im(t,r);case w.ZodObject:return am(t,r);case w.ZodBigInt:return Ff(t,r);case w.ZodBoolean:return Kf();case w.ZodDate:return du(t,r);case w.ZodUndefined:return fm(r);case w.ZodNull:return rm(r);case w.ZodArray:return Vf(t,r);case w.ZodUnion:case w.ZodDiscriminatedUnion:return om(t,r);case w.ZodIntersection:return Wf(t,r);case w.ZodTuple:return pm(t,r);case w.ZodRecord:return Rs(t,r);case w.ZodLiteral:return Xf(t,r);case w.ZodEnum:return Gf(t);case w.ZodNativeEnum:return em(t);case w.ZodNullable:return sm(t,r);case w.ZodOptional:return cm(t,r);case w.ZodMap:return Qf(t,r);case w.ZodSet:return dm(t,r);case w.ZodLazy:return()=>t.getter()._def;case w.ZodPromise:return lm(t,r);case w.ZodNaN:case w.ZodNever:return tm(r);case w.ZodEffects:return Jf(t,r);case w.ZodAny:return he(r);case w.ZodUnknown:return mm(r);case w.ZodDefault:return Bf(t,r);case w.ZodBranded:return Es(t,r);case w.ZodReadonly:return hm(t,r);case w.ZodCatch:return Hf(t,r);case w.ZodPipeline:return um(t,r);case w.ZodFunction:case w.ZodVoid:case w.ZodSymbol:return;default:return(n=>{})(e)}};function D(t,e,r=!1){let n=e.seen.get(t);if(e.override){let a=e.override?.(t,e,n,r);if(a!==qf)return a}if(n&&!r){let a=V$(n,e);if(a!==void 0)return a}let o={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,o);let s=gm(t,t.typeName,e),i=typeof s=="function"?D(s(),e):s;if(i&&F$(t,e,i),e.postProcess){let a=e.postProcess(i,t,e);return o.jsonSchema=i,a}return o.jsonSchema=i,i}var V$=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:zs(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,n)=>e.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),he(e)):e.$refStrategy==="seen"?he(e):void 0}},F$=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r);var mu=(t,e)=>{let r=Uf(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((c,[u,l])=>({...c,[u]:D(l._def,{...r,currentPath:[...r.basePath,r.definitionPath,u]},!0)??he(r)}),{}):void 0,o=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,s=D(t._def,o===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,o]},!1)??he(r),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i),r.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[r.openAiAnyTypeName]||(n[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:r.$refStrategy==="relative"?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));let a=o===void 0?n?{...s,[r.definitionPath]:n}:s:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,o].join("/"),[r.definitionPath]:{...n,[o]:s}};return r.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function K$(t){return!t||t==="jsonSchema7"||t==="draft-7"?"draft-7":t==="jsonSchema2019-09"||t==="draft-2020-12"?"draft-2020-12":"draft-7"}function hu(t,e){return et(t)?Ac(t,{target:K$(e?.target),io:e?.pipeStrategy??"input"}):mu(t,{strictUnions:e?.strictUnions??!0,pipeStrategy:e?.pipeStrategy??"input"})}function gu(t){let r=Jt(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=ns(r);if(typeof n!="string")throw new Error("Schema method literal must be a string");return n}function yu(t,e){let r=Bt(t,e);if(!r.success)throw r.error;return r.data}var H$=6e4,Cs=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(ls,r=>{this._oncancel(r)}),this.setNotificationHandler(ps,r=>{this._onprogress(r)}),this.setRequestHandler(ds,r=>({})),this._taskStore=e?.taskStore,this._taskMessageQueue=e?.taskMessageQueue,this._taskStore&&(this.setRequestHandler(fs,async(r,n)=>{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new C(A.InvalidParams,"Failed to retrieve task: Task not found");return{...o}}),this.setRequestHandler(hs,async(r,n)=>{let o=async()=>{let s=r.params.taskId;if(this._taskMessageQueue){let a;for(;a=await this._taskMessageQueue.dequeue(s,n.sessionId);){if(a.type==="response"||a.type==="error"){let c=a.message,u=c.id,l=this._requestResolvers.get(u);if(l)if(this._requestResolvers.delete(u),a.type==="response")l(c);else{let d=c,f=new C(d.error.code,d.error.message,d.error.data);l(f)}else{let d=a.type==="response"?"Response":"Error";this._onerror(new Error(`${d} handler missing for request ${u}`))}continue}await this._transport?.send(a.message,{relatedRequestId:n.requestId})}}let i=await this._taskStore.getTask(s,n.sessionId);if(!i)throw new C(A.InvalidParams,`Task not found: ${s}`);if(!Wt(i.status))return await this._waitForTaskUpdate(s,n.signal),await o();if(Wt(i.status)){let a=await this._taskStore.getTaskResult(s,n.sessionId);return this._clearTaskQueue(s),{...a,_meta:{...a._meta,[Gt]:{taskId:s}}}}return await o()};return await o()}),this.setRequestHandler(gs,async(r,n)=>{try{let{tasks:o,nextCursor:s}=await this._taskStore.listTasks(r.params?.cursor,n.sessionId);return{tasks:o,nextCursor:s,_meta:{}}}catch(o){throw new C(A.InvalidParams,`Failed to list tasks: ${o instanceof Error?o.message:String(o)}`)}}),this.setRequestHandler(_s,async(r,n)=>{try{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new C(A.InvalidParams,`Task not found: ${r.params.taskId}`);if(Wt(o.status))throw new C(A.InvalidParams,`Cannot cancel task in terminal status: ${o.status}`);await this._taskStore.updateTaskStatus(r.params.taskId,"cancelled","Client cancelled task execution.",n.sessionId),this._clearTaskQueue(r.params.taskId);let s=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!s)throw new C(A.InvalidParams,`Task not found after cancellation: ${r.params.taskId}`);return{_meta:{},...s}}catch(o){throw o instanceof C?o:new C(A.InvalidRequest,`Failed to cancel task: ${o instanceof Error?o.message:String(o)}`)}}))}async _oncancel(e){if(!e.params.requestId)return;this._requestHandlerAbortControllers.get(e.params.requestId)?.abort(e.params.reason)}_setupTimeout(e,r,n,o,s=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(o,r),startTime:Date.now(),timeout:r,maxTotalTimeout:n,resetTimeoutOnProgress:s,onTimeout:o})}_resetTimeout(e){let r=this._timeoutInfo.get(e);if(!r)return!1;let n=Date.now()-r.startTime;if(r.maxTotalTimeout&&n>=r.maxTotalTimeout)throw this._timeoutInfo.delete(e),C.fromError(A.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:n});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(e){let r=this._timeoutInfo.get(e);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(e))}async connect(e){if(this._transport)throw new Error("Already connected to a transport. Call close() before connecting to a new transport, or use a separate Protocol instance per connection.");this._transport=e;let r=this.transport?.onclose;this._transport.onclose=()=>{r?.(),this._onclose()};let n=this.transport?.onerror;this._transport.onerror=s=>{n?.(s),this._onerror(s)};let o=this._transport?.onmessage;this._transport.onmessage=(s,i)=>{o?.(s,i),Vn(s)||zf(s)?this._onresponse(s):Gc(s)?this._onrequest(s,i):Pf(s)?this._onnotification(s):this._onerror(new Error(`Unknown message type: ${JSON.stringify(s)}`))},await this._transport.start()}_onclose(){let e=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();for(let n of this._requestHandlerAbortControllers.values())n.abort();this._requestHandlerAbortControllers.clear();let r=C.fromError(A.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(let n of e.values())n(r)}_onerror(e){this.onerror?.(e)}_onnotification(e){let r=this._notificationHandlers.get(e.method)??this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(e)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(e,r){let n=this._requestHandlers.get(e.method)??this.fallbackRequestHandler,o=this._transport,s=e.params?._meta?.[Gt]?.taskId;if(n===void 0){let l={jsonrpc:"2.0",id:e.id,error:{code:A.MethodNotFound,message:"Method not found"}};s&&this._taskMessageQueue?this._enqueueTaskMessage(s,{type:"error",message:l,timestamp:Date.now()},o?.sessionId).catch(d=>this._onerror(new Error(`Failed to enqueue error response: ${d}`))):o?.send(l).catch(d=>this._onerror(new Error(`Failed to send an error response: ${d}`)));return}let i=new AbortController;this._requestHandlerAbortControllers.set(e.id,i);let a=kf(e.params)?e.params.task:void 0,c=this._taskStore?this.requestTaskStore(e,o?.sessionId):void 0,u={signal:i.signal,sessionId:o?.sessionId,_meta:e.params?._meta,sendNotification:async l=>{if(i.signal.aborted)return;let d={relatedRequestId:e.id};s&&(d.relatedTask={taskId:s}),await this.notification(l,d)},sendRequest:async(l,d,f)=>{if(i.signal.aborted)throw new C(A.ConnectionClosed,"Request was cancelled");let m={...f,relatedRequestId:e.id};s&&!m.relatedTask&&(m.relatedTask={taskId:s});let p=m.relatedTask?.taskId??s;return p&&c&&await c.updateTaskStatus(p,"input_required"),await this.request(l,d,m)},authInfo:r?.authInfo,requestId:e.id,requestInfo:r?.requestInfo,taskId:s,taskStore:c,taskRequestedTtl:a?.ttl,closeSSEStream:r?.closeSSEStream,closeStandaloneSSEStream:r?.closeStandaloneSSEStream};Promise.resolve().then(()=>{a&&this.assertTaskHandlerCapability(e.method)}).then(()=>n(e,u)).then(async l=>{if(i.signal.aborted)return;let d={result:l,jsonrpc:"2.0",id:e.id};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"response",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)},async l=>{if(i.signal.aborted)return;let d={jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(l.code)?l.code:A.InternalError,message:l.message??"Internal error",...l.data!==void 0&&{data:l.data}}};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"error",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)}).catch(l=>this._onerror(new Error(`Failed to send response: ${l}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progressToken:r,...n}=e.params,o=Number(r),s=this._progressHandlers.get(o);if(!s){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}let i=this._responseHandlers.get(o),a=this._timeoutInfo.get(o);if(a&&i&&a.resetTimeoutOnProgress)try{this._resetTimeout(o)}catch(c){this._responseHandlers.delete(o),this._progressHandlers.delete(o),this._cleanupTimeout(o),i(c);return}s(n)}_onresponse(e){let r=Number(e.id),n=this._requestResolvers.get(r);if(n){if(this._requestResolvers.delete(r),Vn(e))n(e);else{let i=new C(e.error.code,e.error.message,e.error.data);n(i)}return}let o=this._responseHandlers.get(r);if(o===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}this._responseHandlers.delete(r),this._cleanupTimeout(r);let s=!1;if(Vn(e)&&e.result&&typeof e.result=="object"){let i=e.result;if(i.task&&typeof i.task=="object"){let a=i.task;typeof a.taskId=="string"&&(s=!0,this._taskProgressTokens.set(a.taskId,r))}}if(s||this._progressHandlers.delete(r),Vn(e))o(e);else{let i=C.fromError(e.error.code,e.error.message,e.error.data);o(i)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(e,r,n){let{task:o}=n??{};if(!o){try{yield{type:"result",result:await this.request(e,r,n)}}catch(i){yield{type:"error",error:i instanceof C?i:new C(A.InternalError,String(i))}}return}let s;try{let i=await this.request(e,en,n);if(i.task)s=i.task.taskId,yield{type:"taskCreated",task:i.task};else throw new C(A.InternalError,"Task creation did not return a task");for(;;){let a=await this.getTask({taskId:s},n);if(yield{type:"taskStatus",task:a},Wt(a.status)){a.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)}:a.status==="failed"?yield{type:"error",error:new C(A.InternalError,`Task ${s} failed`)}:a.status==="cancelled"&&(yield{type:"error",error:new C(A.InternalError,`Task ${s} was cancelled`)});return}if(a.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)};return}let c=a.pollInterval??this._options?.defaultTaskPollInterval??1e3;await new Promise(u=>setTimeout(u,c)),n?.signal?.throwIfAborted()}}catch(i){yield{type:"error",error:i instanceof C?i:new C(A.InternalError,String(i))}}}request(e,r,n){let{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i,task:a,relatedTask:c}=n??{};return new Promise((u,l)=>{let d=x=>{l(x)};if(!this._transport){d(new Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{this.assertCapabilityForMethod(e.method),a&&this.assertTaskCapability(e.method)}catch(x){d(x);return}n?.signal?.throwIfAborted();let f=this._requestMessageId++,m={...e,jsonrpc:"2.0",id:f};n?.onprogress&&(this._progressHandlers.set(f,n.onprogress),m.params={...e.params,_meta:{...e.params?._meta||{},progressToken:f}}),a&&(m.params={...m.params,task:a}),c&&(m.params={...m.params,_meta:{...m.params?._meta||{},[Gt]:c}});let p=x=>{this._responseHandlers.delete(f),this._progressHandlers.delete(f),this._cleanupTimeout(f),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:f,reason:String(x)}},{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i}).catch(k=>this._onerror(new Error(`Failed to send cancellation: ${k}`)));let b=x instanceof C?x:new C(A.RequestTimeout,String(x));l(b)};this._responseHandlers.set(f,x=>{if(!n?.signal?.aborted){if(x instanceof Error)return l(x);try{let b=Bt(r,x.result);b.success?u(b.data):l(b.error)}catch(b){l(b)}}}),n?.signal?.addEventListener("abort",()=>{p(n?.signal?.reason)});let h=n?.timeout??H$,g=()=>p(C.fromError(A.RequestTimeout,"Request timed out",{timeout:h}));this._setupTimeout(f,h,n?.maxTotalTimeout,g,n?.resetTimeoutOnProgress??!1);let _=c?.taskId;if(_){let x=b=>{let k=this._responseHandlers.get(f);k?k(b):this._onerror(new Error(`Response handler missing for side-channeled request ${f}`))};this._requestResolvers.set(f,x),this._enqueueTaskMessage(_,{type:"request",message:m,timestamp:Date.now()}).catch(b=>{this._cleanupTimeout(f),l(b)})}else this._transport.send(m,{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i}).catch(x=>{this._cleanupTimeout(f),l(x)})})}async getTask(e,r){return this.request({method:"tasks/get",params:e},ms,r)}async getTaskResult(e,r,n){return this.request({method:"tasks/result",params:e},r,n)}async listTasks(e,r){return this.request({method:"tasks/list",params:e},ys,r)}async cancelTask(e,r){return this.request({method:"tasks/cancel",params:e},Rf,r)}async notification(e,r){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);let n=r?.relatedTask?.taskId;if(n){let a={...e,jsonrpc:"2.0",params:{...e.params,_meta:{...e.params?._meta||{},[Gt]:r.relatedTask}}};await this._enqueueTaskMessage(n,{type:"notification",message:a,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(e.method)&&!e.params&&!r?.relatedRequestId&&!r?.relatedTask){if(this._pendingDebouncedNotifications.has(e.method))return;this._pendingDebouncedNotifications.add(e.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(e.method),!this._transport)return;let a={...e,jsonrpc:"2.0"};r?.relatedTask&&(a={...a,params:{...a.params,_meta:{...a.params?._meta||{},[Gt]:r.relatedTask}}}),this._transport?.send(a,r).catch(c=>this._onerror(c))});return}let i={...e,jsonrpc:"2.0"};r?.relatedTask&&(i={...i,params:{...i.params,_meta:{...i.params?._meta||{},[Gt]:r.relatedTask}}}),await this._transport.send(i,r)}setRequestHandler(e,r){let n=gu(e);this.assertRequestHandlerCapability(n),this._requestHandlers.set(n,(o,s)=>{let i=yu(e,o);return Promise.resolve(r(i,s))})}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,r){let n=gu(e);this._notificationHandlers.set(n,o=>{let s=yu(e,o);return Promise.resolve(r(s))})}removeNotificationHandler(e){this._notificationHandlers.delete(e)}_cleanupTaskProgressHandler(e){let r=this._taskProgressTokens.get(e);r!==void 0&&(this._progressHandlers.delete(r),this._taskProgressTokens.delete(e))}async _enqueueTaskMessage(e,r,n){if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let o=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(e,r,n,o)}async _clearTaskQueue(e,r){if(this._taskMessageQueue){let n=await this._taskMessageQueue.dequeueAll(e,r);for(let o of n)if(o.type==="request"&&Gc(o.message)){let s=o.message.id,i=this._requestResolvers.get(s);i?(i(new C(A.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(s)):this._onerror(new Error(`Resolver missing for request ${s} during task ${e} cleanup`))}}}async _waitForTaskUpdate(e,r){let n=this._options?.defaultTaskPollInterval??1e3;try{let o=await this._taskStore?.getTask(e);o?.pollInterval&&(n=o.pollInterval)}catch{}return new Promise((o,s)=>{if(r.aborted){s(new C(A.InvalidRequest,"Request cancelled"));return}let i=setTimeout(o,n);r.addEventListener("abort",()=>{clearTimeout(i),s(new C(A.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(e,r){let n=this._taskStore;if(!n)throw new Error("No task store configured");return{createTask:async o=>{if(!e)throw new Error("No request provided");return await n.createTask(o,e.id,{method:e.method,params:e.params},r)},getTask:async o=>{let s=await n.getTask(o,r);if(!s)throw new C(A.InvalidParams,"Failed to retrieve task: Task not found");return s},storeTaskResult:async(o,s,i)=>{await n.storeTaskResult(o,s,i,r);let a=await n.getTask(o,r);if(a){let c=Jn.parse({method:"notifications/tasks/status",params:a});await this.notification(c),Wt(a.status)&&this._cleanupTaskProgressHandler(o)}},getTaskResult:o=>n.getTaskResult(o,r),updateTaskStatus:async(o,s,i)=>{let a=await n.getTask(o,r);if(!a)throw new C(A.InvalidParams,`Task "${o}" not found - it may have been cleaned up`);if(Wt(a.status))throw new C(A.InvalidParams,`Cannot update task "${o}" from terminal status "${a.status}" to "${s}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await n.updateTaskStatus(o,s,i,r);let c=await n.getTask(o,r);if(c){let u=Jn.parse({method:"notifications/tasks/status",params:c});await this.notification(u),Wt(c.status)&&this._cleanupTaskProgressHandler(o)}},listTasks:o=>n.listTasks(o,r)}}};function ym(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function _m(t,e){let r={...t};for(let n in e){let o=n,s=e[o];if(s===void 0)continue;let i=r[o];ym(i)&&ym(s)?r[o]={...i,...s}:r[o]=s}return r}var oy=Ro(rd(),1),sy=Ro(ny(),1);function NP(){let t=new oy.default({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return(0,sy.default)(t),t}var hi=class{constructor(e){this._ajv=e??NP()}getValidator(e){let r="$id"in e&&typeof e.$id=="string"?this._ajv.getSchema(e.$id)??this._ajv.compile(e):this._ajv.compile(e);return n=>r(n)?{valid:!0,data:n,errorMessage:void 0}:{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(r.errors)}}};var gi=class{constructor(e){this._server=e}requestStream(e,r,n){return this._server.requestStream(e,r,n)}async getTask(e,r){return this._server.getTask({taskId:e},r)}async getTaskResult(e,r,n){return this._server.getTaskResult({taskId:e},r,n)}async listTasks(e,r){return this._server.listTasks(e?{cursor:e}:void 0,r)}async cancelTask(e,r){return this._server.cancelTask({taskId:e},r)}};function iy(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"tools/call":if(!t.tools?.call)throw new Error(`${r} does not support task creation for tools/call (required for ${e})`);break;default:break}}function ay(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"sampling/createMessage":if(!t.sampling?.createMessage)throw new Error(`${r} does not support task creation for sampling/createMessage (required for ${e})`);break;case"elicitation/create":if(!t.elicitation?.create)throw new Error(`${r} does not support task creation for elicitation/create (required for ${e})`);break;default:break}}var yi=class extends Cs{constructor(e,r){super(r),this._serverInfo=e,this._loggingLevels=new Map,this.LOG_LEVEL_SEVERITY=new Map(Wn.options.map((n,o)=>[n,o])),this.isMessageIgnored=(n,o)=>{let s=this._loggingLevels.get(o);return s?this.LOG_LEVEL_SEVERITY.get(n)<this.LOG_LEVEL_SEVERITY.get(s):!1},this._capabilities=r?.capabilities??{},this._instructions=r?.instructions,this._jsonSchemaValidator=r?.jsonSchemaValidator??new hi,this.setRequestHandler(Yc,n=>this._oninitialize(n)),this.setNotificationHandler(Qc,()=>this.oninitialized?.()),this._capabilities.logging&&this.setRequestHandler(iu,async(n,o)=>{let s=o.sessionId||o.requestInfo?.headers["mcp-session-id"]||void 0,{level:i}=n.params,a=Wn.safeParse(i);return a.success&&this._loggingLevels.set(s,a.data),{}})}get experimental(){return this._experimental||(this._experimental={tasks:new gi(this)}),this._experimental}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=_m(this._capabilities,e)}setRequestHandler(e,r){let o=Jt(e)?.method;if(!o)throw new Error("Schema is missing a method literal");let s;if(et(o)){let a=o;s=a._zod?.def?.value??a.value}else{let a=o;s=a._def?.value??a.value}if(typeof s!="string")throw new Error("Schema method literal must be a string");if(s==="tools/call"){let a=async(c,u)=>{let l=Bt(rn,c);if(!l.success){let p=l.error instanceof Error?l.error.message:String(l.error);throw new C(A.InvalidParams,`Invalid tools/call request: ${p}`)}let{params:d}=l.data,f=await Promise.resolve(r(c,u));if(d.task){let p=Bt(en,f);if(!p.success){let h=p.error instanceof Error?p.error.message:String(p.error);throw new C(A.InvalidParams,`Invalid task creation result: ${h}`)}return p.data}let m=Bt(Ss,f);if(!m.success){let p=m.error instanceof Error?m.error.message:String(m.error);throw new C(A.InvalidParams,`Invalid tools/call result: ${p}`)}return m.data};return super.setRequestHandler(e,a)}return super.setRequestHandler(e,r)}assertCapabilityForMethod(e){switch(e){case"sampling/createMessage":if(!this._clientCapabilities?.sampling)throw new Error(`Client does not support sampling (required for ${e})`);break;case"elicitation/create":if(!this._clientCapabilities?.elicitation)throw new Error(`Client does not support elicitation (required for ${e})`);break;case"roots/list":if(!this._clientCapabilities?.roots)throw new Error(`Client does not support listing roots (required for ${e})`);break;case"ping":break}}assertNotificationCapability(e){switch(e){case"notifications/message":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw new Error(`Server does not support notifying about resources (required for ${e})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw new Error(`Server does not support notifying of tool list changes (required for ${e})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw new Error(`Server does not support notifying of prompt list changes (required for ${e})`);break;case"notifications/elicitation/complete":if(!this._clientCapabilities?.elicitation?.url)throw new Error(`Client does not support URL elicitation (required for ${e})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){if(this._capabilities)switch(e){case"completion/complete":if(!this._capabilities.completions)throw new Error(`Server does not support completions (required for ${e})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw new Error(`Server does not support resources (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw new Error(`Server does not support tasks capability (required for ${e})`);break;case"ping":case"initialize":break}}assertTaskCapability(e){ay(this._clientCapabilities?.tasks?.requests,e,"Client")}assertTaskHandlerCapability(e){this._capabilities&&iy(this._capabilities.tasks?.requests,e,"Server")}async _oninitialize(e){let r=e.params.protocolVersion;return this._clientCapabilities=e.params.capabilities,this._clientVersion=e.params.clientInfo,{protocolVersion:bf.includes(r)?r:Bc,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},us)}async createMessage(e,r){if((e.tools||e.toolChoice)&&!this._clientCapabilities?.sampling?.tools)throw new Error("Client does not support sampling tools capability.");if(e.messages.length>0){let n=e.messages[e.messages.length-1],o=Array.isArray(n.content)?n.content:[n.content],s=o.some(u=>u.type==="tool_result"),i=e.messages.length>1?e.messages[e.messages.length-2]:void 0,a=i?Array.isArray(i.content)?i.content:[i.content]:[],c=a.some(u=>u.type==="tool_use");if(s){if(o.some(u=>u.type!=="tool_result"))throw new Error("The last message must contain only tool_result content if any is present");if(!c)throw new Error("tool_result blocks are not matching any tool_use from the previous message")}if(c){let u=new Set(a.filter(d=>d.type==="tool_use").map(d=>d.id)),l=new Set(o.filter(d=>d.type==="tool_result").map(d=>d.toolUseId));if(u.size!==l.size||![...u].every(d=>l.has(d)))throw new Error("ids of tool_result blocks and tool_use blocks from previous message do not match")}}return e.tools?this.request({method:"sampling/createMessage",params:e},cu,r):this.request({method:"sampling/createMessage",params:e},au,r)}async elicitInput(e,r){switch(e.mode??"form"){case"url":{if(!this._clientCapabilities?.elicitation?.url)throw new Error("Client does not support url elicitation.");let o=e;return this.request({method:"elicitation/create",params:o},Ts,r)}case"form":{if(!this._clientCapabilities?.elicitation?.form)throw new Error("Client does not support form elicitation.");let o=e.mode==="form"?e:{...e,mode:"form"},s=await this.request({method:"elicitation/create",params:o},Ts,r);if(s.action==="accept"&&s.content&&o.requestedSchema)try{let a=this._jsonSchemaValidator.getValidator(o.requestedSchema)(s.content);if(!a.valid)throw new C(A.InvalidParams,`Elicitation response content does not match requested schema: ${a.errorMessage}`)}catch(i){throw i instanceof C?i:new C(A.InternalError,`Error validating elicitation response: ${i instanceof Error?i.message:String(i)}`)}return s}}}createElicitationCompletionNotifier(e,r){if(!this._clientCapabilities?.elicitation?.url)throw new Error("Client does not support URL elicitation (required for notifications/elicitation/complete)");return()=>this.notification({method:"notifications/elicitation/complete",params:{elicitationId:e}},r)}async listRoots(e,r){return this.request({method:"roots/list",params:e},uu,r)}async sendLoggingMessage(e,r){if(this._capabilities.logging&&!this.isMessageIgnored(e.level,r))return this.notification({method:"notifications/message",params:e})}async sendResourceUpdated(e){return this.notification({method:"notifications/resources/updated",params:e})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}};var uy=Symbol.for("mcp.completable");function ld(t){return!!t&&typeof t=="object"&&uy in t}function ly(t){return t[uy]?.complete}var cy;(function(t){t.Completable="McpCompletable"})(cy||(cy={}));var ZP=/^[A-Za-z0-9._-]{1,128}$/;function MP(t){let e=[];if(t.length===0)return{isValid:!1,warnings:["Tool name cannot be empty"]};if(t.length>128)return{isValid:!1,warnings:[`Tool name exceeds maximum length of 128 characters (current: ${t.length})`]};if(t.includes(" ")&&e.push("Tool name contains spaces, which may cause parsing issues"),t.includes(",")&&e.push("Tool name contains commas, which may cause parsing issues"),(t.startsWith("-")||t.endsWith("-"))&&e.push("Tool name starts or ends with a dash, which may cause parsing issues in some contexts"),(t.startsWith(".")||t.endsWith("."))&&e.push("Tool name starts or ends with a dot, which may cause parsing issues in some contexts"),!ZP.test(t)){let r=t.split("").filter(n=>!/[A-Za-z0-9._-]/.test(n)).filter((n,o,s)=>s.indexOf(n)===o);return e.push(`Tool name contains invalid characters: ${r.map(n=>`"${n}"`).join(", ")}`,"Allowed characters are: A-Z, a-z, 0-9, underscore (_), dash (-), and dot (.)"),{isValid:!1,warnings:e}}return{isValid:!0,warnings:e}}function DP(t,e){if(e.length>0){console.warn(`Tool name validation warning for "${t}":`);for(let r of e)console.warn(`  - ${r}`);console.warn("Tool registration will proceed, but this may cause compatibility issues."),console.warn("Consider updating the tool name to conform to the MCP tool naming standard."),console.warn("See SEP: Specify Format for Tool Names (https://github.com/modelcontextprotocol/modelcontextprotocol/issues/986) for more details.")}}function dd(t){let e=MP(t);return DP(t,e.warnings),e.isValid}var _i=class{constructor(e){this._mcpServer=e}registerToolTask(e,r,n){let o={taskSupport:"required",...r.execution};if(o.taskSupport==="forbidden")throw new Error(`Cannot register task-based tool '${e}' with taskSupport 'forbidden'. Use registerTool() instead.`);return this._mcpServer._createRegisteredTool(e,r.title,r.description,r.inputSchema,r.outputSchema,r.annotations,o,r._meta,n)}};var vi=class{constructor(e,r){this._registeredResources={},this._registeredResourceTemplates={},this._registeredTools={},this._registeredPrompts={},this._toolHandlersInitialized=!1,this._completionHandlerInitialized=!1,this._resourceHandlersInitialized=!1,this._promptHandlersInitialized=!1,this.server=new yi(e,r)}get experimental(){return this._experimental||(this._experimental={tasks:new _i(this)}),this._experimental}async connect(e){return await this.server.connect(e)}async close(){await this.server.close()}setToolRequestHandlers(){this._toolHandlersInitialized||(this.server.assertCanSetRequestHandler(sr(ks)),this.server.assertCanSetRequestHandler(sr(rn)),this.server.registerCapabilities({tools:{listChanged:!0}}),this.server.setRequestHandler(ks,()=>({tools:Object.entries(this._registeredTools).filter(([,e])=>e.enabled).map(([e,r])=>{let n={name:e,title:r.title,description:r.description,inputSchema:(()=>{let o=Yr(r.inputSchema);return o?hu(o,{strictUnions:!0,pipeStrategy:"input"}):qP})(),annotations:r.annotations,execution:r.execution,_meta:r._meta};if(r.outputSchema){let o=Yr(r.outputSchema);o&&(n.outputSchema=hu(o,{strictUnions:!0,pipeStrategy:"output"}))}return n})})),this.server.setRequestHandler(rn,async(e,r)=>{try{let n=this._registeredTools[e.params.name];if(!n)throw new C(A.InvalidParams,`Tool ${e.params.name} not found`);if(!n.enabled)throw new C(A.InvalidParams,`Tool ${e.params.name} disabled`);let o=!!e.params.task,s=n.execution?.taskSupport,i="createTask"in n.handler;if((s==="required"||s==="optional")&&!i)throw new C(A.InternalError,`Tool ${e.params.name} has taskSupport '${s}' but was not registered with registerToolTask`);if(s==="required"&&!o)throw new C(A.MethodNotFound,`Tool ${e.params.name} requires task augmentation (taskSupport: 'required')`);if(s==="optional"&&!o&&i)return await this.handleAutomaticTaskPolling(n,e,r);let a=await this.validateToolInput(n,e.params.arguments,e.params.name),c=await this.executeToolHandler(n,a,r);return o||await this.validateToolOutput(n,c,e.params.name),c}catch(n){if(n instanceof C&&n.code===A.UrlElicitationRequired)throw n;return this.createToolError(n instanceof Error?n.message:String(n))}}),this._toolHandlersInitialized=!0)}createToolError(e){return{content:[{type:"text",text:e}],isError:!0}}async validateToolInput(e,r,n){if(!e.inputSchema)return;let s=Yr(e.inputSchema)??e.inputSchema,i=await ts(s,r);if(!i.success){let a="error"in i?i.error:"Unknown error",c=rs(a);throw new C(A.InvalidParams,`Input validation error: Invalid arguments for tool ${n}: ${c}`)}return i.data}async validateToolOutput(e,r,n){if(!e.outputSchema||!("content"in r)||r.isError)return;if(!r.structuredContent)throw new C(A.InvalidParams,`Output validation error: Tool ${n} has an output schema but no structured content was provided`);let o=Yr(e.outputSchema),s=await ts(o,r.structuredContent);if(!s.success){let i="error"in s?s.error:"Unknown error",a=rs(i);throw new C(A.InvalidParams,`Output validation error: Invalid structured content for tool ${n}: ${a}`)}}async executeToolHandler(e,r,n){let o=e.handler;if("createTask"in o){if(!n.taskStore)throw new Error("No task store provided.");let i={...n,taskStore:n.taskStore};if(e.inputSchema){let a=o;return await Promise.resolve(a.createTask(r,i))}else{let a=o;return await Promise.resolve(a.createTask(i))}}if(e.inputSchema){let i=o;return await Promise.resolve(i(r,n))}else{let i=o;return await Promise.resolve(i(n))}}async handleAutomaticTaskPolling(e,r,n){if(!n.taskStore)throw new Error("No task store provided for task-capable tool.");let o=await this.validateToolInput(e,r.params.arguments,r.params.name),s=e.handler,i={...n,taskStore:n.taskStore},a=o?await Promise.resolve(s.createTask(o,i)):await Promise.resolve(s.createTask(i)),c=a.task.taskId,u=a.task,l=u.pollInterval??5e3;for(;u.status!=="completed"&&u.status!=="failed"&&u.status!=="cancelled";){await new Promise(f=>setTimeout(f,l));let d=await n.taskStore.getTask(c);if(!d)throw new C(A.InternalError,`Task ${c} not found during polling`);u=d}return await n.taskStore.getTaskResult(c)}setCompletionRequestHandler(){this._completionHandlerInitialized||(this.server.assertCanSetRequestHandler(sr(Ps)),this.server.registerCapabilities({completions:{}}),this.server.setRequestHandler(Ps,async e=>{switch(e.params.ref.type){case"ref/prompt":return Zf(e),this.handlePromptCompletion(e,e.params.ref);case"ref/resource":return Mf(e),this.handleResourceCompletion(e,e.params.ref);default:throw new C(A.InvalidParams,`Invalid completion reference: ${e.params.ref}`)}}),this._completionHandlerInitialized=!0)}async handlePromptCompletion(e,r){let n=this._registeredPrompts[r.name];if(!n)throw new C(A.InvalidParams,`Prompt ${r.name} not found`);if(!n.enabled)throw new C(A.InvalidParams,`Prompt ${r.name} disabled`);if(!n.argsSchema)return zo;let s=Jt(n.argsSchema)?.[e.params.argument.name];if(!ld(s))return zo;let i=ly(s);if(!i)return zo;let a=await i(e.params.argument.value,e.params.context);return py(a)}async handleResourceCompletion(e,r){let n=Object.values(this._registeredResourceTemplates).find(i=>i.resourceTemplate.uriTemplate.toString()===r.uri);if(!n){if(this._registeredResources[r.uri])return zo;throw new C(A.InvalidParams,`Resource template ${e.params.ref.uri} not found`)}let o=n.resourceTemplate.completeCallback(e.params.argument.name);if(!o)return zo;let s=await o(e.params.argument.value,e.params.context);return py(s)}setResourceRequestHandlers(){this._resourceHandlersInitialized||(this.server.assertCanSetRequestHandler(sr(vs)),this.server.assertCanSetRequestHandler(sr(xs)),this.server.assertCanSetRequestHandler(sr(bs)),this.server.registerCapabilities({resources:{listChanged:!0}}),this.server.setRequestHandler(vs,async(e,r)=>{let n=Object.entries(this._registeredResources).filter(([s,i])=>i.enabled).map(([s,i])=>({uri:s,name:i.name,...i.metadata})),o=[];for(let s of Object.values(this._registeredResourceTemplates)){if(!s.resourceTemplate.listCallback)continue;let i=await s.resourceTemplate.listCallback(r);for(let a of i.resources)o.push({...s.metadata,...a})}return{resources:[...n,...o]}}),this.server.setRequestHandler(xs,async()=>({resourceTemplates:Object.entries(this._registeredResourceTemplates).map(([r,n])=>({name:r,uriTemplate:n.resourceTemplate.uriTemplate.toString(),...n.metadata}))})),this.server.setRequestHandler(bs,async(e,r)=>{let n=new URL(e.params.uri),o=this._registeredResources[n.toString()];if(o){if(!o.enabled)throw new C(A.InvalidParams,`Resource ${n} disabled`);return o.readCallback(n,r)}for(let s of Object.values(this._registeredResourceTemplates)){let i=s.resourceTemplate.uriTemplate.match(n.toString());if(i)return s.readCallback(n,i,r)}throw new C(A.InvalidParams,`Resource ${n} not found`)}),this._resourceHandlersInitialized=!0)}setPromptRequestHandlers(){this._promptHandlersInitialized||(this.server.assertCanSetRequestHandler(sr($s)),this.server.assertCanSetRequestHandler(sr(ws)),this.server.registerCapabilities({prompts:{listChanged:!0}}),this.server.setRequestHandler($s,()=>({prompts:Object.entries(this._registeredPrompts).filter(([,e])=>e.enabled).map(([e,r])=>({name:e,title:r.title,description:r.description,arguments:r.argsSchema?UP(r.argsSchema):void 0}))})),this.server.setRequestHandler(ws,async(e,r)=>{let n=this._registeredPrompts[e.params.name];if(!n)throw new C(A.InvalidParams,`Prompt ${e.params.name} not found`);if(!n.enabled)throw new C(A.InvalidParams,`Prompt ${e.params.name} disabled`);if(n.argsSchema){let o=Yr(n.argsSchema),s=await ts(o,e.params.arguments);if(!s.success){let c="error"in s?s.error:"Unknown error",u=rs(c);throw new C(A.InvalidParams,`Invalid arguments for prompt ${e.params.name}: ${u}`)}let i=s.data,a=n.callback;return await Promise.resolve(a(i,r))}else{let o=n.callback;return await Promise.resolve(o(r))}}),this._promptHandlersInitialized=!0)}resource(e,r,...n){let o;typeof n[0]=="object"&&(o=n.shift());let s=n[0];if(typeof r=="string"){if(this._registeredResources[r])throw new Error(`Resource ${r} is already registered`);let i=this._createRegisteredResource(e,void 0,r,o,s);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),i}else{if(this._registeredResourceTemplates[e])throw new Error(`Resource template ${e} is already registered`);let i=this._createRegisteredResourceTemplate(e,void 0,r,o,s);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),i}}registerResource(e,r,n,o){if(typeof r=="string"){if(this._registeredResources[r])throw new Error(`Resource ${r} is already registered`);let s=this._createRegisteredResource(e,n.title,r,n,o);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),s}else{if(this._registeredResourceTemplates[e])throw new Error(`Resource template ${e} is already registered`);let s=this._createRegisteredResourceTemplate(e,n.title,r,n,o);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),s}}_createRegisteredResource(e,r,n,o,s){let i={name:e,title:r,metadata:o,readCallback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({uri:null}),update:a=>{typeof a.uri<"u"&&a.uri!==n&&(delete this._registeredResources[n],a.uri&&(this._registeredResources[a.uri]=i)),typeof a.name<"u"&&(i.name=a.name),typeof a.title<"u"&&(i.title=a.title),typeof a.metadata<"u"&&(i.metadata=a.metadata),typeof a.callback<"u"&&(i.readCallback=a.callback),typeof a.enabled<"u"&&(i.enabled=a.enabled),this.sendResourceListChanged()}};return this._registeredResources[n]=i,i}_createRegisteredResourceTemplate(e,r,n,o,s){let i={resourceTemplate:n,title:r,metadata:o,readCallback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({name:null}),update:u=>{typeof u.name<"u"&&u.name!==e&&(delete this._registeredResourceTemplates[e],u.name&&(this._registeredResourceTemplates[u.name]=i)),typeof u.title<"u"&&(i.title=u.title),typeof u.template<"u"&&(i.resourceTemplate=u.template),typeof u.metadata<"u"&&(i.metadata=u.metadata),typeof u.callback<"u"&&(i.readCallback=u.callback),typeof u.enabled<"u"&&(i.enabled=u.enabled),this.sendResourceListChanged()}};this._registeredResourceTemplates[e]=i;let a=n.uriTemplate.variableNames;return Array.isArray(a)&&a.some(u=>!!n.completeCallback(u))&&this.setCompletionRequestHandler(),i}_createRegisteredPrompt(e,r,n,o,s){let i={title:r,description:n,argsSchema:o===void 0?void 0:zr(o),callback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({name:null}),update:a=>{typeof a.name<"u"&&a.name!==e&&(delete this._registeredPrompts[e],a.name&&(this._registeredPrompts[a.name]=i)),typeof a.title<"u"&&(i.title=a.title),typeof a.description<"u"&&(i.description=a.description),typeof a.argsSchema<"u"&&(i.argsSchema=zr(a.argsSchema)),typeof a.callback<"u"&&(i.callback=a.callback),typeof a.enabled<"u"&&(i.enabled=a.enabled),this.sendPromptListChanged()}};return this._registeredPrompts[e]=i,o&&Object.values(o).some(c=>{let u=c instanceof Le?c._def?.innerType:c;return ld(u)})&&this.setCompletionRequestHandler(),i}_createRegisteredTool(e,r,n,o,s,i,a,c,u){dd(e);let l={title:r,description:n,inputSchema:dy(o),outputSchema:dy(s),annotations:i,execution:a,_meta:c,handler:u,enabled:!0,disable:()=>l.update({enabled:!1}),enable:()=>l.update({enabled:!0}),remove:()=>l.update({name:null}),update:d=>{typeof d.name<"u"&&d.name!==e&&(typeof d.name=="string"&&dd(d.name),delete this._registeredTools[e],d.name&&(this._registeredTools[d.name]=l)),typeof d.title<"u"&&(l.title=d.title),typeof d.description<"u"&&(l.description=d.description),typeof d.paramsSchema<"u"&&(l.inputSchema=zr(d.paramsSchema)),typeof d.outputSchema<"u"&&(l.outputSchema=zr(d.outputSchema)),typeof d.callback<"u"&&(l.handler=d.callback),typeof d.annotations<"u"&&(l.annotations=d.annotations),typeof d._meta<"u"&&(l._meta=d._meta),typeof d.enabled<"u"&&(l.enabled=d.enabled),this.sendToolListChanged()}};return this._registeredTools[e]=l,this.setToolRequestHandlers(),this.sendToolListChanged(),l}tool(e,...r){if(this._registeredTools[e])throw new Error(`Tool ${e} is already registered`);let n,o,s,i;if(typeof r[0]=="string"&&(n=r.shift()),r.length>1){let c=r[0];pd(c)?(o=r.shift(),r.length>1&&typeof r[0]=="object"&&r[0]!==null&&!pd(r[0])&&(i=r.shift())):typeof c=="object"&&c!==null&&(i=r.shift())}let a=r[0];return this._createRegisteredTool(e,void 0,n,o,s,i,{taskSupport:"forbidden"},void 0,a)}registerTool(e,r,n){if(this._registeredTools[e])throw new Error(`Tool ${e} is already registered`);let{title:o,description:s,inputSchema:i,outputSchema:a,annotations:c,_meta:u}=r;return this._createRegisteredTool(e,o,s,i,a,c,{taskSupport:"forbidden"},u,n)}prompt(e,...r){if(this._registeredPrompts[e])throw new Error(`Prompt ${e} is already registered`);let n;typeof r[0]=="string"&&(n=r.shift());let o;r.length>1&&(o=r.shift());let s=r[0],i=this._createRegisteredPrompt(e,void 0,n,o,s);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),i}registerPrompt(e,r,n){if(this._registeredPrompts[e])throw new Error(`Prompt ${e} is already registered`);let{title:o,description:s,argsSchema:i}=r,a=this._createRegisteredPrompt(e,o,s,i,n);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),a}isConnected(){return this.server.transport!==void 0}async sendLoggingMessage(e,r){return this.server.sendLoggingMessage(e,r)}sendResourceListChanged(){this.isConnected()&&this.server.sendResourceListChanged()}sendToolListChanged(){this.isConnected()&&this.server.sendToolListChanged()}sendPromptListChanged(){this.isConnected()&&this.server.sendPromptListChanged()}};var qP={type:"object",properties:{}};function fy(t){return t!==null&&typeof t=="object"&&"parse"in t&&typeof t.parse=="function"&&"safeParse"in t&&typeof t.safeParse=="function"}function LP(t){return"_def"in t||"_zod"in t||fy(t)}function pd(t){return typeof t!="object"||t===null||LP(t)?!1:Object.keys(t).length===0?!0:Object.values(t).some(fy)}function dy(t){if(t)return pd(t)?zr(t):t}function UP(t){let e=Jt(t);return e?Object.entries(e).map(([r,n])=>{let o=Xp(n),s=Yp(n);return{name:r,description:o,required:!s}}):[]}function sr(t){let r=Jt(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=ns(r);if(typeof n=="string")return n;throw new Error("Schema method literal must be a string")}function py(t){return{completion:{values:t.slice(0,100),total:t.length,hasMore:t.length>100}}}var zo={completion:{values:[],hasMore:!1}};var fd=Ro(require("node:process"),1);var xi=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;let e=this._buffer.indexOf(`
`);if(e===-1)return null;let r=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),VP(r)}clear(){this._buffer=void 0}};function VP(t){return Ef.parse(JSON.parse(t))}function my(t){return JSON.stringify(t)+`
`}var bi=class{constructor(e=fd.default.stdin,r=fd.default.stdout){this._stdin=e,this._stdout=r,this._readBuffer=new xi,this._started=!1,this._ondata=n=>{this._readBuffer.append(n),this.processReadBuffer()},this._onerror=n=>{this.onerror?.(n)}}async start(){if(this._started)throw new Error("StdioServerTransport already started! If using Server class, note that connect() calls start() automatically.");this._started=!0,this._stdin.on("data",this._ondata),this._stdin.on("error",this._onerror)}processReadBuffer(){for(;;)try{let e=this._readBuffer.readMessage();if(e===null)break;this.onmessage?.(e)}catch(e){this.onerror?.(e)}}async close(){this._stdin.off("data",this._ondata),this._stdin.off("error",this._onerror),this._stdin.listenerCount("data")===0&&this._stdin.pause(),this._readBuffer.clear(),this.onclose?.()}send(e){return new Promise(r=>{let n=my(e);this._stdout.write(n)?r():this._stdout.once("drain",r)})}};var Eo=Ro(require("node:crypto"),1);var gy="0123456789ABCDEFGHJKMNPQRSTVWXYZ",$i=32;var FP=16,yy=10,hy=0xffffffffffff;var Dr;(function(t){t.Base32IncorrectEncoding="B32_ENC_INVALID",t.DecodeTimeInvalidCharacter="DEC_TIME_CHAR",t.DecodeTimeValueMalformed="DEC_TIME_MALFORMED",t.EncodeTimeNegative="ENC_TIME_NEG",t.EncodeTimeSizeExceeded="ENC_TIME_SIZE_EXCEED",t.EncodeTimeValueMalformed="ENC_TIME_MALFORMED",t.PRNGDetectFailure="PRNG_DETECT",t.ULIDInvalid="ULID_INVALID",t.Unexpected="UNEXPECTED",t.UUIDInvalid="UUID_INVALID"})(Dr||(Dr={}));var qr=class extends Error{constructor(e,r){super(`${r} (${e})`),this.name="ULIDError",this.code=e}};function KP(t){let e=Math.floor(t()*$i)%$i;return gy.charAt(e)}function HP(t){let e=BP(),r=e&&(e.crypto||e.msCrypto)||(typeof Eo.default<"u"?Eo.default:null);if(typeof r?.getRandomValues=="function")return()=>{let n=new Uint8Array(1);return r.getRandomValues(n),n[0]/256};if(typeof r?.randomBytes=="function")return()=>r.randomBytes(1).readUInt8()/256;if(Eo.default?.randomBytes)return()=>Eo.default.randomBytes(1).readUInt8()/256;throw new qr(Dr.PRNGDetectFailure,"Failed to find a reliable PRNG")}function BP(){return WP()?self:typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:null}function JP(t,e){let r="";for(;t>0;t--)r=KP(e)+r;return r}function GP(t,e=yy){if(isNaN(t))throw new qr(Dr.EncodeTimeValueMalformed,`Time must be a number: ${t}`);if(t>hy)throw new qr(Dr.EncodeTimeSizeExceeded,`Cannot encode a time larger than ${hy}: ${t}`);if(t<0)throw new qr(Dr.EncodeTimeNegative,`Time must be positive: ${t}`);if(Number.isInteger(t)===!1)throw new qr(Dr.EncodeTimeValueMalformed,`Time must be an integer: ${t}`);let r,n="";for(let o=e;o>0;o--)r=t%$i,n=gy.charAt(r)+n,t=(t-r)/$i;return n}function WP(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}function _y(t,e){let r=e||HP(),n=!t||isNaN(t)?Date.now():t;return GP(n,yy)+JP(FP,r)}var wi=class{baseUrl;apiKey;teamId;projectId;brainETag=null;brainCache=null;brainParamsKey=null;constructor(e){if(this.apiKey=e?.apiKey??process.env.CONTOX_API_KEY??"",this.baseUrl=(e?.apiUrl??process.env.CONTOX_API_URL??"https://contox.dev").replace(/\/$/,""),this.teamId=e?.teamId??process.env.CONTOX_TEAM_ID??"",this.projectId=e?.projectId??process.env.CONTOX_PROJECT_ID??"",!this.apiKey)throw new Error("CONTOX_API_KEY is required. Set it as an environment variable.");if(!this.teamId)throw new Error("CONTOX_TEAM_ID is required. Set it as an environment variable.");if(!this.projectId)throw new Error("CONTOX_PROJECT_ID is required. Set it as an environment variable.")}async request(e,r={}){let n=`${this.baseUrl}/api${e}`,o=await fetch(n,{...r,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...r.headers}});if(!o.ok){let s=await o.json().catch(()=>({})),i=typeof s.error=="string"?s.error:o.statusText;throw new Error(`API error (${String(o.status)}): ${i}`)}return o.json()}async listContexts(e){let r=new URLSearchParams({teamId:this.teamId,projectId:this.projectId});return e?.schemaKey&&r.set("schemaKey",e.schemaKey),e?.tier!==void 0&&r.set("tier",String(e.tier)),e?.state&&r.set("state",e.state),e?.contextType&&r.set("contextType",e.contextType),e?.parentContextId&&r.set("parentContextId",e.parentContextId),this.request(`/contexts?${r.toString()}`)}async getContext(e){return this.request(`/contexts/${encodeURIComponent(e)}`)}async createContext(e){return this.request("/contexts",{method:"POST",body:JSON.stringify(e)})}async updateContext(e,r){return this.request(`/contexts/${encodeURIComponent(e)}`,{method:"PATCH",body:JSON.stringify(r)})}async deleteContext(e){await this.request(`/contexts/${encodeURIComponent(e)}`,{method:"DELETE"})}async findBySchemaKey(e){return(await this.listContexts({schemaKey:e}))[0]??null}async findContextByName(e){return(await this.listContexts()).find(n=>n.name===e)??null}async searchContexts(e){let r=await this.listContexts(),n=e.toLowerCase();return r.filter(o=>o.name.toLowerCase().includes(n)||(o.description?.toLowerCase().includes(n)??!1))}async searchContent(e){return this.request(`/contexts/search?q=${encodeURIComponent(e)}&projectId=${encodeURIComponent(this.projectId)}`)}async getBrain(e,r){let n=new URLSearchParams({teamId:this.teamId,projectId:this.projectId});if(r&&n.set("includeDrafts","true"),e){let u=Object.entries(e).map(([l,d])=>`${l}:${String(d)}`).join(",");n.set("entriesLimit",u)}let o=n.toString();o!==this.brainParamsKey&&(this.brainETag=null,this.brainCache=null,this.brainParamsKey=o);let s={};this.brainETag&&(s["If-None-Match"]=this.brainETag);let i=`${this.baseUrl}/api/contexts/brain?${o}`,a=await fetch(i,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...s}});if(a.status===304&&this.brainCache)return this.brainCache;if(!a.ok){let u=await a.json().catch(()=>({})),l=typeof u.error=="string"?u.error:a.statusText;throw new Error(`API error (${String(a.status)}): ${l}`)}let c=await a.json();return this.brainETag=a.headers.get("etag"),this.brainCache=c,c}async createEntry(e){return this.request("/context-entries",{method:"POST",body:JSON.stringify(e)})}async listEntries(e,r){let n=new URLSearchParams({contextId:e});return r?.limit&&n.set("limit",String(r.limit)),r?.cursorAfter&&n.set("cursorAfter",r.cursorAfter),r?.entryType&&n.set("entryType",r.entryType),this.request(`/context-entries?${n.toString()}`)}async optimisticUpdate(e,r,n,o){for(let i=0;i<3;i++){let a=await this.getContext(e),c=a.content??"",u=r(c);try{return await this.updateContext(e,{content:u,version:a.version,source:n,sourceRef:o})}catch(l){if((l instanceof Error?l.message:String(l)).includes("409")&&i<2)continue;throw l}}throw new Error("OCC: max retries exceeded")}async populate(e,r,n){return this.request("/contexts/populate",{method:"POST",body:JSON.stringify({teamId:this.teamId,projectId:this.projectId,nodes:e,dryRun:r,source:n})})}async approveContext(e){await this.request(`/contexts/${encodeURIComponent(e)}/approve?action=approve`,{method:"POST"})}async deprecateContext(e){await this.request(`/contexts/${encodeURIComponent(e)}/approve?action=deprecate`,{method:"POST"})}async getTree(){return this.request(`/contexts/tree?teamId=${encodeURIComponent(this.teamId)}&projectId=${encodeURIComponent(this.projectId)}`)}async createLink(e,r,n,o,s){await this.request("/context-links",{method:"POST",body:JSON.stringify({teamId:this.teamId,projectId:this.projectId,fromSchemaKey:e,toSchemaKey:r,linkType:n,reason:o,confidence:s,source:"mcp"})})}async getLinks(e,r){let n=new URLSearchParams({teamId:this.teamId,projectId:this.projectId,schemaKey:e});return r&&n.set("direction",r),this.request(`/context-links?${n.toString()}`)}async compactContext(e){return this.request(`/contexts/${encodeURIComponent(e)}/compact`,{method:"POST"})}static generateUlid(){return _y()}};var Si=require("node:crypto"),ki=class{baseUrl;apiKey;projectId;hmacSecret;brainETag=null;brainCache=null;constructor(e){this.apiKey=e.apiKey,this.baseUrl=(e.apiUrl??"https://contox.dev").replace(/\/$/,""),this.projectId=e.projectId,this.hmacSecret=e.hmacSecret??null}async getBrain(e){let r=new URLSearchParams({projectId:this.projectId});e?.minConfidence!==void 0&&r.set("minConfidence",String(e.minConfidence)),e?.limit!==void 0&&r.set("limit",String(e.limit)),e?.tokenBudget!==void 0&&r.set("tokenBudget",String(e.tokenBudget));let n={};this.brainETag&&(n["If-None-Match"]=this.brainETag);let o=`${this.baseUrl}/api/v2/brain?${r.toString()}`,s=await fetch(o,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...n}});if(s.status===304&&this.brainCache)return this.brainCache;if(!s.ok){let a=await s.json().catch(()=>({})),c=typeof a.error=="string"?a.error:s.statusText;throw new Error(`V2 brain error (${String(s.status)}): ${c}`)}let i=await s.json();return this.brainETag=s.headers.get("etag"),this.brainCache=i,i}async search(e,r){let n=new URLSearchParams({projectId:this.projectId,q:e});return r?.limit!==void 0&&n.set("limit",String(r.limit)),r?.minSimilarity!==void 0&&n.set("minSimilarity",String(r.minSimilarity)),this.request(`/v2/search?${n.toString()}`)}async listItems(e){let r=new URLSearchParams({projectId:this.projectId});return e?.type&&r.set("type",e.type),e?.schemaKey&&r.set("schemaKey",e.schemaKey),e?.status&&r.set("status",e.status),e?.limit!==void 0&&r.set("limit",String(e.limit)),e?.offset!==void 0&&r.set("offset",String(e.offset)),this.request(`/v2/items?${r.toString()}`)}async getItem(e,r){let n=r?"?includeEmbedding=true":"";return this.request(`/v2/items/${encodeURIComponent(e)}${n}`)}async ingest(e){if(!this.hmacSecret)throw new Error("V2_HMAC_SECRET is required for V2 ingest");let r=JSON.stringify(e),n=new Date().toISOString(),o=(0,Si.randomUUID)(),s=(0,Si.createHmac)("sha256",this.hmacSecret).update(r).digest("hex");return this.request("/v2/ingest",{method:"POST",body:JSON.stringify({source:"mcp-server",timestamp:n,nonce:o,signature:s,projectId:this.projectId,event:e,skipEnrichment:!0})})}async analyzeHygiene(e){return this.request("/v2/hygiene",{method:"POST",body:JSON.stringify({action:"analyze",mode:e.mode,scope:{teamId:e.teamId,projectId:this.projectId},filters:e.schemaKeyPrefix?{schemaKeyPrefix:e.schemaKeyPrefix}:void 0})})}async applyHygiene(e){return this.request("/v2/hygiene",{method:"POST",body:JSON.stringify({action:"apply",scope:{teamId:e.teamId,projectId:this.projectId},plan:e.plan,selectedActionIds:e.selectedActionIds,dryRun:e.dryRun??!1})})}async autoResolve(e,r){return this.request("/v2/auto-resolve",{method:"POST",body:JSON.stringify({projectId:this.projectId,commits:e,dryRun:r??!1})})}async ask(e){return this.request("/v2/ask",{method:"POST",body:JSON.stringify({projectId:this.projectId,question:e})})}async request(e,r={}){let n=`${this.baseUrl}/api${e}`,o=await fetch(n,{...r,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...r.headers}});if(!o.ok){let s=await o.json().catch(()=>({})),i=typeof s.error=="string"?s.error:o.statusText;throw new Error(`V2 API error (${String(o.status)}): ${i}`)}return o.json()}};var vy=[{id:"architecture",name:"Architecture",description:"Tech stack, architecture decisions, design patterns, project structure, infrastructure",order:0},{id:"conventions",name:"Conventions & Rules",description:"Coding conventions, style rules, linter gotchas, naming patterns, team agreements",order:1},{id:"implementation",name:"Implementation Log",description:"Features built, components created, APIs implemented, integrations added",order:2},{id:"decisions",name:"Technical Decisions",description:"Key decisions with rationale: why X over Y, trade-offs considered, constraints",order:3},{id:"bugs",name:"Bugs & Fixes",description:"Bugs found and how they were fixed, edge cases discovered, workarounds applied",order:4},{id:"todo",name:"Todo & Next Steps",description:"Pending tasks, known issues, planned improvements, tech debt to address",order:5},{id:"sessions",name:"Session Log",description:"Chronological log of all AI sessions with date and summary",order:6}];async function xy(t,e={}){let r=e.since??new Date(Date.now()-864e5).toISOString(),n=[];n.push("# On-Call View"),n.push(""),n.push(`> Since: ${r}`),n.push("");try{let o=await t.findBySchemaKey("root/sessions");if(o){let s=await t.listEntries(o.id,{limit:5});if(n.push("## Recent Sessions"),n.push(""),s.entries.length===0)n.push("No recent sessions.");else for(let i of s.entries)n.push(`- **${i.title}** (${i.createdAt})`),i.tags&&i.tags.length>0&&n.push(`  Tags: ${i.tags.join(", ")}`);n.push("")}}catch{n.push("## Recent Sessions"),n.push(""),n.push("_Unable to fetch sessions._"),n.push("")}try{let o=await t.listContexts({state:"draft"}),s=new Date(Date.now()-7*24*60*60*1e3).toISOString(),i=o.filter(a=>(a.createdAt??"")<s);if(n.push("## Stale Drafts (>7 days)"),n.push(""),i.length===0)n.push("No stale drafts.");else{n.push(`Found ${i.length} stale draft(s):`),n.push("");for(let a of i.slice(0,10))n.push(`- **${a.name}** (schemaKey: ${a.schemaKey??"none"}, created: ${a.createdAt??"unknown"})`);i.length>10&&n.push(`- ... and ${i.length-10} more`)}n.push("")}catch{n.push("## Stale Drafts"),n.push(""),n.push("_Unable to fetch drafts._"),n.push("")}try{let o=await t.findBySchemaKey("root/bugs");if(o){let s=await t.listEntries(o.id,{limit:5});if(n.push("## Recent Bugs"),n.push(""),s.entries.length===0)n.push("No recent bugs recorded.");else for(let i of s.entries)n.push(`- **${i.title}** (${i.createdAt})`);n.push("")}}catch{n.push("## Recent Bugs"),n.push(""),n.push("_Unable to fetch bugs._"),n.push("")}try{let s=(await t.getTree()).total,i=await t.listContexts(),a=i.filter(l=>l.state==="approved").length,c=i.filter(l=>l.state==="draft").length,u=i.filter(l=>l.state==="deprecated").length;n.push("## Brain Health"),n.push(""),n.push("| Metric | Value |"),n.push("|--------|-------|"),n.push(`| Total contexts | ${s} |`),n.push(`| Approved | ${a} |`),n.push(`| Draft | ${c} |`),n.push(`| Deprecated | ${u} |`),n.push("")}catch{n.push("## Brain Health"),n.push(""),n.push("_Unable to fetch brain stats._"),n.push("")}return n.join(`
`)}var XP=new Map,md={schemaKey:"root",name:"Project Memory",contextType:"system",tier:1,order:0,description:"Root context \u2014 project overview and metadata",storageModel:"content",writePolicy:"mcp",children:[{schemaKey:"root/cortex",name:"Cortex",contextType:"system",tier:1,order:1,description:"Auto-generated project summary \u2014 current focus, recent sessions",storageModel:"content",writePolicy:"mcp"},{schemaKey:"root/stack",name:"Stack & Infrastructure",contextType:"reference",tier:1,order:2,description:"Tech stack, architecture decisions, design patterns, project structure",storageModel:"content",writePolicy:"both",children:[{schemaKey:"root/stack/database",name:"Database Schema",contextType:"reference",tier:2,order:0,description:"Database schema, collections, indexes, relationships",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/stack/environment",name:"Environment & Config",contextType:"reference",tier:2,order:1,description:"Environment variables, configuration files, deployment settings",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/stack/deployment",name:"Deployment & CI/CD",contextType:"reference",tier:2,order:2,description:"Deployment setup, CI/CD pipelines, hosting infrastructure",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/api",name:"API Surface",contextType:"reference",tier:1,order:3,description:"API endpoints, request/response schemas, authentication",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/backend/auth",linkType:"see-also"},{toSchemaKey:"root/stack/database",linkType:"depends-on"}],children:[{schemaKey:"root/api/auth",name:"Auth & User Endpoints",contextType:"reference",tier:2,order:0,description:"Authentication, registration, password reset, session management",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/api/core",name:"Core Resource Endpoints",contextType:"reference",tier:2,order:1,description:"CRUD endpoints for core business entities",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/api/integrations",name:"Integration Endpoints",contextType:"reference",tier:2,order:2,description:"Third-party integration endpoints (Slack, VS Code, etc.)",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/frontend",name:"Frontend Architecture",contextType:"reference",tier:1,order:4,description:"Frontend components, pages, hooks, design system",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/frontend/design",linkType:"depends-on"},{toSchemaKey:"root/api",linkType:"see-also"}],children:[{schemaKey:"root/frontend/ui",name:"UI Component Library",contextType:"reference",tier:2,order:0,description:"Reusable UI components, their props and usage patterns",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/frontend/pages",name:"Page Components & Routes",contextType:"reference",tier:2,order:1,description:"Page-level components and routing structure",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/frontend/hooks",name:"Hooks & State Management",contextType:"reference",tier:2,order:2,description:"Custom hooks, state management patterns, data fetching",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/frontend/design",name:"Design System Tokens",contextType:"reference",tier:2,order:3,description:"Colors, typography, spacing, design tokens and variables",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/backend",name:"Backend Architecture",contextType:"reference",tier:1,order:5,description:"Backend modules, business logic, external integrations",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/stack/database",linkType:"depends-on"},{toSchemaKey:"root/api",linkType:"see-also"}],children:[{schemaKey:"root/backend/auth",name:"Auth & Security",contextType:"reference",tier:2,order:0,description:"Authentication middleware, RBAC, security patterns",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/backend/logic",name:"Business Logic Modules",contextType:"reference",tier:2,order:1,description:"Core business logic, validation, data processing",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/backend/integrations",name:"External Integrations",contextType:"reference",tier:2,order:2,description:"Third-party service integrations (Stripe, Appwrite, etc.)",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/packages",name:"Packages & Extensions",contextType:"reference",tier:1,order:6,description:"MCP server, CLI, Claude plugin, VS Code extension",storageModel:"content",writePolicy:"scanner",children:[{schemaKey:"root/packages/mcp",name:"MCP Server Package",contextType:"reference",tier:2,order:0,description:"MCP server implementation, tools, API client",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/packages/cli",name:"CLI Package",contextType:"reference",tier:2,order:1,description:"CLI commands, options, configuration",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/packages/plugin",name:"Claude Plugin Package",contextType:"reference",tier:2,order:2,description:"Claude Code plugin configuration and marketplace metadata",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/packages/vscode",name:"VS Code Extension",contextType:"reference",tier:2,order:3,description:"VS Code extension functionality and configuration",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/conventions",name:"Conventions & Patterns",contextType:"memory",tier:1,order:7,description:"Coding conventions, style rules, naming patterns, team agreements",storageModel:"entries",writePolicy:"both"},{schemaKey:"root/decisions",name:"Architecture Decisions",contextType:"memory",tier:1,order:8,description:"Key decisions with rationale: why X over Y, trade-offs, constraints",storageModel:"entries",writePolicy:"both"},{schemaKey:"root/todo",name:"Active Todo & Roadmap",contextType:"memory",tier:1,order:9,description:"Pending tasks, known issues, planned improvements, tech debt",storageModel:"entries",writePolicy:"both"},{schemaKey:"root/bugs",name:"Bug Registry",contextType:"memory",tier:1,order:10,description:"Bugs found and how they were fixed, edge cases, workarounds",storageModel:"entries",writePolicy:"mcp"},{schemaKey:"root/journal",name:"Implementation Journal",contextType:"memory",tier:2,order:11,description:"Features built, components created, APIs implemented",storageModel:"entries",writePolicy:"mcp"},{schemaKey:"root/sessions",name:"Session Chronicle",contextType:"system",tier:2,order:12,description:"Chronological log of all AI sessions with date and summary",storageModel:"entries",writePolicy:"mcp"},{schemaKey:"root/contracts",name:"API Contracts",contextType:"reference",tier:1,order:13,description:"Contract documents per domain \u2014 identity, IO, invariants, failure modes, SLOs",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/api",linkType:"depends-on"}],children:[{schemaKey:"root/contracts/auth",name:"Auth Contract",contextType:"reference",tier:2,order:0,description:"Cookie/bearer auth, derivation, RBAC contract",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/backend/auth",linkType:"see-also"}]},{schemaKey:"root/contracts/brain-endpoint",name:"Brain Endpoint Contract",contextType:"reference",tier:2,order:1,description:"GET /brain contract \u2014 ETag, tier assembly, token budget",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/entries",name:"Entries Contract",contextType:"reference",tier:2,order:2,description:"Context entries CRUD \u2014 ULID ordering, idempotency, cursor pagination",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/populate",name:"Populate Contract",contextType:"reference",tier:2,order:3,description:"Batch upsert contract \u2014 diffStats, dryRun, contentHash dedup",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/search",name:"Search Contract",contextType:"reference",tier:2,order:4,description:"Unified search contract \u2014 proof objects, relevance, link boost",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/links",name:"Links Contract",contextType:"reference",tier:2,order:5,description:"Context links CRUD \u2014 bidirectional queries, confidence scoring",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/contracts/compaction",name:"Compaction Contract",contextType:"reference",tier:2,order:6,description:"Entries compaction contract \u2014 rolling summary, no deletion",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/runbooks",name:"Runbooks",contextType:"reference",tier:1,order:14,description:"Operational runbooks for incident response and diagnostics",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/ops",linkType:"see-also"}],children:[{schemaKey:"root/runbooks/brain-5xx",name:"Runbook: Brain 5xx",contextType:"reference",tier:2,order:0,description:"Brain endpoint returns 500 \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/populate-stuck",name:"Runbook: Populate Stuck",contextType:"reference",tier:2,order:1,description:"Populate run stuck or failing \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/search-low-recall",name:"Runbook: Search Low Recall",contextType:"reference",tier:2,order:2,description:"Search returns poor results \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/drafts-never-approved",name:"Runbook: Drafts Never Approved",contextType:"reference",tier:2,order:3,description:"Draft contexts accumulate without approval \u2014 diagnosis",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/audit-mismatch",name:"Runbook: Audit Mismatch",contextType:"reference",tier:2,order:4,description:"Mutation audit log inconsistent \u2014 diagnosis and resolution",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/runbooks/appwrite-throttling",name:"Runbook: Appwrite Throttling",contextType:"reference",tier:2,order:5,description:"Appwrite rate limits hit \u2014 diagnosis and mitigation",storageModel:"content",writePolicy:"scanner"}]},{schemaKey:"root/ops",name:"Operations & SLOs",contextType:"reference",tier:1,order:15,description:"SLOs per CUJ, error budget policy, golden signals, observability",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/contracts",linkType:"depends-on"}]},{schemaKey:"root/security",name:"Security & Threat Model",contextType:"reference",tier:1,order:16,description:"STRIDE threat model, ASVS checklist, auth surface, mitigations",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/backend/auth",linkType:"see-also"}]},{schemaKey:"root/governance",name:"Data Governance",contextType:"reference",tier:1,order:17,description:"Lifecycle rules, immutable fields, integrity jobs, state machine",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/quality",name:"Quality Gates",contextType:"reference",tier:1,order:18,description:"Test suites, contract tests, retrieval eval, populate gates",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/performance",name:"Performance & Cost",contextType:"reference",tier:1,order:19,description:"Token budgets, degradation strategy, cheap retrieval, cost tracking",storageModel:"content",writePolicy:"scanner"},{schemaKey:"root/patterns",name:"Patterns Cookbook",contextType:"reference",tier:1,order:20,description:"Canonical code patterns with snippets \u2014 OCC, idempotency, ETag, pagination",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/conventions",linkType:"see-also"}]},{schemaKey:"root/flows",name:"Data Flows",contextType:"reference",tier:1,order:21,description:"Mermaid sequence diagrams for critical paths \u2014 auth, save, populate, search",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/api",linkType:"see-also"}]},{schemaKey:"root/schema",name:"DB Schema Docs",contextType:"reference",tier:1,order:22,description:"Appwrite collections, attributes, types, indexes with justifications",storageModel:"content",writePolicy:"scanner",links:[{toSchemaKey:"root/stack/database",linkType:"see-also"}]},{schemaKey:"root/adrs",name:"Architecture Decision Records",contextType:"memory",tier:1,order:23,description:"Formal ADRs \u2014 context, options, decision, tradeoffs, consequences",storageModel:"content",writePolicy:"both",links:[{toSchemaKey:"root/decisions",linkType:"see-also"}]}]};function by(t){if(XP.set(t.schemaKey,t),t.children)for(let e of t.children)by(e)}by(md);function $y(t,e){if(t.schemaKey===e)return t;if(t.children)for(let r of t.children){let n=$y(r,e);if(n)return n}return null}async function wy(t,e){let r=[];r.push(`# Explain: ${e}`),r.push("");let n=$y(md,e);if(n){if(r.push("## Schema Metadata"),r.push(""),r.push("| Property | Value |"),r.push("|----------|-------|"),r.push(`| SchemaKey | \`${n.schemaKey}\` |`),r.push(`| Name | ${n.name} |`),n.tier!==void 0&&r.push(`| Tier | ${n.tier} |`),n.contextType&&r.push(`| Context Type | ${n.contextType} |`),n.writePolicy&&r.push(`| Write Policy | ${n.writePolicy} |`),n.storageModel&&r.push(`| Storage Model | ${n.storageModel} |`),n.description&&r.push(`| Description | ${n.description} |`),n.children&&r.push(`| Children | ${n.children.length} |`),r.push(""),n.links&&n.links.length>0){r.push("### Links (Schema-Declared)"),r.push("");for(let o of n.links)r.push(`- **${o.linkType}** \u2192 \`${o.toSchemaKey}\``);r.push("")}}else r.push("> SchemaKey not found in brain-schema.ts"),r.push("");try{let o=await t.findBySchemaKey(e);if(o){if(r.push("## Context"),r.push(""),r.push("| Property | Value |"),r.push("|----------|-------|"),r.push(`| ID | ${o.id} |`),r.push(`| State | ${o.state??"unknown"} |`),r.push(`| Version | ${o.version??0} |`),o.contentHash&&r.push(`| Content Hash | ${o.contentHash.slice(0,12)}... |`),o.lastEntryAt&&r.push(`| Last Entry | ${o.lastEntryAt} |`),r.push(""),o.content){let s=o.content.length>500?o.content.slice(0,500)+"...":o.content;r.push("### Content Preview"),r.push(""),r.push(s),r.push("")}try{let s=await t.getLinks(e);if(s.outgoing.length>0||s.incoming.length>0){if(r.push("## Links (Runtime)"),r.push(""),s.outgoing.length>0){r.push("**Outgoing:**");for(let i of s.outgoing)r.push(`- ${i.linkType} \u2192 \`${i.toSchemaKey}\``);r.push("")}if(s.incoming.length>0){r.push("**Incoming:**");for(let i of s.incoming)r.push(`- ${i.linkType} \u2190 \`${i.fromSchemaKey}\``);r.push("")}}}catch{}try{let s=await t.listEntries(o.id,{limit:5});if(s.entries.length>0){r.push("## Recent Entries"),r.push("");for(let i of s.entries){r.push(`### ${i.title}`),r.push(`> ${i.entryType??"entry"} | ${i.createdAt}`);let a=i.content.length>200?i.content.slice(0,200)+"...":i.content;r.push(a),r.push("")}}}catch{}}else r.push("## Context"),r.push(""),r.push("_No context found for this schemaKey in the current project._"),r.push("")}catch(o){r.push("## Context"),r.push(""),r.push(`_Error fetching context: ${String(o)}_`),r.push("")}if(e.startsWith("root/contracts/")){r.push("## Related Contract"),r.push("");let o=e.replace("root/contracts/","");r.push(`This is a contract domain. See generated contract: \`generated/contracts/${o}.md\``),r.push("")}else{let o=e.replace("root/","").split("/")[0];if(o)try{await t.findBySchemaKey(`root/contracts/${o}`)&&(r.push("## Related Contract"),r.push(""),r.push(`See: \`root/contracts/${o}\``),r.push(""))}catch{}}return r.join(`
`)}var Ci=require("node:path"),kn=require("node:fs");var Dt=require("node:fs"),De=require("node:path"),YP=new Set(["node_modules",".next",".git","dist","out","build",".cache",".turbo","coverage",".nyc_output",".storybook","storybook-static","__pycache__",".venv","vendor",".svn",".hg","test-results","playwright-report",".playwright"]),QP=new Set(["package-lock.json","pnpm-lock.yaml","yarn.lock","bun.lockb",".DS_Store","Thumbs.db","nul"]),ez=new Set([".png",".jpg",".jpeg",".gif",".svg",".ico",".webp",".avif",".woff",".woff2",".ttf",".eot",".otf",".mp3",".mp4",".wav",".ogg",".webm",".zip",".tar",".gz",".br",".7z",".rar",".pdf",".doc",".docx",".xls",".xlsx",".exe",".dll",".so",".dylib",".wasm",".map"]),tz=32*1024,rz=[{pattern:/^README\.md$/i,reason:"Project documentation"},{pattern:/^ARCHITECTURE\.md$/i,reason:"Architecture documentation"},{pattern:/^CLAUDE\.md$/i,reason:"AI assistant instructions"},{pattern:/^AGENTS\.md$/i,reason:"AI agent instructions"},{pattern:/^RULES\.md$/i,reason:"Project rules"},{pattern:/^CONTRIBUTING\.md$/i,reason:"Contribution guidelines"},{pattern:/^\.cursorrules$/i,reason:"AI assistant rules"},{pattern:/^\.clinerules$/i,reason:"AI assistant rules"},{pattern:/^Dockerfile$/i,reason:"Container configuration"},{pattern:/^docker-compose\.ya?ml$/i,reason:"Container orchestration"},{pattern:/^\.env\.example$/i,reason:"Environment template"},{pattern:/^schema\.prisma$/i,reason:"Database schema"},{pattern:/^drizzle\.config\.\w+$/i,reason:"Database configuration"}];function nz(t){return YP.has(t)||t.startsWith(".")}function oz(t){if(QP.has(t))return!0;let e=(0,De.extname)(t).toLowerCase();return!!ez.has(e)}function sz(t){for(let{pattern:e,reason:r}of rz)if(e.test(t))return{match:!0,reason:r};return{match:!1,reason:""}}function iz(t){let e=(0,De.extname)(t).toLowerCase();return{".ts":"TypeScript",".tsx":"TypeScript (JSX)",".js":"JavaScript",".jsx":"JavaScript (JSX)",".py":"Python",".rb":"Ruby",".go":"Go",".rs":"Rust",".java":"Java",".kt":"Kotlin",".swift":"Swift",".cs":"C#",".cpp":"C++",".c":"C",".php":"PHP",".vue":"Vue",".svelte":"Svelte",".astro":"Astro",".css":"CSS",".scss":"SCSS",".less":"LESS",".html":"HTML",".md":"Markdown",".json":"JSON",".yaml":"YAML",".yml":"YAML",".toml":"TOML",".xml":"XML",".sql":"SQL",".graphql":"GraphQL",".gql":"GraphQL",".sh":"Shell",".bash":"Shell",".zsh":"Shell",".dockerfile":"Dockerfile"}[e]??null}function az(t,e,r){let n=[],o=[],s=[],i=/export\s+(?:const|function)\s+(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)\b/g,a;for(;(a=i.exec(t))!==null;)n.push(a[1]);let c=/export\s+const\s+(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)\s*=\s*(\w+)\(/g;for(;(a=c.exec(t))!==null;)n.includes(a[1])||n.push(a[1]),s.push(a[2]);let u=/(?:const|let)\s+(\w+Schema)\s*=\s*z\.\w+\(\{([^}]*(?:\{[^}]*\}[^}]*)*)\}\)/g;for(;(a=u.exec(t))!==null;){let d=a[1],m=a[2].replace(/\s+/g," ").trim();o.push(`${d}: { ${m.length>200?m.slice(0,200)+"...":m} }`)}let l=[...new Set(s)];return{path:e,methods:n,filePath:r,schemas:o,middleware:l}}function cz(t,e){let r=(0,De.basename)(e).replace(/\.(tsx|jsx)$/,""),n=null,o=null,s=t.match(/export\s+default\s+function\s+(\w+)/),i=t.match(/export\s+function\s+(\w+)/);s?r=s[1]:i&&(r=i[1]);let a=[/(?:export\s+)?interface\s+(\w*Props\w*)\s*\{([^}]*(?:\{[^}]*\}[^}]*)*)\}/,/(?:export\s+)?type\s+(\w*Props\w*)\s*=\s*\{([^}]*(?:\{[^}]*\}[^}]*)*)\}/];for(let u of a){let l=t.match(u);if(l){let f=l[2].trim().split(`
`).map(m=>m.trim()).filter(m=>m&&!m.startsWith("//")&&!m.startsWith("/*"));f.length>0&&(n=f.slice(0,15).join(`
`),f.length>15&&(n+=`
// ... ${String(f.length-15)} more props`));break}}let c=t.match(/\/\*\*\s*\n([^*]*(?:\*[^/][^*]*)*)\*\/\s*\n\s*(?:export\s+)?(?:default\s+)?function/);return c&&(o=c[1].replace(/^\s*\*\s?/gm,"").trim().split(`
`)[0]??null),{name:r,filePath:e,props:n,description:o}}function Ti(t,e){let r=[],n=null,o=t.match(/^\/\*\*\s*\n([^*]*(?:\*[^/][^*]*)*)\*\/\s*\n/);o&&(n=o[1].replace(/^\s*\*\s?/gm,"").trim().split(`
`)[0]??null);let s=/export\s+(async\s+)?function\s+(\w+)\s*(<[^>]*>)?\s*\(([^)]*)\)\s*:\s*([^\n{]+)/g,i;for(;(i=s.exec(t))!==null;){let f=i[1]?"async ":"",m=i[2],p=i[3]??"",h=i[4].replace(/\s+/g," ").trim(),g=i[5].trim().replace(/\s*\{$/,"");r.push({name:m,signature:`${f}function ${m}${p}(${h}): ${g}`,kind:"function"})}let a=/export\s+const\s+(\w+)\s*(?::\s*[^=]+)?\s*=\s*(async\s+)?\(([^)]*)\)\s*(?::\s*([^\n=>]+))?\s*=>/g;for(;(i=a.exec(t))!==null;){let f=i[1],m=i[2]?"async ":"",p=i[3].replace(/\s+/g," ").trim(),h=i[4]?.trim()??"unknown";r.some(g=>g.name===f)||r.push({name:f,signature:`${m}const ${f} = (${p}): ${h}`,kind:"function"})}let c=/export\s+const\s+(\w+)\s*(?::\s*([^=\n]+))?\s*=/g;for(;(i=c.exec(t))!==null;){let f=i[1],m=i[2]?.trim();r.some(p=>p.name===f)||r.push({name:f,signature:m?`const ${f}: ${m}`:`const ${f}`,kind:"const"})}let u=/export\s+interface\s+(\w+)\s*(?:<[^>]*>)?\s*\{([^}]*(?:\{[^}]*\}[^}]*)*)\}/g;for(;(i=u.exec(t))!==null;){let f=i[1],p=i[2].trim().split(`
`).map(g=>g.trim()).filter(g=>g&&!g.startsWith("//")),h=p.slice(0,8).join("; ");r.push({name:f,signature:`interface ${f} { ${h}${p.length>8?"; ...":""} }`,kind:"interface"})}let l=/export\s+type\s+(\w+)\s*(?:<[^>]*>)?\s*=\s*([^\n;]+)/g;for(;(i=l.exec(t))!==null;){let f=i[1],m=i[2].trim();r.push({name:f,signature:`type ${f} = ${m.length>100?m.slice(0,100)+"...":m}`,kind:"type"})}let d=/export\s+(?:abstract\s+)?class\s+(\w+)(?:\s+extends\s+(\w+))?(?:\s+implements\s+(\w+))?/g;for(;(i=d.exec(t))!==null;){let f=i[1],m=i[2]?` extends ${i[2]}`:"",p=i[3]?` implements ${i[3]}`:"";r.push({name:f,signature:`class ${f}${m}${p}`,kind:"class"})}return{filePath:e,exports:r,description:n}}function Sy(t){let e=[],r=[],n=[],o=[],s=[],i=[],a=[],c=[],u={},l=0,d=0;function f(g,_){if(_>8)return;let x;try{x=(0,Dt.readdirSync)(g)}catch{return}let b=x.sort((k,I)=>{let M=hd((0,De.join)(g,k)),ve=hd((0,De.join)(g,I));return M&&!ve?-1:!M&&ve?1:k.localeCompare(I)});for(let k of b){let I=(0,De.join)(g,k),M=(0,De.relative)(t,I).replace(/\\/g,"/");if(hd(I)){if(nz(k))continue;d++,e.push(M+"/"),f(I,_+1)}else{if(oz(k))continue;l++,e.push(M);let ve=iz(k);if(ve&&(u[ve]=(u[ve]??0)+1),M.startsWith("src/app/")&&(k==="page.tsx"||k==="route.ts")){let te=M.replace("src/app","").replace("/page.tsx","").replace("/route.ts","").replace(/\/\[([^\]]+)\]/g,"/:$1");if(k==="route.ts"){let Pt=Mt(I);Pt&&!Pt.startsWith("[File too large")?r.push(az(Pt,te||"/",M)):r.push({path:te||"/",methods:[],filePath:M,schemas:[],middleware:[]})}else r.push({path:te||"/",methods:["PAGE"],filePath:M,schemas:[],middleware:[]})}if(M.match(/src\/components\/.*\.(tsx|jsx)$/)&&!M.includes(".test.")&&!M.includes(".stories.")){let te=Mt(I);te&&!te.startsWith("[File too large")?n.push(cz(te,M)):n.push({name:(0,De.basename)(M).replace(/\.(tsx|jsx)$/,""),filePath:M,props:null,description:null})}if(M.match(/src\/hooks\/.*\.(ts|js)$/)&&!M.includes(".test.")){let te=Mt(I);te&&!te.startsWith("[File too large")&&s.push(Ti(te,M))}if(M.match(/src\/stores\/.*\.(ts|js)$/)&&!M.includes(".test.")){let te=Mt(I);te&&!te.startsWith("[File too large")&&i.push(Ti(te,M))}if(M==="src/middleware.ts"||M==="middleware.ts"){let te=Mt(I);te&&!te.startsWith("[File too large")&&a.push(Ti(te,M))}if(M.match(/src\/lib\/.*\.(ts|js)$/)&&!M.includes(".test.")){let te=Mt(I);te&&!te.startsWith("[File too large")?o.push(Ti(te,M)):o.push({filePath:M,exports:[],description:null})}let Xe=sz(k);if(Xe.match){let te=Mt(I);te&&c.push({path:M,content:te,reason:Xe.reason})}}}}f(t,0);let m=ky((0,De.join)(t,"package.json")),p=ky((0,De.join)(t,"tsconfig.json")),h=Mt((0,De.join)(t,".env.example"));return{root:t,tree:e,packageJson:m,tsConfig:p,envExample:h,routes:r,components:n,libs:o,hooks:s,stores:i,middlewares:a,keyFiles:c,stats:{totalFiles:l,totalDirs:d,languages:u}}}function hd(t){try{return(0,Dt.statSync)(t).isDirectory()}catch{return!1}}function Mt(t){try{if(!(0,Dt.existsSync)(t))return null;let e=(0,Dt.statSync)(t);return e.size>tz?`[File too large: ${Math.round(e.size/1024)}KB]`:(0,Dt.readFileSync)(t,"utf-8")}catch{return null}}function ky(t){let e=Mt(t);if(!e||e.startsWith("[File too large"))return null;try{return JSON.parse(e)}catch{return null}}var bn=require("node:path");function gd(t){return Math.ceil(t.length/4)}function zy(t){let e=t.packageJson?String(t.packageJson.name??(0,bn.basename)(t.root)):(0,bn.basename)(t.root),r=[],n=new Date().toISOString(),o=dz(t),s=t.routes.filter(a=>!a.methods.includes("PAGE")),i=t.routes.filter(a=>a.methods.includes("PAGE"));{let a=[];a.push(`# ${e} \u2014 Project Overview
`),a.push(`> Scanned: ${n}
`),t.packageJson?.description&&a.push(`**Description**: ${String(t.packageJson.description)}
`),o.length>0&&a.push(`**Stack**: ${o.join(", ")}
`),a.push(`**Stats**: ${String(t.stats.totalFiles)} files, ${String(t.stats.totalDirs)} directories`),a.push(`**Routes**: ${String(s.length)} API endpoints, ${String(i.length)} pages`),a.push(`**Components**: ${String(t.components.length)} React components`),a.push(`**Libraries**: ${String(t.libs.length)} modules in src/lib/`),t.hooks.length>0&&a.push(`**Hooks**: ${String(t.hooks.length)} custom hooks`),t.stores.length>0&&a.push(`**Stores**: ${String(t.stores.length)} state stores`),a.push("");let c=Object.entries(t.stats.languages).sort(([,u],[,l])=>l-u).slice(0,8);c.length>0&&a.push("**Languages**: "+c.map(([u,l])=>`${u} (${String(l)})`).join(", ")+`
`),a.push(`## Project Structure
`),a.push("```"),a.push(pz(t.tree)),a.push("```\n"),a.push(`## Architecture Notes
`),t.routes.some(u=>u.middleware.includes("withRateLimit"))&&a.push("- API routes use `withRateLimit` middleware for rate limiting"),t.routes.some(u=>u.schemas.length>0)&&a.push("- Request validation via Zod schemas"),t.middlewares.length>0&&a.push("- Next.js middleware active at `src/middleware.ts`"),t.stores.length>0&&a.push(`- Client state management: ${String(t.stores.length)} Zustand stores`),t.hooks.length>0&&a.push(`- ${String(t.hooks.length)} custom React hooks in src/hooks/`),a.push(""),r.push({name:"[Scan] Overview",description:`Project overview: ${o.slice(0,3).join(", ")}, ${String(t.stats.totalFiles)} files`,content:a.join(`
`),order:0,schemaKey:"root/scan",tier:1,contextType:"reference"})}if(i.length>0){let a=[];a.push(`## Pages
`),a.push("| Route | File |"),a.push("|-------|------|");for(let c of i.sort((u,l)=>u.path.localeCompare(l.path)))a.push(`| \`${c.path}\` | ${c.filePath} |`);a.push(""),r.push({name:"[Scan] Pages & Routes",description:`${String(i.length)} Next.js page routes`,content:a.join(`
`),order:1,schemaKey:"root/frontend/pages",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"})}if(s.length>0){let a=s.filter(m=>/^\/api\/(auth|user|team|orgs)/.test(m.path)),c=s.filter(m=>/^\/api\/(contexts|projects|context-entries|context-links)/.test(m.path)),u=s.filter(m=>/^\/api\/(billing|integrations|webhooks|keys|ai)/.test(m.path)),l=new Set([...a,...c,...u]),d=s.filter(m=>!l.has(m)),f=d.length>0?Pi("API: System & Admin",d):`## API Overview

${String(s.length)} API endpoints across ${String(a.length>0?1:0)+String(c.length>0?1:0)+String(u.length>0?1:0)} domains.`;r.push({name:"[Scan] API: System",description:`${String(s.length)} total API endpoints (${String(d.length)} system)`,content:f,order:2,schemaKey:"root/api",tier:2,contextType:"reference"}),a.length>0&&r.push({name:"[Scan] API: Auth & User",description:`${String(a.length)} endpoints: auth, user, team, orgs`,content:Pi("API: Auth & User Management",a),order:3,schemaKey:"root/api/auth",parentSchemaKey:"root/api",tier:2,contextType:"reference"}),c.length>0&&r.push({name:"[Scan] API: Core CRUD",description:`${String(c.length)} endpoints: contexts, projects, entries, links`,content:Pi("API: Core CRUD",c),order:4,schemaKey:"root/api/core",parentSchemaKey:"root/api",tier:2,contextType:"reference"}),u.length>0&&r.push({name:"[Scan] API: Integrations",description:`${String(u.length)} endpoints: billing, integrations, webhooks, keys, AI`,content:Pi("API: Integrations",u),order:5,schemaKey:"root/api/integrations",parentSchemaKey:"root/api",tier:2,contextType:"reference"})}if(t.components.length>0){let a=t.components.filter(f=>f.filePath.includes("/contox/")),c=t.components.filter(f=>f.filePath.includes("/ui/")),u=t.components.filter(f=>f.filePath.includes("/pages/")||f.filePath.includes("/landing/")||f.filePath.includes("/providers/")||f.filePath.includes("/skeletons/")||f.filePath.includes("/icons/")),l=new Set([...a,...c,...u]),d=t.components.filter(f=>!l.has(f));if(a.length>0&&r.push({name:"[Scan] Components: Domain",description:`${String(a.length)} domain components (brain, editor, entries, etc.)`,content:zi(a),order:6,schemaKey:"root/frontend",tier:2,contextType:"reference"}),c.length>0&&r.push({name:"[Scan] Components: UI Library",description:`${String(c.length)} UI primitives (buttons, cards, dialogs, etc.)`,content:zi(c),order:7,schemaKey:"root/frontend/ui",parentSchemaKey:"root/frontend",tier:3,contextType:"reference"}),u.length>0){let f=[...u,...d];r.push({name:"[Scan] Components: Pages & Layout",description:`${String(f.length)} page, landing, provider, and layout components`,content:zi(f),order:8,schemaKey:"root/frontend/layout",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"})}else d.length>0&&r.push({name:"[Scan] Components: Other",description:`${String(d.length)} uncategorized components`,content:zi(d),order:8,schemaKey:"root/frontend/layout",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"})}if(t.hooks.length>0&&r.push({name:"[Scan] Hooks",description:`${String(t.hooks.length)} custom React hooks`,content:xn("Custom Hooks (src/hooks/)",t.hooks),order:9,schemaKey:"root/frontend/hooks",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"}),t.stores.length>0&&r.push({name:"[Scan] State Stores",description:`${String(t.stores.length)} Zustand stores`,content:xn("State Stores (src/stores/)",t.stores),order:10,schemaKey:"root/frontend/stores",parentSchemaKey:"root/frontend",tier:2,contextType:"reference"}),t.libs.length>0||t.middlewares.length>0){let a=t.libs.filter(h=>h.filePath.includes("/middleware/")),c=t.libs.filter(h=>/\/(stripe|email|openrouter|rate-limiter|quotas|webhook-dispatcher|activity-logger)/.test(h.filePath)),u=t.libs.filter(h=>h.filePath.includes("/validations/")),l=new Set([...a,...c,...u]),d=t.libs.filter(h=>!l.has(h)),f=t.libs.length+t.middlewares.length,m=[...t.libs,...t.middlewares].reduce((h,g)=>h+g.exports.length,0),p=[];if(p.push(`## Backend Overview
`),p.push(`**${String(f)} modules** \u2014 ${String(m)} exported functions/types
`),p.push("| Category | Count | Key Modules |"),p.push("|----------|-------|-------------|"),d.length>0){let h=d.slice(0,5).map(g=>`\`${(0,bn.basename)(g.filePath).replace(/\.(ts|js)$/,"")}\``).join(", ");p.push(`| Core | ${String(d.length)} | ${h} |`)}if(c.length>0){let h=c.map(g=>`\`${(0,bn.basename)(g.filePath).replace(/\.(ts|js)$/,"")}\``).join(", ");p.push(`| Services | ${String(c.length)} | ${h} |`)}if(u.length>0&&p.push(`| Validations | ${String(u.length)} | Zod schemas for API input |`),a.length>0||t.middlewares.length>0){let h=a.length+t.middlewares.length;p.push(`| Middleware | ${String(h)} | auth-derive, brain-invariants |`)}if(p.push(""),r.push({name:"[Scan] Backend Overview",description:`${String(f)} backend modules, ${String(m)} exports`,content:p.join(`
`),order:11,schemaKey:"root/backend",tier:2,contextType:"reference"}),d.length>0&&r.push({name:"[Scan] Libs: Core",description:`${String(d.length)} core libraries (appwrite, auth, utils, etc.)`,content:xn("Core Libraries",d),order:12,schemaKey:"root/backend/logic",parentSchemaKey:"root/backend",tier:2,contextType:"reference"}),c.length>0&&r.push({name:"[Scan] Libs: Services",description:`${String(c.length)} service integrations (stripe, email, AI, etc.)`,content:xn("Service Integrations",c),order:13,schemaKey:"root/backend/integrations",parentSchemaKey:"root/backend",tier:2,contextType:"reference"}),u.length>0&&r.push({name:"[Scan] Libs: Validations",description:`${String(u.length)} Zod validation schemas`,content:xn("Validation Schemas",u),order:14,schemaKey:"root/backend/validations",parentSchemaKey:"root/backend",tier:2,contextType:"reference"}),a.length>0||t.middlewares.length>0){let h=[...a,...t.middlewares];r.push({name:"[Scan] Auth & Middleware",description:`${String(h.length)} auth/middleware modules`,content:xn("Auth & Middleware",h),order:15,schemaKey:"root/backend/auth",parentSchemaKey:"root/backend",tier:2,contextType:"reference"})}}if(t.packageJson){let a=uz(t.packageJson);if(a){let c=t.packageJson.dependencies;r.push({name:"[Scan] Dependencies",description:`${String(Object.keys(c??{}).length)} runtime deps, npm scripts`,content:a,order:16,schemaKey:"root/stack",tier:2,contextType:"reference"})}}if((t.tsConfig||t.envExample)&&r.push({name:"[Scan] Configuration",description:"TypeScript config, environment variables",content:lz(t),order:17,schemaKey:"root/stack/environment",parentSchemaKey:"root/stack",tier:2,contextType:"reference"}),t.keyFiles.some(a=>a.path.startsWith("packages/"))){let a=t.keyFiles.filter(c=>c.path.startsWith("packages/"));r.push({name:"[Scan] Packages",description:`${String(a.length)} monorepo packages (CLI, MCP, plugins)`,content:Ty(a),order:18,schemaKey:"root/packages",tier:2,contextType:"reference"})}{let a=t.keyFiles.filter(c=>!c.path.startsWith("packages/"));a.length>0&&r.push({name:"[Scan] Documentation",description:`Key docs: ${a.map(c=>c.path).join(", ")}`,content:Ty(a),order:19,schemaKey:"root/scan/docs",parentSchemaKey:"root/scan",tier:3,contextType:"reference"})}return r}function Pi(t,e){let r=[];r.push(`## ${t}
`);for(let n of e.sort((o,s)=>o.path.localeCompare(s.path))){let o=n.methods.length>0?n.methods.join(", "):"UNKNOWN";if(r.push(`### \`${o}\` ${n.path}`),r.push(`> File: \`${n.filePath}\``),n.middleware.length>0&&r.push(`> Middleware: ${n.middleware.map(s=>`\`${s}\``).join(", ")}`),n.schemas.length>0){r.push(`
**Request schemas:**`),r.push("```typescript");for(let s of n.schemas)r.push(s);r.push("```")}r.push("")}return r.join(`
`)}function zi(t){let e=[];e.push(`## Components
`);let r=fz(t.map(o=>o.filePath)),n=new Map(t.map(o=>[o.filePath,o]));for(let[o,s]of r){e.push(`### ${o}
`);for(let i of s){let a=n.get(i);if(!a)continue;let c=a.description?` \u2014 ${a.description}`:"";e.push(`#### \`${a.name}\`${c}`),e.push(`> File: \`${a.filePath}\``),a.props&&(e.push(`
**Props:**`),e.push("```typescript"),e.push(a.props),e.push("```")),e.push("")}}return e.join(`
`)}function xn(t,e){let r=[];r.push(`## ${t}
`);for(let n of e.sort((o,s)=>o.filePath.localeCompare(s.filePath))){let o=(0,bn.basename)(n.filePath).replace(/\.(ts|js)$/,""),s=n.description?` \u2014 ${n.description}`:"";if(r.push(`### \`${o}\`${s}`),r.push(`> File: \`${n.filePath}\``),n.exports.length>0){r.push(""),r.push("```typescript");for(let i of n.exports)r.push(`export ${i.signature}`);r.push("```")}else r.push(`
*No public exports detected*`);r.push("")}return r.join(`
`)}function uz(t){let e=[],r=t.dependencies,n=t.devDependencies;if(r&&Object.keys(r).length>0){e.push(`## Runtime Dependencies
`);let s=Py(r);for(let[i,a]of s)e.push(`**${i}**: ${a.map(([c,u])=>`${c} ${u}`).join(", ")}`);e.push("")}if(n&&Object.keys(n).length>0){e.push(`## Dev Dependencies
`);let s=Py(n);for(let[i,a]of s)e.push(`**${i}**: ${a.map(([c,u])=>`${c} ${u}`).join(", ")}`);e.push("")}let o=t.scripts;if(o&&Object.keys(o).length>0){e.push(`## NPM Scripts
`),e.push("```");for(let[s,i]of Object.entries(o))e.push(`${s}: ${i}`);e.push("```")}return e.length>0?e.join(`
`):null}function lz(t){let e=[];if(t.tsConfig){let r=t.tsConfig.compilerOptions;r&&(e.push(`## TypeScript Configuration
`),e.push("```json"),e.push(JSON.stringify({compilerOptions:r},null,2)),e.push("```\n"))}return t.envExample&&(e.push(`## Environment Variables
`),e.push("```env"),e.push(t.envExample.trim()),e.push("```")),e.join(`
`)}function Ty(t){let e=[];e.push(`## Key Documentation
`);for(let r of t){e.push(`### ${r.path}`),e.push(`> ${r.reason}
`);let n=r.path.split(".").pop()??"",o=n==="md"?"markdown":n;e.push(`\`\`\`${o}`);let s=8e3;r.content.length>s?(e.push(r.content.slice(0,s)),e.push(`
... [truncated, ${String(Math.round(r.content.length/1024))}KB total]`)):e.push(r.content),e.push("```\n")}return e.join(`
`)}function dz(t){let e=[];if(!t.packageJson)return e;let r={...t.packageJson.dependencies??{},...t.packageJson.devDependencies??{}};return r.next?e.push(`Next.js ${r.next}`):r.nuxt?e.push(`Nuxt ${r.nuxt}`):r["@angular/core"]?e.push(`Angular ${r["@angular/core"]}`):r.svelte?e.push(`Svelte ${r.svelte}`):r.astro?e.push(`Astro ${r.astro}`):r.react?e.push(`React ${r.react}`):r.vue&&e.push(`Vue ${r.vue}`),r.typescript&&e.push("TypeScript"),r.tailwindcss?e.push("Tailwind CSS"):r["styled-components"]&&e.push("styled-components"),r.prisma||r["@prisma/client"]?e.push("Prisma"):r["drizzle-orm"]?e.push("Drizzle"):r.mongoose?e.push("MongoDB"):r.pg&&e.push("PostgreSQL"),r.appwrite||r["node-appwrite"]?e.push("Appwrite"):r.firebase||r["firebase-admin"]?e.push("Firebase"):r["@supabase/supabase-js"]&&e.push("Supabase"),r["next-auth"]?e.push("NextAuth"):r["@clerk/nextjs"]&&e.push("Clerk"),r.zustand?e.push("Zustand"):r["@reduxjs/toolkit"]?e.push("Redux"):r.jotai&&e.push("Jotai"),r.vitest?e.push("Vitest"):r.jest&&e.push("Jest"),r.stripe&&e.push("Stripe"),r.resend&&e.push("Resend"),r["@sentry/nextjs"]&&e.push("Sentry"),e}function pz(t){let e=[],r=new Map;r.set("",{dirs:[],fileCount:0});for(let s of t){let i=s.endsWith("/"),a=s.replace(/\/$/,"").split("/");if(i&&a.length<=3){let c=a.slice(0,-1).join("/"),u=a[a.length-1]??"";r.has(c)||r.set(c,{dirs:[],fileCount:0}),r.get(c).dirs.push(u),r.has(s.replace(/\/$/,""))||r.set(s.replace(/\/$/,""),{dirs:[],fileCount:0})}else if(!i){let u=a.slice(0,-1).join("/");for(;u&&!r.has(u);)u=u.split("/").slice(0,-1).join("/");r.has(u)&&r.get(u).fileCount++}}function n(s,i){let a=r.get(s);if(a)for(let c of a.dirs.sort()){let u=s?`${s}/${c}`:c,l=r.get(u),d="  ".repeat(i),f=l?.fileCount?` (${String(l.fileCount)} files)`:"";e.push(`${d}${c}/${f}`),n(u,i+1)}}let o=r.get("");return o?.fileCount&&e.push(`(${String(o.fileCount)} root files)`),n("",0),e.join(`
`)}function fz(t){let e=new Map;for(let r of t){let o=r.split("/").slice(0,3).join("/");e.has(o)||e.set(o,[]),e.get(o).push(r)}return[...e.entries()].sort(([r],[n])=>r.localeCompare(n))}function Py(t){let e=new Map;for(let[n,o]of Object.entries(t)){let s="Other";n.match(/^(next|react|react-dom|vue|nuxt|svelte|astro|@angular)/)?s="Framework":n.match(/^(@dnd-kit|framer-motion|@radix|@headlessui|lucide|@heroicons)/)?s="UI":n.match(/^(tailwindcss|postcss|autoprefixer|sass|styled-)/)?s="Styling":n.match(/^(prisma|drizzle|mongoose|pg|@prisma|typeorm)/)?s="Database":n.match(/^(appwrite|node-appwrite|firebase|@supabase)/)?s="Backend/BaaS":n.match(/^(next-auth|@clerk|passport|bcrypt|jsonwebtoken)/)?s="Auth":n.match(/^(zustand|@reduxjs|jotai|recoil|mobx)/)?s="State":n.match(/^(vitest|jest|@testing|playwright|cypress|@playwright)/)?s="Testing":n.match(/^(typescript|@types\/|eslint|prettier|@eslint)/)?s="Tooling":n.match(/^(stripe|@stripe)/)?s="Payments":n.match(/^(resend|nodemailer|@sendgrid)/)?s="Email":n.match(/^(@sentry|sentry)/)?s="Monitoring":n.match(/^(zod|yup|joi|class-validator)/)?s="Validation":n.match(/^(next-intl|i18next|react-intl)/)?s="i18n":n.match(/^(@storybook|storybook|chromatic)/)&&(s="Storybook"),e.has(s)||e.set(s,[]),e.get(s).push([n,o])}let r=["Framework","Backend/BaaS","Auth","Database","State","UI","Styling","Validation","Payments","Email","i18n","Monitoring","Testing","Storybook","Tooling","Other"];return[...e.entries()].sort(([n],[o])=>{let s=r.indexOf(n),i=r.indexOf(o);return(s===-1?99:s)-(i===-1?99:i)})}var Iy=require("node:child_process"),Ry=require("node:path"),mz=1e4,hz=1024*1024,gz=2048,Ey=5120,yz=200,Cy="\u2039\u2039\u2039COMMIT_SEP\u203A\u203A\u203A",Io="\u2039\u2039\u2039FIELD_SEP\u203A\u203A\u203A",_z=20;function Ie(t,e){try{return(0,Iy.execSync)(`git ${t}`,{cwd:e,encoding:"utf-8",timeout:mz,maxBuffer:hz,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function yd(t,e){return t.length<=e?t:`${t.slice(0,e)}
[...truncated at ${String(e)} chars]`}function vz(t){let e=0;for(let r of t.split(`
`)){let n=r.split("	"),o=parseInt(n[0]??"0",10),s=parseInt(n[1]??"0",10);isNaN(o)||(e+=o),isNaN(s)||(e+=s)}return e}async function xz(t,e){try{let r=await t.findBySchemaKey("root/sessions");if(!r)return null;let n=await t.listEntries(r.id,{limit:1});if(n.entries.length===0)return null;let o=n.entries[0]?.sourceRef;if(!o||!o.startsWith("git:"))return null;let s=o.slice(4);return Ie(`cat-file -t ${s}`,e)!=="commit"?null:s}catch{return null}}function bz(t){if(!t)return[];let e=t.split(Cy).filter(n=>n.trim().length>0),r=[];for(let n of e){let o=n.split(Io);o.length<5||r.push({sha:(o[0]??"").trim(),shortSha:(o[1]??"").trim(),author:(o[2]??"").trim(),date:(o[3]??"").trim(),message:(o[4]??"").trim()})}return r}function $z(t,e){let n=Ie(`show ${t} --name-only --format=`,e).split(`
`).filter(c=>c.trim().length>0),o=Ie(`show ${t} --numstat --format=`,e),s=Ie(`show ${t} --stat --format=`,e),i=vz(o),a=null;if(i>0&&i<yz){let c=Ie(`show ${t} --patch --unified=0 --format=`,e);c&&(a=yd(c,gz))}return{files:n,numstat:o,diffStat:s,patch:a}}function wz(t,e,r){if(!e&&r===0)return null;let n="",o="",s=[];if(e){let i=Ie("diff --cached --stat",t),a=Ie("diff --cached --unified=0",t);n=yd([i,a].filter(Boolean).join(`

`),Ey);let c=Ie("diff --stat",t),u=Ie("diff --unified=0",t);o=yd([c,u].filter(Boolean).join(`

`),Ey)}if(r>0){let i=Ie("ls-files --others --exclude-standard",t);s.push(...i.split(`
`).filter(a=>a.trim().length>0).slice(0,50))}return{staged:n,unstaged:o,untrackedFiles:s}}async function Ei(t,e={}){let r=e.directory?(0,Ry.resolve)(e.directory):process.cwd(),n=e.limit??_z,o=e.mode??"first-parent",s=Ie("rev-parse --show-toplevel",r);if(!s)throw new Error(`Not a git repository: ${r}`);let i=Ie("rev-parse --abbrev-ref HEAD",r),a=Ie("rev-parse HEAD",r),u=Ie("status --porcelain",r).length>0,l=Ie("ls-files --others --exclude-standard",r),d=l?l.split(`
`).filter(Boolean).length:0,f=await xz(t,r),m,p,h=o==="first-parent"?" --first-parent":"";f?(m=`${f.slice(0,7)}..HEAD`,p=`log${h} ${f}..HEAD`):(m=`HEAD~${String(n)}..HEAD`,p=`log${h} -n ${String(n)}`);let g=Ie(`${p} --oneline`,r),_=g?g.split(`
`).filter(Boolean).length:0,x=[Cy,"%H",Io,"%h",Io,"%an",Io,"%aI",Io,"%B"].join(""),b=Ie(`${p} -n ${String(n)} --format=${x}`,r),k=bz(b),I=_>n,M=[];for(let Xe of k){let te=$z(Xe.sha,r);M.push({...Xe,...te})}let ve=wz(r,u,d);return{repoRoot:s,currentBranch:i,headSha:a,isDirty:u,untrackedCount:d,baseSha:f,range:m,mode:o,commits:M,totalUnsaved:_,truncated:I,wip:ve}}function jy(t){let e=[];e.push("# Git Digest"),e.push(""),e.push(`**Branch**: ${t.currentBranch}`),e.push(`**HEAD**: ${t.headSha.slice(0,7)}`),e.push(`**Range**: ${t.range} (${t.mode})`),e.push(`**Unsaved commits**: ${String(t.totalUnsaved)}${t.truncated?` (showing first ${String(t.commits.length)})`:""}`),e.push(`**Dirty**: ${t.isDirty?"yes":"no"}${t.untrackedCount>0?` (${String(t.untrackedCount)} untracked)`:""}`),e.push(""),t.commits.length===0&&e.push("_No unsaved commits._");for(let r of t.commits){if(e.push("---"),e.push(`## ${r.shortSha} \u2014 ${r.message.split(`
`)[0]??""}`),e.push(`**Author**: ${r.author} | **Date**: ${r.date}`),e.push(""),r.message.includes(`
`)){let n=r.message.split(`
`).slice(1).join(`
`).trim();n&&(e.push("**Body**:"),e.push(n),e.push(""))}e.push(`**Files** (${String(r.files.length)}):`);for(let n of r.files)e.push(`- ${n}`);e.push(""),r.diffStat&&(e.push(`**Stat**: ${r.diffStat.split(`
`).pop()??""}`),e.push("")),r.patch!==null&&(e.push("**Patch** (minimal):"),e.push("```diff"),e.push(r.patch),e.push("```"),e.push(""))}if(t.wip&&(e.push("---"),e.push("## WIP (non-committed)"),e.push(""),t.wip.staged&&(e.push("### Staged changes"),e.push("```"),e.push(t.wip.staged),e.push("```"),e.push("")),t.wip.unstaged&&(e.push("### Unstaged changes"),e.push("```"),e.push(t.wip.unstaged),e.push("```"),e.push("")),t.wip.untrackedFiles.length>0)){e.push("### Untracked files");for(let r of t.wip.untrackedFiles)e.push(`- ${r}`);e.push("")}return e.join(`
`)}var wn=require("node:fs"),Ay=require("node:child_process"),$n=require("node:path"),Ny=".contox.json",kz=5e3;function Sz(t=process.cwd()){let e=t;for(let r=0;r<20;r++){let n=(0,$n.join)(e,Ny);if((0,wn.existsSync)(n))try{let s=(0,wn.readFileSync)(n,"utf-8");return JSON.parse(s)}catch{return null}let o=(0,$n.join)(e,"..");if(o===e)break;e=o}return null}function _d(t){try{return(0,Ay.execSync)("git rev-parse --show-toplevel",{cwd:t,encoding:"utf-8",timeout:kz,stdio:["pipe","pipe","pipe"]}).trim()}catch{return null}}function Tz(t){let e=_d(t);return e?(0,$n.basename)(e):null}async function Pz(t,e,r,n){let o=new URLSearchParams({teamId:r,name:n}),s=await fetch(`${e}/api/projects?${o.toString()}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});return s.ok?s.json():[]}async function zz(t,e,r,n){let o=await fetch(`${e}/api/projects`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({name:n,teamId:r})});if(!o.ok){let s=await o.json().catch(()=>({})),i=typeof s.error=="string"?s.error:o.statusText;throw new Error(`Failed to create project "${n}": ${i}`)}return o.json()}function Oy(t,e){try{let r=(0,$n.join)(t,Ny);(0,wn.writeFileSync)(r,JSON.stringify(e,null,2)+`
`,"utf-8")}catch{}}async function Zy(t){let e=t.apiKey??"",r=(t.apiUrl??"https://contox.dev").replace(/\/$/,""),n=t.teamId??"";if(!e)throw new Error("CONTOX_API_KEY is required. Set it as an environment variable.");if(!n)throw new Error("CONTOX_TEAM_ID is required. Set it as an environment variable.");let o=process.cwd(),s=Sz(o);if(s?.projectId)return{apiKey:e,apiUrl:r,teamId:s.teamId||n,projectId:s.projectId};let i=Tz(o);if(i)try{let a=await Pz(e,r,n,i);if(a.length>0){let l=a[0],d=_d(o)??o;return Oy(d,{teamId:n,projectId:l.id,projectName:l.name}),{apiKey:e,apiUrl:r,teamId:n,projectId:l.id}}let c=await zz(e,r,n,i),u=_d(o)??o;return Oy(u,{teamId:n,projectId:c.id,projectName:c.name}),{apiKey:e,apiUrl:r,teamId:n,projectId:c.id}}catch{}if(t.projectId)return{apiKey:e,apiUrl:r,teamId:n,projectId:t.projectId};throw new Error(`Could not resolve project. Either:
  - Add a .contox.json file (run \`contox init\`)
  - Set CONTOX_PROJECT_ID environment variable
  - Run from a git repository directory`)}var Ri=require("node:fs/promises"),Dy=require("node:path"),My="<!-- contox:start -->",vd="<!-- contox:end -->";async function bd(t,e,r,n){try{let o=await Iz(e,r,n),s=(0,Dy.join)(t,"CLAUDE.md"),i="";try{i=await(0,Ri.readFile)(s,"utf-8")}catch{}let a=Ez(i,o);return await(0,Ri.writeFile)(s,a,"utf-8"),!0}catch(o){let s=o instanceof Error?o.message:String(o);return console.error(`[contox] CLAUDE.md update failed: ${s}`),!1}}function Ez(t,e){let r=`${My}
${e}
${vd}`;if(!t.trim())return r+`
`;let n=t.indexOf(My),o=t.indexOf(vd);if(n!==-1&&o!==-1){let i=t.slice(0,n),a=t.slice(o+vd.length);return i+r+a}let s=t.endsWith(`
`)?`
`:`

`;return t+s+r+`
`}async function Iz(t,e,r){let n=[];if(n.push("# Contox \u2014 Auto-generated Project Context"),n.push(""),n.push("> This section is auto-managed by Contox. Do not edit between the markers."),n.push("> Your own content outside the markers is preserved."),n.push(""),n.push("## Memory Protocol"),n.push(""),n.push("### Session Start"),n.push("- Call `contox_get_memory` to load project context from previous sessions"),n.push(""),n.push("### During Session"),n.push('- Use `contox_search "topic"` to find specific memory items about what you\'re working on'),n.push("- Use `contox_context_pack` with a task description for focused, task-relevant context"),n.push("- Use all Contox tools freely to read/write data (create contexts, update, search, scan, etc.)"),n.push("- This pushes information to the Contox platform in real-time"),n.push(""),n.push("### Saving \u2014 USER-INITIATED ONLY"),n.push("- **NEVER** call `contox_save_session` automatically or proactively"),n.push('- Only save when the user explicitly asks (e.g. "save", "save session", "contox save")'),n.push("- The user may be working on multiple tasks in parallel \u2014 auto-saving could mix contexts"),n.push(""),r)n.push(r),n.push("");else if(e)n.push(Ii(e,2e3)),n.push("");else try{let o=await t.listContexts(),s=o.find(c=>c.schemaKey==="root/stack");if(s){let c=await xd(t,s);c&&(n.push("## Project Stack"),n.push(""),n.push(Ii(c,500)),n.push(""))}let i=o.find(c=>c.schemaKey==="root/conventions");if(i){let c=await xd(t,i);c&&(n.push("## Conventions"),n.push(""),n.push(Ii(c,500)),n.push(""))}let a=o.find(c=>c.schemaKey==="root/cortex");if(a){let c=await xd(t,a);c&&(n.push("## Current Focus"),n.push(""),n.push(Ii(c,300)),n.push(""))}}catch{n.push("## Project Context"),n.push(""),n.push("_Run `contox_get_memory` at session start to load full project context._"),n.push("")}return n.join(`
`)}function Ii(t,e){let r=t.trim();if(r.length<=e)return r;let n=r.slice(0,e),o=n.lastIndexOf(`
`);return o>e*.5?n.slice(0,o):n+"..."}async function xd(t,e){if(e.content!=null&&e.content.length>0)return e.content;try{return(await t.getContext(e.id)).content??""}catch{return""}}function qt(t){return Math.ceil(t.length/4)}async function qy(t,e){let{task:r,scope:n,tokenBudget:o}=e,s=[];s.push(`# Context Pack
`),s.push(`> Task: ${r}`),s.push(`> Scope: ${n} | Budget: ~${String(o)} tokens
`);let i=qt(s.join(`
`)),a=o-i-50;if(n==="full"){let l=await t.getBrain({tokenBudget:a});s.push(l.document);let d=l.layers?` | L1: ${String(l.layers.layer1)}, L2: ${String(l.layers.layer2)}, archived: ${String(l.layers.archived)}`:"";return s.push(`
---
_${String(l.itemsLoaded)} items${d} | ~${String(qt(s.join(`
`)))} tokens_`),s.join(`
`)}if(n==="minimal"){let l=await t.listItems({limit:5});if(l.items.length===0)return s.push("_No memory items yet._"),s.join(`
`);for(let d of l.items){let f=Rz(d);if(qt(s.join(`
`)+f)>o)break;s.push(f)}return s.push(`
---
_${String(l.items.length)} items (minimal) | ~${String(qt(s.join(`
`)))} tokens_`),s.join(`
`)}try{let l=await t.getBrain();l.summary&&(s.push(l.summary),s.push(""))}catch{}let c=[];try{c=(await t.search(r,{limit:15,minSimilarity:.6})).results}catch{try{let l=await t.getBrain({tokenBudget:a});return s.push(l.document),s.push(`
---
_Fallback: full brain (search unavailable) | ~${String(qt(s.join(`
`)))} tokens_`),s.join(`
`)}catch{return s.push("_Search and brain unavailable. Use `contox_get_memory` to load project memory._"),s.join(`
`)}}if(c.length===0){let l=await t.getBrain({limit:20,tokenBudget:a});return s.push(l.document),s.push(`
---
_No semantic matches \u2014 showing top items | ~${String(qt(s.join(`
`)))} tokens_`),s.join(`
`)}let u=new Map;for(let l of c){let d=l.schemaKey.split("/").slice(0,2).join("/"),f=u.get(d)??[];f.push(l),u.set(d,f)}for(let[l,d]of u){let f=l.split("/").pop()??l,m=`## ${f.charAt(0).toUpperCase()}${f.slice(1)}
`;if(qt(s.join(`
`)+m)>o)break;s.push(m);for(let p of d){let h=Cz(p);if(qt(s.join(`
`)+h)>o)break;s.push(h)}}return s.push(`
---
_${String(c.length)} relevant items | ~${String(qt(s.join(`
`)))} tokens_`),s.join(`
`)}function Rz(t){let e=[];return e.push(`### ${t.title}`),e.push(`> confidence: ${t.confidence.toFixed(2)} | ${t.schemaKey}`),t.files.length>0&&e.push(`> files: ${t.files.slice(0,5).join(", ")}`),e.push(""),e.push(t.facts),e.push(""),e.join(`
`)}function Cz(t){let e=[];return e.push(`### ${t.title}`),e.push(`> similarity: ${t.similarity.toFixed(3)} | confidence: ${t.confidence.toFixed(2)} | ${t.type}`),t.files.length>0&&e.push(`> files: ${t.files.slice(0,5).join(", ")}`),e.push(""),e.push(t.facts),e.push(""),e.join(`
`)}var ge=new vi({name:"contox",version:"1.1.0"}),de,at;ge.tool("contox_get_memory","Load the complete project memory. Call this at the START of every session to remember previous work. Returns a markdown document with: Architecture, Conventions, Implementation Log, Decisions, Bugs & Fixes, Todo, and Session Log.",{},async()=>{try{let t=await at.getBrain(),e=t.summary||t.document,r=Math.ceil(e.length/4),n=["---",`_${String(t.itemsLoaded)} total items in memory | showing compact overview (~${String(r)} tokens) | hash: ${t.brainHash}_`,"",'> **Tip:** Use `contox_search "your query"` to find specific memory items about what you\'re working on.',"> Use `contox_context_pack` with a task description for focused, task-relevant context."].join(`
`);return{content:[{type:"text",text:`${e}
${n}
`}]}}catch(t){return{content:[{type:"text",text:`Error loading memory: ${String(t)}`}],isError:!0}}});var jz=vy.filter(t=>t.id!=="sessions").map(t=>`"${t.id}": ${t.description}`).join(`
`);ge.tool("contox_save_session",`Save this session's work into persistent project memory.

IMPORTANT: Only call this tool when the user EXPLICITLY asks to save (e.g. "save", "save session", "contox save"). NEVER call it automatically or proactively \u2014 the user may be working on multiple tasks in parallel and needs to control when sessions are saved.

Provide a summary and structured changes. Each change has a category, title, and content.

Available categories:
${jz}

The session log is updated automatically. Content is APPENDED to existing sub-contexts (never overwritten).`,{summary:z.string().describe("Brief session summary (1-3 sentences): what was accomplished"),changes:z.array(z.object({category:z.enum(["architecture","conventions","implementation","decisions","bugs","todo"]).describe("Category for this change"),title:z.string().describe('Brief title (e.g. "Added auth middleware", "Fixed CSS z-index bug")'),content:z.string().describe("Detailed content to save. Use markdown. Be specific and include file paths, patterns, key decisions.")})).describe("List of changes to save, organized by category"),headCommitSha:z.string().optional().describe("HEAD commit SHA at save time (from contox_git_digest). Tracks save position for incremental digests.")},async t=>{try{let e=await at.ingest({type:"mcp_save",summary:t.summary,changes:t.changes,headCommitSha:t.headCommitSha});at.getBrain().then(n=>{bd(process.cwd(),de,n.document,n.summary).catch(()=>{})}).catch(()=>{bd(process.cwd(),de).catch(()=>{})});let r="";return t.headCommitSha&&(Ei(de,{limit:10}).then(n=>{if(n.commits.length>0){let o=n.commits.map(s=>({sha:s.sha,message:s.message,files:s.files}));return at.autoResolve(o)}return null}).then(n=>{n&&n.resolved.length>0&&console.error(`[auto-resolve] Post-save: resolved ${String(n.resolved.length)} memory items`)}).catch(()=>{}),r=`
Auto-resolve running in background \u2014 matching commits against existing memory items.`),{content:[{type:"text",text:["Session saved via V2 pipeline.",`- Event ID: ${e.eventId}`,`- Session: ${e.sessionId}`,'Raw event stored. Enrichment deferred \u2014 user must click "Generate Memory" in the dashboard to trigger the pipeline.',r].join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error saving session: ${String(e)}`}],isError:!0}}});ge.tool("contox_list_contexts","List all contexts for the current project (including sub-contexts)",{},async()=>{try{let e=(await de.listContexts()).map(r=>({id:r.id,name:r.name,description:r.description,parentContextId:r.parentContextId,schemaKey:r.schemaKey,tier:r.tier,state:r.state,tokens:r.tokens,updatedAt:r.updatedAt}));return{content:[{type:"text",text:JSON.stringify(e,null,2)}]}}catch(t){return{content:[{type:"text",text:`Error: ${String(t)}`}],isError:!0}}});ge.tool("contox_get_context","Get a specific context by ID, including its full content",{id:z.string().describe("The context ID")},async t=>{try{let e=await de.getContext(t.id);return{content:[{type:"text",text:JSON.stringify(e,null,2)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ge.tool("contox_create_context","Create a new context manually.",{name:z.string().describe("Context name"),description:z.string().optional().describe("Optional description"),content:z.string().optional().describe("Optional initial content"),parentContextId:z.string().optional().describe("Optional parent context ID for hierarchy")},async t=>{try{let e=await de.createContext({name:t.name,teamId:de.teamId,projectId:de.projectId,description:t.description,parentContextId:t.parentContextId});return t.content&&await de.updateContext(e.id,{content:t.content}),{content:[{type:"text",text:`Context created: ${e.name} (${e.id})`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ge.tool("contox_update_context","Update an existing context (name, description, or content). Content is replaced, not appended.",{id:z.string().describe("The context ID to update"),name:z.string().optional().describe("New name"),description:z.string().optional().describe("New description"),content:z.string().optional().describe("New content (replaces existing)")},async t=>{try{let e={};t.name!==void 0&&(e.name=t.name),t.description!==void 0&&(e.description=t.description),t.content!==void 0&&(e.content=t.content);let r=await de.updateContext(t.id,e);return{content:[{type:"text",text:`Context updated: ${r.name} (${r.id})`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ge.tool("contox_delete_context","Delete a context by ID. This is irreversible.",{id:z.string().describe("The context ID to delete")},async t=>{try{return await de.deleteContext(t.id),{content:[{type:"text",text:`Context deleted: ${t.id}`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ge.tool("contox_search",`Search contexts by name, description, AND content. Use this to find specific code patterns, function signatures, API endpoints, component props, or any information stored in the project memory. Returns matching snippets with surrounding context.

Examples: "useAuth", "stripe", "password reset", "Button props", "GET /api/contexts"`,{query:z.string().describe("Search query \u2014 searches across all context content, names, and descriptions")},async t=>{try{let e=await at.search(t.query,{limit:10,minSimilarity:.65});if(e.results.length===0)return{content:[{type:"text",text:`No results found for "${t.query}" (semantic search, ${String(e.totalCandidates)} candidates)`}]};let r=[];r.push(`Found ${String(e.results.length)} result(s) for "${t.query}" (semantic, ${String(e.totalCandidates)} candidates):
`);for(let n of e.results)r.push(`## ${n.title}`),r.push(`> ${n.type} | similarity: ${n.similarity.toFixed(3)} | confidence: ${n.confidence.toFixed(2)} | ${n.schemaKey}`),n.files.length>0&&r.push(`> files: ${n.files.slice(0,5).join(", ")}`),r.push(""),r.push(n.facts),r.push("");return{content:[{type:"text",text:r.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ge.tool("contox_populate","Populate the brain hierarchy with structured contexts. Used by scanners and CLI to batch-create/update contexts by schemaKey. Created contexts default to state 'draft'. Returns audit trail with runId and diff stats.",{nodes:z.array(z.object({schemaKey:z.string().describe('Unique schema key (e.g. "root/api/auth")'),name:z.string().describe("Display name for the context"),content:z.string().optional().describe("Markdown content"),description:z.string().optional().describe("Brief description"),contextType:z.enum(["system","reference","memory"]).optional().describe("Context type"),tier:z.number().optional().describe("Tier (1=always loaded, 2=on-demand, 3=archive)"),parentSchemaKey:z.string().optional().describe("Parent schema key for hierarchy")})).describe("List of nodes to populate"),dryRun:z.boolean().optional().describe("If true, only return diff stats without writing"),source:z.string().optional().describe('Source identifier (e.g. "cli-scan", "mcp-populate")')},async t=>{try{let e=await de.populate(t.nodes,t.dryRun,t.source);return{content:[{type:"text",text:[`Populate ${t.dryRun?"(dry run) ":""}completed.`,`- Run ID: ${e.runId}`,`- Created: ${String(e.created)}`,`- Updated: ${String(e.updated)}`,`- Unchanged: ${String(e.unchanged)}`,`- Errors: ${String(e.errors)}`].join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ge.tool("contox_add_entry","Add an entry to a journal-like context (bugs, implementation journal, sessions). Entries are INSERT-only (event-sourced) and idempotent via idempotencyKey. Uses client-generated ULID for monotone ordering.",{contextId:z.string().describe("Target context ID"),title:z.string().describe("Entry title (max 200 chars)"),content:z.string().describe("Entry content in markdown"),entryType:z.string().optional().describe('Entry type (e.g. "bug-fix", "feature", "session")'),tags:z.array(z.string()).optional().describe("Tags for categorization"),idempotencyKey:z.string().optional().describe("Idempotency key for retry safety"),source:z.string().optional().describe("Source identifier"),sourceRef:z.string().optional().describe("Source reference (commit SHA, session ID, etc.)")},async t=>{try{let e=await de.createEntry({contextId:t.contextId,title:t.title,content:t.content,entryType:t.entryType,tags:t.tags,idempotencyKey:t.idempotencyKey,source:t.source,sourceRef:t.sourceRef});return{content:[{type:"text",text:`Entry added: ${e.title} (${e.id})`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ge.tool("contox_get_tree","Get the hierarchical brain tree for the current project. Returns a nested tree of contexts with schemaKey, tier, state, contextType, and children. Useful for understanding the project knowledge structure at a glance.",{},async()=>{try{let t=await de.getTree();return{content:[{type:"text",text:JSON.stringify(t.tree,null,2)}]}}catch(t){return{content:[{type:"text",text:`Error: ${String(t)}`}],isError:!0}}});ge.tool("contox_approve","Approve or deprecate a context (state machine). Approved contexts are included in the brain document. Deprecated contexts are hidden. Only works on contexts with a state (draft \u2192 approved \u2192 deprecated).",{id:z.string().describe("The context ID"),action:z.enum(["approve","deprecate"]).describe('"approve" to make visible in brain, "deprecate" to hide')},async t=>{try{return t.action==="approve"?await de.approveContext(t.id):await de.deprecateContext(t.id),{content:[{type:"text",text:`Context ${t.action==="approve"?"approved":"deprecated"}: ${t.id}`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ge.tool("contox_get_links","Get links for a context by its schemaKey. Returns incoming and outgoing links with linkType, reason, and confidence. Links represent relationships between contexts (see-also, depends-on, child-of, related).",{schemaKey:z.string().describe('The schemaKey of the context (e.g. "root/api/auth")'),direction:z.enum(["both","outgoing","incoming"]).optional().describe("Filter direction (default: both)")},async t=>{try{let e=await de.getLinks(t.schemaKey,t.direction),r=[];if(e.outgoing.length>0){r.push(`## Outgoing (${String(e.outgoing.length)})`);for(let n of e.outgoing)r.push(`- \u2192 ${n.toSchemaKey} [${n.linkType}]${n.reason?` \u2014 ${n.reason}`:""}${n.confidence!==null?` (conf: ${String(n.confidence)})`:""}`)}if(e.incoming.length>0){r.push(`## Incoming (${String(e.incoming.length)})`);for(let n of e.incoming)r.push(`- \u2190 ${n.fromSchemaKey} [${n.linkType}]${n.reason?` \u2014 ${n.reason}`:""}${n.confidence!==null?` (conf: ${String(n.confidence)})`:""}`)}return r.length===0&&r.push(`No links found for "${t.schemaKey}"`),{content:[{type:"text",text:r.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ge.tool("contox_add_link",'Create a directed link between two contexts by their schemaKeys. Links form a knowledge graph \u2014 use them to express relationships like "depends-on", "see-also", "child-of", or "related".',{from:z.string().describe('Source schemaKey (e.g. "root/frontend/hooks")'),to:z.string().describe('Target schemaKey (e.g. "root/api/auth")'),linkType:z.enum(["see-also","depends-on","child-of","related"]).describe("Type of relationship"),reason:z.string().optional().describe("Why this link exists"),confidence:z.number().optional().describe("Confidence score 0-1 (e.g. 0.9 = very confident)")},async t=>{try{return await de.createLink(t.from,t.to,t.linkType,t.reason,t.confidence),{content:[{type:"text",text:`Link created: ${t.from} \u2192 ${t.to} [${t.linkType}]`}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ge.tool("contox_compact","Compact entries for a journal-like context (bugs, journal, sessions). Summarizes all entries into a single content block, reducing token count while preserving key information. Use when a context has too many entries.",{id:z.string().describe("The context ID to compact")},async t=>{try{let e=await de.compactContext(t.id);return{content:[{type:"text",text:[`Compaction completed for context ${t.id}:`,`- Entries processed: ${String(e.entriesCount)}`,`- Summary length: ${String(e.summaryLength)} chars`,`- ${e.message}`].join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ge.tool("contox_oncall_view","View on-call operational summary for the current project. Shows recent sessions, stale drafts (>7 days), recent bugs, and brain health stats. Use this for a quick project health check.",{since:z.string().optional().describe("ISO date string \u2014 show data since this time (default: last 24h)")},async t=>{try{return{content:[{type:"text",text:await xy(de,{since:t.since})}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ge.tool("contox_explain_schemakey","Deep-dive into any brain schemaKey. Returns: schema metadata (tier, contextType, writePolicy), context content preview, runtime links (incoming/outgoing), recent entries, and related contracts. Use this to understand any part of the brain.",{schemaKey:z.string().describe('The schemaKey to explain (e.g. "root/contracts/auth", "root/bugs")')},async t=>{try{return{content:[{type:"text",text:await wy(de,t.schemaKey)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ge.tool("contox_scan",`Scan a local codebase directory and push ~15-20 hierarchical sub-contexts to the project brain. Walks the filesystem to extract routes, components, libraries, hooks, stores, dependencies, and key documentation files. Results are organized into granular sub-contexts mapped to brain schemaKeys and pushed via the populate API with content-hash dedup.

Use this to index a codebase so the AI can understand the project structure without reading source files. The scan respects .gitignore-like exclusions (node_modules, .next, dist, etc.) and reads files up to 32KB.`,{directory:z.string().optional().describe("Absolute path to the project root directory to scan. Defaults to the current working directory."),dryRun:z.boolean().optional().describe("If true, scan and build sub-contexts but do not push to the API. Returns what would be created/updated.")},async t=>{try{let e=(0,Ci.resolve)(t.directory??process.cwd());if(!(0,kn.existsSync)(e)||!(0,kn.statSync)(e).isDirectory())return{content:[{type:"text",text:`Error: "${e}" is not a valid directory.`}],isError:!0};let r=(0,kn.existsSync)((0,Ci.resolve)(e,".git")),n=(0,kn.existsSync)((0,Ci.resolve)(e,"package.json"));if(!r&&!n)return{content:[{type:"text",text:"Error: Directory must be a project root (must contain .git or package.json)."}],isError:!0};let o=Sy(e),s=o.routes.filter(_=>!_.methods.includes("PAGE")),i=o.routes.filter(_=>_.methods.includes("PAGE")),a=[...o.libs,...o.hooks,...o.stores].reduce((_,x)=>_+x.exports.length,0),c=zy(o),u=0;for(let _ of c)u+=gd(_.content);let l=[`Scan completed for: ${e}`,`- Files: ${String(o.stats.totalFiles)}, Directories: ${String(o.stats.totalDirs)}`,`- API endpoints: ${String(s.length)}, Pages: ${String(i.length)}`,`- Components: ${String(o.components.length)}, Libraries: ${String(o.libs.length)}, Hooks: ${String(o.hooks.length)}, Stores: ${String(o.stores.length)}`,`- Exported functions/types: ${String(a)}`,`- Key documentation files: ${String(o.keyFiles.length)}`,`- Sub-contexts generated: ${String(c.length)} (~${String(u)} tokens)`];if(t.dryRun){l.push(""),l.push("Sub-contexts (dry run \u2014 not pushed):");for(let _ of c){let x=gd(_.content);l.push(`  - ${_.name} [${_.schemaKey}] (~${String(x)} tokens)`)}return{content:[{type:"text",text:l.join(`
`)}]}}let d=c.sort((_,x)=>{let b=_.schemaKey.split("/").length,k=x.schemaKey.split("/").length;return b!==k?b-k:_.order-x.order}).map(_=>({schemaKey:_.schemaKey,name:_.name,content:_.content,description:_.description,contextType:_.contextType??"reference",tier:_.tier??2,parentSchemaKey:_.parentSchemaKey})),f=50,m=0,p=0,h=0,g=0;for(let _=0;_<d.length;_+=f){let x=d.slice(_,_+f),b=await de.populate(x,!1,"mcp-scan");m+=b.created,p+=b.updated,h+=b.unchanged,g+=b.errors}return l.push(""),l.push("Populate results:"),l.push(`- Created: ${String(m)}`),l.push(`- Updated: ${String(p)}`),l.push(`- Unchanged: ${String(h)}`),g>0&&l.push(`- Errors: ${String(g)}`),{content:[{type:"text",text:l.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error scanning codebase: ${String(e)}`}],isError:!0}}});ge.tool("contox_git_digest",`Read git commits since last save. Returns structured commit data (SHA, message, files, diff stats, smart patches) + WIP evidence for Claude to analyze and enrich before saving.

Uses SHA-based range tracking (not dates) for reliable incremental digests. The base SHA is read from the last session entry's sourceRef field.`,{directory:z.string().optional().describe("Absolute path to the git repo root. Defaults to the current working directory."),limit:z.number().optional().describe("Max commits to return. Default 20."),mode:z.enum(["first-parent","all"]).optional().describe("first-parent (default): clean shipping journal. all: exhaustive including merge commits.")},async t=>{try{let e=await Ei(de,{directory:t.directory,limit:t.limit,mode:t.mode});return{content:[{type:"text",text:jy(e)}]}}catch(e){return{content:[{type:"text",text:`Error reading git digest: ${String(e)}`}],isError:!0}}});ge.tool("contox_context_pack",`Build a focused context pack for the current task. Uses V2 semantic search to find the most relevant memory items and assembles a token-budgeted markdown document.

Scopes:
- "relevant" (default): Semantic search for task-related items only
- "full": Complete brain document, truncated to budget
- "minimal": Top 5 highest-confidence items

Falls back to full brain if semantic search is unavailable.`,{task:z.string().describe("Current task description \u2014 used for semantic search"),scope:z.enum(["full","relevant","minimal"]).default("relevant").describe("How much context to include"),tokenBudget:z.number().default(4e3).describe("Approximate token budget for the pack")},async t=>{try{return{content:[{type:"text",text:await qy(at,{task:t.task,scope:t.scope,tokenBudget:t.tokenBudget})}]}}catch(e){return{content:[{type:"text",text:`Error building context pack: ${String(e)}`}],isError:!0}}});ge.tool("contox_ask",`Ask a natural-language question about your project memory. Uses semantic search to find relevant memory items, then synthesizes a cited answer using an LLM.

Returns a markdown answer with [Source N] citations, the matched sources, similarity scores, and token usage.

Requires embeddings to exist (run a Genesis scan first).`,{question:z.string().min(3).describe("The question to ask about the project memory")},async t=>{try{if(!at)return{content:[{type:"text",text:"Error: V2 API not configured. Set CONTOX_API_KEY and CONTOX_PROJECT_ID."}],isError:!0};let e=await at.ask(t.question);return{content:[{type:"text",text:[e.answer,"","---",`_${String(e.sources.length)} sources | avg similarity: ${(e.avgSimilarity*100).toFixed(0)}% | ${String(e.usage.totalTokens)} tokens | model: ${e.model}_`].join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error asking question: ${String(e)}`}],isError:!0}}});ge.tool("contox_hygiene",`Run the Memory Hygiene Agent to analyze and clean up memory items.

Modes:
- "quick": Analyze the 20 most recent items (fast, low cost)
- "weekly": Analyze all items updated in the last 7 days

The agent proposes safe, minimal edits: rename titles, retag, merge duplicates, deprecate superseded items, flag quality issues, redact secrets. It NEVER auto-applies changes.

Two-phase workflow:
1. Call without "apply" to get a HygienePlan (proposed actions)
2. Call with "apply" + selectedActionIds to execute chosen actions

Each action has a confidence score and requiresHumanApproval flag.`,{mode:z.enum(["quick","weekly"]).default("quick").describe('Analysis mode: "quick" (20 recent items) or "weekly" (last 7 days)'),schemaKeyPrefix:z.string().optional().describe('Filter items by schemaKey prefix (e.g. "root/bugs")'),apply:z.array(z.string()).optional().describe("Action IDs to apply from a previous plan. Omit to analyze only."),plan:z.string().optional().describe("JSON-stringified HygienePlan from a previous analyze call. Required when applying."),dryRun:z.boolean().optional().describe("If true, show what would be applied without executing.")},async t=>{try{let e=process.env.CONTOX_TEAM_ID??"";if(t.apply&&t.apply.length>0){if(!t.plan)return{content:[{type:"text",text:'Error: "plan" is required when applying actions.'}],isError:!0};let o;try{o=JSON.parse(t.plan)}catch{return{content:[{type:"text",text:'Error: "plan" must be valid JSON.'}],isError:!0}}let s=await at.applyHygiene({teamId:e,plan:o,selectedActionIds:t.apply,dryRun:t.dryRun}),i=[`Hygiene Apply ${t.dryRun?"(DRY RUN) ":""}Result:`,`- Applied: ${String(s.appliedActionIds.length)}`,`- Skipped: ${String(s.skippedActionIds.length)}`,`- Errors: ${String(s.errors.length)}`];if(s.errors.length>0){i.push("","Errors:");for(let a of s.errors)i.push(`  - ${a.actionId}: ${a.message}`)}return{content:[{type:"text",text:i.join(`
`)}]}}let r=await at.analyzeHygiene({mode:t.mode,teamId:e,schemaKeyPrefix:t.schemaKeyPrefix}),n=[`Memory Hygiene Report (${t.mode} mode)`,`${"\u2500".repeat(40)}`,`Items analyzed: ${String(r.metrics.totalMemories)}`,`Actions proposed: ${String(r.metrics.actionsCount)}`,`Tokens: ${String(r.usage.promptTokens)}+${String(r.usage.completionTokens)}`,"",r.summary];if(r.warnings.length>0){n.push("","Warnings:");for(let o of r.warnings)n.push(`  \u26A0 ${o}`)}if(r.actions.length>0){n.push("");let o=new Map;for(let s of r.actions){let i=o.get(s.type)??[];i.push(s),o.set(s.type,i)}for(let[s,i]of o){n.push(`${s} (${String(i.length)})`);for(let a of i){let c=a.requiresHumanApproval?" [NEEDS APPROVAL]":"";n.push(`  \u2022 ${a.reason} (confidence: ${String(a.confidence)})${c}`),n.push(`    id: ${a.actionId} | targets: ${a.targetMemoryIds.join(", ")}`)}n.push("")}n.push("To apply actions, call contox_hygiene with:","  apply: [actionId1, actionId2, ...]",`  plan: '${JSON.stringify(r)}'`)}return{content:[{type:"text",text:n.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error: ${String(e)}`}],isError:!0}}});ge.tool("contox_auto_resolve",`Automatically resolve memory items when code fixes are committed. Analyzes recent git commits, matches modified files against existing BugFix/Todo/security memory items, and marks resolved items as archived.

Use this AFTER committing fixes to automatically update the project memory. The tool:
1. Reads recent git commits (since last save)
2. Matches commit files against memory items' file references
3. Uses keyword matching (fix, resolve, patch, secure, etc.) as a secondary signal
4. Archives high-confidence matches, flags medium-confidence ones for review

Supports dry-run mode to preview what would be resolved without making changes.`,{directory:z.string().optional().describe("Absolute path to the git repo root. Defaults to the current working directory."),limit:z.number().optional().describe("Max commits to analyze. Default 20."),dryRun:z.boolean().optional().describe("If true, show what would be resolved without making changes.")},async t=>{try{let e=await Ei(de,{directory:t.directory,limit:t.limit});if(e.commits.length===0)return{content:[{type:"text",text:"No commits found to analyze. Nothing to resolve."}]};let r=e.commits.map(s=>({sha:s.sha,message:s.message,files:s.files})),n=await at.autoResolve(r,t.dryRun),o=[];if(n.dryRun?o.push("# Auto-Resolve (DRY RUN)"):o.push("# Auto-Resolve Results"),o.push(""),o.push(`Analyzed **${String(e.commits.length)}** commits against **${String(n.totalItemsScanned)}** active memory items.`),o.push(""),n.resolved.length===0)o.push("No memory items matched the committed changes.");else{o.push(`## Resolved (${String(n.resolved.length)})`),o.push("");for(let s of n.resolved){let i=s.newStatus==="archived"?"\u2705":"\u{1F50D}";o.push(`${i} **${s.title}** (${s.type})`),o.push(`  - Match: ${s.matchType} | Confidence: ${String(s.confidence)}`),o.push(`  - Commit: ${s.commitSha.slice(0,7)}`),s.matchedFiles.length>0&&o.push(`  - Files: ${s.matchedFiles.join(", ")}`),o.push(`  - Status: ${s.previousStatus} \u2192 ${s.newStatus}`),o.push("")}}if(n.skipped.length>0){o.push(`## Skipped (${String(n.skipped.length)})`);for(let s of n.skipped)o.push(`- ${s.title}: ${s.reason}`);o.push("")}return{content:[{type:"text",text:o.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Error auto-resolving: ${String(e)}`}],isError:!0}}});async function Oz(){let t=await Zy({apiKey:process.env.CONTOX_API_KEY,apiUrl:process.env.CONTOX_API_URL,teamId:process.env.CONTOX_TEAM_ID,projectId:process.env.CONTOX_PROJECT_ID});de=new wi(t),at=new ki({apiKey:t.apiKey??"",apiUrl:t.apiUrl,projectId:t.projectId??"",hmacSecret:process.env.CONTOX_HMAC_SECRET??process.env.V2_HMAC_SECRET_MCP??process.env.V2_HMAC_SECRET});let e=new bi;await ge.connect(e)}Oz().catch(t=>{console.error("Fatal error:",t),process.exit(1)});
